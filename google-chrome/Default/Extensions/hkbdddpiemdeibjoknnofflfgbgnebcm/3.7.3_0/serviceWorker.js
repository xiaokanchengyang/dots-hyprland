const i={originalSubtitleStyle:{fontFamily:"Roboto",fontSize:20,color:[0,0,100,1],background:[0,0,0,1],stroke:[0,0,0,0]},translatedSubtitleStyle:{fontFamily:"Microsoft YaHei",fontSize:20,color:[0,0,100,1],background:[0,0,0,1],stroke:[0,0,0,0]},spacing:0,direction:"column",colorHistory:[[0,71.55,93.73,1],[24.58,91.16,97.65,1],[47.95,91.6,98.04,1],[141.89,66.67,87.06,1],[172.46,78.77,83.14,1],[217.22,76.02,96.47,1],[292.03,51.41,97.65,1]],translatedLanguageCode:null,subtitleMode:"bilingual"},l={},g={...i},u=new Set([...Object.values(l),...Object.keys(g)]),d={},h=(t,s)=>s.split(".").reduce((o,e)=>o&&o[e],t),f=(t,s,o)=>{const e=s.split("."),n=e.pop(),a=e.reduce((r,c)=>(r[c]||(r[c]={}),r[c]),t);a[n]=o},y=async()=>{const t=await chrome.storage.sync.get(),s={...t},o=[];for(const[e,n]of Object.entries(l))t.hasOwnProperty(e)&&(s[n]=t[e],delete s[e]);for(const[e,n]of Object.entries(g))s.hasOwnProperty(e)||(s[e]=n);for(const[e,n]of Object.entries(d)){const a=h(s,e);JSON.stringify(a)!==JSON.stringify(n)&&f(s,e,n)}for(const e of Object.keys(t))u.has(e)||o.push(e);await chrome.storage.sync.set(s),o.length&&await chrome.storage.sync.remove(o)};chrome.runtime.onInstalled.addListener(async t=>{t.reason==="install"?(await chrome.storage.sync.clear(),await chrome.storage.sync.set(i),chrome.storage.local.set({hasVersionUpdate:!0})):t.reason==="update"&&(await y(),chrome.storage.local.set({hasVersionUpdate:!0}))});chrome.runtime.onMessageExternal.addListener((t,s,o)=>{const{type:e,content:n}=t;switch(e){case"getFontList":return chrome.fontSettings.getFontList().then(o),!0;case"getUserSettings":return chrome.storage.sync.get().then(o),!0;case"syncUserSettings":chrome.storage.sync.set(n);break;case"getHasVersionUpdate":chrome.storage.local.get("hasVersionUpdate").then(o);break;case"setHasVersionUpdate":chrome.storage.local.set({hasVersionUpdate:n});break}});
