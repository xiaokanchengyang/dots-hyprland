(()=>{"use strict";const e={blacklist:{urls:{},domains:{"chrome.google.com":!0,extensions:!0}},LayoutSettings:{Resize:!1,RTL:!1,FoldLongContent:!0,SelectTranslatePosition:"TopRight"},languageSetting:{sl:"auto",tl:{ach:"ach",ady:"en",af:"af","af-NA":"af","af-ZA":"af",ak:"aka",am:"am",ar:"ar","ar-AR":"ar","ar-MA":"ar","ar-SA":"ar","ay-BO":"aym",az:"az","az-AZ":"az","be-BY":"be",bg:"bg","bg-BG":"bg",bn:"bn","bn-IN":"bn","bn-BD":"bn","bs-BA":"bs",ca:"ca","ca-ES":"ca",cak:"en",ceb:"ceb","ck-US":"chr",co:"co",cs:"cs","cs-CZ":"cs",cy:"cy","cy-GB":"cy",da:"da","da-DK":"da",de:"de","de-AT":"de","de-DE":"de","de-CH":"de",dsb:"en",el:"el","el-GR":"el",en:"en","en-GB":"en","en-AU":"en","en-CA":"en","en-IE":"en","en-IN":"en","en-PI":"en","en-UD":"en","en-US":"en","en-ZA":"en","en@pirate":"en",eo:"eo","eo-EO":"eo",es:"es","es-AR":"es","es-419":"es","es-CL":"es","es-CO":"es","es-EC":"es","es-ES":"es","es-LA":"es","es-NI":"es","es-MX":"es","es-US":"es","es-VE":"es",et:"et","et-EE":"et",eu:"eu","eu-ES":"eu",fa:"fa","fa-IR":"fa","fb-LT":"en",ff:"en",fi:"fi","fi-FI":"fi","fo-FO":"fao",fr:"fr","fr-CA":"fr","fr-FR":"fr","fr-BE":"fr","fr-CH":"fr","fy-NL":"fy",ga:"ga","ga-IE":"ga",gd:"gd",gl:"gl","gl-ES":"gl","gn-PY":"grn","gu-IN":"gu","gx-GR":"el",ha:"ha",haw:"haw",he:"he","he-IL":"he",hi:"hi","hi-IN":"hi",hmn:"hmn",hr:"hr","hr-HR":"hr",hsb:"en",ht:"ht",hu:"hu","hu-HU":"hu","hy-AM":"hy",id:"id","id-ID":"id",ig:"ig",is:"is","is-IS":"is",it:"it","it-IT":"it",iw:"he",ja:"ja","ja-JP":"ja","jv-ID":"jw","ka-GE":"ka","kk-KZ":"kk",km:"km","km-KH":"km",kab:"kab",kn:"kn","kn-IN":"kn",ko:"ko","ko-KR":"ko","ku-TR":"ku",ky:"ky",la:"la","la-VA":"la",lb:"lb","li-NL":"lim",lo:"lo",lt:"lt","lt-LT":"lt",lv:"lv","lv-LV":"lv",mai:"mai","mg-MG":"mg",mi:"mi",mk:"mk","mk-MK":"mk",ml:"ml","ml-IN":"ml","mn-MN":"mn",mr:"mr","mr-IN":"mr",ms:"ms","ms-MY":"ms",mt:"mt","mt-MT":"mt",my:"my",no:"no",nb:"no","nb-NO":"no",ne:"ne","ne-NP":"ne",nl:"nl","nl-BE":"nl","nl-NL":"nl","nn-NO":"no",ny:"ny",oc:"oci","or-IN":"or",pa:"pa","pa-IN":"pa",pl:"pl","pl-PL":"pl","ps-AF":"ps",pt:"pt","pt-BR":"pt","pt-PT":"pt","qu-PE":"que","rm-CH":"roh",ro:"ro","ro-RO":"ro",ru:"ru","ru-RU":"ru","sa-IN":"san",sd:"sd","se-NO":"sme","si-LK":"si",sk:"sk","sk-SK":"sk",sl:"sl","sl-SI":"sl",sm:"sm",sn:"sn","so-SO":"so",sq:"sq","sq-AL":"sq",sr:"sr","sr-RS":"sr",st:"st",su:"su",sv:"sv","sv-SE":"sv",sw:"sw","sw-KE":"sw",ta:"ta","ta-IN":"ta",te:"te","te-IN":"te",tg:"tg","tg-TJ":"tg",th:"th","th-TH":"th",tl:"fil","tl-PH":"fil",tlh:"tlh",tr:"tr","tr-TR":"tr","tt-RU":"tat",uk:"uk","uk-UA":"uk",ur:"ur","ur-PK":"ur",uz:"uz","uz-UZ":"uz",vi:"vi","vi-VN":"vi","xh-ZA":"xh",yi:"yi","yi-DE":"yi",yo:"yo",zh:"zh-CN","zh-Hans":"zh-CN","zh-Hant":"zh-TW","zh-CN":"zh-CN","zh-HK":"zh-TW","zh-SG":"zh-CN","zh-TW":"zh-TW","zu-ZA":"zu"}[chrome.i18n.getUILanguage()]},OtherSettings:{MutualTranslate:!1,SelectTranslate:!0,TranslateAfterDblClick:!1,TranslateAfterSelect:!1,CancelTextSelection:!1,UseGoogleAnalytics:!0,UsePDFjs:!0},DefaultTranslator:"GoogleTranslate",DefaultPageTranslator:"GooglePageTranslate",HybridTranslatorConfig:{translators:["BaiduTranslate","BingTranslate","GoogleTranslate"],selections:{originalText:"BaiduTranslate",mainMeaning:"BaiduTranslate",tPronunciation:"BaiduTranslate",sPronunciation:"BaiduTranslate",detailedMeanings:"BingTranslate",definitions:"GoogleTranslate",examples:"BaiduTranslate"}},TranslateResultFilter:{mainMeaning:!0,originalText:!0,tPronunciation:!0,sPronunciation:!0,tPronunciationIcon:!0,sPronunciationIcon:!0,detailedMeanings:!0,definitions:!0,examples:!0},ContentDisplayOrder:["mainMeaning","originalText","detailedMeanings","definitions","examples"],HidePageTranslatorBanner:!1};function t(e,t){return new Promise((n=>{if("string"==typeof e)e=[e];else if(void 0===e){e=[];for(let n in t)e.push(n)}chrome.storage.sync.get(e,(s=>{let a=!1;for(let n of e)s[n]||("function"==typeof t&&(t=t(e)),s[n]=t[n],a=!0);a?chrome.storage.sync.set(s,(()=>n(s))):n(s)}))}))}const n=new class{constructor(){this._services=new Map,this._eventManager=new class{constructor(){this._handlerID=1,this._eventToHandlerIDs=new Map,this._handlerIDToHandler=new Map}on(e,t){const n=this._allocHandlerID();this._handlerIDToHandler.set(n,t),this._eventToHandlerIDs.has(e)?this._eventToHandlerIDs.get(e).add(n):this._eventToHandlerIDs.set(e,new Set([n]));let s=!1;return(()=>{s?console.warn("You shouldn't call the canceler more than once!"):(s=!0,this._off(e,n))}).bind(this)}emit(e,t,n){const s=this._eventToHandlerIDs.get(e);if(s)for(const e of s){const s=this._handlerIDToHandler.get(e);s&&s(t,n)}}_allocHandlerID(){for(;this._handlerIDToHandler.has(this._handlerID);)this._handlerID=(this._handlerID+1)%Number.MAX_SAFE_INTEGER;return this._handlerID}_off(e,t){const n=this._eventToHandlerIDs.get(e);n&&n.delete(t),this._handlerIDToHandler.delete(t)}},chrome.runtime.onMessage.addListener(((e,t,n)=>{let s=JSON.parse(e);if(s&&s.type)switch(s.type){case"event":this._eventManager.emit(s.event,s.detail,t),n&&n();break;case"service":{const e=this._services.get(s.service);if(!e)break;return e(s.params,t).then((e=>n&&n(e))),!0}default:console.error(`Unknown message type: ${e.type}`)}else console.error(`Bad message: ${e}`)}).bind(this))}provide(e,t){this._services.set(e,t)}request(e,t){const n=JSON.stringify({type:"service",service:e,params:t});return new Promise(((e,t)=>{chrome.runtime.sendMessage(n,(n=>{chrome.runtime.lastError?t(chrome.runtime.lastError):e(n)}))}))}requestToTab(e,t,n){const s=this._getTabMessageSender();return s?s(e,JSON.stringify({type:"service",service:t,params:n})):Promise.reject("Can not send message to tabs in current context!")}on(e,t){return this._eventManager.on(e,t)}emit(e,t){let n=JSON.stringify({type:"event",event:e,detail:t});chrome.runtime.sendMessage(n,(()=>{chrome.runtime.lastError&&console.error(chrome.runtime.lastError)}))}emitToTabs(e,t,n){const s=this._getTabMessageSender();if(!s)return void console.error("Can not send message to tabs in current context!");"number"==typeof e&&(e=[e]);const a=JSON.stringify({type:"event",event:t,detail:n});for(let t of e)s(t,a).catch((e=>console.error(e)))}_getTabMessageSender(){return chrome.tabs&&chrome.tabs.sendMessage?(e,t)=>new Promise(((n,s)=>{chrome.tabs.sendMessage(e,t,(e=>{chrome.runtime.lastError?s(chrome.runtime.lastError):n(e)}))})):null}};function s(e,t){let n=document.getElementsByClassName("translator-config");for(let s of n){for(let e=s.options.length;e>0;e--)s.options.remove(e-1);let n=s.getAttribute("data-affected").split(/\s/g),a=e.selections[n[0]];for(let e of t)e===a?s.options.add(new Option(chrome.i18n.getMessage(e),e,!0,!0)):s.options.add(new Option(chrome.i18n.getMessage(e),e));s.onchange=()=>{let t=s.options[s.selectedIndex].value;for(let s of n)e.selections[s]=t;let a=new Set;e.translators=[];for(let t in e.selections){let n=e.selections[t];a.has(n)||(e.translators.push(n),a.add(n))}chrome.storage.sync.set({HybridTranslatorConfig:e})}}}function a(e,t){let n=e;return t.forEach((e=>{n=n[e]})),n}function r(e,t,n){let s=e;for(let e=0;e<t.length-1;e++)s=s[t[e]];s[t[t.length-1]]=n;let a={};a[t[0]]=e[t[0]],chrome.storage.sync.set(a)}window.onload=()=>{!function(){let e=document.getElementsByClassName("i18n");for(let t=0;t<e.length;t++){let n="beforeEnd";e[t].hasAttribute("data-insert-pos")&&(n=e[t].getAttribute("data-insert-pos")),e[t].insertAdjacentText(n,chrome.i18n.getMessage(e[t].getAttribute("data-i18n-name")))}}(),document.getElementById("PrivacyPolicyLink").setAttribute("href",chrome.i18n.getMessage("PrivacyPolicyLink")),t(["languageSetting","HybridTranslatorConfig"],e).then((async e=>{let t=e.HybridTranslatorConfig,a=e.languageSetting;s(t,(await n.request("get_available_translators",{from:a.sl,to:a.tl})).slice(1))})),n.on("hybrid_translator_config_updated",(e=>s(e.config,e.availableTranslators))),t(void 0,e).then((e=>{let t=document.getElementsByTagName("input");const n=document.getElementById("select-translate-position");for(let s of[...t,n]){let t=s.getAttribute("setting-path").split(/\s/g),n=a(e,t);switch(s.getAttribute("setting-type")){case"checkbox":s.checked=-1!==n.indexOf(s.value),s.onchange=t=>{const n=t.target,s=n.getAttribute("setting-path").split(/\s/g),o=a(e,s);n.checked?o.push(n.value):o.splice(o.indexOf(n.value),1),r(e,s,o)};break;case"radio":s.checked=n===s.value,s.onchange=t=>{const n=t.target,s=n.getAttribute("setting-path").split(/\s/g);n.checked&&r(e,s,n.value)};break;case"switch":s.checked=n,s.onchange=t=>{const n=t.target.getAttribute("setting-path").split(/\s/g);r(e,n,t.target.checked)};break;case"select":s.value=n,s.onchange=t=>{const n=t.target,s=n.getAttribute("setting-path").split(/\s/g);r(e,s,n.options[n.selectedIndex].value)}}}}))}})();