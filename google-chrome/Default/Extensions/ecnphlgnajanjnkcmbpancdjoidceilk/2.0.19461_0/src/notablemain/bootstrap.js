(function(){"use strict";const o=document.createElement("iframe");o.setAttribute("src",chrome.runtime.getURL("delegate.html")),o.style.display="none",document.body.appendChild(o),window.addEventListener("message",async e=>{if(e.data.type!=="download-blob-url")return;if(!e.data.url.includes(`chrome-extension://${chrome.runtime.id}/`)){console.log("download-blob-url ignoring message from different extension");return}const t=e.ports[0];if(!t){console.error("download-blob-url message received without a port");return}try{const r=await fetch(e.data.url);if(!r.ok){t.postMessage({type:"error",error:`${r.status}: ${r.statusText}`});return}const s=await r.arrayBuffer();t.postMessage({type:"data",data:s},{transfer:[s]})}catch(r){console.error(r),t.postMessage({type:"error",error:r.message||"Unknown error"})}}),window.addEventListener("message",async e=>{if(e.data.type!=="kami-ping")return;const n=e.ports[0];if(!n)return;const t=chrome.runtime.getManifest();n.postMessage({type:"pong",extension:{id:chrome.runtime.id,name:t.name,version:t.version}})})})();
