(function(){"use strict";const At={BASE_URL:"/",DEV:!1,EXTENSION_PUBLIC_HOST:"https://web.kamihq.com/api",EXTENSION_PUBLIC_WEB_HOST:"https://web.kamihq.com",MODE:"production",PROD:!0,SSR:!1},{EXTENSION_PUBLIC_HOST:$e,EXTENSION_PUBLIC_WEB_HOST:De}=At;if(!$e)throw new Error("EXTENSION_PUBLIC_HOST is not defined");if(!De)throw new Error("EXTENSION_PUBLIC_WEB_HOST is not defined");function Rt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var de={exports:{}},Me=function(r,i){return function(){for(var n=new Array(arguments.length),e=0;e<n.length;e++)n[e]=arguments[e];return r.apply(i,n)}},It=Me,Z=Object.prototype.toString;function pe(t){return Z.call(t)==="[object Array]"}function he(t){return typeof t>"u"}function Lt(t){return t!==null&&!he(t)&&t.constructor!==null&&!he(t.constructor)&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}function $t(t){return Z.call(t)==="[object ArrayBuffer]"}function Dt(t){return typeof FormData<"u"&&t instanceof FormData}function Mt(t){var r;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?r=ArrayBuffer.isView(t):r=t&&t.buffer&&t.buffer instanceof ArrayBuffer,r}function Ft(t){return typeof t=="string"}function Nt(t){return typeof t=="number"}function Fe(t){return t!==null&&typeof t=="object"}function oe(t){if(Z.call(t)!=="[object Object]")return!1;var r=Object.getPrototypeOf(t);return r===null||r===Object.prototype}function Ut(t){return Z.call(t)==="[object Date]"}function Bt(t){return Z.call(t)==="[object File]"}function Wt(t){return Z.call(t)==="[object Blob]"}function Ne(t){return Z.call(t)==="[object Function]"}function jt(t){return Fe(t)&&Ne(t.pipe)}function Ht(t){return typeof URLSearchParams<"u"&&t instanceof URLSearchParams}function Kt(t){return t.replace(/^\s*/,"").replace(/\s*$/,"")}function zt(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function fe(t,r){if(!(t===null||typeof t>"u"))if(typeof t!="object"&&(t=[t]),pe(t))for(var i=0,a=t.length;i<a;i++)r.call(null,t[i],i,t);else for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&r.call(null,t[n],n,t)}function me(){var t={};function r(n,e){oe(t[e])&&oe(n)?t[e]=me(t[e],n):oe(n)?t[e]=me({},n):pe(n)?t[e]=n.slice():t[e]=n}for(var i=0,a=arguments.length;i<a;i++)fe(arguments[i],r);return t}function Vt(t,r,i){return fe(r,function(n,e){i&&typeof n=="function"?t[e]=It(n,i):t[e]=n}),t}function Gt(t){return t.charCodeAt(0)===65279&&(t=t.slice(1)),t}var G={isArray:pe,isArrayBuffer:$t,isBuffer:Lt,isFormData:Dt,isArrayBufferView:Mt,isString:Ft,isNumber:Nt,isObject:Fe,isPlainObject:oe,isUndefined:he,isDate:Ut,isFile:Bt,isBlob:Wt,isFunction:Ne,isStream:jt,isURLSearchParams:Ht,isStandardBrowserEnv:zt,forEach:fe,merge:me,extend:Vt,trim:Kt,stripBOM:Gt},ee=G;function Ue(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Be=function(r,i,a){if(!i)return r;var n;if(a)n=a(i);else if(ee.isURLSearchParams(i))n=i.toString();else{var e=[];ee.forEach(i,function(l,o){l===null||typeof l>"u"||(ee.isArray(l)?o=o+"[]":l=[l],ee.forEach(l,function(m){ee.isDate(m)?m=m.toISOString():ee.isObject(m)&&(m=JSON.stringify(m)),e.push(Ue(o)+"="+Ue(m))}))}),n=e.join("&")}if(n){var s=r.indexOf("#");s!==-1&&(r=r.slice(0,s)),r+=(r.indexOf("?")===-1?"?":"&")+n}return r},Jt=G;function ae(){this.handlers=[]}ae.prototype.use=function(r,i){return this.handlers.push({fulfilled:r,rejected:i}),this.handlers.length-1},ae.prototype.eject=function(r){this.handlers[r]&&(this.handlers[r]=null)},ae.prototype.forEach=function(r){Jt.forEach(this.handlers,function(a){a!==null&&r(a)})};var Xt=ae,Qt=G,Yt=function(r,i,a){return Qt.forEach(a,function(e){r=e(r,i)}),r},ge,We;function je(){return We||(We=1,ge=function(r){return!!(r&&r.__CANCEL__)}),ge}var Zt=G,er=function(r,i){Zt.forEach(r,function(n,e){e!==i&&e.toUpperCase()===i.toUpperCase()&&(r[i]=n,delete r[e])})},ve,He;function tr(){return He||(He=1,ve=function(r,i,a,n,e){return r.config=i,a&&(r.code=a),r.request=n,r.response=e,r.isAxiosError=!0,r.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},r}),ve}var ye,Ke;function ze(){if(Ke)return ye;Ke=1;var t=tr();return ye=function(i,a,n,e,s){var u=new Error(i);return t(u,a,n,e,s)},ye}var _e,Ve;function rr(){if(Ve)return _e;Ve=1;var t=ze();return _e=function(i,a,n){var e=n.config.validateStatus;!n.status||!e||e(n.status)?i(n):a(t("Request failed with status code "+n.status,n.config,null,n.request,n))},_e}var we,Ge;function nr(){if(Ge)return we;Ge=1;var t=G;return we=t.isStandardBrowserEnv()?function(){return{write:function(a,n,e,s,u,l){var o=[];o.push(a+"="+encodeURIComponent(n)),t.isNumber(e)&&o.push("expires="+new Date(e).toGMTString()),t.isString(s)&&o.push("path="+s),t.isString(u)&&o.push("domain="+u),l===!0&&o.push("secure"),document.cookie=o.join("; ")},read:function(a){var n=document.cookie.match(new RegExp("(^|;\\s*)("+a+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(a){this.write(a,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),we}var be,Je;function ir(){return Je||(Je=1,be=function(r){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(r)}),be}var ke,Xe;function or(){return Xe||(Xe=1,ke=function(r,i){return i?r.replace(/\/+$/,"")+"/"+i.replace(/^\/+/,""):r}),ke}var Se,Qe;function ar(){if(Qe)return Se;Qe=1;var t=ir(),r=or();return Se=function(a,n){return a&&!t(n)?r(a,n):n},Se}var xe,Ye;function sr(){if(Ye)return xe;Ye=1;var t=G,r=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return xe=function(a){var n={},e,s,u;return a&&t.forEach(a.split(`
`),function(o){if(u=o.indexOf(":"),e=t.trim(o.substr(0,u)).toLowerCase(),s=t.trim(o.substr(u+1)),e){if(n[e]&&r.indexOf(e)>=0)return;e==="set-cookie"?n[e]=(n[e]?n[e]:[]).concat([s]):n[e]=n[e]?n[e]+", "+s:s}}),n},xe}var Ce,Ze;function ur(){if(Ze)return Ce;Ze=1;var t=G;return Ce=t.isStandardBrowserEnv()?function(){var i=/(msie|trident)/i.test(navigator.userAgent),a=document.createElement("a"),n;function e(s){var u=s;return i&&(a.setAttribute("href",u),u=a.href),a.setAttribute("href",u),{href:a.href,protocol:a.protocol?a.protocol.replace(/:$/,""):"",host:a.host,search:a.search?a.search.replace(/^\?/,""):"",hash:a.hash?a.hash.replace(/^#/,""):"",hostname:a.hostname,port:a.port,pathname:a.pathname.charAt(0)==="/"?a.pathname:"/"+a.pathname}}return n=e(window.location.href),function(u){var l=t.isString(u)?e(u):u;return l.protocol===n.protocol&&l.host===n.host}}():function(){return function(){return!0}}(),Ce}var Ee,et;function tt(){if(et)return Ee;et=1;var t=G,r=rr(),i=nr(),a=Be,n=ar(),e=sr(),s=ur(),u=ze();return Ee=function(o){return new Promise(function(m,c){var f=o.data,w=o.headers;t.isFormData(f)&&delete w["Content-Type"];var p=new XMLHttpRequest;if(o.auth){var C=o.auth.username||"",g=o.auth.password?unescape(encodeURIComponent(o.auth.password)):"";w.Authorization="Basic "+btoa(C+":"+g)}var S=n(o.baseURL,o.url);if(p.open(o.method.toUpperCase(),a(S,o.params,o.paramsSerializer),!0),p.timeout=o.timeout,p.onreadystatechange=function(){if(!(!p||p.readyState!==4)&&!(p.status===0&&!(p.responseURL&&p.responseURL.indexOf("file:")===0))){var O="getAllResponseHeaders"in p?e(p.getAllResponseHeaders()):null,A=!o.responseType||o.responseType==="text"?p.responseText:p.response,P={data:A,status:p.status,statusText:p.statusText,headers:O,config:o,request:p};r(m,c,P),p=null}},p.onabort=function(){p&&(c(u("Request aborted",o,"ECONNABORTED",p)),p=null)},p.onerror=function(){c(u("Network Error",o,null,p)),p=null},p.ontimeout=function(){var O="timeout of "+o.timeout+"ms exceeded";o.timeoutErrorMessage&&(O=o.timeoutErrorMessage),c(u(O,o,"ECONNABORTED",p)),p=null},t.isStandardBrowserEnv()){var T=(o.withCredentials||s(S))&&o.xsrfCookieName?i.read(o.xsrfCookieName):void 0;T&&(w[o.xsrfHeaderName]=T)}if("setRequestHeader"in p&&t.forEach(w,function(O,A){typeof f>"u"&&A.toLowerCase()==="content-type"?delete w[A]:p.setRequestHeader(A,O)}),t.isUndefined(o.withCredentials)||(p.withCredentials=!!o.withCredentials),o.responseType)try{p.responseType=o.responseType}catch(E){if(o.responseType!=="json")throw E}typeof o.onDownloadProgress=="function"&&p.addEventListener("progress",o.onDownloadProgress),typeof o.onUploadProgress=="function"&&p.upload&&p.upload.addEventListener("progress",o.onUploadProgress),o.cancelToken&&o.cancelToken.promise.then(function(O){p&&(p.abort(),c(O),p=null)}),f||(f=null),p.send(f)})},Ee}var z=G,rt=er,lr={"Content-Type":"application/x-www-form-urlencoded"};function nt(t,r){!z.isUndefined(t)&&z.isUndefined(t["Content-Type"])&&(t["Content-Type"]=r)}function cr(){var t;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(t=tt()),t}var se={adapter:cr(),transformRequest:[function(r,i){return rt(i,"Accept"),rt(i,"Content-Type"),z.isFormData(r)||z.isArrayBuffer(r)||z.isBuffer(r)||z.isStream(r)||z.isFile(r)||z.isBlob(r)?r:z.isArrayBufferView(r)?r.buffer:z.isURLSearchParams(r)?(nt(i,"application/x-www-form-urlencoded;charset=utf-8"),r.toString()):z.isObject(r)?(nt(i,"application/json;charset=utf-8"),JSON.stringify(r)):r}],transformResponse:[function(r){if(typeof r=="string")try{r=JSON.parse(r)}catch{}return r}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(r){return r>=200&&r<300}};se.headers={common:{Accept:"application/json, text/plain, */*"}},z.forEach(["delete","get","head"],function(r){se.headers[r]={}}),z.forEach(["post","put","patch"],function(r){se.headers[r]=z.merge(lr)});var it=se,ot=G,Te=Yt,dr=je(),pr=it;function qe(t){t.cancelToken&&t.cancelToken.throwIfRequested()}var hr=function(r){qe(r),r.headers=r.headers||{},r.data=Te(r.data,r.headers,r.transformRequest),r.headers=ot.merge(r.headers.common||{},r.headers[r.method]||{},r.headers),ot.forEach(["delete","get","head","post","put","patch","common"],function(n){delete r.headers[n]});var i=r.adapter||pr.adapter;return i(r).then(function(n){return qe(r),n.data=Te(n.data,n.headers,r.transformResponse),n},function(n){return dr(n)||(qe(r),n&&n.response&&(n.response.data=Te(n.response.data,n.response.headers,r.transformResponse))),Promise.reject(n)})},j=G,at=function(r,i){i=i||{};var a={},n=["url","method","data"],e=["headers","auth","proxy","params"],s=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],u=["validateStatus"];function l(c,f){return j.isPlainObject(c)&&j.isPlainObject(f)?j.merge(c,f):j.isPlainObject(f)?j.merge({},f):j.isArray(f)?f.slice():f}function o(c){j.isUndefined(i[c])?j.isUndefined(r[c])||(a[c]=l(void 0,r[c])):a[c]=l(r[c],i[c])}j.forEach(n,function(f){j.isUndefined(i[f])||(a[f]=l(void 0,i[f]))}),j.forEach(e,o),j.forEach(s,function(f){j.isUndefined(i[f])?j.isUndefined(r[f])||(a[f]=l(void 0,r[f])):a[f]=l(void 0,i[f])}),j.forEach(u,function(f){f in i?a[f]=l(r[f],i[f]):f in r&&(a[f]=l(void 0,r[f]))});var v=n.concat(e).concat(s).concat(u),m=Object.keys(r).concat(Object.keys(i)).filter(function(f){return v.indexOf(f)===-1});return j.forEach(m,o),a},st=G,fr=Be,ut=Xt,mr=hr,ue=at;function ne(t){this.defaults=t,this.interceptors={request:new ut,response:new ut}}ne.prototype.request=function(r){typeof r=="string"?(r=arguments[1]||{},r.url=arguments[0]):r=r||{},r=ue(this.defaults,r),r.method?r.method=r.method.toLowerCase():this.defaults.method?r.method=this.defaults.method.toLowerCase():r.method="get";var i=[mr,void 0],a=Promise.resolve(r);for(this.interceptors.request.forEach(function(e){i.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){i.push(e.fulfilled,e.rejected)});i.length;)a=a.then(i.shift(),i.shift());return a},ne.prototype.getUri=function(r){return r=ue(this.defaults,r),fr(r.url,r.params,r.paramsSerializer).replace(/^\?/,"")},st.forEach(["delete","get","head","options"],function(r){ne.prototype[r]=function(i,a){return this.request(ue(a||{},{method:r,url:i,data:(a||{}).data}))}}),st.forEach(["post","put","patch"],function(r){ne.prototype[r]=function(i,a,n){return this.request(ue(n||{},{method:r,url:i,data:a}))}});var gr=ne,Oe,lt;function ct(){if(lt)return Oe;lt=1;function t(r){this.message=r}return t.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},t.prototype.__CANCEL__=!0,Oe=t,Oe}var Pe,dt;function vr(){if(dt)return Pe;dt=1;var t=ct();function r(i){if(typeof i!="function")throw new TypeError("executor must be a function.");var a;this.promise=new Promise(function(s){a=s});var n=this;i(function(s){n.reason||(n.reason=new t(s),a(n.reason))})}return r.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},r.source=function(){var a,n=new r(function(s){a=s});return{token:n,cancel:a}},Pe=r,Pe}var Ae,pt;function yr(){return pt||(pt=1,Ae=function(r){return function(a){return r.apply(null,a)}}),Ae}var Re,ht;function _r(){return ht||(ht=1,Re=function(r){return typeof r=="object"&&r.isAxiosError===!0}),Re}var ft=G,wr=Me,le=gr,br=at,kr=it;function mt(t){var r=new le(t),i=wr(le.prototype.request,r);return ft.extend(i,le.prototype,r),ft.extend(i,r),i}var X=mt(kr);X.Axios=le,X.create=function(r){return mt(br(X.defaults,r))},X.Cancel=ct(),X.CancelToken=vr(),X.isCancel=je(),X.all=function(r){return Promise.all(r)},X.spread=yr(),X.isAxiosError=_r(),de.exports=X,de.exports.default=X;var Sr=de.exports,xr=Sr;const K=Rt(xr);var V=De,Cr=$e;(function(t){if(typeof exports=="object"&&typeof module<"u")module.exports=t();else if(typeof define=="function"&&define.amd)define([],t);else{var r;r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this,r.ProgressBar=t()}})(function(){return function t(r,i,a){function n(u,l){if(!i[u]){if(!r[u]){var o=typeof require=="function"&&require;if(!l&&o)return o(u,!0);if(e)return e(u,!0);var v=new Error("Cannot find module '"+u+"'");throw v.code="MODULE_NOT_FOUND",v}var m=i[u]={exports:{}};r[u][0].call(m.exports,function(c){var f=r[u][1][c];return n(f||c)},m,m.exports,t,r,i,a)}return i[u].exports}for(var e=typeof require=="function"&&require,s=0;s<a.length;s++)n(a[s]);return n}({1:[function(t,r,i){(function(){var a=this||Function("return this")(),n=function(){function e(){}function s(d,_){var k;for(k in d)Object.hasOwnProperty.call(d,k)&&_(k)}function u(d,_){return s(_,function(k){d[k]=_[k]}),d}function l(d,_){s(_,function(k){typeof d[k]>"u"&&(d[k]=_[k])})}function o(d,_,k,R,q,L,N){var B,h,y,b=d<L?0:(d-L)/q;for(B in _)_.hasOwnProperty(B)&&(h=N[B],y=typeof h=="function"?h:p[h],_[B]=v(k[B],R[B],y,b));return _}function v(d,_,k,R){return d+(_-d)*k(R)}function m(d,_){var k=w.prototype.filter,R=d._filterArgs;s(k,function(q){typeof k[q][_]<"u"&&k[q][_].apply(d,R)})}function c(d,_,k,R,q,L,N,B,h,y,b){A=_+k+R,P=Math.min(b||O(),A),F=P>=A,M=R-(A-P),d.isPlaying()&&(F?(h(N,d._attachment,M),d.stop(!0)):(d._scheduleId=y(d._timeoutHandler,T),m(d,"beforeTween"),P<_+k?o(1,q,L,N,1,1,B):o(P,q,L,N,R,_+k,B),m(d,"afterTween"),h(q,d._attachment,M)))}function f(d,_){var k={},R=typeof _;return R==="string"||R==="function"?s(d,function(q){k[q]=_}):s(d,function(q){k[q]||(k[q]=_[q]||g)}),k}function w(d,_){this._currentState=d||{},this._configured=!1,this._scheduleFunction=C,typeof _<"u"&&this.setConfig(_)}var p,C,g="linear",S=500,T=1e3/60,E=Date.now?Date.now:function(){return+new Date},O=typeof SHIFTY_DEBUG_NOW<"u"?SHIFTY_DEBUG_NOW:E;C=typeof window<"u"&&(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||window.mozCancelRequestAnimationFrame&&window.mozRequestAnimationFrame)||setTimeout;var A,P,F,M;return w.prototype.tween=function(d){return this._isTweening?this:(d===void 0&&this._configured||this.setConfig(d),this._timestamp=O(),this._start(this.get(),this._attachment),this.resume())},w.prototype.setConfig=function(d){d=d||{},this._configured=!0,this._attachment=d.attachment,this._pausedAtTime=null,this._scheduleId=null,this._delay=d.delay||0,this._start=d.start||e,this._step=d.step||e,this._finish=d.finish||e,this._duration=d.duration||S,this._currentState=u({},d.from||this.get()),this._originalState=this.get(),this._targetState=u({},d.to||this.get());var _=this;this._timeoutHandler=function(){c(_,_._timestamp,_._delay,_._duration,_._currentState,_._originalState,_._targetState,_._easing,_._step,_._scheduleFunction)};var k=this._currentState,R=this._targetState;return l(R,k),this._easing=f(k,d.easing||g),this._filterArgs=[k,this._originalState,R,this._easing],m(this,"tweenCreated"),this},w.prototype.get=function(){return u({},this._currentState)},w.prototype.set=function(d){this._currentState=d},w.prototype.pause=function(){return this._pausedAtTime=O(),this._isPaused=!0,this},w.prototype.resume=function(){return this._isPaused&&(this._timestamp+=O()-this._pausedAtTime),this._isPaused=!1,this._isTweening=!0,this._timeoutHandler(),this},w.prototype.seek=function(d){d=Math.max(d,0);var _=O();return this._timestamp+d===0?this:(this._timestamp=_-d,this.isPlaying()||(this._isTweening=!0,this._isPaused=!1,c(this,this._timestamp,this._delay,this._duration,this._currentState,this._originalState,this._targetState,this._easing,this._step,this._scheduleFunction,_),this.pause()),this)},w.prototype.stop=function(d){return this._isTweening=!1,this._isPaused=!1,this._timeoutHandler=e,(a.cancelAnimationFrame||a.webkitCancelAnimationFrame||a.oCancelAnimationFrame||a.msCancelAnimationFrame||a.mozCancelRequestAnimationFrame||a.clearTimeout)(this._scheduleId),d&&(m(this,"beforeTween"),o(1,this._currentState,this._originalState,this._targetState,1,0,this._easing),m(this,"afterTween"),m(this,"afterTweenEnd"),this._finish.call(this,this._currentState,this._attachment)),this},w.prototype.isPlaying=function(){return this._isTweening&&!this._isPaused},w.prototype.setScheduleFunction=function(d){this._scheduleFunction=d},w.prototype.dispose=function(){var d;for(d in this)this.hasOwnProperty(d)&&delete this[d]},w.prototype.filter={},w.prototype.formula={linear:function(d){return d}},p=w.prototype.formula,u(w,{now:O,each:s,tweenProps:o,tweenProp:v,applyFilter:m,shallowCopy:u,defaults:l,composeEasingObject:f}),typeof SHIFTY_DEBUG_NOW=="function"&&(a.timeoutHandler=c),typeof i=="object"?r.exports=w:typeof a.Tweenable>"u"&&(a.Tweenable=w),w}();(function(){n.shallowCopy(n.prototype.formula,{easeInQuad:function(e){return Math.pow(e,2)},easeOutQuad:function(e){return-(Math.pow(e-1,2)-1)},easeInOutQuad:function(e){return(e/=.5)<1?.5*Math.pow(e,2):-.5*((e-=2)*e-2)},easeInCubic:function(e){return Math.pow(e,3)},easeOutCubic:function(e){return Math.pow(e-1,3)+1},easeInOutCubic:function(e){return(e/=.5)<1?.5*Math.pow(e,3):.5*(Math.pow(e-2,3)+2)},easeInQuart:function(e){return Math.pow(e,4)},easeOutQuart:function(e){return-(Math.pow(e-1,4)-1)},easeInOutQuart:function(e){return(e/=.5)<1?.5*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2)},easeInQuint:function(e){return Math.pow(e,5)},easeOutQuint:function(e){return Math.pow(e-1,5)+1},easeInOutQuint:function(e){return(e/=.5)<1?.5*Math.pow(e,5):.5*(Math.pow(e-2,5)+2)},easeInSine:function(e){return-Math.cos(e*(Math.PI/2))+1},easeOutSine:function(e){return Math.sin(e*(Math.PI/2))},easeInOutSine:function(e){return-.5*(Math.cos(Math.PI*e)-1)},easeInExpo:function(e){return e===0?0:Math.pow(2,10*(e-1))},easeOutExpo:function(e){return e===1?1:-Math.pow(2,-10*e)+1},easeInOutExpo:function(e){return e===0?0:e===1?1:(e/=.5)<1?.5*Math.pow(2,10*(e-1)):.5*(-Math.pow(2,-10*--e)+2)},easeInCirc:function(e){return-(Math.sqrt(1-e*e)-1)},easeOutCirc:function(e){return Math.sqrt(1-Math.pow(e-1,2))},easeInOutCirc:function(e){return(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},easeOutBounce:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},easeInBack:function(e){var s=1.70158;return e*e*((s+1)*e-s)},easeOutBack:function(e){var s=1.70158;return(e-=1)*e*((s+1)*e+s)+1},easeInOutBack:function(e){var s=1.70158;return(e/=.5)<1?.5*(e*e*(((s*=1.525)+1)*e-s)):.5*((e-=2)*e*(((s*=1.525)+1)*e+s)+2)},elastic:function(e){return-1*Math.pow(4,-8*e)*Math.sin((6*e-1)*(2*Math.PI)/2)+1},swingFromTo:function(e){var s=1.70158;return(e/=.5)<1?.5*(e*e*(((s*=1.525)+1)*e-s)):.5*((e-=2)*e*(((s*=1.525)+1)*e+s)+2)},swingFrom:function(e){var s=1.70158;return e*e*((s+1)*e-s)},swingTo:function(e){var s=1.70158;return(e-=1)*e*((s+1)*e+s)+1},bounce:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},bouncePast:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?2-(7.5625*(e-=1.5/2.75)*e+.75):e<2.5/2.75?2-(7.5625*(e-=2.25/2.75)*e+.9375):2-(7.5625*(e-=2.625/2.75)*e+.984375)},easeFromTo:function(e){return(e/=.5)<1?.5*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2)},easeFrom:function(e){return Math.pow(e,4)},easeTo:function(e){return Math.pow(e,.25)}})})(),function(){function e(u,l,o,v,m,c){function f(d){return((E*d+O)*d+A)*d}function w(d){return((P*d+F)*d+M)*d}function p(d){return(3*E*d+2*O)*d+A}function C(d){return 1/(200*d)}function g(d,_){return w(T(d,_))}function S(d){return d>=0?d:0-d}function T(d,_){var k,R,q,L,N,B;for(q=d,B=0;B<8;B++){if(L=f(q)-d,S(L)<_)return q;if(N=p(q),S(N)<1e-6)break;q-=L/N}if(k=0,R=1,q=d,q<k)return k;if(q>R)return R;for(;k<R;){if(L=f(q),S(L-d)<_)return q;d>L?k=q:R=q,q=.5*(R-k)+k}return q}var E=0,O=0,A=0,P=0,F=0,M=0;return A=3*l,O=3*(v-l)-A,E=1-A-O,M=3*o,F=3*(m-o)-M,P=1-M-F,g(u,C(c))}function s(u,l,o,v){return function(m){return e(m,u,l,o,v,1)}}n.setBezierFunction=function(u,l,o,v,m){var c=s(l,o,v,m);return c.displayName=u,c.x1=l,c.y1=o,c.x2=v,c.y2=m,n.prototype.formula[u]=c},n.unsetBezierFunction=function(u){delete n.prototype.formula[u]}}(),function(){function e(u,l,o,v,m,c){return n.tweenProps(v,l,u,o,1,c,m)}var s=new n;s._filterArgs=[],n.interpolate=function(u,l,o,v,m){var c=n.shallowCopy({},u),f=m||0,w=n.composeEasingObject(u,v||"linear");s.set({});var p=s._filterArgs;p.length=0,p[0]=c,p[1]=u,p[2]=l,p[3]=w,n.applyFilter(s,"tweenCreated"),n.applyFilter(s,"beforeTween");var C=e(u,c,l,o,w,f);return n.applyFilter(s,"afterTween"),C}}(),function(e){function s(h,y){var b,x=[],I=h.length;for(b=0;b<I;b++)x.push("_"+y+"_"+b);return x}function u(h){var y=h.match(d);return y?(y.length===1||h.charAt(0).match(M))&&y.unshift(""):y=["",""],y.join(L)}function l(h){e.each(h,function(y){var b=h[y];typeof b=="string"&&b.match(q)&&(h[y]=o(b))})}function o(h){return f(q,h,v)}function v(h){var y=m(h);return"rgb("+y[0]+","+y[1]+","+y[2]+")"}function m(h){return h=h.replace(/#/,""),h.length===3&&(h=h.split(""),h=h[0]+h[0]+h[1]+h[1]+h[2]+h[2]),N[0]=c(h.substr(0,2)),N[1]=c(h.substr(2,2)),N[2]=c(h.substr(4,2)),N}function c(h){return parseInt(h,16)}function f(h,y,b){var x=y.match(h),I=y.replace(h,L);if(x)for(var H,J=x.length,Y=0;Y<J;Y++)H=x.shift(),I=I.replace(L,b(H));return I}function w(h){return f(k,h,p)}function p(h){for(var y=h.match(_),b=y.length,x=h.match(R)[0],I=0;I<b;I++)x+=parseInt(y[I],10)+",";return x=x.slice(0,-1)+")"}function C(h){var y={};return e.each(h,function(b){var x=h[b];if(typeof x=="string"){var I=A(x);y[b]={formatString:u(x),chunkNames:s(I,b)}}}),y}function g(h,y){e.each(y,function(b){for(var x=h[b],I=A(x),H=I.length,J=0;J<H;J++)h[y[b].chunkNames[J]]=+I[J];delete h[b]})}function S(h,y){e.each(y,function(b){var x=h[b],I=T(h,y[b].chunkNames),H=E(I,y[b].chunkNames);x=O(y[b].formatString,H),h[b]=w(x)})}function T(h,y){for(var b,x={},I=y.length,H=0;H<I;H++)b=y[H],x[b]=h[b],delete h[b];return x}function E(h,y){B.length=0;for(var b=y.length,x=0;x<b;x++)B.push(h[y[x]]);return B}function O(h,y){for(var b=h,x=y.length,I=0;I<x;I++)b=b.replace(L,+y[I].toFixed(4));return b}function A(h){return h.match(_)}function P(h,y){e.each(y,function(b){var x,I=y[b],H=I.chunkNames,J=H.length,Y=h[b];if(typeof Y=="string"){var te=Y.split(" "),re=te[te.length-1];for(x=0;x<J;x++)h[H[x]]=te[x]||re}else for(x=0;x<J;x++)h[H[x]]=Y;delete h[b]})}function F(h,y){e.each(y,function(b){var x=y[b],I=x.chunkNames,H=I.length,J=h[I[0]],Y=typeof J;if(Y==="string"){for(var te="",re=0;re<H;re++)te+=" "+h[I[re]],delete h[I[re]];h[b]=te.substr(1)}else h[b]=J})}var M=/(\d|\-|\.)/,d=/([^\-0-9\.]+)/g,_=/[0-9.\-]+/g,k=new RegExp("rgb\\("+_.source+/,\s*/.source+_.source+/,\s*/.source+_.source+"\\)","g"),R=/^.*\(/,q=/#([0-9]|[a-f]){3,6}/gi,L="VAL",N=[],B=[];e.prototype.filter.token={tweenCreated:function(h,y,b,x){l(h),l(y),l(b),this._tokenData=C(h)},beforeTween:function(h,y,b,x){P(x,this._tokenData),g(h,this._tokenData),g(y,this._tokenData),g(b,this._tokenData)},afterTween:function(h,y,b,x){S(h,this._tokenData),S(y,this._tokenData),S(b,this._tokenData),F(x,this._tokenData)}}}(n)}).call(null)},{}],2:[function(t,r,i){var a=t("./shape"),n=t("./utils"),e=function(s,u){this._pathTemplate="M 50,50 m 0,-{radius} a {radius},{radius} 0 1 1 0,{2radius} a {radius},{radius} 0 1 1 0,-{2radius}",this.containerAspectRatio=1,a.apply(this,arguments)};e.prototype=new a,e.prototype.constructor=e,e.prototype._pathString=function(s){var u=s.strokeWidth;s.trailWidth&&s.trailWidth>s.strokeWidth&&(u=s.trailWidth);var l=50-u/2;return n.render(this._pathTemplate,{radius:l,"2radius":2*l})},e.prototype._trailString=function(s){return this._pathString(s)},r.exports=e},{"./shape":7,"./utils":9}],3:[function(t,r,i){var a=t("./shape"),n=t("./utils"),e=function(s,u){this._pathTemplate="M 0,{center} L 100,{center}",a.apply(this,arguments)};e.prototype=new a,e.prototype.constructor=e,e.prototype._initializeSvg=function(s,u){s.setAttribute("viewBox","0 0 100 "+u.strokeWidth),s.setAttribute("preserveAspectRatio","none")},e.prototype._pathString=function(s){return n.render(this._pathTemplate,{center:s.strokeWidth/2})},e.prototype._trailString=function(s){return this._pathString(s)},r.exports=e},{"./shape":7,"./utils":9}],4:[function(t,r,i){r.exports={Line:t("./line"),Circle:t("./circle"),SemiCircle:t("./semicircle"),Square:t("./square"),Path:t("./path"),Shape:t("./shape"),utils:t("./utils")}},{"./circle":2,"./line":3,"./path":5,"./semicircle":6,"./shape":7,"./square":8,"./utils":9}],5:[function(t,r,i){var a=t("shifty"),n=t("./utils"),e={easeIn:"easeInCubic",easeOut:"easeOutCubic",easeInOut:"easeInOutCubic"},s=function u(l,o){if(!(this instanceof u))throw new Error("Constructor was called without new keyword");o=n.extend({duration:800,easing:"linear",from:{},to:{},step:function(){}},o);var v;v=n.isString(l)?document.querySelector(l):l,this.path=v,this._opts=o,this._tweenable=null;var m=this.path.getTotalLength();this.path.style.strokeDasharray=m+" "+m,this.set(0)};s.prototype.value=function(){var u=this._getComputedDashOffset(),l=this.path.getTotalLength(),o=1-u/l;return parseFloat(o.toFixed(6),10)},s.prototype.set=function(u){this.stop(),this.path.style.strokeDashoffset=this._progressToOffset(u);var l=this._opts.step;if(n.isFunction(l)){var o=this._easing(this._opts.easing),v=this._calculateTo(u,o),m=this._opts.shape||this;l(v,m,this._opts.attachment)}},s.prototype.stop=function(){this._stopTween(),this.path.style.strokeDashoffset=this._getComputedDashOffset()},s.prototype.animate=function(u,l,o){l=l||{},n.isFunction(l)&&(o=l,l={});var v=n.extend({},l),m=n.extend({},this._opts);l=n.extend(m,l);var c=this._easing(l.easing),f=this._resolveFromAndTo(u,c,v);this.stop(),this.path.getBoundingClientRect();var w=this._getComputedDashOffset(),p=this._progressToOffset(u),C=this;this._tweenable=new a,this._tweenable.tween({from:n.extend({offset:w},f.from),to:n.extend({offset:p},f.to),duration:l.duration,easing:c,step:function(g){C.path.style.strokeDashoffset=g.offset;var S=l.shape||C;l.step(g,S,l.attachment)},finish:function(g){n.isFunction(o)&&o()}})},s.prototype._getComputedDashOffset=function(){var u=window.getComputedStyle(this.path,null);return parseFloat(u.getPropertyValue("stroke-dashoffset"),10)},s.prototype._progressToOffset=function(u){var l=this.path.getTotalLength();return l-u*l},s.prototype._resolveFromAndTo=function(u,l,o){return o.from&&o.to?{from:o.from,to:o.to}:{from:this._calculateFrom(l),to:this._calculateTo(u,l)}},s.prototype._calculateFrom=function(u){return a.interpolate(this._opts.from,this._opts.to,this.value(),u)},s.prototype._calculateTo=function(u,l){return a.interpolate(this._opts.from,this._opts.to,u,l)},s.prototype._stopTween=function(){this._tweenable!==null&&(this._tweenable.stop(),this._tweenable=null)},s.prototype._easing=function(u){return e.hasOwnProperty(u)?e[u]:u},r.exports=s},{"./utils":9,shifty:1}],6:[function(t,r,i){var a=t("./shape"),n=t("./circle"),e=t("./utils"),s=function(u,l){this._pathTemplate="M 50,50 m -{radius},0 a {radius},{radius} 0 1 1 {2radius},0",this.containerAspectRatio=2,a.apply(this,arguments)};s.prototype=new a,s.prototype.constructor=s,s.prototype._initializeSvg=function(u,l){u.setAttribute("viewBox","0 0 100 50")},s.prototype._initializeTextContainer=function(u,l,o){u.text.style&&(o.style.top="auto",o.style.bottom="0",u.text.alignToBottom?e.setStyle(o,"transform","translate(-50%, 0)"):e.setStyle(o,"transform","translate(-50%, 50%)"))},s.prototype._pathString=n.prototype._pathString,s.prototype._trailString=n.prototype._trailString,r.exports=s},{"./circle":2,"./shape":7,"./utils":9}],7:[function(t,r,i){var a=t("./path"),n=t("./utils"),e="Object is destroyed",s=function u(l,o){if(!(this instanceof u))throw new Error("Constructor was called without new keyword");if(arguments.length!==0){this._opts=n.extend({color:"#555",strokeWidth:1,trailColor:null,trailWidth:null,fill:null,text:{style:{color:null,position:"absolute",left:"50%",top:"50%",padding:0,margin:0,transform:{prefix:!0,value:"translate(-50%, -50%)"}},autoStyleContainer:!0,alignToBottom:!0,value:null,className:"progressbar-text"},svgStyle:{display:"block",width:"100%"},warnings:!1},o,!0),n.isObject(o)&&o.svgStyle!==void 0&&(this._opts.svgStyle=o.svgStyle),n.isObject(o)&&n.isObject(o.text)&&o.text.style!==void 0&&(this._opts.text.style=o.text.style);var v,m=this._createSvgView(this._opts);if(v=n.isString(l)?document.querySelector(l):l,!v)throw new Error("Container does not exist: "+l);this._container=v,this._container.appendChild(m.svg),this._opts.warnings&&this._warnContainerAspectRatio(this._container),this._opts.svgStyle&&n.setStyles(m.svg,this._opts.svgStyle),this.svg=m.svg,this.path=m.path,this.trail=m.trail,this.text=null;var c=n.extend({attachment:void 0,shape:this},this._opts);this._progressPath=new a(m.path,c),n.isObject(this._opts.text)&&this._opts.text.value!==null&&this.setText(this._opts.text.value)}};s.prototype.animate=function(u,l,o){if(this._progressPath===null)throw new Error(e);this._progressPath.animate(u,l,o)},s.prototype.stop=function(){if(this._progressPath===null)throw new Error(e);this._progressPath!==void 0&&this._progressPath.stop()},s.prototype.destroy=function(){if(this._progressPath===null)throw new Error(e);this.stop(),this.svg.parentNode.removeChild(this.svg),this.svg=null,this.path=null,this.trail=null,this._progressPath=null,this.text!==null&&(this.text.parentNode.removeChild(this.text),this.text=null)},s.prototype.set=function(u){if(this._progressPath===null)throw new Error(e);this._progressPath.set(u)},s.prototype.value=function(){if(this._progressPath===null)throw new Error(e);return this._progressPath===void 0?0:this._progressPath.value()},s.prototype.setText=function(u){if(this._progressPath===null)throw new Error(e);this.text===null&&(this.text=this._createTextContainer(this._opts,this._container),this._container.appendChild(this.text)),n.isObject(u)?(n.removeChildren(this.text),this.text.appendChild(u)):this.text.innerHTML=u},s.prototype._createSvgView=function(u){var l=document.createElementNS("http://www.w3.org/2000/svg","svg");this._initializeSvg(l,u);var o=null;(u.trailColor||u.trailWidth)&&(o=this._createTrail(u),l.appendChild(o));var v=this._createPath(u);return l.appendChild(v),{svg:l,path:v,trail:o}},s.prototype._initializeSvg=function(u,l){u.setAttribute("viewBox","0 0 100 100")},s.prototype._createPath=function(u){var l=this._pathString(u);return this._createPathElement(l,u)},s.prototype._createTrail=function(u){var l=this._trailString(u),o=n.extend({},u);return o.trailColor||(o.trailColor="#eee"),o.trailWidth||(o.trailWidth=o.strokeWidth),o.color=o.trailColor,o.strokeWidth=o.trailWidth,o.fill=null,this._createPathElement(l,o)},s.prototype._createPathElement=function(u,l){var o=document.createElementNS("http://www.w3.org/2000/svg","path");return o.setAttribute("d",u),o.setAttribute("stroke",l.color),o.setAttribute("stroke-width",l.strokeWidth),l.fill?o.setAttribute("fill",l.fill):o.setAttribute("fill-opacity","0"),o},s.prototype._createTextContainer=function(u,l){var o=document.createElement("div");o.className=u.text.className;var v=u.text.style;return v&&(u.text.autoStyleContainer&&(l.style.position="relative"),n.setStyles(o,v),v.color||(o.style.color=u.color)),this._initializeTextContainer(u,l,o),o},s.prototype._initializeTextContainer=function(u,l,o){},s.prototype._pathString=function(u){throw new Error("Override this function for each progress bar")},s.prototype._trailString=function(u){throw new Error("Override this function for each progress bar")},s.prototype._warnContainerAspectRatio=function(u){if(this.containerAspectRatio){var l=window.getComputedStyle(u,null),o=parseFloat(l.getPropertyValue("width"),10),v=parseFloat(l.getPropertyValue("height"),10);n.floatEquals(this.containerAspectRatio,o/v)||(console.warn("Incorrect aspect ratio of container","#"+u.id,"detected:",l.getPropertyValue("width")+"(width)","/",l.getPropertyValue("height")+"(height)","=",o/v),console.warn("Aspect ratio of should be",this.containerAspectRatio))}},r.exports=s},{"./path":5,"./utils":9}],8:[function(t,r,i){var a=t("./shape"),n=t("./utils"),e=function(s,u){this._pathTemplate="M 0,{halfOfStrokeWidth} L {width},{halfOfStrokeWidth} L {width},{width} L {halfOfStrokeWidth},{width} L {halfOfStrokeWidth},{strokeWidth}",this._trailTemplate="M {startMargin},{halfOfStrokeWidth} L {width},{halfOfStrokeWidth} L {width},{width} L {halfOfStrokeWidth},{width} L {halfOfStrokeWidth},{halfOfStrokeWidth}",a.apply(this,arguments)};e.prototype=new a,e.prototype.constructor=e,e.prototype._pathString=function(s){var u=100-s.strokeWidth/2;return n.render(this._pathTemplate,{width:u,strokeWidth:s.strokeWidth,halfOfStrokeWidth:s.strokeWidth/2})},e.prototype._trailString=function(s){var u=100-s.strokeWidth/2;return n.render(this._trailTemplate,{width:u,strokeWidth:s.strokeWidth,halfOfStrokeWidth:s.strokeWidth/2,startMargin:s.strokeWidth/2-s.trailWidth/2})},r.exports=e},{"./shape":7,"./utils":9}],9:[function(t,r,i){function a(g,S,T){g=g||{},S=S||{},T=T||!1;for(var E in S)if(S.hasOwnProperty(E)){var O=g[E],A=S[E];T&&m(O)&&m(A)?g[E]=a(O,A,T):g[E]=A}return g}function n(g,S){var T=g;for(var E in S)if(S.hasOwnProperty(E)){var O=S[E],A="\\{"+E+"\\}",P=new RegExp(A,"g");T=T.replace(P,O)}return T}function e(g,S,T){for(var E=g.style,O=0;O<p.length;++O){var A=p[O];E[A+u(S)]=T}E[S]=T}function s(g,S){c(S,function(T,E){T!=null&&(m(T)&&T.prefix===!0?e(g,E,T.value):g.style[E]=T)})}function u(g){return g.charAt(0).toUpperCase()+g.slice(1)}function l(g){return typeof g=="string"||g instanceof String}function o(g){return typeof g=="function"}function v(g){return Object.prototype.toString.call(g)==="[object Array]"}function m(g){if(v(g))return!1;var S=typeof g;return S==="object"&&!!g}function c(g,S){for(var T in g)if(g.hasOwnProperty(T)){var E=g[T];S(E,T)}}function f(g,S){return Math.abs(g-S)<C}function w(g){for(;g.firstChild;)g.removeChild(g.firstChild)}var p="Webkit Moz O ms".split(" "),C=.001;r.exports={extend:a,render:n,setStyle:e,setStyles:s,capitalize:u,isString:l,isFunction:o,isObject:m,forEachObject:c,floatEquals:f,removeChildren:w}},{}]},{},[4])(4)});const gt={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;","`":"&#96;"};function vt(t,...r){const i=new RegExp(Object.keys(gt).join("|"),"g");function a(n=""){return String(n).replace(i,e=>gt[e])}return t.raw.reduce((n,e,s)=>{let u=r[s-1];return Array.isArray(u)?u=u.join(""):t.raw[s-1]&&t.raw[s-1].endsWith("$")?n=n.slice(0,-1):u=a(u),n+u+e})}var Q=window.location.origin,Er=function(t){const r=t.slice(t.indexOf("?")),i=/([^&=]+)=?([^&]*)/g,a=r.substring(1),n={};let e;for(;e=i.exec(a);){const s=decodeURIComponent(e[1]),u=decodeURIComponent(e[2]);n[s]=u}return n},Tr=function(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16))},qr=Tr(),D=function(t,r){try{const i=document.querySelector("#kamidata");if(i){const a=i.dataset.kamiUserId;if(a){r=r||{},r.version_name="Kami Schoology",r.session_id=qr;const n={name:t,value:r};K.post(`${Cr}/events`,n,{params:{user_id:a}})}}}catch(i){console.error(i)}},W=document.createElement("div"),U=Er(document.location.search);let ie=!1;try{ie=!!localStorage.getItem("kami-grader")}catch{}document.head.insertAdjacentHTML("beforeend",`<style type="text/css">
.km-tooltip {
  position: relative;
  display: inline-block;
}

.km-tooltip .km-tooltiptext {
  width: 241px;
  text-align: center;
  border-radius: 1px;
  padding: 1em;
  position: absolute;
  z-index: 1;
  border: 1px solid black;
  right: -68px;
  margin-top: 2px;
  background-color: white;
}

.km-tooltiptext {
  visibility: hidden;
}

.km-tooltip:hover .km-tooltiptext {
  visibility: visible;
}

.km-graded-wrapper {
  padding: 2px 25px 3px 6px; 
  font-weight: 600;
  position: absolute; 
  margin-left: -140px; 
  margin-top: 14px;
}

.km-ungraded-wrapper {
  font-weight: 600;
  position: absolute; 
  margin-left: -140px; 
}
</style>`);function Or(t){let r=document.querySelector("#grade_with_kami_wrapper");if(r)return;let i=document.querySelector("#s-grade-item-edit-enrollment-grade-form"),a="beforebegin",n="km-graded-wrapper",e="Grade with Kami";if(i||(i=document.querySelector("#dropbox-viewer-grade"),a="afterbegin",n="km-ungraded-wrapper",e="Open with Kami"),!i)return null;let s=`<div id="grade_with_kami_wrapper"
  class="${t?"km-tooltip":""} ${n}">
    ${e}
  <input type="checkbox" style="margin-left: 4px;" ${t?"disabled":""} />
  <div class="km-tooltiptext">
    ${t}
  </div>
</div>`;if(i.insertAdjacentHTML(a,s),r=document.querySelector("#grade_with_kami_wrapper"),r){let u=r.querySelector("input");u&&(u.checked=ie,u.onchange=l=>{if(ie=l.target.checked,ie){try{localStorage.setItem("kami-grader",1)}catch{}let o=bt(yt());o&&St(o)}else{try{localStorage.removeItem("kami-grader")}catch{}xt()}})}}function Pr(){return document.querySelector("#dropbox-viewer-revision-select-button .ui-selectmenu-status").innerText.split(" ")[1]}function yt(){let t=document.querySelectorAll(".comment-body-wrapper"),r=null;for(let i=t.length-1;i>-1;i--){let a=t[i];if(wt(a)){let e=a.querySelector(".revision-notification");if(e){r=e.innerText.split(" ")[1];break}else if(a.innerText.match(/Open Revision [0-9]+ in Kami/)){r=a.innerText.match(/Open Revision ([0-9]+) in Kami/)[1];break}}}return r}function _t(){const t=`${V}/web/images/turnin-left.gif`;document.querySelector("body").insertAdjacentHTML("beforeend",`<img class="turnin-animation turnin-animation-left" src="${t}" />`),document.querySelector("body").insertAdjacentHTML("beforeend",`<img class="turnin-animation turnin-animation-right" src="${t}" />`)}function wt(t){if(!t)return null;let r=t.querySelector("a");if(!r)return null;let i=r.href;if(!i)return null;if(i.includes("web/viewer.html")){let a=i.split("viewer.html?")[1],n=new URLSearchParams(a);if(n.get("state")){let e=JSON.parse(n.get("state"));if(e.ids&&e.ids[0])return{document_identifier:e.ids[0],storage:"googledrive"}}if(n.get("source")==="onedrive")return{document_identifier:n.get("document_identifier"),encoded_onedrive_drive_id:n.get("encoded_onedrive_drive_id"),storage:"onedrive"}}else return null}function bt(t){let r=document.querySelectorAll(".comment-body-wrapper");if(!r)return null;for(let i=0;i<r.length;i++){let a=r[i],n=a.querySelector(".revision-notification");if(n){if(n.innerText.split(" ")[1]!==t)continue}else if(!a.innerText.includes(`Open Revision ${t} in Kami`))continue;let e=wt(a);if(e)return e}return null}function kt(){let t=document.querySelectorAll("iframe"),r=Array.from(t).findIndex(i=>i.id!=="kami-iframe"&&(!i.style.display||i.attributes["km-schoology-iframe"]));return t[r]}function St(t){let r=document.querySelector("#kami-iframe"),i=kt();if(i&&(i.style.display="none",i.setAttribute("km-schoology-iframe",1)),!r&&t){let a;if(t.storage==="onedrive")a=`${V}/web/viewer.html?document_identifier=${t.document_identifier}&source=onedrive&encoded_onedrive_drive_id=${t.encoded_onedrive_drive_id}&schoology_grading=1`;else{const e={ids:[t.document_identifier]};a=`${V}/web/viewer.html?state=${encodeURIComponent(JSON.stringify(e))}&schoology_grading=1`}i.insertAdjacentHTML("afterend",vt`
    <iframe 
      src="${a}" id="kami-iframe" 
      frameborder="0" width="100%" height="100%" allowfullscreen="true" allow="${"accelerometer *; ambient-light-sensor *; autoplay *; camera *;   encrypted-media *; fullscreen *; geolocation *; gyroscope *; magnetometer *;   microphone *; midi *; payment *; picture-in-picture *; speaker *; usb *; vr *;   clipboard-read *; clipboard-write *; display-capture *;"}"
    />
  `)}}function xt(){let t=kt();t&&(t.style.display="",t.removeAttribute("km-schoology-iframe"))}function Ie(){let t=Pr(),r=yt(),i=bt(t),a=null;t!=r&&(i?a=`Kami can not be used to grade this assignment submission 
    because Kami has a copy of a later revision.`:a=`Kami can not be used to grade this assignment submission 
    because a valid Kami link could not be found.`),Or(a),!a&&ie?St(i):xt()}var Ct=!!document.querySelector('link[href="https://asset-cdn.schoology.com/sites/all/modules/schoology_core/s_course/s_course_unified_ui.css"'),Ar=document.location.pathname.match(/^\/assignment\/([0-9]+)\/info/),Et=document.location.pathname.match(/^\/assignment\/([0-9]+)\/dropbox\/view\/[0-9]/),Le=Ar||Et;if(Le){try{Ct||Dr()}catch(i){D("Schoology Error",{state:"Error",message:i.message,tag:"match_updates_page"})}Et&&document.location.href.match(/\?from_gb=1$/)&&Ie(),new MutationObserver(function(i){let a=!1;i.forEach(function(n){if(n.addedNodes)for(let e=0;e<n.addedNodes.length;e++){let s=n.addedNodes[e];!a&&s.attributes&&s.attributes.class&&s.attributes.class.value.includes("popups-extra-large")&&(Ie(),a=!0),!a&&["dropbox-viewer-revision-select-button","dropbox-viewer-user-select-menu","dropbox-viewer-item-select-menu"].includes(s.id)&&(Ie(),a=!0)}})}).observe(document.querySelector("body"),{childList:!0})}var Rr=document.location.pathname.match(/^\/course\/([0-9]+)\/updates/),Ir=document.location.pathname.match(/^\/home\/recent-activity/)||document.location.pathname.match(/^\/home/);if(Rr||Ir)try{Tt();var Lr=document.querySelectorAll("#main-inner .item-list"),$r=new MutationObserver(function(t){Tt()});Lr.forEach(function(t){$r.observe(t,{childList:!0,subtree:!0})})}catch(t){D("Schoology Error",{state:"Error",message:t.message,tag:"match_updates_page"})}function Dr(){var t=Le[1],r=document.querySelectorAll("#main-inner .attachments-file");if(r.forEach(function(o){const v=o.querySelector(".attachments-file-name a");if(!(!!o.querySelector(".pdf-icon")||v.href.endsWith(".pdf")))return;var f=o.querySelector(".sExtlink-processed").href,w=o.querySelector(".sExtlink-processed").innerText,p=document.querySelector(".page-title").innerText;const C=o.querySelector(".infotip-content"),g=f.match(/\/attachment\/([0-9]+)\/source/);if(!g)return;const S=g[1],T=C&&C.textContent.includes("k_sch_"),E={schoology:{assignment_id:t,assignment_name:p,attachment_id:S,schoology_origin:Q,is_kami_assignment:T}};C&&T&&(E.schoology.storage=C.textContent.includes("k_o_k_sch_")?"onedrive":"googledrive");function O(N){const B="schoology-"+t+"-attachment-"+S,h=new URL(f);T&&h.searchParams.set("schoology_encoded_file_name",C.textContent);const y=new URL(`${V}/web/viewer.html`);y.searchParams.set("file",h.toString()),y.searchParams.set("individual_copy_key",B),y.searchParams.set("source","schoology"),y.searchParams.set("integration_data",JSON.stringify(E)),y.searchParams.set("filename",w),y.searchParams.set("referer",document.location.href),window.open(y.toString(),"_blank")}let A=o.querySelector(".attachments-file-name"),P=A.querySelector(".view-file-popup");P&&(P.style.display="none");let F=o.querySelector(".delete-attachment"),M=document.createElement("div");M.classList="kami-open-button-container";let d=T?"Assignment ":"";M.innerHTML=`<a class="link-btn kami-open-button" target="_blank" title="Open ${d}With Kami" alt="open ${d}with kami"><span></span>Open ${d}With Kami</a>`,M.addEventListener("click",O),o.insertBefore(M,F);let _=A.querySelector("a")||A.querySelector(".sExtlink-processed");_.onclick=function(N){N.preventDefault(),O()};let k=`<div class="action-links-wrapper action-links-wrapper-regular " style="display: inline-block; float: none; position: relative;">
    <div tabindex="0" role="button" href="#" class="action-links-unfold" style="display: inline-block; font-size: 15px; color: rgba(0, 0, 0, 0); height: 24px;" alt="more actions" title="More Actions">
      <span class="action-links-unfold-text" style="height: 23px; user-select: none;">o</span>
    </div>
    <ul class="action-links" style="display: none; right: 0;">
      <li class="action-edit"><a href="${P.href}" id="edit-assignment" class="popups-processed sExtlink-processed" title="View PDF" alt="view pdf">View PDF</a></li>
      <li class="action-library-save"><a href="${_.href}" id="save-assignment-to-resources" class="popups-processed sExtlink-processed" title="Download" alt="download">Download</a></li>
    </ul>
  </div>`;W.innerHTML=k;let R=W.children[0];W.removeChild(R),o.insertBefore(R,F);let q=R.querySelector(".action-links-unfold"),L=q.parentNode.parentNode.querySelector(".action-links");window.addEventListener("click",function(N){N.target===q||q.contains(N.target)||L.style.display!=="none"&&(L.style.display="none")}),q.addEventListener("click",function(){L.style.display==="none"?L.style.display="block":L.style.display="none"})}),U.kami_return_assignment_url){D("Schoology Turnin",{state:"PageScript Initial"});var i=`<div class="kami-overlay kami-overlay-fullscreen">
  <img src="${V}/web/images/icon256.png" id="kami-logo">
    <div id="kami-progress-bar"></div>
  </div>`;W.innerHTML=i;var i=W.children[0];W.removeChild(i),document.body.appendChild(i);var a=new ProgressBar.Line("#kami-progress-bar",{strokeWidth:8,color:"#873ECF",trailColor:"#c9c9c9",trailWidth:4,svgStyle:{width:"100%",height:"100%"},text:{value:"Getting Ready...",style:{color:"#000",padding:20,margin:0,transform:null},autoStyleContainer:!1},step:function(o,v){v.setText(`Submitting assignment ${Math.round(v.value()*100)} %`)}}),n=document.querySelector("[href='/assignment/"+t+"/dropbox/submit']");if(!n){history.pushState(null,"",document.location.toString().split("?")[0]),i.remove(),alert("We were unable to turn in this file. This may be because you are a teacher in this course, or because the assignment is locked, or submissions might be disabled. You can return to Kami by clicking the 'Open With Kami' button and export your work manually."),D("Schoology Turnin",{state:"Failed",cause:"SUBMIT_NOT_FOUND"});return}n.click();var e=U.kami_return_assignment_file_name||"submission.pdf",s=e.match(/^(.*)\.(\S*)$/);s?e=s[1]+".pdf":e=e+".pdf";var u=function(){D("Schoology Turnin",{state:"Fetch return PDF"}),K.get(U.kami_return_assignment_url,{responseType:"blob",onDownloadProgress:function(o){a.animate(o.loaded/o.total*.5)}}).catch(function(o){console.warn("Kami Fetch PDF error",o),D("Schoology Turnin",{state:"Fetch PDF error",error:o,url_params:U})}).then(function(o){D("Schoology Turnin",{state:"Upload To Schoology"});var v=new FormData;return v.append("name",e),v.append("use_plain",1),v.append("file",o.data),K.post(`${Q}/file/upload-service`,v,{headers:{Authorization:"Bearer "+Drupal.settings.s_attachment.file_service_upload.token},onUploadProgress:function(m){a.animate(m.loaded/m.total*.5+.5)}})}).then(function(o){D("Schoology Turnin",{state:"Show Submit Dialog"});var v=o.data,m={};m[v.fileMetadataId]={title:e,encode:!0},document.querySelector("[name='file[files]'").value=JSON.stringify(m);var c=vt`
          <div class="progressWrapper" id="o_1cer5oedb1u3qlrt61qr7s174oa" style="opacity: 1;">
            <div class="progressContainer green">
              <span class="progressName" id="file-${v.fileMetadataId}">${e}</span>
              <div class="progressBarStatus">Complete</div><div class="progressBarComplete" style="">
              </div>
              <div class="file-details-content clearfix" style="display: none;">
              </div>
            </div>
          </div>
        `;W.innerHTML=c;var f=W.children[0];W.removeChild(f),document.querySelector("#attachments-added-container").appendChild(f),Popups.resizeAndCenter(Popups.activePopup()),history.pushState(null,"",document.location.toString().split("?")[0]);var w=document.querySelector("#dropbox-submit-upload-tab-content form");w.action=w.action.split("%3F")[0];var p=U.document_identifier;if(p&&p!="undefined"){let C;U.storage==="onedrive"?(p=encodeURIComponent(p).replace(/!/g,"%21"),C=`${V}/web/viewer.html?document_identifier=${p}&source=onedrive`,U.onedrive_drive_id&&(C+=`&encoded_onedrive_drive_id=${window.btoa(U.onedrive_drive_id)}`)):C=`${V}/web/viewer.html?state=${encodeURIComponent(JSON.stringify({ids:[p],action:"open"}))}`,$("textarea#edit-drop-item-comment").val("Open in Kami: "+C),$("textarea#edit-drop-item-comment").prop("readonly",!0);let g=document.querySelector("#edit-submit");g&&g.addEventListener("click",function(){_t()})}$(i).hide()}).catch(function(o){console.warn("Kami error showing submit dialog",o),D("Schoology Turnin",{state:"Show Submit Dialog Error",error:o.toString(),url_params:U})})};D("Schoology Turnin",{state:"Waiting for upload token"});var l=setInterval(function(){Drupal&&Drupal.settings&&Drupal.settings.s_attachment&&Drupal.settings.s_attachment.file_service_upload&&Drupal.settings.s_attachment.file_service_upload.token&&(clearInterval(l),u())},100)}}function Tt(){var t=document.querySelectorAll('#main-inner .attachments-file:not([kami-processed="true"])');t.forEach(function(r){if(r.setAttribute("kami-processed","true"),r.querySelector(".pdf-icon")){let o=function(v){const m=new URL(`${V}/web/viewer.html`);m.searchParams.set("file",i),m.searchParams.set("individual_copy_key",l),m.searchParams.set("source","schoology"),m.searchParams.set("filename",a),m.searchParams.set("referer",document.location.href),window.open(m.toString(),"_blank")};var i=r.querySelector(".sExtlink-processed").href,a=r.querySelector(".sExtlink-processed").innerText;const s=i.match(/\/attachment\/([0-9]+)\/source/);if(!s)return;const l="schoology-attachment-"+s[1];var n=r.querySelector(".attachments-file-name"),e=document.createElement("a");e.innerHTML="OPEN WITH KAMI",e.classList="kami-link",e.addEventListener("click",o),n.appendChild(e)}})}var Mr=document.location.pathname.match(/^\/assignment\/([0-9]+)\//),Fr=document.location.pathname.match(/^\/course\/([0-9]+)\/materials-unified/);if((Mr||Fr)&&Ct&&U.kami_return_assignment_url){D("Schoology Elementary Turnin",{state:"PageScript Initial"});var ce=`<div class="kami-overlay kami-overlay-fullscreen">
    <img src="${V}/web/images/icon256.png" id="kami-logo">
      <div id="kami-progress-bar"></div>
      <div id="kami-completed" class="kami-elementary-message" style="display: none">
          Your assignment has been submitted
      </div>
      <div id="kami-error" class="kami-elementary-message" style="display: none">
          There was an error submitting your assignment, please try again.
      </div>
      <button id="kami-finished-button" style="display: none;">Done</button>
    </div>`;W.innerHTML=ce;var ce=W.children[0];W.removeChild(ce),document.body.appendChild(ce);var qt=new ProgressBar.Line("#kami-progress-bar",{strokeWidth:8,color:"#873ECF",trailColor:"#c9c9c9",trailWidth:4,svgStyle:{width:"100%",height:"100%"},text:{value:"Getting Ready...",style:{color:"#000",padding:20,margin:0,transform:null},autoStyleContainer:!1},step:function(i,a){a.setText(`Submitting assignment ${Math.round(a.value()*100)} %`)}});let t=U.kami_return_assignment_file_name||"submission.pdf",r=t.match(/^(.*)\.(\S*)$/);r?t=r[1]+".pdf":t=t+".pdf",D("Schoology Elementary Turnin",{state:"Fetch return PDF"}),K.get(U.kami_return_assignment_url,{responseType:"blob",onDownloadProgress:function(i){qt.animate(i.loaded/i.total*.5)}}).catch(function(i){console.warn("Kami Fetch PDF error",i),D("Schoology Elementary Turnin",{state:"Fetch PDF error",error:i,url_params:U})}).then(function(i){return K.get(`${Q}/uploads/token`).then(function(a){return D("Schoology Elementary Turnin",{state:"Upload To Schoology"}),K.post(`${Q}/svc/file-upload-service/multipart/start`,{},{headers:{Authorization:`Bearer ${a.data.data.token}`}}).then(function(n){return K.post(`${Q}/svc/file-upload-service/multipart/chunk`,{filename:n.data.filename,uploadId:n.data.uploadId,partNumber:1},{headers:{Authorization:`Bearer ${a.data.data.token}`}}).then(function(e){return K.put(e.data.signedUrl,i.data,{onUploadProgress:function(s){qt.animate(s.loaded/s.total*.5+.5)}}).then(function(s){return console.log(s),K.post(`${Q}/svc/file-upload-service/multipart/finish`,{etags:[{eTag:s.headers.etag,partNumber:1}],filemime:"application/pdf",filename:n.data.filename,uploadId:n.data.uploadId},{headers:{Authorization:`Bearer ${a.data.data.token}`}})})})})})}).then(function(i){D("Schoology Elementary Turnin",{state:"Submit Assignment"});let a=document.location.pathname.match(/^\/assignment\/([0-9]+)\//)[1],e=document.evaluate("//script[contains(., 'course-materials-container')]",document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue.innerHTML,s=e.match(/\"csrf\":{\"key":\"([^\"]+)\","token":"([^\"]+)\"}/),u=s[1],l=s[2],o=e.match(/sectionId":"([0-9]+)"/)[1];return K.post(`${Q}/v2/sections/${o}/assignments/${a}/upload`,{fileId:i.data.fileId,fileType:"upload"},{headers:{"x-csrf-key":u,"x-csrf-token":l}}).then(function(){var v=U.document_identifier;if(v&&v!="undefined"){let m;return U.storage==="onedrive"?(v=encodeURIComponent(v).replace(/!/g,"%21"),m=`${V}/web/viewer.html?document_identifier=${v}&source=onedrive`,U.onedrive_drive_id&&(m+=`&encoded_onedrive_drive_id=${window.btoa(U.onedrive_drive_id)}`)):m=`${V}/web/viewer.html?state=${encodeURIComponent(JSON.stringify({ids:[v],action:"open"}))}`,K.get(`${Q}/v2/sections/${o}/assignments/${a}`).then(function(c){return K.get(c.data.submissions.viewUrl).then(function(f){D("Schoology Elementary Turnin",{state:"Got View Dropbox Response",response:f});let w=f.data.match(/s-drop-item-add-comment-form-form-token\" value="([A-z0-9]+)"/)[1],p=f.data.match(/form_build_id"\ id="([A-z0-9\-]+)"/)[1];var C=new FormData;C.append("form_build_id",p),C.append("form_token",w),C.append("form_id","s_drop_item_add_comment_form"),C.append("op","Add Comment"),C.append("drupal_ajax","1");let g=c.data.submissions.revisions.pop().revisionId;return C.append("comment","Open Revision "+g+" in Kami: "+m),K.post(c.data.submissions.viewUrl,C)})}).catch(function(c){D("Schoology Elementary Turnin",{state:"Submit Grading Comment Error",error:c.toString(),stack:c.stack,url_params:U})})}else return Promise.resolve()})}).then(function(){D("Schoology Elementary Turnin",{state:"Success"}),document.querySelector("#kami-progress-bar").remove(),document.querySelector("#kami-finished-button").addEventListener("click",function(){document.location=window.location.href.replace(window.location.search,"")}),document.querySelector("#kami-completed").style.display="block",document.querySelector("#kami-finished-button").style.display="block";const i=document.querySelector("#kami-logo"),a=document.querySelector("#tick-url");a&&(i.src=a.dataset.tickUrl,i.style.width="60px"),_t()}).catch(function(i){document.querySelector("#kami-error").style.display="block",document.querySelector("#kami-finished-button").style.display="block",document.querySelector("#kami-finished-button").addEventListener("click",function(){document.location=window.location.href.replace(window.location.search,"")}),console.warn("Kami error showing submit dialog",i),script_tags=Array.from(document.querySelectorAll("script")).map(function(a){return a.innerHTML}).filter(function(a){return a.length>20}),D("Schoology Elementary Turnin",{state:"Submission Error",error:i.toString(),stack:i.stack,url_params:U,script_tags})})}var Ot=document.location.pathname.match(/^\/course\/([0-9]+)\/materials/),Pt=document.location.pathname.match(/^\/course\/([0-9]+)\/grades/);(Ot||Pt||Le)&&typeof Drupal<"u"&&(Drupal.behaviors.sGradeItemKamiAssignmentSubmission=function(t){r()||i();function r(){const c=document.head.querySelector("[data-kami-hide-create-assignment-button]");return c&&c.dataset.kamiHideCreateAssignmentButton==="true"}function i(){try{var c=$(".course-material-type-assignment",t);if(!c.length)return;a(),n(),D("Schoology Assignment Dialog",{state:"Show"})}catch(f){console.log(f),D("Schoology Assignment Dialog",{state:"Error",error:f.message})}}function a(){var c=`<div class="s-grade-item-assignment-submission-app" tabindex="0" data-app-nid="kami">
        <div class="app-logo-container"><img class="app-logo" src="${V}/web/images/icon48.png"></div>
        <div class="app-title">Kami</div>
        <div class="kami-tooltip">New! Assign Kami files from Schoology and allow students to turn in in-app! <a href="https://help.kamihq.com/schoology/using-kamis-schoology-integration" target="_blank">Learn More</a>
        </div>`;W.innerHTML=c;var f=W.children[0];W.removeChild(f);var w=document.querySelector(".s-grade-item-assignment-submission-apps");if(w==null){var p=`<div id="s-grade-item-assignment-submission-wrapper" class="form-row-wrapper s-grade-item-assignment-submission-inline-wrapper clearfix"><input type="hidden" name="assignment_submission_id" id="edit-assignment-submission-id" value=""><link rel="stylesheet" href="https://asset-cdn.schoology.com/sites/all/modules/schoology_core/s_grades/s_grade_item/s_grade_item_assignment_submission.css">
  <div class="form-item ">
  <label>Assign From App: </label>
  </div>
  <div class="s-grade-item-assignment-submission-container"><div class="s-grade-item-assignment-submission-apps">
  </div>
  <div class="s-grade-item-assignment-submission-content" style="display:none">
        <div class="s-grade-item-assignment-submission-content-icon"></div>
        <div class="s-grade-item-assignment-submission-content-title"></div>
        <a href="#" class="s-grade-item-assignment-submission-content-remove sExtlink-processed" tabindex="0"></a>
        <div class="s-grade-item-assignment-submission-content-hint">This will create a copy of your file for each student</div>
      </div>
  </div>`;W.innerHTML=p;var C=W.children[0];W.removeChild(C);var g=document.querySelector("#attachments");g.parentElement.insertBefore(C,g.nextSibling);var S=document.querySelector(".s-grade-item-assignment-submission-content-remove");S.addEventListener("click",function(T){$(".s-grade-item-assignment-submission-content",t).hide(),$(".s-grade-item-assignment-submission-app",t).show().removeClass("active"),$(".adv-option-btn.toggle-dropbox").show();var E=$(".adv-option-btn.toggle-comments");E.hasClass("adv-option-on")||E.click(),E.show()}),w=document.querySelector(".s-grade-item-assignment-submission-apps")}w.appendChild(f),f.addEventListener("click",s,{capture:!0}),window.addEventListener("message",u)}function n(){var c=document.querySelector("[name='file[files]'"),f={};try{f=JSON.parse(c.value)}catch{}for(const p of Object.keys(f))if(f[p].kami_assignment){var w={title:f[p].title};l(w)}}var e;function s(c){if(!c.target.closest(".kami-tooltip")){c.stopPropagation(),c.preventDefault(),c.stopImmediatePropagation(),Popups.saveSettings(),D("Schoology Assignment Dialog",{state:"Open Picker Iframe"});var w=Popups.activePopup(),p=Popups.options({ajaxForm:!1,extraClass:"popups-extra-large s-grade-item-assignment-submission-popup",updateMethod:"none",hijackDestination:!1,disableCursorMod:!0,disableAttachBehaviors:!1}),C=`<iframe id="schoology-app-container" frameborder="0" width="100%" height="600" 
        src="${V}/web/viewer.html?open_dialog=lti_google_file_picker&seamless_dialog=true&parent_origin=${encodeURIComponent(Q)}&schoology=1&supports_microsoft=1" name="schoology-app-container"
        class="sAppLauncher-processed" style="height: 600px;"></iframe>
        `;e=Popups.openPathContent("assignment_submission_app","Add Assignment From Kami",C,c.target,p,w)}}function u(c){if(c.data&&c.data.type==="kami_file_picker"){if(c.data.action==="cancel")Popups.close(e),D("Schoology Assignment Dialog",{state:"Picker iFrame Cancel"});else if(c.data.action==="picked"){D("Schoology Assignment Dialog",{state:"Picker iFrame File Picked"});var f=`<div class="kami-overlay">
              <img src="${V}/web/images/icon256.png" id="kami-logo">
              <div id="kami-progress-bar"></div>
            </div>`;document.querySelector(`#${e.id}  .popups-body`).innerHTML=f;var w=new ProgressBar.Line("#kami-progress-bar",{strokeWidth:8,color:"#873ECF",trailColor:"#c9c9c9",trailWidth:4,svgStyle:{width:"100%",height:"100%"},text:{value:"Getting Ready...",style:{color:"#000",padding:20,margin:0,transform:null},autoStyleContainer:!1},step:function(P,F){F.setText(Math.round(F.value()*100)+" %")}}),p=c.data,C=p.file_name.match(/^(.*)\.(\S*)$/),g,S=p.current_user.current_license,T="";S&&S.license_key&&S.allow_auto_enrollment&&(T="k_lic_"+btoa(S.license_key)+"_");var E="";switch(p.storage){case"onedrive":E="k_o_";break;case"googledrive":E="k_g_";break}var O="k_sch_"+btoa(p.current_user.email)+"_";C?g=O+C[1]+".pdf":g=O+p.file_name+".pdf",g=T+E+g;const A={};p.authorization_header&&(A.Authorization=p.authorization_header),K.get(p.download_url,{responseType:"blob",onDownloadProgress:function(P){w.animate(P.loaded/P.total*.5)},headers:A}).then(function(P){var F=new FormData;return F.append("name",g),F.append("use_plain",1),F.append("chunks",1),F.append("chunk",0),F.append("file",P.data),K.post(`${Q}/s_attachment_upload_chunked/2`,F,{onUploadProgress:function(M){w.animate(M.loaded/M.total*.5+.5)}})}).then(function(P){if(console.log(P),P.request.responseURL.startsWith("https://app.schoology.com/login")){Popups.openPathContent("assignment_submission_logged_out_error","Logged Out",`<div class="kami-logged-out-dialog">
                    <p>You have been logged out of Schoology. Please login and try again.</p>

                    <button onclick="window.location.href = 'https://app.schoology.com/login'" class="kami-logged-out-dialog-login-button">Log In</button>
                  </div>`,null,Popups.options({ajaxForm:!1,updateMethod:"none",hijackDestination:!1,disableCursorMod:!0,disableAttachBehaviors:!1}),Popups.activePopup());return}var M=document.querySelector("[name='file[files]'"),d={};try{d=JSON.parse(M.value)}catch{}let _=p.file_name+".Kami";d[P.data.file.fid]={title:_,encode:!0,kami_assignment:!0},M.value=JSON.stringify(d),l({title:_});var k=document.querySelector(".s-grade-item-assignment-submission-content-remove"),R=function(q){var L={};try{L=JSON.parse(M.value)}catch{}delete L[P.data.file.fid],M.value=JSON.stringify(L),k.removeEventListener("click",R)};k.addEventListener("click",R),Popups.close(e),D("Schoology Assignment Dialog",{state:"Kami Attachment Ready"})}).catch(function(P){document.querySelector(`#${e.id} .popups-body .kami-overlay`).innerHTML=`
              <div style="margin: 0 5em">
                <h5 color="">Oops, an error occurred when loading your file</h5>
                <p>It is possible that some of the network resources used by Kami have been blocked.
                  Please contact your network administrator and make sure 
                  <a href="https://help.kamiapp.com/en/articles/1420804-kami-network-requirements" target="_blank">
                    Kami Network Requirements
                  </a> are met.
                </p>
                <pre class="debug-message" ng-if="error_message">${p.debug_print}</pre>
              </div>`;const F=P.config?P.config.url:void 0,M=P.response?P.response.status:void 0;D("Schoology Error",{error:{name:P.name,message:P.message,stack:P.stack,url:F,response_status:M}})})}}}function l(c){$(".s-grade-item-assignment-submission-app, .s-grade-item-kami-assignment-submission-app").each(function(){var f=$(this);f.data("app-nid")=="kami"?f.addClass("active"):f.hide()}),c.icon&&c.icon.url&&($(".s-grade-item-assignment-submission-content-icon").css("background-image","url("+c.icon.url+")"),c.icon.width&&c.icon.height&&o(c)),$(".s-grade-item-assignment-submission-content-title").text(c.title),$(".s-grade-item-assignment-submission-content").show(),v(),m()}function o(c){var f=$(".s-grade-item-assignment-submission-content-icon"),w=$(".s-grade-item-assignment-submission-content-title"),p=parseInt(w.css("max-width"),10),C=parseInt(f.css("width"),10),g=+c.icon.width;w.css("max-width",p+C-g+"px"),f.css("width",c.icon.width+"px"),f.css("height",c.icon.height+"px")}function v(){var c=$(".adv-option-btn.toggle-dropbox");c.hasClass("adv-option-on")||c.click(),c.hide()}function m(){var c=$(".adv-option-btn.toggle-comments");c.hasClass("adv-option-on")&&c.click(),c.hide()}}),(Ot||Pt)&&setInterval(()=>{let t=document.querySelector(".popups-box");if(t){let r=t.querySelector("#edit-external-tool-consumer-key-wrapper"),i=t.querySelector("#edit-external-tool-shared-secret-wrapper"),a=t.querySelector("textarea#edit-external-tool-url");if(a&&["https://api.local.kamipdf.com","https://api-staging.kamihq.com","https://canary.kamihq.com/api","https://canary2.kamihq.com/api","https://api-test.kamihq.com","https://api-test1.kamihq.com","https://api-test2.kamihq.com","https://api-test3.kamihq.com","https://api-test4.kamihq.com","https://api-test5.kamihq.com","https://api-test6.kamihq.com","https://api-test7.kami.systems","https://api-test8.kami.systems","https://api-test9.kami.systems","https://api.kamihq.com"].some(s=>a.value.startsWith(s))){if(r){let s=r.querySelector("input");s.value="",r.style.display="none"}if(i){let s=i.querySelector("input");s.value="",i.style.display="none"}}}},500),document.location.pathname.match(/^\/external_tool\/([0-9]+)\/launch/)&&(iframe=document.querySelector("iframe#external-tool-iframe"),iframe&&(iframe.allow="geolocation *; microphone *; camera *; midi *; encrypted-media *; autoplay *; clipboard-write *; display-capture *; fullscreen *;",iframe.setAttribute("allowfullscreen","allowfullscreen"),iframe.setAttribute("webkitallowfullscreen","true"),iframe.setAttribute("mozallowfullscreen","true"),iframe.src=iframe.src))})();
