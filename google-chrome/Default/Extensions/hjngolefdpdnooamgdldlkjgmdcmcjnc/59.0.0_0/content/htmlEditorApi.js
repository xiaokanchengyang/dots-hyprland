(()=>{"use strict";var e,t,n={Insert:"INSERT_HTML_EDITOR",Extract:"EXTRACT_SELECTION_HTML_EDITOR",SetEditor:"SET_HTML_EDITOR"},i=(e,t)=>{window.postMessage({type:"EQUATIO_HTML_EDITOR_API_RESPONSE",action:e,value:t})},o="tinymce",r=()=>{if(!window.tinyMCE||!window.tinyMCE.activeEditor)return!1;var t=window.tinyMCE.activeEditor;if(3===e){if(!t.initialized)return!1;var n=t.getWin().frameElement;return document.activeElement===n}return t.hasFocus()},a=e=>{t&&clearTimeout(t),t=setTimeout((()=>{window.tinyMCE.activeEditor&&(e||r())?i(n.SetEditor,o):i(n.SetEditor,null)}),100)},d=t=>{var n=()=>a(!0);if(3===e){var i=e=>{var t=e.getWin();t.addEventListener("focusin",n),t.addEventListener("focus",n)};t.initialized?i(t):t.onInit.add((()=>i(t)))}else t.on("focusin",n),t.on("focus",n)},c=()=>a(),E=!1,s=()=>{var t;E||(window.tinyMCE.editors?t=window.tinyMCE.editors:"function"==typeof window.tinyMCE.get&&(t=window.tinyMCE.get()),t&&t.length&&t.forEach((e=>{d(e)})),3===e?(window.tinyMCE.onAddEditor.add(((e,t)=>d(t))),window.tinyMCE.onRemoveEditor.add(c)):(window.tinyMCE.on("AddEditor",(e=>d(e.editor))),window.tinyMCE.on("RemoveEditor",c)),E=!0)},w=(e,t)=>{if(window.tinyMCE.activeEditor)try{return window.tinyMCE.activeEditor.execCommand("mceInsertContent",!1,t),void i(e,!0)}catch(t){console.error(t),i(e,null)}},l=e=>{if(window.tinyMCE&&window.tinyMCE.activeEditor)try{var t=window.tinyMCE.activeEditor.selection.getContent();return void i(e,t)}catch(t){console.error(t),i(e,null)}},v=()=>{window.addEventListener("message",(e=>{if(e.source===window&&e.data&&"EQUATIO_HTML_EDITOR_API"===e.data.type&&e.data.targetEditor===o)switch(e.data.action){case n.Insert:w(e.data.action,e.data.value);break;case n.Extract:l(e.data.action);break;case n.SetEditor:a()}}))},u=()=>{var t=window.tinyMCE.majorVersion;if(!t)return!1;var n=Number(t);return!(Number.isNaN(n)||n<3)&&(e=n,!0)},m=!1;const C=()=>{!m&&window.tinyMCE&&u()&&(s(),v(),m=!0)};var T,g,y="contentEditable";function f(e){if(!T)throw new Error("NO_ACTIVE_INSERT_RANGE");var t=window.getSelection();t.removeAllRanges(),t.addRange(T);var n=t.getRangeAt(0);if(n.deleteContents(),g&&g.insertHtml)g.insertHtml(e);else{var i=document.createElement("div");i.innerHTML=e;for(var o,r=document.createDocumentFragment();o=i.firstChild;)r.appendChild(o);n.insertNode(r),n.collapse(!1),t.removeAllRanges(),t.addRange(n),T=n}}var M,I,R=(e,t)=>{try{return f(t),void i(e,!0)}catch(t){console.error(t),i(e,null)}},_=e=>{try{var t=window.getSelection();t.removeAllRanges(),t.addRange(T);var n=t.getRangeAt(0),o=t.anchorOffset,r=n.commonAncestorContainer;if(!r||1!==r.nodeType)return void i(e," ");var a=r,d=r.childNodes;return d&&d.length-1>=o&&(a=d[o]),"IMG"!==a.nodeName?void i(e," "):void i(e,a.outerHTML)}catch(t){console.error(t),i(e,null)}},h=()=>{var e=window.getSelection().getRangeAt(0);T=e},p=e=>e?1===e.nodeType?e:e.parentElement?p(e.parentElement):null:null,A=()=>{var e=window.getSelection().anchorNode,t=p(e);if((!t||!t.closest(".equatio-toolbar-wrapper"))&&(t||!document.activeElement||!document.activeElement.closest(".equatio-toolbar-wrapper"))){if(t&&t.isContentEditable)return h(),M=!0,void i(n.SetEditor,y);M&&(M=!1,i(n.SetEditor,null))}},L=()=>{var e=()=>{I&&clearTimeout(I),I=setTimeout(A,200)};document.addEventListener("selectionchange",e),document.addEventListener("selectstart",e)},S=e=>{if(e.source===window&&e.data&&"EQUATIO_HTML_EDITOR_API"===e.data.type&&e.data.targetEditor===y)switch(e.data.action){case n.Insert:R(e.data.action,e.data.value);break;case n.Extract:_(e.data.action);break;case n.SetEditor:A()}},N=()=>{var e=window.getSelection().anchorNode,t=p(e);return!(!t||!t.closest(".equatio-toolbar-wrapper"))},O=()=>{try{if(window.LRNCKEDITOR||window.CKEDITOR){var e=window.LRNCKEDITOR||window.CKEDITOR;if(!e.on)return;e.on("currentInstance",(()=>{N()||(g=e.currentInstance)}))}}catch(e){}},b=!1;const D=()=>{b||(window.addEventListener("message",S),L(),O(),b=!0)};var H=()=>{C(),D()};window.addEventListener("focus",(()=>{H()})),H()})();