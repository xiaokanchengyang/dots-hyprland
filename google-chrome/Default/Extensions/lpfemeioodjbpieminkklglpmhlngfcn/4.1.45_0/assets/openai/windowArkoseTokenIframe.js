import{a as r}from"../../chunks/WZHIWEFG.js";import{i as s}from"../../chunks/3PS7M655.js";var m=class{constructor(e,t){s(this,"model");s(this,"apiLink");s(this,"enforcement");s(this,"pendingPromises",[]);s(this,"isReady");s(this,"config");s(this,"status");this.isReady=!0,this.status="unSetConfig",this.model=e,this.apiLink=t,this.enforcement=void 0,this.pendingPromises=[],this.model==="gpt_3_5"?window.useArkoseSetupEnforcementgpt35=this.useArkoseSetupEnforcement.bind(this):this.model==="gpt_4"&&(window["useArkoseSetupEnforcementchatgpt-paid"]=this.useArkoseSetupEnforcement.bind(this)),this.injectScript()}useArkoseSetupEnforcement(e){this.enforcement=e}injectScript(){let e=document.createElement("script");this.model==="gpt_3_5"?(e.src=this.apiLink,e.setAttribute("data-callback","useArkoseSetupEnforcementgpt35"),e.setAttribute("data-status","loading")):this.model==="gpt_4"&&(e.src=this.apiLink,e.setAttribute("data-callback","useArkoseSetupEnforcementchatgpt-paid"),e.setAttribute("data-status","loading")),document.body.appendChild(e)}async generate(e){for(let t=12;t>0&&!this.enforcement;t--)await new Promise(n=>setTimeout(n,1e3));return this.enforcement?new Promise((t,n)=>{var d,c,p,g;this.pendingPromises=[{resolve:t,reject:n}],e&&((d=this.enforcement)==null||d.setConfig({data:{blob:e}})),this.status!=="ready"?(c=this.enforcement)==null||c.setConfig({selector:"#useArkoseSetupEnforcementchatgpt-paid",mode:"inline",onCompleted:o=>{this.pendingPromises.length,this.pendingPromises.forEach(i=>{i.resolve(o.token)}),this.pendingPromises=[]},onReady:()=>{var o,i;this.status="ready",this.isReady=!0,(o=this.enforcement)==null||o.reset(),(i=this.enforcement)==null||i.run()},onError:o=>{},onFailed:o=>{this.pendingPromises.forEach(i=>{i.reject(new Error("Failed to generate arkose token"))})}}):((p=this.enforcement)==null||p.reset(),(g=this.enforcement)==null||g.run())}):""}},u,l=(u=document.querySelector("script[data-arkose_token_gpt_3_5]"))==null?void 0:u.getAttribute("data-arkose_token_gpt_3_5"),h,f=(h=document.querySelector("script[data-arkose_token_gpt_4]"))==null?void 0:h.getAttribute("data-arkose_token_gpt_4");if(l&&f){let a=new m("gpt_3_5",l),e=new m("gpt_4",f);a.isReady||e.isReady?(window.parent.postMessage({id:r,type:"inject_iframe_response",data:{success:!0}},"*"),window.addEventListener("message",async t=>{var n,d;if(t.data&&t.data.id===r){let c=((d=(n=t.data)==null?void 0:n.data)==null?void 0:d.model)||"gpt_3_5";if(t.data.type==="ping")t.source.postMessage({type:"pong",id:r,data:{success:c==="gpt_3_5"?a.isReady:e.isReady}},t.origin);else if(t.data.type==="get_token"){let{dx:p}=t.data.data,g=c==="gpt_3_5"?a:e,o=await Promise.race([e.generate(p)]);t.source.postMessage({type:"get_token_response",id:r,data:{token:o}},t.origin),o&&(e.isReady=!1,a.isReady=!1)}}})):window.parent.postMessage({id:r,type:"inject_iframe_response",data:{success:!1}},"*")}
