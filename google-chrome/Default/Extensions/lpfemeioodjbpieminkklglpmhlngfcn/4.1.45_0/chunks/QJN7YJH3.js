import{a as l}from"./IWA7K7OR.js";import{a as U}from"./TSWQGEA7.js";import{h as R}from"./KHXRDVYA.js";import{a as O}from"./XXRKTLQP.js";import{f as E}from"./3PS7M655.js";var c=E(O());var o="USECHATGPT_AUTH_INFO_STORAGE_KEY_20230829";var p={new_user:0,old_free_user:0,pro_gift:0,free:0,pro:1,elite:2};var T=E(U());var m={GET_USER_INFO:"/user/get_user_info",TWITTER_SHARE_COMPLETE:"/user/twitter_share_complete",TWITTER_FOLLOWING_COMPLETE:"/user/twitter_following_complete",GET_REFERRAL_DASHBOARD:"/user/get_referral_dashboard",SAVE_TWITTER_SCREEN_NAME:"/user/save_twitter_screen_name",GET_TWITTER_REFERRAL_TASKS_STATUS:"/user/get_twitter_referral_tasks_status",GET_USER_SUBSCRIPTION_INFO:"/user/get_user_subscription_info"},I={GET_FAVOURITE_PROMPTS:"/prompt/get_favourite_prompts",GET_OWN_PROMPTS:"/prompt/get_own_prompts",SEARCH_PROMPT:"/prompt/search_prompt",GET_PROMPT_DETAIL:"/prompt/get_prompt_detail",GET_PRIVATE_PROMPT_DETAIL:"/prompt/get_private_prompt_detail",PROMPT_CATEGORY:"/prompt/category",ADD_PROMPT:"/prompt/add_own_prompt",ADD_FAVOURITE_PROMPT:"/prompt/add_favourite_prompt",REMOVE_FAVOURITE_PROMPT:"/prompt/remove_favourite_prompt",DELETE_PROMPT:"/prompt/remove_own_prompt",EDIT_OWN_PROMPT:"/prompt/update_own_prompt"};var y=()=>{try{let e=window.localStorage.getItem("UseChatGPTAuthServiceProvider.email"),t=`UseChatGPTAuthServiceProvider.${e}`,r=window.localStorage.getItem(t+".accessToken"),s=window.localStorage.getItem(t+".refreshToken");return s?{accessToken:r,refreshToken:s,email:e}:null}catch(e){return null}},u=async()=>{var t;let e=await c.default.storage.local.get(o);return e[o]?(t=e[o])==null?void 0:t.refreshToken:""},C=async()=>{var t;let e=await c.default.storage.local.get(o);return e[o]?(t=e[o])==null?void 0:t.userInfo:null},N=async()=>(await new l({runtime:"client"}).postMessage({event:"Client_logoutUseChatGPTAuth"})).success,L=async()=>{try{let e=await u();if(!e)return;let t=await fetch(`${R}${m.GET_USER_SUBSCRIPTION_INFO}`,{headers:{Authorization:`Bearer ${e}`}});if(t.ok){let r=await t.json();if(r.status==="OK"&&r.data)return r.data}return}catch(e){return}},F=e=>{var t,r;try{let n=[...(t=e.roles)!=null?t:[]].sort((a,i)=>(p[i.name]||0)-(p[a.name]||0)),_=((r=n==null?void 0:n[0])==null?void 0:r.name)||"free",P=!1;if(e!=null&&e.chatgpt_expires_at&&_==="free"&&new Date(e.chatgpt_expires_at).getTime()>new Date().getTime()&&(_="pro_gift"),_==="free"&&(e!=null&&e.created_at)){let a=(0,T.default)(e==null?void 0:e.created_at);(0,T.default)().utc().diff(a,"day")<=-1e5&&(_="new_user",P=!0)}return _}catch(s){return"free"}};export{o as a,I as b,y as c,u as d,C as e,N as f,L as g,F as h};
