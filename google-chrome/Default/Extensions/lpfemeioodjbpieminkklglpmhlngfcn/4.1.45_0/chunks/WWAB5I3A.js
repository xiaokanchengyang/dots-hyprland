import{D as uo,I as ho,L as po,N as Rt,O as fo,R as yo}from"./GTVKCQRS.js";import{c as mo,d as It}from"./IBXKRLTS.js";import{c as lo}from"./RKUV5YFC.js";import{a as At,b as Gn,f as co}from"./24PMNBYU.js";import{a as Ur,d as wt,f as Nt,g as ao}from"./QJN7YJH3.js";import{a as G}from"./SSXGEXEV.js";import{a as ye}from"./E5ZZU67S.js";import{a as So,c as qr,d as Un}from"./B47LU4I6.js";import{a as Mn}from"./IWA7K7OR.js";import{c as Kt,g as xt,h as Gr,i as Je,j as io,l as On,s as oo,v as Xe,w as Dn}from"./KHXRDVYA.js";import{a as gt}from"./XXRKTLQP.js";import{a as Hr,c as go,j as Br}from"./3RR3WT5X.js";import{a as no,c as H,f as Ne,i as v}from"./3PS7M655.js";var sa=H((Ep,ui)=>{function ra(r,e){if(e&&e.documentElement)r=e,e=arguments[2];else if(!r||!r.documentElement)throw new Error("First argument to Readability constructor should be a document object.");if(e=e||{},this._doc=r,this._docJSDOMParser=this._doc.firstChild.__JSDOMParser__,this._articleTitle=null,this._articleByline=null,this._articleDir=null,this._articleSiteName=null,this._attempts=[],this._debug=!!e.debug,this._maxElemsToParse=e.maxElemsToParse||this.DEFAULT_MAX_ELEMS_TO_PARSE,this._nbTopCandidates=e.nbTopCandidates||this.DEFAULT_N_TOP_CANDIDATES,this._charThreshold=e.charThreshold||this.DEFAULT_CHAR_THRESHOLD,this._classesToPreserve=this.CLASSES_TO_PRESERVE.concat(e.classesToPreserve||[]),this._keepClasses=!!e.keepClasses,this._serializer=e.serializer||function(t){return t.innerHTML},this._disableJSONLD=!!e.disableJSONLD,this._allowedVideoRegex=e.allowedVideoRegex||this.REGEXPS.videos,this._flags=this.FLAG_STRIP_UNLIKELYS|this.FLAG_WEIGHT_CLASSES|this.FLAG_CLEAN_CONDITIONALLY,this._debug){let t=function(s){if(s.nodeType==s.TEXT_NODE)return`${s.nodeName} ("${s.textContent}")`;let n=Array.from(s.attributes||[],function(i){return`${i.name}="${i.value}"`}).join(" ");return`<${s.localName} ${n}>`};this.log=function(){if(typeof console!="undefined")Array.from(arguments,i=>i&&i.nodeType==this.ELEMENT_NODE?t(i):i).unshift("Reader: (Readability)");else if(typeof dump!="undefined"){var s=Array.prototype.map.call(arguments,function(n){return n&&n.nodeName?t(n):n}).join(" ");dump("Reader: (Readability) "+s+`
`)}}}else this.log=function(){}}ra.prototype={FLAG_STRIP_UNLIKELYS:1,FLAG_WEIGHT_CLASSES:2,FLAG_CLEAN_CONDITIONALLY:4,ELEMENT_NODE:1,TEXT_NODE:3,DEFAULT_MAX_ELEMS_TO_PARSE:0,DEFAULT_N_TOP_CANDIDATES:5,DEFAULT_TAGS_TO_SCORE:"section,h2,h3,h4,h5,h6,p,td,pre".toUpperCase().split(","),DEFAULT_CHAR_THRESHOLD:500,REGEXPS:{unlikelyCandidates:/-ad-|ai2html|banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|footer|gdpr|header|legends|menu|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote/i,okMaybeItsACandidate:/and|article|body|column|content|main|shadow/i,positive:/article|body|content|entry|hentry|h-entry|main|page|pagination|post|text|blog|story/i,negative:/-ad-|hidden|^hid$| hid$| hid |^hid |banner|combx|comment|com-|contact|foot|footer|footnote|gdpr|masthead|media|meta|outbrain|promo|related|scroll|share|shoutbox|sidebar|skyscraper|sponsor|shopping|tags|tool|widget/i,extraneous:/print|archive|comment|discuss|e[\-]?mail|share|reply|all|login|sign|single|utility/i,byline:/byline|author|dateline|writtenby|p-author/i,replaceFonts:/<(\/?)font[^>]*>/gi,normalize:/\s{2,}/g,videos:/\/\/(www\.)?((dailymotion|youtube|youtube-nocookie|player\.vimeo|v\.qq)\.com|(archive|upload\.wikimedia)\.org|player\.twitch\.tv)/i,shareElements:/(\b|_)(share|sharedaddy)(\b|_)/i,nextLink:/(next|weiter|continue|>([^\|]|$)|»([^\|]|$))/i,prevLink:/(prev|earl|old|new|<|«)/i,tokenize:/\W+/g,whitespace:/^\s*$/,hasContent:/\S$/,hashUrl:/^#.+/,srcsetUrl:/(\S+)(\s+[\d.]+[xw])?(\s*(?:,|$))/g,b64DataUrl:/^data:\s*([^\s;,]+)\s*;\s*base64\s*,/i,jsonLdArticleTypes:/^Article|AdvertiserContentArticle|NewsArticle|AnalysisNewsArticle|AskPublicNewsArticle|BackgroundNewsArticle|OpinionNewsArticle|ReportageNewsArticle|ReviewNewsArticle|Report|SatiricalArticle|ScholarlyArticle|MedicalScholarlyArticle|SocialMediaPosting|BlogPosting|LiveBlogPosting|DiscussionForumPosting|TechArticle|APIReference$/},UNLIKELY_ROLES:["menu","menubar","complementary","navigation","alert","alertdialog","dialog"],DIV_TO_P_ELEMS:new Set(["BLOCKQUOTE","DL","DIV","IMG","OL","P","PRE","TABLE","UL"]),ALTER_TO_DIV_EXCEPTIONS:["DIV","ARTICLE","SECTION","P"],PRESENTATIONAL_ATTRIBUTES:["align","background","bgcolor","border","cellpadding","cellspacing","frame","hspace","rules","style","valign","vspace"],DEPRECATED_SIZE_ATTRIBUTE_ELEMS:["TABLE","TH","TD","HR","PRE"],PHRASING_ELEMS:["ABBR","AUDIO","B","BDO","BR","BUTTON","CITE","CODE","DATA","DATALIST","DFN","EM","EMBED","I","IMG","INPUT","KBD","LABEL","MARK","MATH","METER","NOSCRIPT","OBJECT","OUTPUT","PROGRESS","Q","RUBY","SAMP","SCRIPT","SELECT","SMALL","SPAN","STRONG","SUB","SUP","TEXTAREA","TIME","VAR","WBR"],CLASSES_TO_PRESERVE:["page"],HTML_ESCAPE_MAP:{lt:"<",gt:">",amp:"&",quot:'"',apos:"'"},_postProcessContent:function(r){this._fixRelativeUris(r),this._simplifyNestedElements(r),this._keepClasses||this._cleanClasses(r)},_removeNodes:function(r,e){if(this._docJSDOMParser&&r._isLiveNodeList)throw new Error("Do not pass live node lists to _removeNodes");for(var t=r.length-1;t>=0;t--){var s=r[t],n=s.parentNode;n&&(!e||e.call(this,s,t,r))&&n.removeChild(s)}},_replaceNodeTags:function(r,e){if(this._docJSDOMParser&&r._isLiveNodeList)throw new Error("Do not pass live node lists to _replaceNodeTags");for(let t of r)this._setNodeTag(t,e)},_forEachNode:function(r,e){Array.prototype.forEach.call(r,e,this)},_findNode:function(r,e){return Array.prototype.find.call(r,e,this)},_someNode:function(r,e){return Array.prototype.some.call(r,e,this)},_everyNode:function(r,e){return Array.prototype.every.call(r,e,this)},_concatNodeLists:function(){var r=Array.prototype.slice,e=r.call(arguments),t=e.map(function(s){return r.call(s)});return Array.prototype.concat.apply([],t)},_getAllNodesWithTag:function(r,e){return r.querySelectorAll?r.querySelectorAll(e.join(",")):[].concat.apply([],e.map(function(t){var s=r.getElementsByTagName(t);return Array.isArray(s)?s:Array.from(s)}))},_cleanClasses:function(r){var e=this._classesToPreserve,t=(r.getAttribute("class")||"").split(/\s+/).filter(function(s){return e.indexOf(s)!=-1}).join(" ");for(t?r.setAttribute("class",t):r.removeAttribute("class"),r=r.firstElementChild;r;r=r.nextElementSibling)this._cleanClasses(r)},_fixRelativeUris:function(r){var e=this._doc.baseURI,t=this._doc.documentURI;function s(o){if(e==t&&o.charAt(0)=="#")return o;try{return new URL(o,e).href}catch(c){}return o}var n=this._getAllNodesWithTag(r,["a"]);this._forEachNode(n,function(o){var c=o.getAttribute("href");if(c)if(c.indexOf("javascript:")===0)if(o.childNodes.length===1&&o.childNodes[0].nodeType===this.TEXT_NODE){var l=this._doc.createTextNode(o.textContent);o.parentNode.replaceChild(l,o)}else{for(var a=this._doc.createElement("span");o.firstChild;)a.appendChild(o.firstChild);o.parentNode.replaceChild(a,o)}else o.setAttribute("href",s(c))});var i=this._getAllNodesWithTag(r,["img","picture","figure","video","audio","source"]);this._forEachNode(i,function(o){var c=o.getAttribute("src"),l=o.getAttribute("poster"),a=o.getAttribute("srcset");if(c&&o.setAttribute("src",s(c)),l&&o.setAttribute("poster",s(l)),a){var u=a.replace(this.REGEXPS.srcsetUrl,function(p,T,S,f){return s(T)+(S||"")+f});o.setAttribute("srcset",u)}})},_simplifyNestedElements:function(r){for(var e=r;e;){if(e.parentNode&&["DIV","SECTION"].includes(e.tagName)&&!(e.id&&e.id.startsWith("readability"))){if(this._isElementWithoutContent(e)){e=this._removeAndGetNext(e);continue}else if(this._hasSingleTagInsideElement(e,"DIV")||this._hasSingleTagInsideElement(e,"SECTION")){for(var t=e.children[0],s=0;s<e.attributes.length;s++)t.setAttribute(e.attributes[s].name,e.attributes[s].value);e.parentNode.replaceChild(t,e),e=t;continue}}e=this._getNextNode(e)}},_getArticleTitle:function(){var r=this._doc,e="",t="";try{e=t=r.title.trim(),typeof e!="string"&&(e=t=this._getInnerText(r.getElementsByTagName("title")[0]))}catch(u){}var s=!1;function n(u){return u.split(/\s+/).length}if(/ [\|\-\\\/>»] /.test(e))s=/ [\\\/>»] /.test(e),e=t.replace(/(.*)[\|\-\\\/>»] .*/gi,"$1"),n(e)<3&&(e=t.replace(/[^\|\-\\\/>»]*[\|\-\\\/>»](.*)/gi,"$1"));else if(e.indexOf(": ")!==-1){var i=this._concatNodeLists(r.getElementsByTagName("h1"),r.getElementsByTagName("h2")),o=e.trim(),c=this._someNode(i,function(u){return u.textContent.trim()===o});c||(e=t.substring(t.lastIndexOf(":")+1),n(e)<3?e=t.substring(t.indexOf(":")+1):n(t.substr(0,t.indexOf(":")))>5&&(e=t))}else if(e.length>150||e.length<15){var l=r.getElementsByTagName("h1");l.length===1&&(e=this._getInnerText(l[0]))}e=e.trim().replace(this.REGEXPS.normalize," ");var a=n(e);return a<=4&&(!s||a!=n(t.replace(/[\|\-\\\/>»]+/g,""))-1)&&(e=t),e},_prepDocument:function(){var r=this._doc;this._removeNodes(this._getAllNodesWithTag(r,["style"])),r.body&&this._replaceBrs(r.body),this._replaceNodeTags(this._getAllNodesWithTag(r,["font"]),"SPAN")},_nextNode:function(r){for(var e=r;e&&e.nodeType!=this.ELEMENT_NODE&&this.REGEXPS.whitespace.test(e.textContent);)e=e.nextSibling;return e},_replaceBrs:function(r){this._forEachNode(this._getAllNodesWithTag(r,["br"]),function(e){for(var t=e.nextSibling,s=!1;(t=this._nextNode(t))&&t.tagName=="BR";){s=!0;var n=t.nextSibling;t.parentNode.removeChild(t),t=n}if(s){var i=this._doc.createElement("p");for(e.parentNode.replaceChild(i,e),t=i.nextSibling;t;){if(t.tagName=="BR"){var o=this._nextNode(t.nextSibling);if(o&&o.tagName=="BR")break}if(!this._isPhrasingContent(t))break;var c=t.nextSibling;i.appendChild(t),t=c}for(;i.lastChild&&this._isWhitespace(i.lastChild);)i.removeChild(i.lastChild);i.parentNode.tagName==="P"&&this._setNodeTag(i.parentNode,"DIV")}})},_setNodeTag:function(r,e){if(this.log("_setNodeTag",r,e),this._docJSDOMParser)return r.localName=e.toLowerCase(),r.tagName=e.toUpperCase(),r;for(var t=r.ownerDocument.createElement(e);r.firstChild;)t.appendChild(r.firstChild);r.parentNode.replaceChild(t,r),r.readability&&(t.readability=r.readability);for(var s=0;s<r.attributes.length;s++)try{t.setAttribute(r.attributes[s].name,r.attributes[s].value)}catch(n){}return t},_prepArticle:function(r){this._cleanStyles(r),this._markDataTables(r),this._fixLazyImages(r),this._cleanConditionally(r,"form"),this._cleanConditionally(r,"fieldset"),this._clean(r,"object"),this._clean(r,"embed"),this._clean(r,"footer"),this._clean(r,"link"),this._clean(r,"aside");var e=this.DEFAULT_CHAR_THRESHOLD;this._forEachNode(r.children,function(t){this._cleanMatchedNodes(t,function(s,n){return this.REGEXPS.shareElements.test(n)&&s.textContent.length<e})}),this._clean(r,"iframe"),this._clean(r,"input"),this._clean(r,"textarea"),this._clean(r,"select"),this._clean(r,"button"),this._cleanHeaders(r),this._cleanConditionally(r,"table"),this._cleanConditionally(r,"ul"),this._cleanConditionally(r,"div"),this._replaceNodeTags(this._getAllNodesWithTag(r,["h1"]),"h2"),this._removeNodes(this._getAllNodesWithTag(r,["p"]),function(t){var s=t.getElementsByTagName("img").length,n=t.getElementsByTagName("embed").length,i=t.getElementsByTagName("object").length,o=t.getElementsByTagName("iframe").length,c=s+n+i+o;return c===0&&!this._getInnerText(t,!1)}),this._forEachNode(this._getAllNodesWithTag(r,["br"]),function(t){var s=this._nextNode(t.nextSibling);s&&s.tagName=="P"&&t.parentNode.removeChild(t)}),this._forEachNode(this._getAllNodesWithTag(r,["table"]),function(t){var s=this._hasSingleTagInsideElement(t,"TBODY")?t.firstElementChild:t;if(this._hasSingleTagInsideElement(s,"TR")){var n=s.firstElementChild;if(this._hasSingleTagInsideElement(n,"TD")){var i=n.firstElementChild;i=this._setNodeTag(i,this._everyNode(i.childNodes,this._isPhrasingContent)?"P":"DIV"),t.parentNode.replaceChild(i,t)}}})},_initializeNode:function(r){switch(r.readability={contentScore:0},r.tagName){case"DIV":r.readability.contentScore+=5;break;case"PRE":case"TD":case"BLOCKQUOTE":r.readability.contentScore+=3;break;case"ADDRESS":case"OL":case"UL":case"DL":case"DD":case"DT":case"LI":case"FORM":r.readability.contentScore-=3;break;case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"TH":r.readability.contentScore-=5;break}r.readability.contentScore+=this._getClassWeight(r)},_removeAndGetNext:function(r){var e=this._getNextNode(r,!0);return r.parentNode.removeChild(r),e},_getNextNode:function(r,e){if(!e&&r.firstElementChild)return r.firstElementChild;if(r.nextElementSibling)return r.nextElementSibling;do r=r.parentNode;while(r&&!r.nextElementSibling);return r&&r.nextElementSibling},_textSimilarity:function(r,e){var t=r.toLowerCase().split(this.REGEXPS.tokenize).filter(Boolean),s=e.toLowerCase().split(this.REGEXPS.tokenize).filter(Boolean);if(!t.length||!s.length)return 0;var n=s.filter(o=>!t.includes(o)),i=n.join(" ").length/s.join(" ").length;return 1-i},_checkByline:function(r,e){if(this._articleByline)return!1;if(r.getAttribute!==void 0)var t=r.getAttribute("rel"),s=r.getAttribute("itemprop");return(t==="author"||s&&s.indexOf("author")!==-1||this.REGEXPS.byline.test(e))&&this._isValidByline(r.textContent)?(this._articleByline=r.textContent.trim(),!0):!1},_getNodeAncestors:function(r,e){e=e||0;for(var t=0,s=[];r.parentNode&&(s.push(r.parentNode),!(e&&++t===e));)r=r.parentNode;return s},_grabArticle:function(r){this.log("**** grabArticle ****");var e=this._doc,t=r!==null;if(r=r||this._doc.body,!r)return this.log("No body found in document. Abort."),null;for(var s=r.innerHTML;;){this.log("Starting grabArticle loop");var n=this._flagIsActive(this.FLAG_STRIP_UNLIKELYS),i=[],o=this._doc.documentElement;let ro=!0;for(;o;){o.tagName==="HTML"&&(this._articleLang=o.getAttribute("lang"));var c=o.className+" "+o.id;if(!this._isProbablyVisible(o)){this.log("Removing hidden node - "+c),o=this._removeAndGetNext(o);continue}if(o.getAttribute("aria-modal")=="true"&&o.getAttribute("role")=="dialog"){o=this._removeAndGetNext(o);continue}if(this._checkByline(o,c)){o=this._removeAndGetNext(o);continue}if(ro&&this._headerDuplicatesTitle(o)){this.log("Removing header: ",o.textContent.trim(),this._articleTitle.trim()),ro=!1,o=this._removeAndGetNext(o);continue}if(n){if(this.REGEXPS.unlikelyCandidates.test(c)&&!this.REGEXPS.okMaybeItsACandidate.test(c)&&!this._hasAncestorTag(o,"table")&&!this._hasAncestorTag(o,"code")&&o.tagName!=="BODY"&&o.tagName!=="A"){this.log("Removing unlikely candidate - "+c),o=this._removeAndGetNext(o);continue}if(this.UNLIKELY_ROLES.includes(o.getAttribute("role"))){this.log("Removing content with role "+o.getAttribute("role")+" - "+c),o=this._removeAndGetNext(o);continue}}if((o.tagName==="DIV"||o.tagName==="SECTION"||o.tagName==="HEADER"||o.tagName==="H1"||o.tagName==="H2"||o.tagName==="H3"||o.tagName==="H4"||o.tagName==="H5"||o.tagName==="H6")&&this._isElementWithoutContent(o)){o=this._removeAndGetNext(o);continue}if(this.DEFAULT_TAGS_TO_SCORE.indexOf(o.tagName)!==-1&&i.push(o),o.tagName==="DIV"){for(var l=null,a=o.firstChild;a;){var u=a.nextSibling;if(this._isPhrasingContent(a))l!==null?l.appendChild(a):this._isWhitespace(a)||(l=e.createElement("p"),o.replaceChild(l,a),l.appendChild(a));else if(l!==null){for(;l.lastChild&&this._isWhitespace(l.lastChild);)l.removeChild(l.lastChild);l=null}a=u}if(this._hasSingleTagInsideElement(o,"P")&&this._getLinkDensity(o)<.25){var p=o.children[0];o.parentNode.replaceChild(p,o),o=p,i.push(o)}else this._hasChildBlockElement(o)||(o=this._setNodeTag(o,"P"),i.push(o))}o=this._getNextNode(o)}var T=[];this._forEachNode(i,function(ze){if(!(!ze.parentNode||typeof ze.parentNode.tagName=="undefined")){var nt=this._getInnerText(ze);if(!(nt.length<25)){var so=this._getNodeAncestors(ze,5);if(so.length!==0){var Mr=0;Mr+=1,Mr+=nt.split(",").length,Mr+=Math.min(Math.floor(nt.length/100),3),this._forEachNode(so,function(mt,Pn){if(!(!mt.tagName||!mt.parentNode||typeof mt.parentNode.tagName=="undefined")){if(typeof mt.readability=="undefined"&&(this._initializeNode(mt),T.push(mt)),Pn===0)var Ln=1;else Pn===1?Ln=2:Ln=Pn*3;mt.readability.contentScore+=Mr/Ln}})}}}});for(var S=[],f=0,C=T.length;f<C;f+=1){var E=T[f],_=E.readability.contentScore*(1-this._getLinkDensity(E));E.readability.contentScore=_,this.log("Candidate:",E,"with score "+_);for(var N=0;N<this._nbTopCandidates;N++){var q=S[N];if(!q||_>q.readability.contentScore){S.splice(N,0,E),S.length>this._nbTopCandidates&&S.pop();break}}}var w=S[0]||null,D=!1,A;if(w===null||w.tagName==="BODY"){for(w=e.createElement("DIV"),D=!0;r.firstChild;)this.log("Moving child out:",r.firstChild),w.appendChild(r.firstChild);r.appendChild(w),this._initializeNode(w)}else if(w){for(var J=[],K=1;K<S.length;K++)S[K].readability.contentScore/w.readability.contentScore>=.75&&J.push(this._getNodeAncestors(S[K]));var R=3;if(J.length>=R)for(A=w.parentNode;A.tagName!=="BODY";){for(var m=0,y=0;y<J.length&&m<R;y++)m+=Number(J[y].includes(A));if(m>=R){w=A;break}A=A.parentNode}w.readability||this._initializeNode(w),A=w.parentNode;for(var P=w.readability.contentScore,me=P/3;A.tagName!=="BODY";){if(!A.readability){A=A.parentNode;continue}var ie=A.readability.contentScore;if(ie<me)break;if(ie>P){w=A;break}P=A.readability.contentScore,A=A.parentNode}for(A=w.parentNode;A.tagName!="BODY"&&A.children.length==1;)w=A,A=w.parentNode;w.readability||this._initializeNode(w)}var M=e.createElement("DIV");t&&(M.id="readability-content");var $=Math.max(10,w.readability.contentScore*.2);A=w.parentNode;for(var te=A.children,we=0,pt=te.length;we<pt;we++){var j=te[we],Jt=!1;if(this.log("Looking at sibling node:",j,j.readability?"with score "+j.readability.contentScore:""),this.log("Sibling has score",j.readability?j.readability.contentScore:"Unknown"),j===w)Jt=!0;else{var Zi=0;if(j.className===w.className&&w.className!==""&&(Zi+=w.readability.contentScore*.2),j.readability&&j.readability.contentScore+Zi>=$)Jt=!0;else if(j.nodeName==="P"){var eo=this._getLinkDensity(j),to=this._getInnerText(j),Rn=to.length;(Rn>80&&eo<.25||Rn<80&&Rn>0&&eo===0&&to.search(/\.( |$)/)!==-1)&&(Jt=!0)}}Jt&&(this.log("Appending node:",j),this.ALTER_TO_DIV_EXCEPTIONS.indexOf(j.nodeName)===-1&&(this.log("Altering sibling:",j,"to div."),j=this._setNodeTag(j,"DIV")),M.appendChild(j),te=A.children,we-=1,pt-=1)}if(this._debug&&this.log("Article content pre-prep: "+M.innerHTML),this._prepArticle(M),this._debug&&this.log("Article content post-prep: "+M.innerHTML),D)w.id="readability-page-1",w.className="page";else{var Dr=e.createElement("DIV");for(Dr.id="readability-page-1",Dr.className="page";M.firstChild;)Dr.appendChild(M.firstChild);M.appendChild(Dr)}this._debug&&this.log("Article content after paging: "+M.innerHTML);var kn=!0,Xt=this._getInnerText(M,!0).length;if(Xt<this._charThreshold)if(kn=!1,r.innerHTML=s,this._flagIsActive(this.FLAG_STRIP_UNLIKELYS))this._removeFlag(this.FLAG_STRIP_UNLIKELYS),this._attempts.push({articleContent:M,textLength:Xt});else if(this._flagIsActive(this.FLAG_WEIGHT_CLASSES))this._removeFlag(this.FLAG_WEIGHT_CLASSES),this._attempts.push({articleContent:M,textLength:Xt});else if(this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY))this._removeFlag(this.FLAG_CLEAN_CONDITIONALLY),this._attempts.push({articleContent:M,textLength:Xt});else{if(this._attempts.push({articleContent:M,textLength:Xt}),this._attempts.sort(function(ze,nt){return nt.textLength-ze.textLength}),!this._attempts[0].textLength)return null;M=this._attempts[0].articleContent,kn=!0}if(kn){var $c=[A,w].concat(this._getNodeAncestors(A));return this._someNode($c,function(ze){if(!ze.tagName)return!1;var nt=ze.getAttribute("dir");return nt?(this._articleDir=nt,!0):!1}),M}}},_isValidByline:function(r){return typeof r=="string"||r instanceof String?(r=r.trim(),r.length>0&&r.length<100):!1},_unescapeHtmlEntities:function(r){if(!r)return r;var e=this.HTML_ESCAPE_MAP;return r.replace(/&(quot|amp|apos|lt|gt);/g,function(t,s){return e[s]}).replace(/&#(?:x([0-9a-z]{1,4})|([0-9]{1,4}));/gi,function(t,s,n){var i=parseInt(s||n,s?16:10);return String.fromCharCode(i)})},_getJSONLD:function(r){var e=this._getAllNodesWithTag(r,["script"]),t;return this._forEachNode(e,function(s){if(!t&&s.getAttribute("type")==="application/ld+json")try{var n=s.textContent.replace(/^\s*<!\[CDATA\[|\]\]>\s*$/g,""),i=JSON.parse(n);if(!i["@context"]||!i["@context"].match(/^https?\:\/\/schema\.org$/)||(!i["@type"]&&Array.isArray(i["@graph"])&&(i=i["@graph"].find(function(a){return(a["@type"]||"").match(this.REGEXPS.jsonLdArticleTypes)})),!i||!i["@type"]||!i["@type"].match(this.REGEXPS.jsonLdArticleTypes)))return;if(t={},typeof i.name=="string"&&typeof i.headline=="string"&&i.name!==i.headline){var o=this._getArticleTitle(),c=this._textSimilarity(i.name,o)>.75,l=this._textSimilarity(i.headline,o)>.75;l&&!c?t.title=i.headline:t.title=i.name}else typeof i.name=="string"?t.title=i.name.trim():typeof i.headline=="string"&&(t.title=i.headline.trim());i.author&&(typeof i.author.name=="string"?t.byline=i.author.name.trim():Array.isArray(i.author)&&i.author[0]&&typeof i.author[0].name=="string"&&(t.byline=i.author.filter(function(a){return a&&typeof a.name=="string"}).map(function(a){return a.name.trim()}).join(", "))),typeof i.description=="string"&&(t.excerpt=i.description.trim()),i.publisher&&typeof i.publisher.name=="string"&&(t.siteName=i.publisher.name.trim());return}catch(a){this.log(a.message)}}),t||{}},_getArticleMetadata:function(r){var e={},t={},s=this._doc.getElementsByTagName("meta"),n=/\s*(dc|dcterm|og|twitter)\s*:\s*(author|creator|description|title|site_name)\s*/gi,i=/^\s*(?:(dc|dcterm|og|twitter|weibo:(article|webpage))\s*[\.:]\s*)?(author|creator|description|title|site_name)\s*$/i;return this._forEachNode(s,function(o){var c=o.getAttribute("name"),l=o.getAttribute("property"),a=o.getAttribute("content");if(a){var u=null,p=null;l&&(u=l.match(n),u&&(p=u[0].toLowerCase().replace(/\s/g,""),t[p]=a.trim())),!u&&c&&i.test(c)&&(p=c,a&&(p=p.toLowerCase().replace(/\s/g,"").replace(/\./g,":"),t[p]=a.trim()))}}),e.title=r.title||t["dc:title"]||t["dcterm:title"]||t["og:title"]||t["weibo:article:title"]||t["weibo:webpage:title"]||t.title||t["twitter:title"],e.title||(e.title=this._getArticleTitle()),e.byline=r.byline||t["dc:creator"]||t["dcterm:creator"]||t.author,e.excerpt=r.excerpt||t["dc:description"]||t["dcterm:description"]||t["og:description"]||t["weibo:article:description"]||t["weibo:webpage:description"]||t.description||t["twitter:description"],e.siteName=r.siteName||t["og:site_name"],e.title=this._unescapeHtmlEntities(e.title),e.byline=this._unescapeHtmlEntities(e.byline),e.excerpt=this._unescapeHtmlEntities(e.excerpt),e.siteName=this._unescapeHtmlEntities(e.siteName),e},_isSingleImage:function(r){return r.tagName==="IMG"?!0:r.children.length!==1||r.textContent.trim()!==""?!1:this._isSingleImage(r.children[0])},_unwrapNoscriptImages:function(r){var e=Array.from(r.getElementsByTagName("img"));this._forEachNode(e,function(s){for(var n=0;n<s.attributes.length;n++){var i=s.attributes[n];switch(i.name){case"src":case"srcset":case"data-src":case"data-srcset":return}if(/\.(jpg|jpeg|png|webp)/i.test(i.value))return}s.parentNode.removeChild(s)});var t=Array.from(r.getElementsByTagName("noscript"));this._forEachNode(t,function(s){var n=r.createElement("div");if(n.innerHTML=s.innerHTML,!!this._isSingleImage(n)){var i=s.previousElementSibling;if(i&&this._isSingleImage(i)){var o=i;o.tagName!=="IMG"&&(o=i.getElementsByTagName("img")[0]);for(var c=n.getElementsByTagName("img")[0],l=0;l<o.attributes.length;l++){var a=o.attributes[l];if(a.value!==""&&(a.name==="src"||a.name==="srcset"||/\.(jpg|jpeg|png|webp)/i.test(a.value))){if(c.getAttribute(a.name)===a.value)continue;var u=a.name;c.hasAttribute(u)&&(u="data-old-"+u),c.setAttribute(u,a.value)}}s.parentNode.replaceChild(n.firstElementChild,i)}}})},_removeScripts:function(r){this._removeNodes(this._getAllNodesWithTag(r,["script","noscript"]))},_hasSingleTagInsideElement:function(r,e){return r.children.length!=1||r.children[0].tagName!==e?!1:!this._someNode(r.childNodes,function(t){return t.nodeType===this.TEXT_NODE&&this.REGEXPS.hasContent.test(t.textContent)})},_isElementWithoutContent:function(r){return r.nodeType===this.ELEMENT_NODE&&r.textContent.trim().length==0&&(r.children.length==0||r.children.length==r.getElementsByTagName("br").length+r.getElementsByTagName("hr").length)},_hasChildBlockElement:function(r){return this._someNode(r.childNodes,function(e){return this.DIV_TO_P_ELEMS.has(e.tagName)||this._hasChildBlockElement(e)})},_isPhrasingContent:function(r){return r.nodeType===this.TEXT_NODE||this.PHRASING_ELEMS.indexOf(r.tagName)!==-1||(r.tagName==="A"||r.tagName==="DEL"||r.tagName==="INS")&&this._everyNode(r.childNodes,this._isPhrasingContent)},_isWhitespace:function(r){return r.nodeType===this.TEXT_NODE&&r.textContent.trim().length===0||r.nodeType===this.ELEMENT_NODE&&r.tagName==="BR"},_getInnerText:function(r,e){e=typeof e=="undefined"?!0:e;var t=r.textContent.trim();return e?t.replace(this.REGEXPS.normalize," "):t},_getCharCount:function(r,e){return e=e||",",this._getInnerText(r).split(e).length-1},_cleanStyles:function(r){if(!(!r||r.tagName.toLowerCase()==="svg")){for(var e=0;e<this.PRESENTATIONAL_ATTRIBUTES.length;e++)r.removeAttribute(this.PRESENTATIONAL_ATTRIBUTES[e]);this.DEPRECATED_SIZE_ATTRIBUTE_ELEMS.indexOf(r.tagName)!==-1&&(r.removeAttribute("width"),r.removeAttribute("height"));for(var t=r.firstElementChild;t!==null;)this._cleanStyles(t),t=t.nextElementSibling}},_getLinkDensity:function(r){var e=this._getInnerText(r).length;if(e===0)return 0;var t=0;return this._forEachNode(r.getElementsByTagName("a"),function(s){var n=s.getAttribute("href"),i=n&&this.REGEXPS.hashUrl.test(n)?.3:1;t+=this._getInnerText(s).length*i}),t/e},_getClassWeight:function(r){if(!this._flagIsActive(this.FLAG_WEIGHT_CLASSES))return 0;var e=0;return typeof r.className=="string"&&r.className!==""&&(this.REGEXPS.negative.test(r.className)&&(e-=25),this.REGEXPS.positive.test(r.className)&&(e+=25)),typeof r.id=="string"&&r.id!==""&&(this.REGEXPS.negative.test(r.id)&&(e-=25),this.REGEXPS.positive.test(r.id)&&(e+=25)),e},_clean:function(r,e){var t=["object","embed","iframe"].indexOf(e)!==-1;this._removeNodes(this._getAllNodesWithTag(r,[e]),function(s){if(t){for(var n=0;n<s.attributes.length;n++)if(this._allowedVideoRegex.test(s.attributes[n].value))return!1;if(s.tagName==="object"&&this._allowedVideoRegex.test(s.innerHTML))return!1}return!0})},_hasAncestorTag:function(r,e,t,s){t=t||3,e=e.toUpperCase();for(var n=0;r.parentNode;){if(t>0&&n>t)return!1;if(r.parentNode.tagName===e&&(!s||s(r.parentNode)))return!0;r=r.parentNode,n++}return!1},_getRowAndColumnCount:function(r){for(var e=0,t=0,s=r.getElementsByTagName("tr"),n=0;n<s.length;n++){var i=s[n].getAttribute("rowspan")||0;i&&(i=parseInt(i,10)),e+=i||1;for(var o=0,c=s[n].getElementsByTagName("td"),l=0;l<c.length;l++){var a=c[l].getAttribute("colspan")||0;a&&(a=parseInt(a,10)),o+=a||1}t=Math.max(t,o)}return{rows:e,columns:t}},_markDataTables:function(r){for(var e=r.getElementsByTagName("table"),t=0;t<e.length;t++){var s=e[t],n=s.getAttribute("role");if(n=="presentation"){s._readabilityDataTable=!1;continue}var i=s.getAttribute("datatable");if(i=="0"){s._readabilityDataTable=!1;continue}var o=s.getAttribute("summary");if(o){s._readabilityDataTable=!0;continue}var c=s.getElementsByTagName("caption")[0];if(c&&c.childNodes.length>0){s._readabilityDataTable=!0;continue}var l=["col","colgroup","tfoot","thead","th"],a=function(p){return!!s.getElementsByTagName(p)[0]};if(l.some(a)){this.log("Data table because found data-y descendant"),s._readabilityDataTable=!0;continue}if(s.getElementsByTagName("table")[0]){s._readabilityDataTable=!1;continue}var u=this._getRowAndColumnCount(s);if(u.rows>=10||u.columns>4){s._readabilityDataTable=!0;continue}s._readabilityDataTable=u.rows*u.columns>10}},_fixLazyImages:function(r){this._forEachNode(this._getAllNodesWithTag(r,["img","picture","figure"]),function(e){if(e.src&&this.REGEXPS.b64DataUrl.test(e.src)){var t=this.REGEXPS.b64DataUrl.exec(e.src);if(t[1]==="image/svg+xml")return;for(var s=!1,n=0;n<e.attributes.length;n++){var i=e.attributes[n];if(i.name!=="src"&&/\.(jpg|jpeg|png|webp)/i.test(i.value)){s=!0;break}}if(s){var o=e.src.search(/base64\s*/i)+7,c=e.src.length-o;c<133&&e.removeAttribute("src")}}if(!((e.src||e.srcset&&e.srcset!="null")&&e.className.toLowerCase().indexOf("lazy")===-1)){for(var l=0;l<e.attributes.length;l++)if(i=e.attributes[l],!(i.name==="src"||i.name==="srcset"||i.name==="alt")){var a=null;if(/\.(jpg|jpeg|png|webp)\s+\d/.test(i.value)?a="srcset":/^\s*\S+\.(jpg|jpeg|png|webp)\S*\s*$/.test(i.value)&&(a="src"),a){if(e.tagName==="IMG"||e.tagName==="PICTURE")e.setAttribute(a,i.value);else if(e.tagName==="FIGURE"&&!this._getAllNodesWithTag(e,["img","picture"]).length){var u=this._doc.createElement("img");u.setAttribute(a,i.value),e.appendChild(u)}}}}})},_getTextDensity:function(r,e){var t=this._getInnerText(r,!0).length;if(t===0)return 0;var s=0,n=this._getAllNodesWithTag(r,e);return this._forEachNode(n,i=>s+=this._getInnerText(i,!0).length),s/t},_cleanConditionally:function(r,e){this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY)&&this._removeNodes(this._getAllNodesWithTag(r,[e]),function(t){var s=function(A){return A._readabilityDataTable},n=e==="ul"||e==="ol";if(!n){var i=0,o=this._getAllNodesWithTag(t,["ul","ol"]);this._forEachNode(o,A=>i+=this._getInnerText(A).length),n=i/this._getInnerText(t).length>.9}if(e==="table"&&s(t)||this._hasAncestorTag(t,"table",-1,s)||this._hasAncestorTag(t,"code"))return!1;var c=this._getClassWeight(t);this.log("Cleaning Conditionally",t);var l=0;if(c+l<0)return!0;if(this._getCharCount(t,",")<10){for(var a=t.getElementsByTagName("p").length,u=t.getElementsByTagName("img").length,p=t.getElementsByTagName("li").length-100,T=t.getElementsByTagName("input").length,S=this._getTextDensity(t,["h1","h2","h3","h4","h5","h6"]),f=0,C=this._getAllNodesWithTag(t,["object","embed","iframe"]),E=0;E<C.length;E++){for(var _=0;_<C[E].attributes.length;_++)if(this._allowedVideoRegex.test(C[E].attributes[_].value))return!1;if(C[E].tagName==="object"&&this._allowedVideoRegex.test(C[E].innerHTML))return!1;f++}var N=this._getLinkDensity(t),q=this._getInnerText(t).length,w=u>1&&a/u<.5&&!this._hasAncestorTag(t,"figure")||!n&&p>a||T>Math.floor(a/3)||!n&&S<.9&&q<25&&(u===0||u>2)&&!this._hasAncestorTag(t,"figure")||!n&&c<25&&N>.2||c>=25&&N>.5||f===1&&q<75||f>1;if(n&&w){for(var D=0;D<t.children.length;D++)if(t.children[D].children.length>1)return w;let A=t.getElementsByTagName("li").length;if(u==A)return!1}return w}return!1})},_cleanMatchedNodes:function(r,e){for(var t=this._getNextNode(r,!0),s=this._getNextNode(r);s&&s!=t;)e.call(this,s,s.className+" "+s.id)?s=this._removeAndGetNext(s):s=this._getNextNode(s)},_cleanHeaders:function(r){let e=this._getAllNodesWithTag(r,["h1","h2"]);this._removeNodes(e,function(t){let s=this._getClassWeight(t)<0;return s&&this.log("Removing header with low class weight:",t),s})},_headerDuplicatesTitle:function(r){if(r.tagName!="H1"&&r.tagName!="H2")return!1;var e=this._getInnerText(r,!1);return this.log("Evaluating similarity of header:",e,this._articleTitle),this._textSimilarity(this._articleTitle,e)>.75},_flagIsActive:function(r){return(this._flags&r)>0},_removeFlag:function(r){this._flags=this._flags&~r},_isProbablyVisible:function(r){return(!r.style||r.style.display!="none")&&!r.hasAttribute("hidden")&&(!r.hasAttribute("aria-hidden")||r.getAttribute("aria-hidden")!="true"||r.className&&r.className.indexOf&&r.className.indexOf("fallback-image")!==-1)},parse:function(){if(this._maxElemsToParse>0){var r=this._doc.getElementsByTagName("*").length;if(r>this._maxElemsToParse)throw new Error("Aborting parsing document; "+r+" elements found")}this._unwrapNoscriptImages(this._doc);var e=this._disableJSONLD?{}:this._getJSONLD(this._doc);this._removeScripts(this._doc),this._prepDocument();var t=this._getArticleMetadata(e);this._articleTitle=t.title;var s=this._grabArticle();if(!s)return null;if(this.log("Grabbed: "+s.innerHTML),this._postProcessContent(s),!t.excerpt){var n=s.getElementsByTagName("p");n.length>0&&(t.excerpt=n[0].textContent.trim())}var i=s.textContent;return{title:this._articleTitle,byline:t.byline||this._articleByline,dir:this._articleDir,lang:this._articleLang,content:this._serializer(s),textContent:i,length:i.length,excerpt:t.excerpt,siteName:t.siteName||this._articleSiteName}}};typeof ui=="object"&&(ui.exports=ra)});var ia=H((Tp,hi)=>{var na={unlikelyCandidates:/-ad-|ai2html|banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|footer|gdpr|header|legends|menu|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote/i,okMaybeItsACandidate:/and|article|body|column|content|main|shadow/i};function Fl(r){return(!r.style||r.style.display!="none")&&!r.hasAttribute("hidden")&&(!r.hasAttribute("aria-hidden")||r.getAttribute("aria-hidden")!="true"||r.className&&r.className.indexOf&&r.className.indexOf("fallback-image")!==-1)}function $l(r,e={}){typeof e=="function"&&(e={visibilityChecker:e});var t={minScore:20,minContentLength:140,visibilityChecker:Fl};e=Object.assign(t,e);var s=r.querySelectorAll("p, pre, article"),n=r.querySelectorAll("div > br");if(n.length){var i=new Set(s);[].forEach.call(n,function(c){i.add(c.parentNode)}),s=Array.from(i)}var o=0;return[].some.call(s,function(c){if(!e.visibilityChecker(c))return!1;var l=c.className+" "+c.id;if(na.unlikelyCandidates.test(l)&&!na.okMaybeItsACandidate.test(l)||c.matches("li p"))return!1;var a=c.textContent.trim().length;return a<e.minContentLength?!1:(o+=Math.sqrt(a-e.minContentLength),o>e.minScore)})}typeof hi=="object"&&(hi.exports=$l)});var aa=H((_p,oa)=>{var Vl=sa(),Wl=ia();oa.exports={Readability:Vl,isProbablyReaderable:Wl}});var _a=H(vi=>{try{let{performance:r}=no("perf_hooks");vi.performance=r}catch(r){vi.performance={now(){return+new Date}}}});var Fi=H(Wa=>{var Va={};Va.StyleSheet=function(){this.parentStyleSheet=null};Wa.StyleSheet=Va.StyleSheet});var pe=H(ja=>{var z={};z.CSSRule=function(){this.parentRule=null,this.parentStyleSheet=null};z.CSSRule.UNKNOWN_RULE=0;z.CSSRule.STYLE_RULE=1;z.CSSRule.CHARSET_RULE=2;z.CSSRule.IMPORT_RULE=3;z.CSSRule.MEDIA_RULE=4;z.CSSRule.FONT_FACE_RULE=5;z.CSSRule.PAGE_RULE=6;z.CSSRule.KEYFRAMES_RULE=7;z.CSSRule.KEYFRAME_RULE=8;z.CSSRule.MARGIN_RULE=9;z.CSSRule.NAMESPACE_RULE=10;z.CSSRule.COUNTER_STYLE_RULE=11;z.CSSRule.SUPPORTS_RULE=12;z.CSSRule.DOCUMENT_RULE=13;z.CSSRule.FONT_FEATURE_VALUES_RULE=14;z.CSSRule.VIEWPORT_RULE=15;z.CSSRule.REGION_STYLE_RULE=16;z.CSSRule.prototype={constructor:z.CSSRule};ja.CSSRule=z.CSSRule});var yr=H(za=>{var fe={CSSStyleDeclaration:Et().CSSStyleDeclaration,CSSRule:pe().CSSRule};fe.CSSStyleRule=function(){fe.CSSRule.call(this),this.selectorText="",this.style=new fe.CSSStyleDeclaration,this.style.parentRule=this};fe.CSSStyleRule.prototype=new fe.CSSRule;fe.CSSStyleRule.prototype.constructor=fe.CSSStyleRule;fe.CSSStyleRule.prototype.type=1;Object.defineProperty(fe.CSSStyleRule.prototype,"cssText",{get:function(){var r;return this.selectorText?r=this.selectorText+" {"+this.style.cssText+"}":r="",r},set:function(r){var e=fe.CSSStyleRule.parse(r);this.style=e.style,this.selectorText=e.selectorText}});fe.CSSStyleRule.parse=function(r){for(var e=0,t="selector",s,n=e,i="",o={selector:!0,value:!0},c=new fe.CSSStyleRule,l,a="",u;u=r.charAt(e);e++)switch(u){case" ":case"	":case"\r":case`
`:case"\f":if(o[t])switch(r.charAt(e-1)){case" ":case"	":case"\r":case`
`:case"\f":break;default:i+=" ";break}break;case'"':if(n=e+1,s=r.indexOf('"',n)+1,!s)throw'" is missing';i+=r.slice(e,s),e=s-1;break;case"'":if(n=e+1,s=r.indexOf("'",n)+1,!s)throw"' is missing";i+=r.slice(e,s),e=s-1;break;case"/":if(r.charAt(e+1)==="*"){if(e+=2,s=r.indexOf("*/",e),s===-1)throw new SyntaxError("Missing */");e=s+1}else i+=u;break;case"{":t==="selector"&&(c.selectorText=i.trim(),i="",t="name");break;case":":t==="name"?(l=i.trim(),i="",t="value"):i+=u;break;case"!":t==="value"&&r.indexOf("!important",e)===e?(a="important",e+=9):i+=u;break;case";":t==="value"?(c.style.setProperty(l,i.trim(),a),a="",i="",t="name"):i+=u;break;case"}":if(t==="value")c.style.setProperty(l,i.trim(),a),a="",i="";else{if(t==="name")break;i+=u}t="selector";break;default:i+=u;break}return c};za.CSSStyleRule=fe.CSSStyleRule});var vr=H(Ja=>{var xe={StyleSheet:Fi().StyleSheet,CSSStyleRule:yr().CSSStyleRule};xe.CSSStyleSheet=function(){xe.StyleSheet.call(this),this.cssRules=[]};xe.CSSStyleSheet.prototype=new xe.StyleSheet;xe.CSSStyleSheet.prototype.constructor=xe.CSSStyleSheet;xe.CSSStyleSheet.prototype.insertRule=function(r,e){if(e<0||e>this.cssRules.length)throw new RangeError("INDEX_SIZE_ERR");var t=xe.parse(r).cssRules[0];return t.parentStyleSheet=this,this.cssRules.splice(e,0,t),e};xe.CSSStyleSheet.prototype.deleteRule=function(r){if(r<0||r>=this.cssRules.length)throw new RangeError("INDEX_SIZE_ERR");this.cssRules.splice(r,1)};xe.CSSStyleSheet.prototype.toString=function(){for(var r="",e=this.cssRules,t=0;t<e.length;t++)r+=e[t].cssText+`
`;return r};Ja.CSSStyleSheet=xe.CSSStyleSheet;xe.parse=Ts().parse});var xs=H(Xa=>{var _s={};_s.MediaList=function(){this.length=0};_s.MediaList.prototype={constructor:_s.MediaList,get mediaText(){return Array.prototype.join.call(this,", ")},set mediaText(r){for(var e=r.split(","),t=this.length=e.length,s=0;s<t;s++)this[s]=e[s].trim()},appendMedium:function(r){Array.prototype.indexOf.call(this,r)===-1&&(this[this.length]=r,this.length++)},deleteMedium:function(r){var e=Array.prototype.indexOf.call(this,r);e!==-1&&Array.prototype.splice.call(this,e,1)}};Xa.MediaList=_s.MediaList});var $i=H(Ka=>{var Le={CSSRule:pe().CSSRule,CSSStyleSheet:vr().CSSStyleSheet,MediaList:xs().MediaList};Le.CSSImportRule=function(){Le.CSSRule.call(this),this.href="",this.media=new Le.MediaList,this.styleSheet=new Le.CSSStyleSheet};Le.CSSImportRule.prototype=new Le.CSSRule;Le.CSSImportRule.prototype.constructor=Le.CSSImportRule;Le.CSSImportRule.prototype.type=3;Object.defineProperty(Le.CSSImportRule.prototype,"cssText",{get:function(){var r=this.media.mediaText;return"@import url("+this.href+")"+(r?" "+r:"")+";"},set:function(r){for(var e=0,t="",s="",n,i;i=r.charAt(e);e++)switch(i){case" ":case"	":case"\r":case`
`:case"\f":t==="after-import"?t="url":s+=i;break;case"@":!t&&r.indexOf("@import",e)===e&&(t="after-import",e+=6,s="");break;case"u":if(t==="url"&&r.indexOf("url(",e)===e){if(n=r.indexOf(")",e+1),n===-1)throw e+': ")" not found';e+=4;var o=r.slice(e,n);o[0]===o[o.length-1]&&(o[0]==='"'||o[0]==="'")&&(o=o.slice(1,-1)),this.href=o,e=n,t="media"}break;case'"':if(t==="url"){if(n=r.indexOf('"',e+1),!n)throw e+`: '"' not found`;this.href=r.slice(e+1,n),e=n,t="media"}break;case"'":if(t==="url"){if(n=r.indexOf("'",e+1),!n)throw e+`: "'" not found`;this.href=r.slice(e+1,n),e=n,t="media"}break;case";":t==="media"&&s&&(this.media.mediaText=s.trim());break;default:t==="media"&&(s+=i);break}}});Ka.CSSImportRule=Le.CSSImportRule});var Tt=H(Ya=>{var Fe={CSSRule:pe().CSSRule};Fe.CSSGroupingRule=function(){Fe.CSSRule.call(this),this.cssRules=[]};Fe.CSSGroupingRule.prototype=new Fe.CSSRule;Fe.CSSGroupingRule.prototype.constructor=Fe.CSSGroupingRule;Fe.CSSGroupingRule.prototype.insertRule=function(e,t){if(t<0||t>this.cssRules.length)throw new RangeError("INDEX_SIZE_ERR");var s=Fe.parse(e).cssRules[0];return s.parentRule=this,this.cssRules.splice(t,0,s),t};Fe.CSSGroupingRule.prototype.deleteRule=function(e){if(e<0||e>=this.cssRules.length)throw new RangeError("INDEX_SIZE_ERR");this.cssRules.splice(e,1)[0].parentRule=null};Ya.CSSGroupingRule=Fe.CSSGroupingRule});var $t=H(Qa=>{var et={CSSRule:pe().CSSRule,CSSGroupingRule:Tt().CSSGroupingRule};et.CSSConditionRule=function(){et.CSSGroupingRule.call(this),this.cssRules=[]};et.CSSConditionRule.prototype=new et.CSSGroupingRule;et.CSSConditionRule.prototype.constructor=et.CSSConditionRule;et.CSSConditionRule.prototype.conditionText="";et.CSSConditionRule.prototype.cssText="";Qa.CSSConditionRule=et.CSSConditionRule});var ws=H(Za=>{var $e={CSSRule:pe().CSSRule,CSSGroupingRule:Tt().CSSGroupingRule,CSSConditionRule:$t().CSSConditionRule,MediaList:xs().MediaList};$e.CSSMediaRule=function(){$e.CSSConditionRule.call(this),this.media=new $e.MediaList};$e.CSSMediaRule.prototype=new $e.CSSConditionRule;$e.CSSMediaRule.prototype.constructor=$e.CSSMediaRule;$e.CSSMediaRule.prototype.type=4;Object.defineProperties($e.CSSMediaRule.prototype,{conditionText:{get:function(){return this.media.mediaText},set:function(r){this.media.mediaText=r},configurable:!0,enumerable:!0},cssText:{get:function(){for(var r=[],e=0,t=this.cssRules.length;e<t;e++)r.push(this.cssRules[e].cssText);return"@media "+this.media.mediaText+" {"+r.join("")+"}"},configurable:!0,enumerable:!0}});Za.CSSMediaRule=$e.CSSMediaRule});var Ns=H(ec=>{var tt={CSSRule:pe().CSSRule,CSSGroupingRule:Tt().CSSGroupingRule,CSSConditionRule:$t().CSSConditionRule};tt.CSSSupportsRule=function(){tt.CSSConditionRule.call(this)};tt.CSSSupportsRule.prototype=new tt.CSSConditionRule;tt.CSSSupportsRule.prototype.constructor=tt.CSSSupportsRule;tt.CSSSupportsRule.prototype.type=12;Object.defineProperty(tt.CSSSupportsRule.prototype,"cssText",{get:function(){for(var r=[],e=0,t=this.cssRules.length;e<t;e++)r.push(this.cssRules[e].cssText);return"@supports "+this.conditionText+" {"+r.join("")+"}"}});ec.CSSSupportsRule=tt.CSSSupportsRule});var Vi=H(tc=>{var Ve={CSSStyleDeclaration:Et().CSSStyleDeclaration,CSSRule:pe().CSSRule};Ve.CSSFontFaceRule=function(){Ve.CSSRule.call(this),this.style=new Ve.CSSStyleDeclaration,this.style.parentRule=this};Ve.CSSFontFaceRule.prototype=new Ve.CSSRule;Ve.CSSFontFaceRule.prototype.constructor=Ve.CSSFontFaceRule;Ve.CSSFontFaceRule.prototype.type=5;Object.defineProperty(Ve.CSSFontFaceRule.prototype,"cssText",{get:function(){return"@font-face {"+this.style.cssText+"}"}});tc.CSSFontFaceRule=Ve.CSSFontFaceRule});var Wi=H(rc=>{var rt={CSSRule:pe().CSSRule};rt.CSSHostRule=function(){rt.CSSRule.call(this),this.cssRules=[]};rt.CSSHostRule.prototype=new rt.CSSRule;rt.CSSHostRule.prototype.constructor=rt.CSSHostRule;rt.CSSHostRule.prototype.type=1001;Object.defineProperty(rt.CSSHostRule.prototype,"cssText",{get:function(){for(var r=[],e=0,t=this.cssRules.length;e<t;e++)r.push(this.cssRules[e].cssText);return"@host {"+r.join("")+"}"}});rc.CSSHostRule=rt.CSSHostRule});var As=H(sc=>{var We={CSSRule:pe().CSSRule,CSSStyleDeclaration:Et().CSSStyleDeclaration};We.CSSKeyframeRule=function(){We.CSSRule.call(this),this.keyText="",this.style=new We.CSSStyleDeclaration,this.style.parentRule=this};We.CSSKeyframeRule.prototype=new We.CSSRule;We.CSSKeyframeRule.prototype.constructor=We.CSSKeyframeRule;We.CSSKeyframeRule.prototype.type=8;Object.defineProperty(We.CSSKeyframeRule.prototype,"cssText",{get:function(){return this.keyText+" {"+this.style.cssText+"} "}});sc.CSSKeyframeRule=We.CSSKeyframeRule});var Is=H(nc=>{var st={CSSRule:pe().CSSRule};st.CSSKeyframesRule=function(){st.CSSRule.call(this),this.name="",this.cssRules=[]};st.CSSKeyframesRule.prototype=new st.CSSRule;st.CSSKeyframesRule.prototype.constructor=st.CSSKeyframesRule;st.CSSKeyframesRule.prototype.type=7;Object.defineProperty(st.CSSKeyframesRule.prototype,"cssText",{get:function(){for(var r=[],e=0,t=this.cssRules.length;e<t;e++)r.push("  "+this.cssRules[e].cssText);return"@"+(this._vendorPrefix||"")+"keyframes "+this.name+` { 
`+r.join(`
`)+`
}`}});nc.CSSKeyframesRule=st.CSSKeyframesRule});var ji=H(ic=>{var Rs={};Rs.CSSValue=function(){};Rs.CSSValue.prototype={constructor:Rs.CSSValue,set cssText(r){var e=this._getConstructorName();throw new Error('DOMException: property "cssText" of "'+e+'" is readonly and can not be replaced with "'+r+'"!')},get cssText(){var r=this._getConstructorName();throw new Error('getter "cssText" of "'+r+'" is not implemented!')},_getConstructorName:function(){var r=this.constructor.toString(),e=r.match(/function\s([^\(]+)/),t=e[1];return t}};ic.CSSValue=Rs.CSSValue});var zi=H(oc=>{var Oe={CSSValue:ji().CSSValue};Oe.CSSValueExpression=function(e,t){this._token=e,this._idx=t};Oe.CSSValueExpression.prototype=new Oe.CSSValue;Oe.CSSValueExpression.prototype.constructor=Oe.CSSValueExpression;Oe.CSSValueExpression.prototype.parse=function(){for(var r=this._token,e=this._idx,t="",s="",n="",i,o=[];;++e){if(t=r.charAt(e),t===""){n="css expression error: unfinished expression!";break}switch(t){case"(":o.push(t),s+=t;break;case")":o.pop(t),s+=t;break;case"/":(i=this._parseJSComment(r,e))?i.error?n="css expression error: unfinished comment in expression!":e=i.idx:(i=this._parseJSRexExp(r,e))?(e=i.idx,s+=i.text):s+=t;break;case"'":case'"':i=this._parseJSString(r,e,t),i?(e=i.idx,s+=i.text):s+=t;break;default:s+=t;break}if(n||o.length===0)break}var c;return n?c={error:n}:c={idx:e,expression:s},c};Oe.CSSValueExpression.prototype._parseJSComment=function(r,e){var t=r.charAt(e+1),s;if(t==="/"||t==="*"){var n=e,i,o;if(t==="/"?o=`
`:t==="*"&&(o="*/"),i=r.indexOf(o,n+1+1),i!==-1)return i=i+o.length-1,s=r.substring(e,i+1),{idx:i,text:s};var c="css expression error: unfinished comment in expression!";return{error:c}}else return!1};Oe.CSSValueExpression.prototype._parseJSString=function(r,e,t){var s=this._findMatchedIdx(r,e,t),n;return s===-1?!1:(n=r.substring(e,s+t.length),{idx:s,text:n})};Oe.CSSValueExpression.prototype._parseJSRexExp=function(r,e){var t=r.substring(0,e).replace(/\s+$/,""),s=[/^$/,/\($/,/\[$/,/\!$/,/\+$/,/\-$/,/\*$/,/\/\s+/,/\%$/,/\=$/,/\>$/,/<$/,/\&$/,/\|$/,/\^$/,/\~$/,/\?$/,/\,$/,/delete$/,/in$/,/instanceof$/,/new$/,/typeof$/,/void$/],n=s.some(function(o){return o.test(t)});if(n){var i="/";return this._parseJSString(r,e,i)}else return!1};Oe.CSSValueExpression.prototype._findMatchedIdx=function(r,e,t){for(var s=e,n,i=-1;;)if(n=r.indexOf(t,s+1),n===-1){n=i;break}else{var o=r.substring(e+1,n),c=o.match(/\\+$/);if(!c||c[0]%2===0)break;s=n}var l=r.indexOf(`
`,e+1);return l<n&&(n=i),n};oc.CSSValueExpression=Oe.CSSValueExpression});var Ji=H(ac=>{var ks={};ks.MatcherList=function(){this.length=0};ks.MatcherList.prototype={constructor:ks.MatcherList,get matcherText(){return Array.prototype.join.call(this,", ")},set matcherText(r){for(var e=r.split(","),t=this.length=e.length,s=0;s<t;s++)this[s]=e[s].trim()},appendMatcher:function(r){Array.prototype.indexOf.call(this,r)===-1&&(this[this.length]=r,this.length++)},deleteMatcher:function(r){var e=Array.prototype.indexOf.call(this,r);e!==-1&&Array.prototype.splice.call(this,e,1)}};ac.MatcherList=ks.MatcherList});var Xi=H(cc=>{var je={CSSRule:pe().CSSRule,MatcherList:Ji().MatcherList};je.CSSDocumentRule=function(){je.CSSRule.call(this),this.matcher=new je.MatcherList,this.cssRules=[]};je.CSSDocumentRule.prototype=new je.CSSRule;je.CSSDocumentRule.prototype.constructor=je.CSSDocumentRule;je.CSSDocumentRule.prototype.type=10;Object.defineProperty(je.CSSDocumentRule.prototype,"cssText",{get:function(){for(var r=[],e=0,t=this.cssRules.length;e<t;e++)r.push(this.cssRules[e].cssText);return"@-moz-document "+this.matcher.matcherText+" {"+r.join("")+"}"}});cc.CSSDocumentRule=je.CSSDocumentRule});var Ts=H(lc=>{var B={};B.parse=function(e){for(var t=0,s="before-selector",n,i="",o=0,c={selector:!0,value:!0,"value-parenthesis":!0,atRule:!0,"importRule-begin":!0,importRule:!0,atBlock:!0,conditionBlock:!0,"documentRule-begin":!0},l=new B.CSSStyleSheet,a=l,u,p=[],T=!1,S,f,C="",E,_,N,q,w,D,A,J,K=/@(-(?:\w+-)+)?keyframes/g,R=function(me){var ie=e.substring(0,t).split(`
`),M=ie.length,$=ie.pop().length+1,te=new Error(me+" (line "+M+", char "+$+")");throw te.line=M,te.char=$,te.styleSheet=l,te},m;m=e.charAt(t);t++)switch(m){case" ":case"	":case"\r":case`
`:case"\f":c[s]&&(i+=m);break;case'"':n=t+1;do n=e.indexOf('"',n)+1,n||R('Unmatched "');while(e[n-2]==="\\");switch(i+=e.slice(t,n),t=n-1,s){case"before-value":s="value";break;case"importRule-begin":s="importRule";break}break;case"'":n=t+1;do n=e.indexOf("'",n)+1,n||R("Unmatched '");while(e[n-2]==="\\");switch(i+=e.slice(t,n),t=n-1,s){case"before-value":s="value";break;case"importRule-begin":s="importRule";break}break;case"/":e.charAt(t+1)==="*"?(t+=2,n=e.indexOf("*/",t),n===-1?R("Missing */"):t=n+1):i+=m,s==="importRule-begin"&&(i+=" ",s="importRule");break;case"@":if(e.indexOf("@-moz-document",t)===t){s="documentRule-begin",A=new B.CSSDocumentRule,A.__starts=t,t+=13,i="";break}else if(e.indexOf("@media",t)===t){s="atBlock",_=new B.CSSMediaRule,_.__starts=t,t+=5,i="";break}else if(e.indexOf("@supports",t)===t){s="conditionBlock",N=new B.CSSSupportsRule,N.__starts=t,t+=8,i="";break}else if(e.indexOf("@host",t)===t){s="hostRule-begin",t+=4,J=new B.CSSHostRule,J.__starts=t,i="";break}else if(e.indexOf("@import",t)===t){s="importRule-begin",t+=6,i+="@import";break}else if(e.indexOf("@font-face",t)===t){s="fontFaceRule-begin",t+=9,w=new B.CSSFontFaceRule,w.__starts=t,i="";break}else{K.lastIndex=t;var y=K.exec(e);if(y&&y.index===t){s="keyframesRule-begin",D=new B.CSSKeyframesRule,D.__starts=t,D._vendorPrefix=y[1],t+=y[0].length-1,i="";break}else s==="selector"&&(s="atRule")}i+=m;break;case"{":s==="selector"||s==="atRule"?(E.selectorText=i.trim(),E.style.__starts=t,i="",s="before-name"):s==="atBlock"?(_.media.mediaText=i.trim(),u&&p.push(u),a=u=_,_.parentStyleSheet=l,i="",s="before-selector"):s==="conditionBlock"?(N.conditionText=i.trim(),u&&p.push(u),a=u=N,N.parentStyleSheet=l,i="",s="before-selector"):s==="hostRule-begin"?(u&&p.push(u),a=u=J,J.parentStyleSheet=l,i="",s="before-selector"):s==="fontFaceRule-begin"?(u&&(w.parentRule=u),w.parentStyleSheet=l,E=w,i="",s="before-name"):s==="keyframesRule-begin"?(D.name=i.trim(),u&&(p.push(u),D.parentRule=u),D.parentStyleSheet=l,a=u=D,i="",s="keyframeRule-begin"):s==="keyframeRule-begin"?(E=new B.CSSKeyframeRule,E.keyText=i.trim(),E.__starts=t,i="",s="before-name"):s==="documentRule-begin"&&(A.matcher.matcherText=i.trim(),u&&(p.push(u),A.parentRule=u),a=u=A,A.parentStyleSheet=l,i="",s="before-selector");break;case":":s==="name"?(f=i.trim(),i="",s="before-value"):i+=m;break;case"(":if(s==="value")if(i.trim()==="expression"){var P=new B.CSSValueExpression(e,t).parse();P.error?R(P.error):(i+=P.expression,t=P.idx)}else s="value-parenthesis",o=1,i+=m;else s==="value-parenthesis"&&o++,i+=m;break;case")":s==="value-parenthesis"&&(o--,o===0&&(s="value")),i+=m;break;case"!":s==="value"&&e.indexOf("!important",t)===t?(C="important",t+=9):i+=m;break;case";":switch(s){case"value":E.style.setProperty(f,i.trim(),C),C="",i="",s="before-name";break;case"atRule":i="",s="before-selector";break;case"importRule":q=new B.CSSImportRule,q.parentStyleSheet=q.styleSheet.parentStyleSheet=l,q.cssText=i+m,l.cssRules.push(q),i="",s="before-selector";break;default:i+=m;break}break;case"}":switch(s){case"value":E.style.setProperty(f,i.trim(),C),C="";case"before-name":case"name":E.__ends=t+1,u&&(E.parentRule=u),E.parentStyleSheet=l,a.cssRules.push(E),i="",a.constructor===B.CSSKeyframesRule?s="keyframeRule-begin":s="before-selector";break;case"keyframeRule-begin":case"before-selector":case"selector":for(u||R("Unexpected }"),T=p.length>0;p.length>0;){if(u=p.pop(),u.constructor.name==="CSSMediaRule"||u.constructor.name==="CSSSupportsRule"){S=a,a=u,a.cssRules.push(S);break}p.length===0&&(T=!1)}T||(a.__ends=t+1,l.cssRules.push(a),a=l,u=null),i="",s="before-selector";break}break;default:switch(s){case"before-selector":s="selector",E=new B.CSSStyleRule,E.__starts=t;break;case"before-name":s="name";break;case"before-value":s="value";break;case"importRule-begin":s="importRule";break}i+=m;break}return l};lc.parse=B.parse;B.CSSStyleSheet=vr().CSSStyleSheet;B.CSSStyleRule=yr().CSSStyleRule;B.CSSImportRule=$i().CSSImportRule;B.CSSGroupingRule=Tt().CSSGroupingRule;B.CSSMediaRule=ws().CSSMediaRule;B.CSSConditionRule=$t().CSSConditionRule;B.CSSSupportsRule=Ns().CSSSupportsRule;B.CSSFontFaceRule=Vi().CSSFontFaceRule;B.CSSHostRule=Wi().CSSHostRule;B.CSSStyleDeclaration=Et().CSSStyleDeclaration;B.CSSKeyframeRule=As().CSSKeyframeRule;B.CSSKeyframesRule=Is().CSSKeyframesRule;B.CSSValueExpression=zi().CSSValueExpression;B.CSSDocumentRule=Xi().CSSDocumentRule});var Et=H(uc=>{var Vt={};Vt.CSSStyleDeclaration=function(){this.length=0,this.parentRule=null,this._importants={}};Vt.CSSStyleDeclaration.prototype={constructor:Vt.CSSStyleDeclaration,getPropertyValue:function(r){return this[r]||""},setProperty:function(r,e,t){if(this[r]){var s=Array.prototype.indexOf.call(this,r);s<0&&(this[this.length]=r,this.length++)}else this[this.length]=r,this.length++;this[r]=e+"",this._importants[r]=t},removeProperty:function(r){if(!(r in this))return"";var e=Array.prototype.indexOf.call(this,r);if(e<0)return"";var t=this[r];return this[r]="",Array.prototype.splice.call(this,e,1),t},getPropertyCSSValue:function(){},getPropertyPriority:function(r){return this._importants[r]||""},getPropertyShorthand:function(){},isPropertyImplicit:function(){},get cssText(){for(var r=[],e=0,t=this.length;e<t;++e){var s=this[e],n=this.getPropertyValue(s),i=this.getPropertyPriority(s);i&&(i=" !"+i),r[e]=s+": "+n+i+";"}return r.join(" ")},set cssText(r){var e,t;for(e=this.length;e--;)t=this[e],this[t]="";Array.prototype.splice.call(this,0,this.length),this._importants={};var s=Vt.parse("#bogus{"+r+"}").cssRules[0].style,n=s.length;for(e=0;e<n;++e)t=s[e],this.setProperty(s[e],s.getPropertyValue(t),s.getPropertyPriority(t))}};uc.CSSStyleDeclaration=Vt.CSSStyleDeclaration;Vt.parse=Ts().parse});var dc=H(hc=>{var Ps={CSSStyleSheet:vr().CSSStyleSheet,CSSRule:pe().CSSRule,CSSStyleRule:yr().CSSStyleRule,CSSGroupingRule:Tt().CSSGroupingRule,CSSConditionRule:$t().CSSConditionRule,CSSMediaRule:ws().CSSMediaRule,CSSSupportsRule:Ns().CSSSupportsRule,CSSStyleDeclaration:Et().CSSStyleDeclaration,CSSKeyframeRule:As().CSSKeyframeRule,CSSKeyframesRule:Is().CSSKeyframesRule};Ps.clone=function r(e){var t=new Ps.CSSStyleSheet,s=e.cssRules;if(!s)return t;for(var n=0,i=s.length;n<i;n++){var o=s[n],c=t.cssRules[n]=new o.constructor,l=o.style;if(l){for(var a=c.style=new Ps.CSSStyleDeclaration,u=0,p=l.length;u<p;u++){var T=a[u]=l[u];a[T]=l[T],a._importants[T]=l.getPropertyPriority(T)}a.length=l.length}o.hasOwnProperty("keyText")&&(c.keyText=o.keyText),o.hasOwnProperty("selectorText")&&(c.selectorText=o.selectorText),o.hasOwnProperty("mediaText")&&(c.mediaText=o.mediaText),o.hasOwnProperty("conditionText")&&(c.conditionText=o.conditionText),o.hasOwnProperty("cssRules")&&(c.cssRules=r(o).cssRules)}return t};hc.clone=Ps.clone});var pc=H(W=>{"use strict";W.CSSStyleDeclaration=Et().CSSStyleDeclaration;W.CSSRule=pe().CSSRule;W.CSSGroupingRule=Tt().CSSGroupingRule;W.CSSConditionRule=$t().CSSConditionRule;W.CSSStyleRule=yr().CSSStyleRule;W.MediaList=xs().MediaList;W.CSSMediaRule=ws().CSSMediaRule;W.CSSSupportsRule=Ns().CSSSupportsRule;W.CSSImportRule=$i().CSSImportRule;W.CSSFontFaceRule=Vi().CSSFontFaceRule;W.CSSHostRule=Wi().CSSHostRule;W.StyleSheet=Fi().StyleSheet;W.CSSStyleSheet=vr().CSSStyleSheet;W.CSSKeyframesRule=Is().CSSKeyframesRule;W.CSSKeyframeRule=As().CSSKeyframeRule;W.MatcherList=Ji().MatcherList;W.CSSDocumentRule=Xi().CSSDocumentRule;W.CSSValue=ji().CSSValue;W.CSSValueExpression=zi().CSSValueExpression;W.parse=Ts().parse;W.clone=dc().clone});var vc=H((yy,yc)=>{var Ki=class{constructor(e,t){this.width=e,this.height=t}getContext(){return null}toDataURL(){return""}};yc.exports={createCanvas:(r,e)=>new Ki(r,e)}});var bc=H((vy,Yi)=>{try{Yi.exports=no("canvas")}catch(r){Yi.exports=vc()}});var De=Ne(gt());var Ru=()=>{let r,e;At(async(t,s,n,i)=>{var o;if(t==="client")switch(s){case"Client_authDone":{return e&&(e=void 0),r&&(On||await De.default.tabs.update(r,{active:!0}),De.default.tabs.sendMessage(r,{id:Kt,event:"Client_authDone",data:n}),r=void 0),{success:!0,message:"ok",data:{}};break}case"Client_openAuthClientTab":{i.tab&&i.tab.id&&(r=i.tab.id);let c=await De.default.tabs.create({active:!0,url:On?`${Je}/login-webchatgpt?ref=${n.ref}`:`${Je}/login-webchatgpt?ref=${n.ref}`});return c&&(e=c.id),{success:!0,message:"ok",data:{}};break}case"Client_updateUseChatGPTAuthInfo":{let{accessToken:c,refreshToken:l,email:a}=n;if(c&&l){await De.default.storage.local.set({[Ur]:{accessToken:c,refreshToken:l,userInfo:null}});let u=await ao(),p={accessToken:c,refreshToken:l,userInfo:{...u,email:a}};return await De.default.storage.local.set({[Ur]:p}),{success:!0,message:"ok",data:p}}else return{success:!1,message:"not find accessToken",data:null};break}case"Client_logoutUseChatGPTAuth":{return await De.default.storage.local.set({[Ur]:{accessToken:null,refreshToken:null,userInfo:null}}),i.tab&&((o=i.tab)!=null&&o.id)&&De.default.tabs.sendMessage(i.tab.id,{id:Kt,event:"Client_logoutUseChatGPTAuth"}),{success:!0,message:"ok",data:{}};break}case"Client_emitPricingHooks":{let{action:c,name:l}=n;return l&&await mo({action:c,name:l}),{success:!0,data:!0,message:"ok"}}default:break}}),De.default.tabs.onUpdated.addListener(async(t,s,n)=>{s.status==="complete"&&n.url&&n.url.includes("chatgpt.com")&&vo()}),vo()},Vc="LIMIT_WEB_ACCESS_COUNT_STORAGE_KEY",Wc=async r=>{await De.default.storage.local.set({[Vc]:r})};async function vo(){try{await Wc(-1)}catch(r){}}var Fr=Ne(gt());function bo(r){let e,t,s,n,i,o,c;return l(),{feed:a,reset:l};function l(){e=!0,t="",s=0,n=-1,i=void 0,o=void 0,c=""}function a(p){t=t?t+p:p,e&&jc(t)&&(t=t.slice(Co.length)),e=!1;let T=t.length,S=0,f=!1;for(;S<T;){f&&(t[S]===`
`&&++S,f=!1);let C=-1,E=n,_;for(let N=s;C<0&&N<T;++N)_=t[N],_===":"&&E<0?E=N-S:_==="\r"?(f=!0,C=N-S):_===`
`&&(C=N-S);if(C<0){s=T-S,n=E;break}else s=0,n=-1;u(t,S,E,C),S+=C+1}S===T?t="":S>0&&(t=t.slice(S))}function u(p,T,S,f){if(f===0){c.length>0&&(r({type:"event",id:i,event:o||void 0,data:c.slice(0,-1)}),c="",i=void 0),o=void 0;return}let C=S<0,E=p.slice(T,T+(C?f:S)),_=0;C?_=f:p[T+S+1]===" "?_=S+2:_=S+1;let N=T+_,q=f-_,w=p.slice(N,N+q).toString();if(E==="data")c+=w?"".concat(w,`
`):`
`;else if(E==="event")o=w;else if(E==="id"&&!w.includes("\0"))i=w;else if(E==="retry"){let D=parseInt(w,10);Number.isNaN(D)||r({type:"reconnect-interval",value:D})}}}var Co=[239,187,191];function jc(r){return Co.every((e,t)=>r.charCodeAt(t)===e)}async function*Eo(r){let e=r.getReader();try{for(;;){let{done:t,value:s}=await e.read();if(t)return;yield s}}finally{e.releaseLock()}}var Me=async(r,e)=>{let{onMessage:t,...s}=e,n=await fetch(r,s);if(!n.ok){let o=await n.json().catch(()=>({}));throw new Error(JSON.stringify(go(o)?{message:`${n.status} ${n.statusText}`,detail:""}:o))}if(s.body&&JSON.parse(s.body).streaming===!1)return await n.json();let i=bo(o=>{o.type==="event"&&t(o.data)});for await(let o of Eo(n.body)){let c=new TextDecoder().decode(o);i.feed(c)}};var Hn=class{constructor(e){v(this,"log");v(this,"status","needAuth");v(this,"active",!1);v(this,"taskList",{});this.log=new ye("Background/Chat/"+e)}async auth(e){this.active=!0,await this.updateClientStatus("success")}async destroy(){await this.updateClientStatus("needAuth"),this.active=!1}async updateClientStatus(e){this.active&&(this.status=e,this.log.info("updateStatus",this.status))}async abortTask(e){return this.taskList[e]&&(this.taskList[e](),delete this.taskList[e]),!0}},re=Hn;var To=[{title:"gpt-3.5-turbo",titleTag:"",value:"gpt-3.5-turbo",maxTokens:4096,tags:[],descriptions:[{label:"client:provider__model__tooltip_card__label__max_token",value:"client:provider__model__tooltip_card__label__max_token__suffix"},{label:"client:provider__model__tooltip_card__label__description",value:"client:provider__chatgpt__model__gpt_3_5__description"}]},{title:"gpt-4",titleTag:"",value:"gpt-4",maxTokens:8192,tags:[],descriptions:[{label:"client:provider__model__tooltip_card__label__max_token",value:"client:provider__model__tooltip_card__label__max_token__suffix"},{label:"client:provider__model__tooltip_card__label__description",value:"client:provider__chatgpt__model__gpt_4__description"}]},{title:"gpt-3.5-turbo-16k",titleTag:"",value:"gpt-3.5-turbo-16k",maxTokens:16384,tags:[],descriptions:[{label:"client:provider__model__tooltip_card__label__max_token",value:"client:provider__model__tooltip_card__label__max_token__suffix"},{label:"client:provider__model__tooltip_card__label__description",value:"client:provider__chatgpt__model__gpt_3_5_16k__description"}]}];var ve=new ye("Background/Chat/UseChatGPTPlusChat"),Bn=class extends re{constructor(){super("UseChatGPTPlusChat");v(this,"status","needAuth");v(this,"lastActiveTabId");v(this,"token");v(this,"conversationId");this.init()}init(){ve.info("init")}async preAuth(){this.active=!0,await this.checkTokenAndUpdateStatus()}async auth(t){this.active=!0,this.lastActiveTabId=t,await this.checkTokenAndUpdateStatus(),this.status==="needAuth"&&await Fr.default.tabs.create({active:!0,url:Je}),await this.updateClientStatus()}async checkTokenAndUpdateStatus(){let t=this.status;this.token=await this.getToken(),this.status=this.token?"success":"needAuth",t!==this.status&&(ve.info("checkTokenAndUpdateStatus",this.status,this.lastActiveTabId),this.lastActiveTabId=void 0),await this.updateClientStatus()}createConversation(){return this.conversationId=G(),this.conversationId}removeConversation(){this.conversationId=void 0}async askChatGPT(t,s,n){if(await this.checkTokenAndUpdateStatus(),this.status!=="success"){n&&n({type:"error",done:!0,error:"Your session has expired. Please log in.",data:{text:"",conversationId:""}});return}let{taskId:i,doc_id:o,backendAPI:c="webchatgpt_gpt_response",streaming:l=!0,chat_history:a=[],model:u}=s||{},p=Object.assign({chat_history:a,streaming:l,message_content:t,chrome_extension_version:xt,model_name:u||To[0].value,temperature:0},o?{doc_id:o}:{});c==="chat_with_document"&&(p.model_name="gpt-3.5-turbo-16k"),c==="webchatgpt_gpt_response"&&(p.model_name="claude-3-haiku");let T=new AbortController,S=T.signal;i&&(this.taskList[i]=()=>T.abort()),ve.info("streaming start",p);let f="",C=!1,E=!1,_=0,N=this.conversationId||"",w=(await Fr.default.storage.local.get(Xe))[Xe]||{},D=w.interval||50,A=w.rate||.5,J=m=>new Promise(y=>setTimeout(y,m)),K=async()=>{if(E)return;if(C&&_===f.length){ve.info("streaming end success"),n&&n({done:!0,type:"message",error:"",data:{text:"",conversationId:N}});return}let m=0,y=Math.floor(f.length-_);if(C){let P=Math.max(Math.floor(f.length*.1),10);m=f.slice(_,P+_).length}else{let P=Math.floor(y*A);m=f.slice(_,P+_).length}m>0&&(ve.debug("streaming echo message",C?"\u4E00\u79D2\u53D1\u9001\u5B8C\u5269\u4E0B\u7684\u6587\u672C":`\u6BCF${D}\u6BEB\u79D2\u53D1\u9001\u5269\u4F59\u6587\u672C\u7684${(A*100).toFixed(0)}%`,_,m,f.length),_+=m,n&&n({type:"message",done:!1,error:"",data:{text:f.slice(0,_),conversationId:N}})),await J(C?100:D),await K()};K();let R=!1;await Me(`${Gr}/gpt/${c}`,{method:"POST",signal:S,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`,"x-version":`webchatgpt_${Fr.default.runtime.getManifest().version}`},body:JSON.stringify(p),onMessage:m=>{try{let y=JSON.parse(m);y!=null&&y.conversation_id&&(N=y.conversation_id),y!=null&&y.text&&(f+=y.text),ve.debug("streaming on message",f)}catch(y){ve.error("parse message.data error: 	",y)}}}).then(m=>{m.status==="OK"&&m.text?n&&n({done:!0,type:"error",error:"",data:{text:m.text,conversationId:N}}):n&&n({done:!0,type:"error",error:m.msg||"Network error.",data:{text:"",conversationId:N}})}).catch(m=>{if(ve.info("streaming end error",m),C=!0,E=!0,(m==null?void 0:m.message)==="BodyStreamBuffer was aborted"||(m==null?void 0:m.message)==="The user aborted a request."){n&&n({type:"error",error:"manual aborted request.",done:!0,data:{text:"",conversationId:N}});return}try{let y=JSON.parse(m.message||m);if(y.msg&&It(y.msg)){n&&n({type:"error",error:y.msg,done:!0,data:{text:"",conversationId:N}});return}(y==null?void 0:y.code)===401&&(R=!0),ve.error("sse error",m),n&&n({done:!0,type:"error",error:y.message||y.detail||"Network error.",data:{text:"",conversationId:N}})}catch(y){n&&n({done:!0,type:"error",error:"Network error.",data:{text:"",conversationId:N}})}}),!C&&l&&(ve.info("streaming end success"),f===""?(Rt("[API] response empty string.",JSON.stringify({model:p.model_name,promptTextLength:p.message_content.length},null,2),{uuid:"6f02f533-def6-4696-b14e-1b00c2d9a4df"}),n&&n({done:!0,type:"error",error:"Something went wrong, please try again. If this issue persists, contact us via email.",data:{text:"",conversationId:N}})):C=!0),R&&(ve.info("user token expired"),this.status="needAuth",await Nt(),await this.updateClientStatus())}async abortTask(t){return this.taskList[t]&&(this.taskList[t](),delete this.taskList[t]),!0}async destroy(){ve.info("destroy"),this.status="needAuth",this.active=!1}async getToken(){return await wt()}async updateClientStatus(){this.active}};var zc=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Jc=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Xc=/^\s*["[{]|^\s*-?\d[\d.]{0,14}\s*$/;function Kc(r,e){if(r!=="__proto__"&&!(r==="constructor"&&e&&typeof e=="object"&&"prototype"in e))return e}function _o(r,e={}){if(typeof r!="string")return r;let t=r.toLowerCase().trim();if(t==="true")return!0;if(t==="false")return!1;if(t==="null")return null;if(t==="nan")return Number.NaN;if(t==="infinity")return Number.POSITIVE_INFINITY;if(t!=="undefined"){if(!Xc.test(r)){if(e.strict)throw new SyntaxError("Invalid JSON");return r}try{return zc.test(r)||Jc.test(r)?JSON.parse(r,Kc):JSON.parse(r)}catch(s){if(e.strict)throw s;return r}}}var rh=String.fromCharCode;var Yc=/#/g,Qc=/&/g;var Zc=/=/g;var wo=/\+/g,el=/%5e/gi,tl=/%60/gi;var rl=/%7c/gi;var sl=/%20/gi;function nl(r){return encodeURI(""+r).replace(rl,"|")}function Fn(r){return nl(typeof r=="string"?r:JSON.stringify(r)).replace(wo,"%2B").replace(sl,"+").replace(Yc,"%23").replace(Qc,"%26").replace(tl,"`").replace(el,"^")}function qn(r){return Fn(r).replace(Zc,"%3D")}function No(r=""){try{return decodeURIComponent(""+r)}catch(e){return""+r}}function il(r){return No(r.replace(wo," "))}function ol(r=""){let e={};r[0]==="?"&&(r=r.slice(1));for(let t of r.split("&")){let s=t.match(/([^=]+)=?(.*)/)||[];if(s.length<2)continue;let n=No(s[1]);if(n==="__proto__"||n==="constructor")continue;let i=il(s[2]||"");typeof e[n]!="undefined"?Array.isArray(e[n])?e[n].push(i):e[n]=[e[n],i]:e[n]=i}return e}function al(r,e){return(typeof e=="number"||typeof e=="boolean")&&(e=String(e)),e?Array.isArray(e)?e.map(t=>`${qn(r)}=${Fn(t)}`).join("&"):`${qn(r)}=${Fn(e)}`:qn(r)}function cl(r){return Object.keys(r).filter(e=>r[e]!==void 0).map(e=>al(e,r[e])).join("&")}var ll=/^\w{2,}:([/\\]{1,2})/,ul=/^\w{2,}:([/\\]{2})?/,hl=/^([/\\]\s*){2,}[^/\\]/;function Ao(r,e={}){return typeof e=="boolean"&&(e={acceptRelative:e}),e.strict?ll.test(r):ul.test(r)||(e.acceptRelative?hl.test(r):!1)}var dl=/\/$|\/\?/;function $n(r="",e=!1){return e?dl.test(r):r.endsWith("/")}function pl(r="",e=!1){if(!e)return($n(r)?r.slice(0,-1):r)||"/";if(!$n(r,!0))return r||"/";let[t,...s]=r.split("?");return(t.slice(0,-1)||"/")+(s.length>0?`?${s.join("?")}`:"")}function ml(r="",e=!1){if(!e)return r.endsWith("/")?r:r+"/";if($n(r,!0))return r||"/";let[t,...s]=r.split("?");return t+"/"+(s.length>0?`?${s.join("?")}`:"")}function gl(r=""){return r.startsWith("/")}function fl(r=""){return(gl(r)?r.slice(1):r)||"/"}function Io(r,e){if(Sl(e)||Ao(r))return r;let t=pl(e);return r.startsWith(t)?r:vl(t,r)}function Ro(r,e){let t=ko(r),s={...ol(t.search),...e};return t.search=cl(s),bl(t)}function Sl(r){return!r||r==="/"}function yl(r){return r&&r!=="/"}function vl(r,...e){let t=r||"";for(let s of e.filter(n=>yl(n)))t=t?ml(t)+fl(s):s;return t}function ko(r="",e){if(!Ao(r,{acceptRelative:!0}))return e?ko(e+r):xo(r);let[t="",s,n=""]=(r.replace(/\\/g,"/").match(/([^/:]+:)?\/\/([^/@]+@)?(.*)/)||[]).splice(1),[i="",o=""]=(n.match(/([^#/?]*)(.*)?/)||[]).splice(1),{pathname:c,search:l,hash:a}=xo(o.replace(/\/(?=[A-Za-z]:)/,""));return{protocol:t,auth:s?s.slice(0,Math.max(0,s.length-1)):"",host:i,pathname:c,search:l,hash:a}}function xo(r=""){let[e="",t="",s=""]=(r.match(/([^#?]*)(\?[^#]*)?(#.*)?/)||[]).splice(1);return{pathname:e,search:t,hash:s}}function bl(r){let e=r.pathname+(r.search?(r.search.startsWith("?")?"":"?")+r.search:"")+r.hash;return r.protocol?r.protocol+"//"+(r.auth?r.auth+"@":"")+r.host+e:e}var Vn=class extends Error{constructor(){super(...arguments),this.name="FetchError"}};function Cl(r,e,t){let s="";e&&(s=e.message),r&&t?s=`${s} (${t.status} ${t.statusText} (${r.toString()}))`:r&&(s=`${s} (${r.toString()})`);let n=new Vn(s);return Object.defineProperty(n,"request",{get(){return r}}),Object.defineProperty(n,"response",{get(){return t}}),Object.defineProperty(n,"data",{get(){return t&&t._data}}),Object.defineProperty(n,"status",{get(){return t&&t.status}}),Object.defineProperty(n,"statusText",{get(){return t&&t.statusText}}),Object.defineProperty(n,"statusCode",{get(){return t&&t.status}}),Object.defineProperty(n,"statusMessage",{get(){return t&&t.statusText}}),n}var El=new Set(Object.freeze(["PATCH","POST","PUT","DELETE"]));function Po(r="GET"){return El.has(r.toUpperCase())}function Tl(r){if(r===void 0)return!1;let e=typeof r;return e==="string"||e==="number"||e==="boolean"||e===null?!0:e!=="object"?!1:Array.isArray(r)?!0:r.constructor&&r.constructor.name==="Object"||typeof r.toJSON=="function"}var _l=new Set(["image/svg","application/xml","application/xhtml","application/html"]),xl=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function wl(r=""){if(!r)return"json";let e=r.split(";").shift()||"";return xl.test(e)?"json":_l.has(e)||e.startsWith("text/")?"text":"blob"}var Nl=new Set([408,409,425,429,500,502,503,504]);function Wn(r){let{fetch:e,Headers:t}=r;function s(o){let c=o.error&&o.error.name==="AbortError"||!1;if(o.options.retry!==!1&&!c){let a;typeof o.options.retry=="number"?a=o.options.retry:a=Po(o.options.method)?0:1;let u=o.response&&o.response.status||500;if(a>0&&Nl.has(u))return n(o.request,{...o.options,retry:a-1})}let l=Cl(o.request,o.error,o.response);throw Error.captureStackTrace&&Error.captureStackTrace(l,n),l}let n=async function(c,l={}){let a={request:c,options:{...r.defaults,...l},response:void 0,error:void 0};a.options.onRequest&&await a.options.onRequest(a),typeof a.request=="string"&&(a.options.baseURL&&(a.request=Io(a.request,a.options.baseURL)),(a.options.query||a.options.params)&&(a.request=Ro(a.request,{...a.options.params,...a.options.query})),a.options.body&&Po(a.options.method)&&Tl(a.options.body)&&(a.options.body=typeof a.options.body=="string"?a.options.body:JSON.stringify(a.options.body),a.options.headers=new t(a.options.headers),a.options.headers.has("content-type")||a.options.headers.set("content-type","application/json"),a.options.headers.has("accept")||a.options.headers.set("accept","application/json"))),a.response=await e(a.request,a.options).catch(async p=>(a.error=p,a.options.onRequestError&&await a.options.onRequestError(a),s(a)));let u=(a.options.parseResponse?"json":a.options.responseType)||wl(a.response.headers.get("content-type")||"");if(u==="json"){let p=await a.response.text(),T=a.options.parseResponse||_o;a.response._data=T(p)}else u==="stream"?a.response._data=a.response.body:a.response._data=await a.response[u]();return a.options.onResponse&&await a.options.onResponse(a),a.response.status>=400&&a.response.status<600?(a.options.onResponseError&&await a.options.onResponseError(a),s(a)):a.response},i=function(c,l){return n(c,l).then(a=>a._data)};return i.raw=n,i.native=e,i.create=(o={})=>Wn({...r,defaults:{...r.defaults,...o}}),i}var Lo=function(){if(typeof globalThis!="undefined")return globalThis;if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(typeof global!="undefined")return global;throw new Error("unable to locate global object")}(),Al=Lo.fetch||(()=>Promise.reject(new Error("[ofetch] global.fetch is not supported!"))),Il=Lo.Headers,be=Wn({fetch:Al,Headers:Il});function Oo(r,e){let s=new RegExp(`"${r}":"([^"]+)"`).exec(e);return s==null?void 0:s[1]}var Do=async()=>{try{let r=await be("https://bard.google.com/faq",{cache:"reload"}),e=Oo("SNlM0e",r),t=Oo("cfb2h",r);return{atValue:e,blValue:t}}catch(r){return{atValue:null,blValue:null}}},Mo=r=>{let e=JSON.parse(r.split(`
`)[3]),t=JSON.parse(e[0][2]);return t?{text:t[4][0][1][0],error:"",ids:[...t[1],t[4][0][0]]}:{text:"",error:`Failed to access Bard
Try again, or visit [bard.google.com](https://bard.google.com) for more information.`,ids:["","",""]}};function Rl(){return Math.floor(Math.random()*9e5)+1e5}var jn=class extends re{constructor(){super("BardChat");v(this,"token");v(this,"contextIds",["","",""]);v(this,"conversationId");this.token=void 0}async checkAuth(){this.active=!0}async auth(){this.active=!0}async askChatGPT(t,s,n){this.conversationId||(this.conversationId=G());let{taskId:i}=s||{},o=new AbortController,c=o.signal,l=!1;if(i&&(this.taskList[i]=()=>o.abort()),!await this.syncBardToken()||!this.token){n&&n({type:"error",error:"UNAUTHORIZED",done:!0,data:{text:"",conversationId:""}});return}try{if(!this.active)return;let a=await be("https://bard.google.com/_/BardChatUi/data/assistant.lamda.BardFrontendService/StreamGenerate",{method:"POST",signal:c,query:{bl:this.token.blValue,_reqid:Rl(),rt:"c"},body:new URLSearchParams({at:this.token.atValue,"f.req":JSON.stringify([null,`[[${JSON.stringify(t)}],null,${JSON.stringify(this.contextIds)}]`])}),parseResponse:S=>S}).catch(S=>{if(S!=null&&S.message.includes("The user aborted a request.")){l=!0,n&&n({type:"error",error:"manual aborted request.",done:!0,data:{text:"",conversationId:""}});return}}),{text:u,ids:p,error:T}=Mo(a);if(this.log.debug("result",a,u,p),p){if(l)return;T?n&&n({type:"message",done:!0,error:T,data:{text:"",conversationId:this.conversationId||""}}):u&&(n&&n({type:"message",done:!1,error:"",data:{text:u,conversationId:this.conversationId||""}}),n&&n({type:"message",done:!0,error:"",data:{text:u,conversationId:this.conversationId||""}}),this.contextIds=p)}else n&&n({type:"error",done:!0,error:"BardChat: Unknown Error",data:{text:"",conversationId:this.conversationId}})}catch(a){this.log.error(a)}}async syncBardToken(){try{let{atValue:t,blValue:s}=await Do();return!t||!s?(this.token=void 0,!1):(this.token={atValue:t,blValue:s},!0)}catch(t){return!1}}reset(){this.conversationId="",this.contextIds=["","",""]}};function kl(){return`13.${Br(104,107)}.${Br(0,255)}.${Br(0,255)}`}var Go="https://www.bing.com/turing/conversation/create";async function Uo(){var i;let r={"x-ms-client-request-id":G(),"x-ms-useragent":"azsdk-js-api-client-factory/1.0.0-beta.1 core-rest-pipeline/1.10.3 OS/macOS"},e;try{if(e=await be.raw(Go,{headers:r,redirect:"error"}),!((i=e._data)!=null&&i.result))throw new Error("Please sign in to [bing.com](https://bing.com/), complete any required verifications, then try again.")}catch(o){if(e=await be.raw(Go,{headers:{...r,"x-forwarded-for":kl()},redirect:"error"}),!e._data)throw new Error("Please sign in to [bing.com](https://bing.com/), complete any required verifications, then try again.")}let t=e._data;if(t.result.value!=="Success"){let o=`${t.result.value}: ${t.result.message}

Please sign in to [bing.com](http://bing.com/), complete any required verifications, then try again.`;throw t.result.value==="UnauthorizedRequest"&&(o+=`
[Log into bing.com to continue.](https://www.bing.com/)`),t.result.value==="Forbidden"&&(o+=`
[Log into bing.com to continue.](https://www.bing.com/)`),new Error(o)}let s=e.headers.get("x-sydney-conversationsignature"),n=e.headers.get("x-sydney-encryptedconversationsignature")||void 0;return t.conversationSignature=t.conversationSignature||s,t.encryptedConversationSignature=n,t}var Ho=async r=>{try{let t=(await qr()).thirdProviderSettings;return t&&t[r]?t[r]:void 0}catch(e){return}};var wh=async(r,e,t,{onMessage:s,onError:n})=>{let i=new Mn({runtime:"client"});return new Promise(o=>{let c=e.messageId,l=Gn(async(a,u)=>{var p;if(a==="Client_askChatGPTQuestionResponse"&&u.taskId===c)return u.error?n==null||n(u.error):(p=u==null?void 0:u.data)!=null&&p.text&&(s==null||s(u.data)),u.done?(o(!0),i.postMessage({event:"Client_askChatGPTQuestionWithProviderDone",data:{}}),l(),{success:!0,message:"ok",data:{}}):{success:!0,message:"ok",data:{}}});i.postMessage({event:"Client_askChatGPTQuestionWithProvider",data:{provider:r,taskId:c,question:e,options:t}})})},Nh=async(r,e,t,{onMessage:s,onError:n})=>{let i=new Mn({runtime:"client"});return new Promise(o=>{let c=e.messageId,l=Gn(async(a,u)=>{var p;if(a==="Client_askChatGPTQuestionResponse"&&u.taskId===c)return u.error?n==null||n(u.error):(p=u==null?void 0:u.data)!=null&&p.text&&(s==null||s(u.data)),u.done?(o(!0),i.postMessage({event:"Client_askChatGPTQuestionWithProviderDone",data:{}}),l(),{success:!0,message:"ok",data:{}}):{success:!0,message:"ok",data:{}}});i.postMessage({event:"Client_askChatGPTQuestionWithProvider",data:{provider:r,taskId:c,question:e,options:t}})})};var zn=Ne(gt());var $r=class{constructor(e,t){v(this,"id");v(this,"clientTabId");v(this,"options");v(this,"url");v(this,"unpackListeners",[]);v(this,"closeListeners",[]);v(this,"messageListeners",[]);v(this,"clearListener");this.id=G(),this.url=e,this.options=t||{}}async init(e){var n;let t=await co(e),s=(n=await zn.default.tabs.query({active:!0}))==null?void 0:n[0];this.clientTabId=(t==null?void 0:t.id)||(s==null?void 0:s.id),this.clearListener=At(async(i,o,c)=>{if(i==="client"&&o==="Client_ListenProxyWebsocketResponse"){let{taskId:l,listenerType:a,data:u}=c;if(l===this.id){switch(a){case"onUnpackedMessage":for(let p of this.unpackListeners)p(u);break;case"onClose":for(let p of this.closeListeners)p(u);break;case"onMessage":for(let p of this.messageListeners)p(u)}return{success:!0,message:"ok",data:!0}}}})}async open(e){await this.sendMessageToClient("Open",{url:this.url,mode:e})}async close(){var e;this.removeAllListeners(),await this.sendMessageToClient("Close",{url:this.url}),(e=this.clearListener)==null||e.call(this)}async sendPacked(e){await this.sendMessageToClient("SendPacked",e)}removeAllListeners(){this.onMessage.removeAllListeners(),this.onUnpackedMessage.removeAllListeners(),this.onClose.removeAllListeners()}get onUnpackedMessage(){return{addListener:e=>{this.unpackListeners.push(e)},removeListener:e=>{this.unpackListeners=this.unpackListeners.filter(t=>t!==e)},removeAllListeners:()=>{this.unpackListeners=[]}}}get onMessage(){return{addListener:e=>{this.messageListeners.push(e)},removeListener:e=>{this.messageListeners=this.messageListeners.filter(t=>t!==e)},removeAllListeners:()=>{this.messageListeners=[]}}}get onClose(){return{addListener:e=>{this.closeListeners.push(e)},removeListener:e=>{this.closeListeners=this.closeListeners.filter(t=>t!==e)},removeAllListeners:()=>{this.closeListeners=[]}}}async sendMessageToClient(e,t){if(this.clientTabId)try{return await zn.default.tabs.sendMessage(this.clientTabId,{id:Kt,data:{taskId:this.id,type:e,data:t},event:"Client_ListenProxyWebsocket"})}catch(s){return await this.close(),null}}};var Pl={["balanced"]:"",["creative"]:"h3imaginative",["precise"]:"h3precise"},Ll=["nlu_direct_response_filter","deepleo","disable_emoji_spoken_text","responsible_ai_policy_235","enablemm","dv3sugg","iyxapbing","iycapbing","galileo","saharagenconv5","log2sph","savememfilter","uprofgen","uprofupd","uprofupdasy","vidsumsnip"],Ol=["tnaenableux","adssqovr","tnaenable","arankc_1_9_3","rankcf","0731ziv2s0","926buffall","inosanewsmob","wrapnoins","prechr","sydtransl","806log2sph","927uprofasy","919vidsnip","829suggtrims0"],Vr=class{constructor(){v(this,"conversationContext")}buildChatRequest(e,t,s){let n=G(),i=Pl[e.conversationStyle];return{arguments:[{source:"cib",optionsSets:Ll.concat(i||[]),allowedMessageTypes:["Chat","InternalSearchQuery","Disengaged","InternalLoaderMessage","SemanticSerp","GenerateContentQuery","SearchQuery"],sliceIds:Ol,verbosity:"verbose",scenario:"SERP",plugins:[],isStartOfSession:e.invocationId===0,message:{timestamp:new Date().toISOString(),author:"user",inputMethod:"Keyboard",text:t,imageUrl:s,messageType:"Chat",requestId:n,messageId:n},requestId:n,conversationId:e.conversationId,conversationSignature:e.conversationSignature,participant:{id:e.clientId}}],invocationId:e.invocationId.toString(),target:"chat",type:4}}async doSendMessage(e){var n;if(!this.conversationContext)try{let i=await Uo(),o=await Ho("BING");this.conversationContext={conversationId:i.conversationId,conversationSignature:i.conversationSignature,encryptedConversationSignature:i.encryptedConversationSignature,clientId:i.clientId,invocationId:0,conversationStyle:(o==null?void 0:o.conversationStyle)||"balanced"}}catch(i){e.onEvent({type:"ERROR",error:i.message||i});return}let t=this.conversationContext,s=new $r(t.encryptedConversationSignature?`wss://sydney.bing.com/sydney/ChatHub?sec_access_token=${encodeURIComponent(t.encryptedConversationSignature)}`:"wss://sydney.bing.com/sydney/ChatHub");await s.init(e.clientTabId),s.onUnpackedMessage.addListener(i=>{var o,c,l,a,u,p,T;for(let S of i)if(JSON.stringify(S)==="{}")s.sendPacked({type:6}),s.sendPacked(this.buildChatRequest(t,e.prompt,e.imageUrl)),t.invocationId+=1;else if(S.type===6)s.sendPacked({type:6});else if(S.type===3)e.onEvent({type:"DONE",data:{conversationId:t.conversationId}}),s.removeAllListeners(),s.close();else if(S.type===1){let f=(c=(o=S.arguments[0])==null?void 0:o.messages)==null?void 0:c[0],C=f?fo(f):"";C&&e.onEvent({type:"UPDATE_ANSWER",data:{text:C,conversationId:t.conversationId}})}else if(S.type===2){let f=((l=S==null?void 0:S.item)==null?void 0:l.messages)||[],C=(u=(a=S==null?void 0:S.item)==null?void 0:a.result)==null?void 0:u.error,E=!1;if(f.some(N=>N.contentOrigin==="TurnLimiter")&&(E=!0,e.onEvent({type:"ERROR",error:"Sorry, you have reached chat turns limit in this conversation."})),C==="User needs to solve CAPTCHA to continue."){E=!0;let N=`

Please visit [bing.com/turing/captcha/challenge](https://www.bing.com/turing/captcha/challenge), complete any required verifications, then try again.`;e.onEvent({type:"ERROR",error:C+N})}if(f.length===0&&((T=(p=S==null?void 0:S.item)==null?void 0:p.result)==null?void 0:T.value)==="UnauthorizedRequest"){E=!0,e.onEvent({type:"ERROR",error:C+`

Please sign in to [bing.com](http://bing.com/), complete any required verifications, then try again.`});return}C==="InvalidRequest"&&(E=!0,e.onEvent({type:"ERROR",error:C})),E&&(this.conversationContext=void 0)}else if(S.type===void 0&&S.error==="Handshake was canceled."){e.onEvent({type:"ERROR",error:"Please sign in to [bing.com](http://bing.com/), complete any required verifications, then try again."});return}}),s.onClose.addListener(()=>{e.onEvent({type:"DONE",data:{conversationId:t.conversationId}})}),(n=e.signal)==null||n.addEventListener("abort",()=>{s.removeAllListeners(),s.close(),e.onEvent({type:"ERROR",error:"manual aborted request."})}),await s.open("bing"),await s.sendPacked({protocol:"json",version:1})}resetConversation(){this.conversationContext=void 0}};var Jn=class extends re{constructor(){super("BingChat");v(this,"bingLib");this.bingLib=new Vr,this.status="success"}async init(){this.log.info("init")}async auth(){this.active=!0,await this.updateClientStatus("success")}async askChatGPT(t,s,n){let{taskId:i,clientTabId:o}=s||{};this.log.info("askChatGPT");let c=new AbortController,l=c.signal;i&&(this.taskList[i]=()=>c.abort()),await this.bingLib.doSendMessage({prompt:t,signal:l,clientTabId:o,onEvent(a){a.type==="ERROR"?n==null||n({type:"error",done:!0,error:a.error,data:{text:"",conversationId:""}}):a.type==="UPDATE_ANSWER"?n==null||n({type:"message",done:!1,error:"",data:{text:a.data.text,conversationId:a.data.conversationId}}):a.type==="DONE"&&(n==null||n({type:"message",done:!0,error:"",data:{text:"",conversationId:a.data.conversationId}}))}})}async removeConversation(t){return this.bingLib.resetConversation(),Promise.resolve(!0)}async destroy(){this.bingLib.resetConversation()}};var Bo=Ne(gt());var Dl=new ye("Background/Chat/ChatSystem"),Xn=class{constructor(){v(this,"lastTimeProvider");v(this,"currentProvider");v(this,"adapters",{});v(this,"sendQuestion",(e,t,s,n)=>{var i;return((i=this.currentAdapter)==null?void 0:i.sendQuestion(e,t,s,n))||Promise.resolve()});this.initChatSystem()}get status(){return this.currentAdapter?this.currentAdapter.status:"needAuth"}get currentAdapter(){return this.currentProvider?this.adapters[this.currentProvider]:void 0}initChatSystem(){At(async(e,t,s,n)=>{var i,o;if(e==="client")switch(t){case"Client_switchChatGPTProvider":{let{provider:c}=s;return await this.switchAdapter(c),{success:!0,data:{provider:c},message:""}}break;case"Client_authChatGPTProvider":{let{provider:c}=s;return await this.switchAdapter(c),await this.auth(((i=n.tab)==null?void 0:i.id)||0),{success:!0,data:{},message:""}}case"Client_checkChatGPTStatus":return{success:!0,data:{status:this.status},message:""};case"Client_createChatGPTConversation":{let c=await this.createConversation();return c?{success:!0,data:{conversationId:c},message:""}:{success:!1,data:{conversationId:c},message:"create conversation failed"}}case"Client_askChatGPTQuestion":{let{taskId:c,question:l,options:a}=s;await this.sendQuestion(c,n,l,a)}break;case"Client_removeChatGPTConversation":{let{conversationId:c}=s;return{success:await this.removeConversation(c||""),data:{},message:""}}case"Client_abortAskChatGPTQuestion":{let{messageId:c}=s;return await this.abortAskQuestion(c),{success:!0,data:{},message:""}}case"Client_destroyWithLogout":return await this.destroy(),{success:!0,data:{},message:""};case"Client_askChatGPTQuestionWithProvider":{let{provider:c,taskId:l,question:a,options:u}=s;await this.switchAdapter(c),await this.auth(((o=n.tab)==null?void 0:o.id)||0),await this.sendQuestion(l,n,a,u)}break;case"Client_askChatGPTQuestionWithProviderDone":this.lastTimeProvider&&this.lastTimeProvider!==this.currentProvider&&(await this.destroy(),await this.switchAdapter(this.lastTimeProvider),this.lastTimeProvider=void 0);break;default:break}}),qr().then(async e=>{e.currentProvider&&await this.switchAdapter(e.currentProvider)})}addAdapter(e,t){this.adapters[e]=t}async switchAdapter(e){if(e===this.currentProvider){Dl.info("switchAdapter","same provider no need to switch");return}return this.lastTimeProvider=this.currentProvider,this.currentAdapter&&await this.currentAdapter.destroy(),this.currentProvider=e,await Un({currentProvider:e}),await this.preAuth(),this.currentAdapter}async auth(e){this.currentAdapter&&await this.currentAdapter.auth(e)}async preAuth(){this.currentAdapter&&await this.currentAdapter.preAuth()}async abortAskQuestion(e){return this.currentAdapter?await this.currentAdapter.abortAskQuestion(e):!1}async createConversation(){var e;return this.currentAdapter&&await((e=this.currentAdapter)==null?void 0:e.createConversation())||""}async removeConversation(e){var s;return this.currentAdapter?await((s=this.currentAdapter)==null?void 0:s.removeConversation(e)):!1}async destroy(){var e;await Bo.default.storage.local.set({[oo]:JSON.stringify([])}),await((e=this.currentAdapter)==null?void 0:e.destroy())}};var qo=(r,e)=>{let t=[],s=r;for(;e[s];){let n=e[s];if(!n.message)break;let i=n.message.content.parts.join("");if(!i)break;t.push({messageId:n.id,parentMessageId:n.parent,text:i}),s=n.parent}return t};var $o="https://chatgpt.com",Wr="WebChatGPT",kt=(r,e,t,s)=>fetch(`${$o}${t}`,{method:e,headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:s===void 0?void 0:JSON.stringify(s)}),Ml=async r=>{try{let{token:e,offset:t=0,limit:s=100,order:n="updated"}=r,o=await(await kt(e,"GET",`/backend-api/conversations?offset=${t}&limit=${s}&order=${n}`)).json();return(o==null?void 0:o.items)||[]}catch(e){return[]}},Fo=async({token:r,conversationId:e,messageId:t,input:s})=>{try{await kt(r,"POST","/backend-api/moderations",{conversation_id:e,message_id:t,input:s,model:"text-moderation-playground"})}catch(n){}},Kn=async(r,e,t)=>{await kt(r,"PATCH",`/backend-api/conversation/${e}`,t)},Yn=async(r=!1)=>{let e=await fetch("https://chatgpt.com/api/auth/session");if(e.status===403&&!r)throw new Error("CLOUDFLARE");let t=await e.json().catch(()=>({}));if(!t.accessToken&&!r)throw new Error("UNAUTHORIZED");return(t==null?void 0:t.accessToken)||""},Qn=class{constructor(e){v(this,"id");v(this,"token");v(this,"model");v(this,"conversationId");v(this,"lastChatGPTAnswerMessageId");v(this,"conversationInfo");v(this,"isCleaningCache",!1);this.token=e.token,this.model=e.model,this.lastChatGPTAnswerMessageId=G(),this.id=G(),this.conversationId=e.conversationId||void 0,this.conversationInfo={title:"",messages:[]}}async updateTitle(e){!this.conversationId||this.conversationInfo.title===e||(await Kn(this.token,this.conversationId,{title:e}),this.conversationInfo.title=e)}async fetchHistoryAndConfig(){if(this.conversationId)try{let t=await(await kt(this.token,"GET",`/backend-api/conversation/${this.conversationId}`)).json();this.conversationInfo={title:t.title,messages:qo(t.current_node,t.mapping),raw:t},t.title!==Wr&&await this.updateTitle(Wr),this.lastChatGPTAnswerMessageId=t.current_node}catch(e){this.lastChatGPTAnswerMessageId=G(),this.conversationId=void 0,this.conversationInfo={title:"",messages:[]}}}async generateAnswer(e,t=!1){let s=e.messageId||G(),n=e.parentMessageId||this.lastChatGPTAnswerMessageId||G(),i=!1,o="",c="",l="primary_assistant",a={action:t?"variant":"next",messages:[{id:s,author:{role:"user"},content:{content_type:"text",parts:[e.prompt]}}],model:this.model,parent_message_id:n,timezone_offset_min:new Date().getTimezoneOffset(),history_and_training_disabled:!1,force_nulligen:!1,force_paragen:!1,force_paragen_model_slug:"",force_rate_limit:!1,reset_rate_limits:!1,suggestions:[],websocket_request_id:G(),conversation_mode:{kind:l}};this.conversationId&&(a.conversation_id=this.conversationId),e.streaming===!1&&(a.streaming=!1);let{arkoseToken:u,chatRequirementsToken:p,dx:T,proofToken:S}=await yo();u&&(a.arkose_token=u),e.meta&&(a.messages[0].metadata=e.meta),await Me(`${$o}/backend-api/conversation`,{method:"POST",signal:e.signal,headers:{Accept:"text/event-stream","Oai-Language":"en-US","Content-Type":"application/json","Openai-Sentinel-Arkose-Token":u||"",Authorization:`Bearer ${this.token}`,"Openai-Sentinel-Chat-Requirements-Token":p,"Openai-Sentinel-Proof-Token":S},body:JSON.stringify(Object.assign(a)),onMessage:f=>{var _,N,q,w,D;if(f==="[DONE]"){o&&this.conversationId&&c&&(this.updateTitle(Wr),Fo({token:this.token,conversationId:this.conversationId,messageId:c,input:o})),e.onEvent({type:"done"});return}let C;try{C=JSON.parse(f)}catch(A){return}let E=((q=(N=(_=C.message)==null?void 0:_.content)==null?void 0:N.parts)==null?void 0:q[0])||((D=(w=C.message)==null?void 0:w.content)==null?void 0:D.text);E?(o=E,c=C.message.id,this.conversationId=C.conversation_id,this.lastChatGPTAnswerMessageId=C.message.id,this.conversationId&&!i&&(i=!0,Fo({token:this.token,conversationId:this.conversationId,messageId:s,input:e.prompt})),e.onEvent({type:"answer",data:{text:E,messageId:C.message.id,conversationId:C.conversation_id,parentMessageId:s}})):C.error&&e.onEvent({type:"error",data:{message:C.error,detail:C}})}}).then(f=>{if(f!=null&&f.wss_url){f.conversation_id&&(this.conversationId=f.conversation_id);return}}).catch(f=>{try{if((f==null?void 0:f.message)==="The user aborted a request."||(f==null?void 0:f.message)==="BodyStreamBuffer was aborted"){e.onEvent({type:"error",data:{message:"manual aborted request.",detail:""}});return}let C=JSON.parse(f.message||f);e.onEvent({type:"error",data:{message:C.message,detail:C.detail}})}catch(C){e.onEvent({type:"error",data:{message:"Network error.",detail:""}})}})}async close(){this.conversationId&&(await Kn(this.token,this.conversationId,{is_visible:!1}),this.conversationInfo={title:"",messages:[]})}async removeCacheConversation(){if(!this.isCleaningCache&&this.token){let t=(await Ml({token:this.token})).filter(n=>n.title===Wr&&n.id!==this.conversationId);if(t.length===0)return;this.isCleaningCache=!0;let s=n=>new Promise(i=>setTimeout(i,n));for(let n=0;n<t.length;n++)try{await Kn(this.token,t[n].id,{is_visible:!1}),await s(3e3)}catch(i){}this.isCleaningCache=!1}}setConversationId(e){this.conversationId=e}},jr=class{constructor(){v(this,"token");v(this,"conversations");v(this,"abortFunctions");v(this,"models");v(this,"plugins");this.conversations=[],this.abortFunctions={},this.plugins=[],this.token=void 0,this.models=[]}async fetchModels(e){if(this.models.length>0)return this.models;let t=await kt(e,"GET","/backend-api/models").then(s=>s.json());return t!=null&&t.models&&t.models.length>0&&(this.models=t.models),t.models}async fetchPlugins(e){if(this.plugins.length>0)return this.plugins;let t=await kt(e,"GET","/backend-api/aip/p?offset=0&limit=100&statuses=approved").then(s=>s.json());return t!=null&&t.items&&t.items.length>0&&(this.plugins=t.items),t.items}async getModelName(e,t){try{let s=await this.fetchModels(e);if((s==null?void 0:s.length)>0){if(t){let n=s.find(i=>i.slug===t);if(n)return n.slug}return s[0].slug}return Dn}catch(s){return Dn}}async getAllModels(){if(this.models.length>0)return this.models;try{let e=this.token||await Yn();return e&&(this.token=e),await this.fetchModels(e)}catch(e){return[]}}async getAllPlugins(){if(this.plugins.length>0)return this.plugins;try{let e=this.token||await Yn();return e&&(this.token=e),await this.fetchPlugins(e)}catch(e){return[]}}async createConversation(e,t,s=!0){if(this.conversations.length>0)return this.conversations[0];try{let n=this.token||await Yn();n&&(this.token=n);let i=await this.getModelName(n,t),o=new Qn({token:n,model:i,conversationId:e});return this.conversations=[o],s&&o.removeCacheConversation(),await o.fetchHistoryAndConfig(),o}catch(n){return}}getConversation(e){return this.conversations.find(t=>t.id===e||t.conversationId===e)}getConversations(){return this.conversations}async closeConversation(e){try{let t=this.getConversation(e);return t&&(this.conversations=this.conversations.filter(s=>s.conversationId!==e&&s.id!==e),await t.close()),!0}catch(t){return!1}}addAbortWithMessageId(e,t){this.abortFunctions[e]=t}removeAbortWithMessageId(e){delete this.abortFunctions[e]}abortWithMessageId(e){try{this.abortFunctions[e]&&(this.abortFunctions[e](),delete this.abortFunctions[e])}catch(t){}}removeCacheConversation(){var e,t;return(t=(e=this.conversations)==null?void 0:e[0])==null?void 0:t.removeCacheConversation()}removeConversationWithId(e){let t=this.conversations.find(s=>s.conversationId===e);t&&t.close()}};var jo="https://chatgpt.com",si=(r,e,t,s)=>fetch(`${jo}${t}`,{method:e,headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:s===void 0?void 0:JSON.stringify(s)}),Gl=async r=>{let{token:e,conversationId:t,message_id:s,sandbox_path:n}=r,i=`https://chatgpt.com/c/${t}`;try{let c=await(await si(e,"GET",`/backend-api/conversation/${t}/interpreter/download?message_id=${s}&sandbox_path=${n}`)).json();return(c==null?void 0:c.status)==="error"?{success:!1,data:i,error:"File Expired"}:{success:!0,data:(c==null?void 0:c.download_url)||i}}catch(o){return{success:!1,data:i,error:"Network Error"}}},Ul=async r=>{let{token:e,uuid:t}=r;try{let n=await(await si(e,"GET",`/backend-api/files/${t}/download`)).json();return{success:!0,data:n==null?void 0:n.download_url}}catch(s){return{success:!1,data:""}}},ei=class{constructor(e,t){v(this,"functionToExecute");v(this,"abortController");v(this,"interval");this.functionToExecute=e,this.abortController=new AbortController,this.interval=t,this.start()}abort(){try{this.abortController.abort()}catch(e){}}async start(){let e=this.abortController.signal;for(;!e.aborted;)try{await this.functionToExecute()}catch(t){}finally{await new Promise(t=>setTimeout(t,this.interval))}}},ti=class{constructor(){v(this,"currentSequenceId");v(this,"isUpdated");this.currentSequenceId=0,this.isUpdated=!1}tryUpdate(e){return this.isUpdated=!0,e>this.currentSequenceId?(this.currentSequenceId=e,!0):!1}tryGetSequenceId(){return this.isUpdated?(this.isUpdated=!1,[!0,this.currentSequenceId]):[!1,null]}reset(){this.currentSequenceId=0,this.isUpdated=!1}},Zn=new ti,ri=class{constructor(){v(this,"token",null);v(this,"status","disconnected");v(this,"socket",null);v(this,"isDetected",!1);v(this,"isSocketService",!1);v(this,"messageListeners",new Map);v(this,"sequenceAckTask",null);v(this,"socketIdMessageMap",new Map)}init(e){this.token=e}async connect(){if(this.status==="connected")return!0;await this.disconnect(),this.status="connecting";let e=await this.registerWebSocket();return e&&e.wss_url?await this.createWebSocket(e.wss_url):!1}async disconnect(){return this.socket&&(this.socket.close(),this.socket=null),this.status="disconnected",this.isDetected=!1,this.isSocketService=!1,!0}async registerWebSocket(){return(await si(this.token,"POST","/backend-api/register-websocket",{})).json()}createWebSocket(e){return new Promise(t=>{let s=setTimeout(()=>{this.socket&&(this.socket.close(),this.status="disconnected"),t(!1)},5e3);this.socket=new WebSocket(e,"json.reliable.webpubsub.azure.v1"),this.socket.binaryType="arraybuffer",this.socket.onopen=()=>{this.sequenceAckTask=new ei(async()=>{var o;let[n,i]=Zn.tryGetSequenceId();n&&i&&((o=this.socket)==null||o.send(JSON.stringify({sequenceId:i,type:"sequenceAck"})))},1e3)},this.socket.onerror=n=>{var i;(i=this.sequenceAckTask)==null||i.abort()},this.socket.onclose=()=>{var n;this.status="disconnected",Zn.reset(),(n=this.sequenceAckTask)==null||n.abort()},this.socket.onmessage=async n=>{try{let i=await this.handleSocketMessage(n);i&&(i.type==="system"?i.kind==="connected"?(clearTimeout(s),this.status="connected",t(!0)):i.kind==="disconnected"&&(clearTimeout(s),this.status="disconnected",t(!1)):i.type==="message"&&this.onSocketMessage(i).then().catch())}catch(i){}}})}async handleSocketMessage(e){let t=Array.isArray(e.data)?Hl(e.data):e.data;if(typeof t=="string"){if(!t)throw new Error("ChatGPTWebapp Socket [Message]: message data empty");let s=JSON.parse(t);if(s.type==="system"){if(s.event==="connected")return Object.assign({},s,{kind:"connected"});if(s.event==="disconnected")return Object.assign({},s,{kind:"disconnected"})}else if(s.type==="message"){if(s.from==="group"){let n=Vo(s.data,s.dataType);return n===null?null:Object.assign({},s,{data:n,message:Wo(n.body),kind:"groupData"})}else if(s.from==="server"){let n=Vo(s.data,s.dataType);return n===null?null:Object.assign({},s,{data:n,message:Wo(n.body),kind:"serverData"})}else if(s.from==="ack")return Object.assign({},s,{kind:"ack"})}else throw new Error("socket message data type error");return null}else throw new Error("socket message data type error")}async detectChatGPTWebappIsSocket(){var e,t,s;if(this.isDetected)return this.isSocketService;if(this.token){let n=!1;try{let i=await fetch(`${jo}/backend-api/accounts/check/v4-2023-04-27`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`}});if(i.ok&&i.status===200){this.isDetected=!0;let o=await i.json(),c=[];(e=o==null?void 0:o.account_ordering)==null||e.forEach(l=>{var a,u,p,T;(u=(a=o==null?void 0:o.accounts)==null?void 0:a[l])!=null&&u.features&&c.push(...(T=(p=o==null?void 0:o.accounts)==null?void 0:p[l])==null?void 0:T.features)}),c.push(...((s=(t=o==null?void 0:o.accounts)==null?void 0:t.default)==null?void 0:s.features)||[]),c.includes("shared_websocket")&&(this.isSocketService=!0,n=!0)}}catch(i){}return n}return this.isSocketService}onMessageIdListener(e,t){this.messageListeners.set(e,t)}async onSocketMessage(e){((e==null?void 0:e.kind)==="serverData"||(e==null?void 0:e.kind)==="groupData")&&this.processMessage(e,t=>{var s;(s=t==null?void 0:t.ChatGPTSocketRawData)!=null&&s.sequenceId&&Zn.tryUpdate(t.ChatGPTSocketRawData.sequenceId),this.messageListeners.forEach((n,i)=>{t.parentMessageId===i&&n(t.parentMessageId,t)})})}async processMessage(e,t){var s,n,i,o,c,l,a,u,p,T,S,f,C,E,_,N,q,w,D,A,J,K,R,m;if(!(!e.message||e.message==="")){if(e.message==="[DONE]"){let y=(s=e.data)==null?void 0:s.response_id;if(y&&this.socketIdMessageMap.has(y)){let P=this.socketIdMessageMap.get(y),me=P.text;this.token&&P.displayImages.length>0&&(await Promise.all(P.displayImages.map(async $=>await Ul({token:this.token,uuid:$})))).forEach($=>{$.success&&$.data&&(me=`![image](${$.data})
${me}`)});let ie=me.match(/\[.*?\]\(.*?\)/g);P.conversationId&&P.messageId&&ie&&ie.length>0&&(await Promise.all(ie.map(async $=>{let te=$.split("](");if(te.length!==2)return;let we=te[0].slice(1),pt=te[1].slice(0,-1);if(!pt.startsWith("sandbox:"))return;let j=await Gl({token:this.token,conversationId:P.conversationId,message_id:P.messageId,sandbox_path:pt.replace("sandbox:","")});if(j.success)return{original:$,new:`[${we}](${j.data})`}}))).forEach($=>{$&&(me=me.replace($.original,$.new))}),t({parentMessageId:P.parentMessageId,messageId:P.messageId,conversationId:P.conversationId,text:me,error:"",done:!0,ChatGPTSocketRawData:e,ChatGPTMessageRawData:P.rawMessage}),this.socketIdMessageMap.delete(y),this.messageListeners.delete(P.parentMessageId)}return}try{let y=JSON.parse(e.message),P=((n=y==null?void 0:y.message)==null?void 0:n.id)||"",me=((o=(i=y==null?void 0:y.message)==null?void 0:i.metadata)==null?void 0:o.parent_id)||"",ie=(c=e.data)==null?void 0:c.response_id;if(!P||!ie||!me)return;this.socketIdMessageMap.has(ie)||this.socketIdMessageMap.set(ie,{messageId:P,parentMessageId:me,conversationId:y.conversation_id,displayImages:[],text:"",rawMessage:y});let M=this.socketIdMessageMap.get(ie);if(y.error){t({messageId:P,parentMessageId:M.parentMessageId,conversationId:y.conversation_id,text:"",error:y.error,done:!0,ChatGPTSocketRawData:e,ChatGPTMessageRawData:y});return}let $=((u=(a=(l=y.message)==null?void 0:l.content)==null?void 0:a.parts)==null?void 0:u[0])||((T=(p=y.message)==null?void 0:p.content)==null?void 0:T.text)||"";if(typeof $=="string"&&$.includes("<<ImageDisplayed>>")){let we=((N=(((_=(E=(C=(f=(S=y.message)==null?void 0:S.metadata)==null?void 0:f.aggregate_result)==null?void 0:C.messages)==null?void 0:E[0])==null?void 0:_.image_url)||"").split("//"))==null?void 0:N[1])||"";we&&!M.displayImages.find(pt=>pt)&&M.displayImages.push(we)}if(((w=(q=y.message)==null?void 0:q.content)==null?void 0:w.content_type)==="multimodal_text"&&((A=(D=y.message.content.parts)==null?void 0:D[0])==null?void 0:A.content_type)==="image_asset_pointer"){$="Creating image";let te=((m=(R=(K=(J=y.message.content.parts)==null?void 0:J[0])==null?void 0:K.asset_pointer)==null?void 0:R.split("//"))==null?void 0:m[1])||"";if(te){if(M.displayImages.find(we=>we===te))return;M.displayImages.push(te)}}M.text=$,this.socketIdMessageMap.set(ie,M),t({messageId:P,parentMessageId:M.parentMessageId,done:!1,conversationId:y.conversation_id,text:M.text,error:"",ChatGPTSocketRawData:e,ChatGPTMessageRawData:y})}catch(y){}}}};function Vo(r,e){if(e==="text"){if(typeof r!="string")throw new TypeError("Message must be a string when dataType is text");return r}if(e==="json")return r;if(e!=="binary"&&e!=="protobuf")return null;let t=Buffer.from(r,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}function Wo(r){try{let e=atob(r).trim();return e.startsWith("data: ")&&(e=e.replace("data: ","")),e}catch(e){return""}}function Hl(r){let e;if(!Array.isArray(r))throw new TypeError('"bufferList" argument must be an Array of Buffers');if(r.length===0)return Buffer.alloc(0);if(typeof e=="undefined"){e=0;for(let n=0;n<r.length;++n)e+=r[n].length}let t=Buffer.allocUnsafe(e),s=0;for(let n=0;n<r.length;++n){let i=r[n];if(i instanceof Uint8Array)s+i.length>t.length?(Buffer.isBuffer(i)||(i=Buffer.from(i)),i.copy(t,s)):Uint8Array.prototype.set.call(t,i,s);else if(Buffer.isBuffer(i))i.copy(t,s);else throw new TypeError('"bufferList" argument must be an Array of Buffers');s+=i.length}return t}var Yt=class{static get socketService(){return Yt.instance||(Yt.instance=new ri),Yt.instance}},zr=Yt;v(zr,"instance");var Qt=zr;var Zt=new ye("ChatGPT/OpenAIChat"),Bl="WebChatGPT",ni=class extends re{constructor(){super("OpenAIChat");v(this,"openAILib");v(this,"status","success");v(this,"conversation");this.openAILib=new jr,this.conversation=void 0,this.init()}init(){this.log.info("init")}async preAuth(){this.log.info("preAuth")}async auth(t){this.active=!0,this.status="success",await this.updateClientStatus()}async createConversation(){return this.conversation=await this.openAILib.createConversation(),this.conversation}async removeConversation(t){return await this.openAILib.closeConversation(t)}async askChatGPT(t,s,n){this.conversation&&(s!=null&&s.newConversation)&&(await this.removeConversation(this.conversation.conversationId),this.conversation=void 0);try{await this.createConversation()}catch(p){n==null||n({type:"error",done:!0,error:p.message||"conversation is not created",data:{text:"",conversationId:""}})}if(!this.openAILib.token){n==null||n({type:"error",done:!0,error:"UNAUTHORIZED",data:{text:"",conversationId:""}});return}if(!this.conversation){n==null||n({type:"error",done:!0,error:"conversation is not created",data:{text:"",conversationId:""}});return}let i=this.openAILib,o=this.conversation,{taskId:c}=s||{};this.log.info("askChatGPT");let l=new AbortController,a=l.signal;if(c&&(this.taskList[c]=()=>l.abort()),Qt.socketService.init(this.openAILib.token||""),await Qt.socketService.detectChatGPTWebappIsSocket())if(await Qt.socketService.connect()){let T=G();Qt.socketService.onMessageIdListener(T,async(S,f)=>{f.done?(c&&i.removeAbortWithMessageId(c),n==null||n({type:"message",done:!0,error:"",data:{text:"",conversationId:o.conversationId}}),o.updateTitle(Bl).catch(console.error)):n==null||n({type:"message",done:!1,error:"",data:{text:f.text,conversationId:f.conversationId}})}),await this.conversation.generateAnswer({prompt:t,messageId:T,signal:a,streaming:!1,onEvent(S){Zt.info("generateAnswer",S,s)}},(s==null?void 0:s.regenerate)===!0)}else n==null||n({type:"error",done:!0,error:"WS Connection failed",data:{text:"",conversationId:""}});else await this.conversation.generateAnswer({prompt:t,signal:a,onEvent(p){if(Zt.info("generateAnswer",p,s),p.type==="error"){Zt.info("error"),Zt.info("abort Controller remove",c),c&&i.removeAbortWithMessageId(c),n==null||n({type:"error",done:!0,error:p.data.message||p.data.detail||"",data:{text:"",conversationId:""}});return}if(p.type==="done"){Zt.info("abort Controller remove",c),c&&i.removeAbortWithMessageId(c),n==null||n({type:"message",done:!0,error:"",data:{text:"",conversationId:o.conversationId}});return}n==null||n({type:"message",done:!1,error:"",data:{text:p.data.text,conversationId:o.conversationId}})}},(s==null?void 0:s.regenerate)===!0)}async abortAskQuestion(t){return this.taskList[t]&&(this.taskList[t](),delete this.taskList[t]),this.openAILib.abortWithMessageId(t)}async destroy(){this.openAILib.removeCacheConversation()}async updateClientStatus(){this.active}};var Jr=Ne(gt());var Ce=new ye("Background/Chat/MaxAIClaudeChat"),ii=class extends re{constructor(){super("MaxAIClaudeChat");v(this,"status","needAuth");v(this,"lastActiveTabId");v(this,"token");v(this,"conversationId");this.init()}init(){Ce.info("init")}async preAuth(){this.active=!0,await this.checkTokenAndUpdateStatus()}async auth(t){this.active=!0,this.lastActiveTabId=t,await this.checkTokenAndUpdateStatus(),this.status==="needAuth"&&await Jr.default.tabs.create({active:!0,url:Je}),await this.updateClientStatus()}async checkTokenAndUpdateStatus(){let t=this.status;this.token=await this.getToken(),this.status=this.token?"success":"needAuth",t!==this.status&&(Ce.info("checkTokenAndUpdateStatus",this.status,this.lastActiveTabId),this.lastActiveTabId=void 0),await this.updateClientStatus()}createConversation(){return this.conversationId=G(),this.conversationId}removeConversation(){this.conversationId=void 0}async askChatGPT(t,s,n){if(await this.checkTokenAndUpdateStatus(),this.status!=="success"){n&&n({type:"error",done:!0,error:"Your session has expired. Please log in.",data:{text:"",conversationId:""}});return}let{taskId:i,streaming:o=!0,regenerate:c=!1,chat_history:l=[],model:a}=s||{},u=Object.assign({chat_history:l,regenerate:c,streaming:o,message_content:t,chrome_extension_version:xt,model_name:a||"claude-3-haiku"}),p=new AbortController,T=p.signal;i&&(this.taskList[i]=()=>p.abort()),Ce.info("streaming start",u);let S="",f=!1,C=!1,E=0,_=this.conversationId||"",q=(await Jr.default.storage.local.get(Xe))[Xe]||{},w=q.interval||50,D=q.rate||.5,A=R=>new Promise(m=>setTimeout(m,R)),J=async()=>{if(C)return;if(f&&E===S.length){Ce.info("streaming end success"),n&&n({done:!0,type:"message",error:"",data:{text:"",conversationId:_}});return}let R=0,m=Math.floor(S.length-E);if(f){let y=Math.max(Math.floor(S.length*.1),10);R=S.slice(E,y+E).length}else{let y=Math.floor(m*D);R=S.slice(E,y+E).length}R>0&&(Ce.debug("streaming echo message",f?"\u4E00\u79D2\u53D1\u9001\u5B8C\u5269\u4E0B\u7684\u6587\u672C":`\u6BCF${w}\u6BEB\u79D2\u53D1\u9001\u5269\u4F59\u6587\u672C\u7684${(D*100).toFixed(0)}%`,E,R,S.length),E+=R,n&&n({type:"message",done:!1,error:"",data:{text:S.slice(0,E),conversationId:_}})),await A(f?100:w),await J()};J();let K=!1;await Me(`${Gr}/gpt/webchatgpt_gpt_response`,{method:"POST",signal:T,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`,"x-version":`webchatgpt_${Jr.default.runtime.getManifest().version}`},body:JSON.stringify(u),onMessage:R=>{try{let m=JSON.parse(R);m!=null&&m.conversation_id&&(_=m.conversation_id),m!=null&&m.text&&(S+=m.text),Ce.debug("streaming on message",S)}catch(m){Ce.error("parse message.data error: 	",m)}}}).then(R=>{R.status==="OK"&&R.text?n&&n({done:!0,type:"error",error:"",data:{text:R.text,conversationId:_}}):n&&n({done:!0,type:"error",error:R.msg||"Network error.",data:{text:"",conversationId:_}})}).catch(R=>{if(Ce.info("streaming end error",R),f=!0,C=!0,(R==null?void 0:R.message)==="BodyStreamBuffer was aborted"||(R==null?void 0:R.message)==="The user aborted a request."){n&&n({type:"error",error:"manual aborted request.",done:!0,data:{text:"",conversationId:_}});return}try{let m=JSON.parse(R.message||R);if(m.msg&&It(m.msg)){n&&n({type:"error",error:m.msg,done:!0,data:{text:"",conversationId:_}});return}(m==null?void 0:m.code)===401&&(K=!0),Ce.error("sse error",R),n&&n({done:!0,type:"error",error:m.message||m.detail||"Network error.",data:{text:"",conversationId:_}})}catch(m){n&&n({done:!0,type:"error",error:"Network error.",data:{text:"",conversationId:_}})}}),!f&&o&&(Ce.info("streaming end success"),S===""?(Rt("[API] response empty string.",JSON.stringify({model:u.model_name,promptTextLength:u.message_content.length},null,2),{uuid:"6f02f533-def6-4696-b14e-1b00c2d9a4df"}),n&&n({done:!0,type:"error",error:"Something went wrong, please try again. If this issue persists, contact us via email.",data:{text:"",conversationId:_}})):f=!0),K&&(Ce.info("user token expired"),this.status="needAuth",await Nt(),await this.updateClientStatus())}async abortTask(t){return this.taskList[t]&&(this.taskList[t](),delete this.taskList[t]),!0}async destroy(){Ce.info("destroy"),this.status="needAuth",this.active=!1}async getToken(){return await wt()}async updateClientStatus(){this.active}};var oi=Ne(gt());var Ee=new ye("Background/Chat/UseChatGPTPlusChat"),ai=class extends re{constructor(){super("FreeAIChat");v(this,"status","success");v(this,"lastActiveTabId");v(this,"token");v(this,"conversationId");this.init()}init(){Ee.info("init")}async preAuth(){this.active=!0,await this.checkTokenAndUpdateStatus()}async auth(t){this.active=!0,this.lastActiveTabId=t,await this.checkTokenAndUpdateStatus(),this.status==="needAuth"&&await oi.default.tabs.create({active:!0,url:Je}),await this.updateClientStatus()}async checkTokenAndUpdateStatus(){let t=this.status;this.token=await this.getToken(),this.status="success",t!==this.status&&(Ee.info("checkTokenAndUpdateStatus",this.status,this.lastActiveTabId),this.lastActiveTabId=void 0),await this.updateClientStatus()}createConversation(){return this.conversationId=G(),this.conversationId}removeConversation(){this.conversationId=void 0}async askChatGPT(t,s,n){if(await this.checkTokenAndUpdateStatus(),this.status!=="success"){n&&n({type:"error",done:!0,error:"Your session has expired. Please log in.",data:{text:"",conversationId:""}});return}let{taskId:i,doc_id:o,backendAPI:c="get_freeai_web_response",streaming:l=!0,chat_history:a=[],model:u}=s||{},p=Object.assign({chat_history:a,streaming:l,message_content:t,chrome_extension_version:xt,model_name:u||So[0].value,temperature:0},o?{doc_id:o}:{}),T=new AbortController,S=T.signal;i&&(this.taskList[i]=()=>T.abort()),Ee.info("streaming start",p);let f="",C=!1,E=!1,_=0,N=this.conversationId||"",w=(await oi.default.storage.local.get(Xe))[Xe]||{},D=w.interval||50,A=w.rate||.5,J=m=>new Promise(y=>setTimeout(y,m)),K=async()=>{if(E)return;if(C&&_===f.length){Ee.info("streaming end success"),n&&n({done:!0,type:"message",error:"",data:{text:"",conversationId:N}});return}let m=0,y=Math.floor(f.length-_);if(C){let P=Math.max(Math.floor(f.length*.1),10);m=f.slice(_,P+_).length}else{let P=Math.floor(y*A);m=f.slice(_,P+_).length}m>0&&(Ee.debug("streaming echo message",C?"\u4E00\u79D2\u53D1\u9001\u5B8C\u5269\u4E0B\u7684\u6587\u672C":`\u6BCF${D}\u6BEB\u79D2\u53D1\u9001\u5269\u4F59\u6587\u672C\u7684${(A*100).toFixed(0)}%`,_,m,f.length),_+=m,n&&n({type:"message",done:!1,error:"",data:{text:f.slice(0,_),conversationId:N}})),await J(C?100:D),await K()};K();let R=!1;await Me(`${io}/gpt/${c}`,{method:"POST",signal:S,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify(p),onMessage:m=>{try{let y=JSON.parse(m);y!=null&&y.conversation_id&&(N=y.conversation_id),y!=null&&y.text&&(f+=y.text),Ee.debug("streaming on message",f)}catch(y){Ee.error("parse message.data error: 	",y)}}}).then(m=>{m.status==="OK"&&m.text?n&&n({done:!0,type:"error",error:"",data:{text:m.text,conversationId:N}}):n&&n({done:!0,type:"error",error:m.msg||"Network error.",data:{text:"",conversationId:N}})}).catch(m=>{if(Ee.info("streaming end error",m),C=!0,E=!0,(m==null?void 0:m.message)==="BodyStreamBuffer was aborted"||(m==null?void 0:m.message)==="The user aborted a request."){n&&n({type:"error",error:"manual aborted request.",done:!0,data:{text:"",conversationId:N}});return}try{let y=JSON.parse(m.message||m);if(y.msg&&It(y.msg)){n&&n({type:"error",error:y.msg,done:!0,data:{text:"",conversationId:N}});return}if((y==null?void 0:y.code)===401){R=!0,n&&n({done:!0,type:"error",error:y,data:{text:"",conversationId:N}});return}Ee.error("sse error",m),n&&n({done:!0,type:"error",error:y.message||y.detail||"Network error.",data:{text:"",conversationId:N}})}catch(y){n&&n({done:!0,type:"error",error:"Network error.",data:{text:"",conversationId:N}})}}),!C&&l&&(Ee.info("streaming end success"),f===""?(Rt("[API] response empty string.",JSON.stringify({model:p.model_name,promptTextLength:p.message_content.length},null,2),{uuid:"6f02f533-def6-4696-b14e-1b00c2d9a4df"}),n&&n({done:!0,type:"error",error:"Something went wrong, please try again. If this issue persists, contact us via email.",data:{text:"",conversationId:N}})):C=!0),R&&(Ee.info("user token expired"),this.status="needAuth",await Nt(),await this.updateClientStatus())}async abortTask(t){return this.taskList[t]&&(this.taskList[t](),delete this.taskList[t]),!0}async destroy(){Ee.info("destroy"),this.status="needAuth",this.active=!1}async getToken(){return await wt()}async updateClientStatus(){this.active}};function zo(r,e){let s=new RegExp(`"${r}":"([^"]+)"`).exec(e);return s==null?void 0:s[1]}var Jo=async()=>{try{let r=await be("https://gemini.google.com/faq",{cache:"reload"}),e=zo("SNlM0e",r),t=zo("cfb2h",r);return{atValue:e,blValue:t}}catch(r){return{atValue:null,blValue:null}}},Xo=r=>{var e,t,s,n,i,o,c,l;try{let a=r.split(`
`).filter(f=>f.startsWith('[["wrb.fr"'))||[],u;for(let f of a){let C=JSON.parse(f),E=JSON.parse((e=C==null?void 0:C[0])==null?void 0:e[2]);if((n=(s=(t=E==null?void 0:E[4])==null?void 0:t[0])==null?void 0:s[1])!=null&&n[0]){u=E;break}}if(!u)return{text:"",error:"Please log into [gemini.google.com](https://gemini.google.com) and try again.",ids:["","",""]};let p=u[4][0][1][0],T=((l=(c=(o=(i=u==null?void 0:u[4])==null?void 0:i[0])==null?void 0:o[12])==null?void 0:c[7])==null?void 0:l[0])||[],S=[];return T.length>0&&T.map(f=>{var _,N,q;let C=(N=(_=f==null?void 0:f[0])==null?void 0:_[3])==null?void 0:N[3],E=(q=f==null?void 0:f[1])==null?void 0:q[0];C&&E&&!S.includes(E)?(S.push(E),p=p.replace(E,`!${E}(${C})`)):p+=`!${E}(${C})`}),{text:p,error:"",ids:[...u[1],u[4][0][0]]}}catch(a){return{text:"",error:"Something went wrong. Please try again.",ids:["","",""]}}};function Ko(){return Math.floor(Math.random()*9e5)+1e5}var ci=class extends re{constructor(){super("GeminiChat");v(this,"token");v(this,"contextIds",["","",""]);v(this,"conversationId");this.token=void 0}async checkAuth(){this.active=!0}async auth(){this.active=!0}async askChatGPT(t,s,n){this.conversationId||(this.conversationId=G());let{taskId:i}=s||{},o=new AbortController,c=o.signal,l=!1;if(i&&(this.taskList[i]=()=>o.abort()),!await this.syncGeminiToken()||!this.token){n&&n({type:"error",error:"UNAUTHORIZED",done:!0,data:{text:"",conversationId:""}});return}try{if(!this.active)return;let a=await be("https://gemini.google.com/_/BardChatUi/data/assistant.lamda.BardFrontendService/StreamGenerate",{method:"POST",signal:c,query:{bl:this.token.blValue,_reqid:Ko(),rt:"c"},body:new URLSearchParams({at:this.token.atValue,"f.req":JSON.stringify([null,`[[${JSON.stringify(t)}],null,${JSON.stringify(this.contextIds)}]`])}),parseResponse:S=>S}).catch(S=>{if(S!=null&&S.message.includes("The user aborted a request.")){l=!0,n&&n({type:"error",error:"manual aborted request.",done:!0,data:{text:"",conversationId:""}});return}}),{text:u,ids:p,error:T}=Xo(a);if(this.log.debug("result",a,u,p),p){if(this.conversationId=p[0].replace("c_",""),l)return;T?n&&n({type:"message",done:!0,error:T,data:{text:"",conversationId:this.conversationId||""}}):u&&(n&&n({type:"message",done:!1,error:"",data:{text:u,conversationId:this.conversationId||""}}),n&&n({type:"message",done:!0,error:"",data:{text:u,conversationId:this.conversationId||""}}),this.contextIds=p)}else n&&n({type:"error",done:!0,error:"GeminiChat: Unknown Error",data:{text:"",conversationId:this.conversationId}})}catch(a){this.log.error(a)}}async syncGeminiToken(){try{let{atValue:t,blValue:s}=await Jo();return!t||!s?(this.token=void 0,!1):(this.token={atValue:t,blValue:s},!0)}catch(t){return!1}}reset(){this.conversationId="",this.contextIds=["","",""]}async removeConversation(t){if(t&&this.token){let s=await be("https://gemini.google.com/_/BardChatUi/data/batchexecute",{method:"POST",query:{rpcids:"GzXR5e",bl:this.token.blValue,_reqid:Ko(),rt:"c","source-path":"/app"},body:new URLSearchParams({at:this.token.atValue,"f.req":JSON.stringify([[["GzXR5e",`["c_${t}"]`,null,"generic"]]])}),parseResponse:n=>n}).catch(n=>{})}}};var er=async()=>{var r;try{let t=await(await fetch("https://claude.ai/api/organizations",{redirect:"error",cache:"no-cache"})).json();return(r=t==null?void 0:t[0])==null?void 0:r.uuid}catch(e){return""}},Yo=async(r,e)=>{try{if(!r)return;let t=G(),s=await fetch(`https://claude.ai/api/organizations/${r}/chat_conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e||"",uuid:t})});if(s.status===201||s.status===200){let n=await s.json();return n.uuid?n:void 0}else return}catch(t){return}},ql=async r=>{try{let e=await fetch(`https://claude.ai/api/organizations/${r}/chat_conversations`,{method:"GET"});if(e.status===200){let t=await e.json();return t.length?t:[]}return[]}catch(e){return[]}},Qo=async(r,e)=>{let t=await ql(r);t=t.filter(n=>n.name===e);let s=[];for(;t.length;)s=t.splice(0,5).map(n=>n.uuid),await Promise.all(s.map(n=>li(r,n))),await new Promise(n=>setTimeout(n,5e3))},li=async(r,e)=>{try{let t=await fetch(`https://claude.ai/api/organizations/${r}/chat_conversations/${e}`,{method:"DELETE"});return t.status===204||t.status===200}catch(t){return!1}},Zo=async(r,e,t)=>{let s=new FormData;s.append("file",e,t||(e==null?void 0:e.name)||""),s.append("orgUuid",r);let n=await fetch("https://claude.ai/api/convert_document",{method:"POST",body:s});if(n.status===200){let o=await n.json();if(o.extracted_content)return o.file_name=t||(e==null?void 0:e.name)||o.file_name||"",{success:!0,data:o,error:""}}let i="Upload failed.";return n.status===429&&(i="Exceeded file upload rate limit"),{success:!1,data:void 0,error:i}};var Xr=class{constructor(e){v(this,"conversation");v(this,"abortController");v(this,"organizationId");v(this,"attachments",[]);this.organizationId=e}get conversationId(){var e;return(e=this.conversation)==null?void 0:e.uuid}async createConversation(e){var t;return this.organizationId||(this.organizationId=await er()),this.organizationId&&(this.conversation=await Yo(this.organizationId,e)),((t=this.conversation)==null?void 0:t.uuid)||""}async sendMessage(e,t){var l;let{regenerate:s=!1,onMessage:n}=t||{},i=(l=this.conversation)==null?void 0:l.uuid;if(!i||!this.organizationId){if(i=await this.createConversation(),!i||!this.organizationId){n==null||n({completion:"",log_id:"",messageLimit:{type:"within_limit"},model:"",stop:!0,stop_reason:"UNAUTHORIZED"});return}return}this.abortController=new AbortController;let o=this.abortController.signal,c=s?`https://claude.ai/api/organizations/${this.organizationId}/chat_conversations/${i}/retry_completion`:`https://claude.ai/api/organizations/${this.organizationId}/chat_conversations/${i}/completion`;s&&(e=""),await Me(c,{signal:o,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({attachments:this.attachments.map(a=>{let u=Hr(a);return delete u.id,u}),files:[],prompt:e,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone}),onMessage:a=>{try{let u=JSON.parse(a);u.log_id&&(n==null||n(u))}catch(u){}}}).then(()=>{}).catch(a=>{var u;if(a!=null&&a.message.includes("The user aborted a request.")||a!=null&&a.message.includes("BodyStreamBuffer was aborted")){n==null||n({completion:"",log_id:"",messageLimit:{type:"within_limit"},model:"",stop:!0,stop_reason:"The user aborted a request."});return}try{let p=JSON.parse(a.message),T=((u=p==null?void 0:p.error)==null?void 0:u.message)||(p==null?void 0:p.message)||"Network Error";n==null||n({completion:"",log_id:"",messageLimit:{type:"within_limit"},model:"",stop:!0,stop_reason:T})}catch(p){n==null||n({completion:"",log_id:"",messageLimit:{type:"within_limit"},model:"",stop:!0,stop_reason:"Network Error"})}}),this.resetAttachments()}abortSendMessage(){var e;(e=this.abortController)==null||e.abort()}async resetConversation(){var e;if((e=this.conversation)!=null&&e.uuid&&this.organizationId){let t=await li(this.organizationId,this.conversation.uuid)}return this.conversation=void 0,!0}async uploadAttachment(e,t){if(!this.organizationId&&(this.organizationId=await er(),!this.organizationId))return{success:!1,error:"organization id not found",data:void 0};if(e.size>10*1024*1024)return{success:!1,error:"file size too large",data:void 0};let s=await Zo(this.organizationId,e,t||e.name);if(s.success&&s.data){let n=s.data;return n.id=G(),this.attachments.push(n),{success:!0,error:void 0,data:n}}else return{success:!1,error:s.error||"Upload failed.",data:void 0}}resetAttachments(){return this.attachments=[],!0}removeAttachment(e){let t=this.attachments.findIndex(s=>s.id===e);return t>-1&&this.attachments.splice(t,1),!0}};var tr=Ne(gt());var Pt="CHROME_EXTENSION_LOCAL_STORAGE_CLAUDE_TOKEN_KEY",ea="WebChatGPT",ta=class extends re{constructor(){super("ClaudeChat");v(this,"claude");this.claude=new Xr,this.status="success"}async init(){this.log.info("init")}async preAuth(){this.active=!0;let t=await tr.default.storage.local.get(Pt);t[Pt]&&(this.claude.organizationId=t[Pt]),this.status=this.claude.organizationId?"success":"needAuth"}async auth(){this.active=!0,this.claude.organizationId=await er(),this.claude.organizationId&&(this.status="success",await tr.default.storage.local.set({[Pt]:this.claude.organizationId}),await this.updateClientStatus("success"))}async createConversation(){if(this.claude.conversationId)return this.claude.conversationId;let t=await this.claude.createConversation(ea);return this.claude.organizationId?await tr.default.storage.local.set({[Pt]:this.claude.organizationId}):(await tr.default.storage.local.remove(Pt),this.status="needAuth",await this.updateClientStatus("needAuth")),t}async askChatGPT(t,s,n){let{regenerate:i}=s||{},o="";this.log.info("ClaudeChat send"),await this.claude.sendMessage(t,{regenerate:i,onMessage:c=>{c.stop?c.stop_reason==="stop_sequence"?n==null||n({type:"message",done:!0,error:"",data:{text:o,conversationId:this.claude.conversationId}}):c.stop_reason==="The user aborted a request."?n==null||n({type:"error",error:"manual aborted request.",done:!0,data:{text:"",conversationId:this.claude.conversationId}}):n==null||n({type:"error",done:!0,error:c.stop_reason||"Network Error",data:{text:o,conversationId:this.claude.conversationId}}):(o+=c.completion||"",n==null||n({type:"message",done:!1,error:"",data:{text:o,conversationId:this.claude.conversationId}}))}})}async abortTask(t){return this.claude.abortSendMessage(),!0}async removeConversation(t){await this.claude.resetConversation(),this.claude.organizationId&&Qo(this.claude.organizationId,ea).then().catch()}};var qc=Ne(aa());var Lt=Symbol("changed"),it=Symbol("classList"),oe=Symbol("CustomElements"),rr=Symbol("content"),Kr=Symbol("dataset"),ot=Symbol("doctype"),sr=Symbol("DOMParser"),x=Symbol("end"),Ot=Symbol("EventTarget"),Dt=Symbol("globals"),ge=Symbol("image"),Ae=Symbol("mime"),Ge=Symbol("MutationObserver"),b=Symbol("next"),di=Symbol("ownerElement"),U=Symbol("prev"),X=Symbol("private"),ft=Symbol("sheet"),Z=Symbol("start"),Yr=Symbol("style"),at=Symbol("upgrade"),L=Symbol("value");var ca=new Set(["ARTICLE","ASIDE","BLOCKQUOTE","BODY","BR","BUTTON","CANVAS","CAPTION","COL","COLGROUP","DD","DIV","DL","DT","EMBED","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","H1","H2","H3","H4","H5","H6","LI","UL","OL","P"]),pi=-1,mi=1,gi=4,fi=128,la=1,Si=2,yi=4,ua=8,ha=16,da=32,St="http://www.w3.org/2000/svg";var{assign:pa,create:ma,defineProperties:ga,entries:fa,getOwnPropertyDescriptors:Np,keys:Sa,setPrototypeOf:Y}=Object;var yt=String;var ee=r=>r.nodeType===1?r[x]:r,ct=({ownerDocument:r})=>r[Ae].ignoreCase,ce=(r,e)=>{r[b]=e,e[U]=r},nr=(r,e,t)=>{ce(r,e),ce(ee(e),t)},ya=(r,e,t,s)=>{ce(r,e),ce(ee(t),s)},Ke=(r,e,t)=>{ce(r,e),ce(e,t)},ir=({localName:r,ownerDocument:e})=>e[Ae].ignoreCase?r.toUpperCase():r,Qr=(r,e)=>{r&&(r[b]=e),e&&(e[U]=r)};var Ue=new WeakMap;var es=!1,or=new WeakMap,Ye=new WeakMap,vt=(r,e,t,s)=>{es&&Ye.has(r)&&r.attributeChangedCallback&&r.constructor.observedAttributes.includes(e)&&r.attributeChangedCallback(e,t,s)},Ca=(r,e)=>t=>{if(Ye.has(t)){let s=Ye.get(t);s.connected!==e&&t.isConnected===e&&(s.connected=e,r in t&&t[r]())}},va=Ca("connectedCallback",!0),ar=r=>{if(es){va(r),Ue.has(r)&&(r=Ue.get(r).shadowRoot);let{[b]:e,[x]:t}=r;for(;e!==t;)e.nodeType===1&&va(e),e=e[b]}},ba=Ca("disconnectedCallback",!1),Ea=r=>{if(es){ba(r),Ue.has(r)&&(r=Ue.get(r).shadowRoot);let{[b]:e,[x]:t}=r;for(;e!==t;)e.nodeType===1&&ba(e),e=e[b]}},Zr=class{constructor(e){this.ownerDocument=e,this.registry=new Map,this.waiting=new Map,this.active=!1}define(e,t,s={}){let{ownerDocument:n,registry:i,waiting:o}=this;if(i.has(e))throw new Error("unable to redefine "+e);if(or.has(t))throw new Error("unable to redefine the same class: "+t);this.active=es=!0;let{extends:c}=s;or.set(t,{ownerDocument:n,options:{is:c?e:""},localName:c||e});let l=c?a=>a.localName===c&&a.getAttribute("is")===e:a=>a.localName===e;if(i.set(e,{Class:t,check:l}),o.has(e)){for(let a of o.get(e))a(t);o.delete(e)}n.querySelectorAll(c?`${c}[is="${e}"]`:e).forEach(this.upgrade,this)}upgrade(e){if(Ye.has(e))return;let{ownerDocument:t,registry:s}=this,n=e.getAttribute("is")||e.localName;if(s.has(n)){let{Class:i,check:o}=s.get(n);if(o(e)){let{attributes:c,isConnected:l}=e;for(let u of c)e.removeAttributeNode(u);let a=fa(e);for(let[u]of a)delete e[u];Y(e,i.prototype),t[at]={element:e,values:a},new i(t,n),Ye.set(e,{connected:l});for(let u of c)e.setAttributeNode(u);l&&e.connectedCallback&&e.connectedCallback()}}}whenDefined(e){let{registry:t,waiting:s}=this;return new Promise(n=>{t.has(e)?n(t.get(e).Class):(s.has(e)||s.set(e,[]),s.get(e).push(n))})}get(e){let t=this.registry.get(e);return t&&t.Class}};var{Parser:jl}=uo,Ta=!0,Mt=(r,e,t)=>{let s=r[x];return e.parentNode=r,nr(s[U],e,s),t&&e.nodeType===1&&ar(e),e},zl=(r,e,t,s,n)=>{t[L]=s,t.ownerElement=r,Ke(e[U],t,e),t.name==="class"&&(r.className=s),n&&vt(r,t.name,null,s)};var ts=(r,e,t)=>{let{active:s,registry:n}=r[oe],i=r,o=null;Ta=!1;let c=new jl({onprocessinginstruction(l,a){l.toLowerCase()==="!doctype"&&(r.doctype=a.slice(l.length).trim())},onopentag(l,a){let u=!0;if(e){if(o)i=Mt(i,r.createElementNS(St,l),s),i.ownerSVGElement=o,u=!1;else if(l==="svg"||l==="SVG")o=r.createElementNS(St,l),i=Mt(i,o,s),u=!1;else if(s){let T=l.includes("-")?l:a.is||"";if(T&&n.has(T)){let{Class:S}=n.get(T);i=Mt(i,new S,s),delete a.is,u=!1}}}u&&(i=Mt(i,r.createElement(l),!1));let p=i[x];for(let T of Sa(a))zl(i,p,r.createAttribute(T),a[T],s)},oncomment(l){Mt(i,r.createComment(l),s)},ontext(l){Mt(i,r.createTextNode(l),s)},onclosetag(){e&&i===o&&(o=null),i=i.parentNode}},{lowerCaseAttributeNames:!1,decodeEntities:!0,xmlMode:!e});return c.write(t),c.end(),Ta=!0,r};var Gt=new Map,O=(r,e)=>{for(let t of[].concat(r))Gt.set(t,e),Gt.set(t.toUpperCase(),e)};var Uc=Ne(_a(),1);var xa=({[b]:r,[x]:e},t)=>{for(;r!==e;){switch(r.nodeType){case 2:bi(r,t);break;case 3:case 8:Ci(r,t);break;case 1:Ti(r,t),r=ee(r);break;case 10:Ei(r,t);break}r=r[b]}let s=t.length-1,n=t[s];typeof n=="number"&&n<0?t[s]+=-1:t.push(-1)},bi=(r,e)=>{e.push(2,r.name);let t=r[L].trim();t&&e.push(t)},Ci=(r,e)=>{let t=r[L];t.trim()&&e.push(r.nodeType,t)},wa=(r,e)=>{e.push(r.nodeType),xa(r,e)},Ei=({name:r,publicId:e,systemId:t},s)=>{s.push(10,r),e&&s.push(e),t&&s.push(t)},Ti=(r,e)=>{e.push(1,r.localName),xa(r,e)};var Aa=(r,e,t,s,n,i)=>({type:r,target:e,addedNodes:t,removedNodes:s,attributeName:n,oldValue:i}),Na=(r,e,t,s,n,i)=>{if(!s||s.includes(t)){let{callback:o,records:c,scheduled:l}=r;c.push(Aa("attributes",e,[],[],t,n?i:void 0)),l||(r.scheduled=!0,Promise.resolve().then(()=>{r.scheduled=!1,o(c.splice(0),r)}))}},cr=(r,e,t)=>{let{ownerDocument:s}=r,{active:n,observers:i}=s[Ge];if(n){for(let o of i)for(let[c,{childList:l,subtree:a,attributes:u,attributeFilter:p,attributeOldValue:T}]of o.nodes)if(l){if(a&&(c===s||c.contains(r))||!a&&c.children.includes(r)){Na(o,r,e,p,T,t);break}}else if(u&&c===r){Na(o,r,e,p,T,t);break}}},lt=(r,e)=>{let{ownerDocument:t}=r,{active:s,observers:n}=t[Ge];if(s){for(let i of n)for(let[o,{subtree:c,childList:l,characterData:a}]of i.nodes)if(l&&(e&&(o===e||c&&o.contains(e))||!e&&(c&&(o===t||o.contains(r))||!c&&o[a?"childNodes":"children"].includes(r)))){let{callback:u,records:p,scheduled:T}=i;p.push(Aa("childList",o,e?[]:[r],e?[r]:[])),T||(i.scheduled=!0,Promise.resolve().then(()=>{i.scheduled=!1,u(p.splice(0),i)}));break}}},rs=class{constructor(e){let t=new Set;this.observers=t,this.active=!1,this.class=class{constructor(n){this.callback=n,this.nodes=new Map,this.records=[],this.scheduled=!1}disconnect(){this.records.splice(0),this.nodes.clear(),t.delete(this),e[Ge].active=!!t.size}observe(n,i={subtree:!1,childList:!1,attributes:!1,attributeFilter:null,attributeOldValue:!1,characterData:!1}){("attributeOldValue"in i||"attributeFilter"in i)&&(i.attributes=!0),i.childList=!!i.childList,i.subtree=!!i.subtree,this.nodes.set(n,i),t.add(this),e[Ge].active=!0}takeRecords(){return this.records.splice(0)}}}};var Ia=new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","class","contenteditable","controls","default","defer","disabled","draggable","formnovalidate","hidden","id","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected","style","truespeed"]),lr=(r,e)=>{let{[L]:t,name:s}=e;e.ownerElement=r,Ke(r,e,r[b]),s==="class"&&(r.className=t),cr(r,s,null),vt(r,s,null,t)},_i=(r,e)=>{let{[L]:t,name:s}=e;ce(e[U],e[b]),e.ownerElement=e[U]=e[b]=null,s==="class"&&(r[it]=null),cr(r,s,t),vt(r,s,t,null)},k={get(r,e){return r.hasAttribute(e)},set(r,e,t){t?r.setAttribute(e,""):r.removeAttribute(e)}},Ie={get(r,e){return parseFloat(r.getAttribute(e)||0)},set(r,e,t){r.setAttribute(e,t)}},g={get(r,e){return r.getAttribute(e)||""},set(r,e,t){r.setAttribute(e,t)}};var ss=new WeakMap;function Jl(r,e){return typeof e=="function"?e.call(r.target,r):e.handleEvent(r),r._stopImmediatePropagationFlag}function Xl({currentTarget:r,target:e}){let t=ss.get(r);if(t&&t.has(this.type)){let s=t.get(this.type);r===e?this.eventPhase=this.AT_TARGET:this.eventPhase=this.BUBBLING_PHASE,this.currentTarget=r,this.target=e;for(let[n,i]of s)if(i&&i.once&&s.delete(n),Jl(this,n))break;return delete this.currentTarget,delete this.target,this.cancelBubble}}var ut=class{constructor(){ss.set(this,new Map)}_getParent(){return null}addEventListener(e,t,s){let n=ss.get(this);n.has(e)||n.set(e,new Map),n.get(e).set(t,s)}removeEventListener(e,t){let s=ss.get(this);if(s.has(e)){let n=s.get(e);n.delete(t)&&!n.size&&s.delete(e)}}dispatchEvent(e){let t=this;for(e.eventPhase=e.CAPTURING_PHASE;t;)t.dispatchEvent&&e._path.push({currentTarget:t,target:this}),t=e.bubbles&&t._getParent&&t._getParent();return e._path.some(Xl,e),e._path=[],e.eventPhase=e.NONE,!e.defaultPrevented}};var Q=class extends Array{item(e){return e<this.length?this[e]:null}};var Ra=({parentNode:r})=>{let e=0;for(;r;)e++,r=r.parentNode;return e},le=class extends ut{static get ELEMENT_NODE(){return 1}static get ATTRIBUTE_NODE(){return 2}static get TEXT_NODE(){return 3}static get COMMENT_NODE(){return 8}static get DOCUMENT_NODE(){return 9}static get DOCUMENT_FRAGMENT_NODE(){return 11}static get DOCUMENT_TYPE_NODE(){return 10}constructor(e,t,s){super(),this.ownerDocument=e,this.localName=t,this.nodeType=s,this.parentNode=null,this[b]=null,this[U]=null}get ELEMENT_NODE(){return 1}get ATTRIBUTE_NODE(){return 2}get TEXT_NODE(){return 3}get COMMENT_NODE(){return 8}get DOCUMENT_NODE(){return 9}get DOCUMENT_FRAGMENT_NODE(){return 11}get DOCUMENT_TYPE_NODE(){return 10}get baseURI(){let e=this.nodeType===9?this:this.ownerDocument;if(e){let t=e.querySelector("base");if(t)return t.getAttribute("href");let{location:s}=e.defaultView;if(s)return s.href}return null}get isConnected(){return!1}get nodeName(){return this.localName}get parentElement(){return null}get previousSibling(){return null}get previousElementSibling(){return null}get nextSibling(){return null}get nextElementSibling(){return null}get childNodes(){return new Q}get firstChild(){return null}get lastChild(){return null}get nodeValue(){return null}set nodeValue(e){}get textContent(){return null}set textContent(e){}normalize(){}cloneNode(){return null}contains(){return!1}insertBefore(e,t){return e}appendChild(e){return e}replaceChild(e,t){return t}removeChild(e){return e}toString(){return""}hasChildNodes(){return!!this.lastChild}isSameNode(e){return this===e}compareDocumentPosition(e){let t=0;if(this!==e){let s=Ra(this),n=Ra(e);if(s<n)t+=yi,this.contains(e)&&(t+=ha);else if(n<s)t+=Si,e.contains(this)&&(t+=ua);else if(s&&n){let{childNodes:i}=this.parentNode;i.indexOf(this)<i.indexOf(e)?t+=yi:t+=Si}(!s||!n)&&(t+=da,t+=la)}return t}isEqualNode(e){if(this===e)return!0;if(this.nodeType===e.nodeType){switch(this.nodeType){case 9:case 11:{let t=this.childNodes,s=e.childNodes;return t.length===s.length&&t.every((n,i)=>n.isEqualNode(s[i]))}}return this.toString()===e.toString()}return!1}_getParent(){return this.parentNode}getRootNode(){let e=this;for(;e.parentNode;)e=e.parentNode;return e.nodeType===9?e.documentElement:e}};var Kl=/"/g,ue=class extends le{constructor(e,t,s=""){super(e,"#attribute",2),this.ownerElement=null,this.name=yt(t),this[L]=yt(s),this[Lt]=!1}get value(){return this[L]}set value(e){let{[L]:t,name:s,ownerElement:n}=this;this[L]=yt(e),this[Lt]=!0,n&&(cr(n,s,t),vt(n,s,t,this[L]))}cloneNode(){let{ownerDocument:e,name:t,[L]:s}=this;return new ue(e,t,s)}toString(){let{name:e,[L]:t}=this;return Ia.has(e)&&!t?e:`${e}="${t.replace(Kl,"&quot;")}"`}toJSON(){let e=[];return bi(this,e),e}};var ns=({ownerDocument:r,parentNode:e})=>{for(;e;){if(e===r)return!0;e=e.parentNode||e.host}return!1},is=({parentNode:r})=>{if(r)switch(r.nodeType){case 9:case 11:return null}return r},Qe=({[U]:r})=>{switch(r?r.nodeType:0){case-1:return r[Z];case 3:case 8:return r}return null},Re=r=>{let e=ee(r)[b];return e&&(e.nodeType===-1?null:e)};var Ut=r=>{let e=Re(r);for(;e&&e.nodeType!==1;)e=Re(e);return e},os=r=>{let e=Qe(r);for(;e&&e.nodeType!==1;)e=Qe(e);return e};var xi=(r,e)=>{let t=r.createDocumentFragment();return t.append(...e),t},as=(r,e)=>{let{ownerDocument:t,parentNode:s}=r;s&&s.insertBefore(xi(t,e),r)},cs=(r,e)=>{let{ownerDocument:t,parentNode:s}=r;s&&s.insertBefore(xi(t,e),ee(r)[b])},ls=(r,e)=>{let{ownerDocument:t,parentNode:s}=r;s&&(s.insertBefore(xi(t,e),r),r.remove())},us=(r,e,t)=>{let{parentNode:s,nodeType:n}=e;(r||t)&&(Qr(r,t),e[U]=null,ee(e)[b]=null),s&&(e.parentNode=null,lt(e,s),n===1&&Ea(e))};var Ze=class extends le{constructor(e,t,s,n){super(e,t,s),this[L]=yt(n)}get isConnected(){return ns(this)}get parentElement(){return is(this)}get previousSibling(){return Qe(this)}get nextSibling(){return Re(this)}get previousElementSibling(){return os(this)}get nextElementSibling(){return Ut(this)}before(...e){as(this,e)}after(...e){cs(this,e)}replaceWith(...e){ls(this,e)}remove(){us(this[U],this,this[b])}get data(){return this[L]}set data(e){this[L]=yt(e),lt(this,this.parentNode)}get nodeValue(){return this.data}set nodeValue(e){this.data=e}get textContent(){return this.data}set textContent(e){this.data=e}get length(){return this.data.length}substringData(e,t){return this.data.substr(e,t)}appendData(e){this.data+=e}insertData(e,t){let{data:s}=this;this.data=s.slice(0,e)+t+s.slice(e)}deleteData(e,t){let{data:s}=this;this.data=s.slice(0,e)+s.slice(e+t)}replaceData(e,t,s){let{data:n}=this;this.data=n.slice(0,e)+s+n.slice(e+t)}toJSON(){let e=[];return Ci(this,e),e}};var Be=class extends Ze{constructor(e,t=""){super(e,"#comment",8,t)}cloneNode(){let{ownerDocument:e,[L]:t}=this;return new Be(e,t)}toString(){return`<!--${this[L]}-->`}};var{isArray:Yl}=Array,hs=({nodeType:r})=>r===1,ka=(r,e)=>e.some(t=>hs(t)&&(r(t)||ka(r,Ht(t)))),Ql=(r,e)=>e==="class"?r.classList.value:r.getAttribute(e),Ht=({childNodes:r})=>r,Zl=r=>{let{localName:e}=r;return ct(r)?e.toLowerCase():e},eu=({parentNode:r})=>r,tu=r=>{let{parentNode:e}=r;return e?Ht(e):r},wi=r=>Yl(r)?r.map(wi).join(""):hs(r)?wi(Ht(r)):r.nodeType===3?r.data:"",ru=(r,e)=>r.hasAttribute(e),su=r=>{let{length:e}=r;for(;e--;){let t=r[e];if(e&&-1<r.lastIndexOf(t,e-1)){r.splice(e,1);continue}for(let{parentNode:s}=t;s;s=s.parentNode)if(r.includes(s)){r.splice(e,1);break}}return r},Pa=(r,e)=>{let t=[];for(let s of e)hs(s)&&(r(s)&&t.push(s),t.push(...Pa(r,Ht(s))));return t},La=(r,e)=>{for(let t of e)if(r(t)||(t=La(r,Ht(t))))return t;return null},Oa={isTag:hs,existsOne:ka,getAttributeValue:Ql,getChildren:Ht,getName:Zl,getParent:eu,getSiblings:tu,getText:wi,hasAttrib:ru,removeSubsets:su,findAll:Pa,findOne:La},ur=(r,e)=>ho(e,{context:e.includes(":scope")?r:void 0,xmlMode:!ct(r),adapter:Oa}),Da=(r,e)=>po(r,e,{strict:!0,context:e.includes(":scope")?r:void 0,xmlMode:!ct(r),adapter:Oa});var{replace:nu}="",iu=/[<>&\xA0]/g,ou={"\xA0":"&nbsp;","&":"&amp;","<":"&lt;",">":"&gt;"},au=r=>ou[r],Ma=r=>nu.call(r,iu,au);var he=class extends Ze{constructor(e,t=""){super(e,"#text",3,t)}get wholeText(){let e=[],{previousSibling:t,nextSibling:s}=this;for(;t&&t.nodeType===3;){e.unshift(t[L]);t=t.previousSibling}for(e.push(this[L]);s&&s.nodeType===3;){e.push(s[L]);s=s.nextSibling}return e.join("")}cloneNode(){let{ownerDocument:e,[L]:t}=this;return new he(e,t)}toString(){return Ma(this[L])}};var cu=r=>r instanceof le,Ni=(r,e,t)=>{let{ownerDocument:s}=r;for(let n of t)r.insertBefore(cu(n)?n:new he(s,n),e)},Bt=class extends le{constructor(e,t,s){super(e,t,s),this[X]=null,this[b]=this[x]={[b]:null,[U]:this,[Z]:this,nodeType:-1,ownerDocument:this.ownerDocument,parentNode:null}}get childNodes(){let e=new Q,{firstChild:t}=this;for(;t;)e.push(t),t=Re(t);return e}get children(){let e=new Q,{firstElementChild:t}=this;for(;t;)e.push(t),t=Ut(t);return e}get firstChild(){let{[b]:e,[x]:t}=this;for(;e.nodeType===2;)e=e[b];return e===t?null:e}get firstElementChild(){let{firstChild:e}=this;for(;e;){if(e.nodeType===1)return e;e=Re(e)}return null}get lastChild(){let e=this[x][U];switch(e.nodeType){case-1:return e[Z];case 2:return null}return e===this?null:e}get lastElementChild(){let{lastChild:e}=this;for(;e;){if(e.nodeType===1)return e;e=Qe(e)}return null}get childElementCount(){return this.children.length}prepend(...e){Ni(this,this.firstChild,e)}append(...e){Ni(this,this[x],e)}replaceChildren(...e){let{[b]:t,[x]:s}=this;for(;t!==s&&t.nodeType===2;)t=t[b];for(;t!==s;){let n=ee(t)[b];t.remove(),t=n}e.length&&Ni(this,s,e)}getElementsByClassName(e){let t=new Q,{[b]:s,[x]:n}=this;for(;s!==n;)s.nodeType===1&&s.hasAttribute("class")&&s.classList.has(e)&&t.push(s),s=s[b];return t}getElementsByTagName(e){let t=new Q,{[b]:s,[x]:n}=this;for(;s!==n;)s.nodeType===1&&(s.localName===e||ir(s)===e)&&t.push(s),s=s[b];return t}querySelector(e){let t=ur(this,e),{[b]:s,[x]:n}=this;for(;s!==n;){if(s.nodeType===1&&t(s))return s;s=s.localName==="template"?s[x]:s[b]}return null}querySelectorAll(e){let t=ur(this,e),s=new Q,{[b]:n,[x]:i}=this;for(;n!==i;)n.nodeType===1&&t(n)&&s.push(n),n=n.localName==="template"?n[x]:n[b];return s}appendChild(e){return this.insertBefore(e,this[x])}contains(e){let t=e;for(;t&&t!==this;)t=t.parentNode;return t===this}insertBefore(e,t=null){if(e===t)return e;if(e===this)throw new Error("unable to append a node to itself");let s=t||this[x];switch(e.nodeType){case 1:e.remove(),e.parentNode=this,nr(s[U],e,s),lt(e,null),ar(e);break;case 11:{let{[X]:n,firstChild:i,lastChild:o}=e;if(i){ya(s[U],i,o,s),ce(e,e[x]),n&&n.replaceChildren();do i.parentNode=this,lt(i,null),i.nodeType===1&&ar(i);while(i!==o&&(i=Re(i)))}break}case 3:case 8:e.remove();default:e.parentNode=this,Ke(s[U],e,s),lt(e,null);break}return e}normalize(){let{[b]:e,[x]:t}=this;for(;e!==t;){let{[b]:s,[U]:n,nodeType:i}=e;i===3&&(e[L]?n&&n.nodeType===3&&(n.textContent+=e.textContent,e.remove()):e.remove()),e=s}}removeChild(e){if(e.parentNode!==this)throw new Error("node is not a child");return e.remove(),e}replaceChild(e,t){let s=ee(t)[b];return t.remove(),this.insertBefore(e,s),t}};var ht=class extends Bt{getElementById(e){let{[b]:t,[x]:s}=this;for(;t!==s;){if(t.nodeType===1&&t.id===e)return t;t=t[b]}return null}cloneNode(e){let{ownerDocument:t,constructor:s}=this,n=new s(t);if(e){let{[x]:i}=n;for(let o of this.childNodes)n.insertBefore(o.cloneNode(e),i)}return n}toString(){let{childNodes:e,localName:t}=this;return`<${t}>${e.join("")}</${t}>`}toJSON(){let e=[];return wa(this,e),e}};var bt=class extends ht{constructor(e){super(e,"#document-fragment",11)}};var ke=class extends le{constructor(e,t,s="",n=""){super(e,"#document-type",10),this.name=t,this.publicId=s,this.systemId=n}cloneNode(){let{ownerDocument:e,name:t,publicId:s,systemId:n}=this;return new ke(e,t,s,n)}toString(){let{name:e,publicId:t,systemId:s}=this,n=0<t.length,i=[e];return n&&i.push("PUBLIC",`"${t}"`),s.length&&(n||i.push("SYSTEM"),i.push(`"${s}"`)),`<!DOCTYPE ${i.join(" ")}>`}toJSON(){let e=[];return Ei(this,e),e}};var ds=r=>r.childNodes.join(""),ps=(r,e)=>{let{ownerDocument:t}=r,{constructor:s}=t,n=new s;n[oe]=t[oe];let{childNodes:i}=ts(n,ct(r),e);r.replaceChildren(...i.map(Ga,t))};function Ga(r){switch(r.ownerDocument=this,r.nodeType){case 1:case 11:r.childNodes.forEach(Ga,this);break}return r}var qt=r=>r.replace(/(([A-Z0-9])([A-Z0-9][a-z]))|(([a-z0-9]+)([A-Z]))/g,"$2$5-$3$6").toLowerCase();var ms=new WeakMap,Ai=r=>`data-${qt(r)}`,lu=r=>r.slice(5).replace(/-([a-z])/g,(e,t)=>t.toUpperCase()),uu={get(r,e){if(e in r)return ms.get(r).getAttribute(Ai(e))},set(r,e,t){return r[e]=t,ms.get(r).setAttribute(Ai(e),t),!0},deleteProperty(r,e){return e in r&&ms.get(r).removeAttribute(Ai(e)),delete r[e]}},hr=class{constructor(e){for(let{name:t,value:s}of e.attributes)/^data-/.test(t)&&(this[lu(t)]=s);return ms.set(this,e),new Proxy(this,uu)}};Y(hr.prototype,null);var{add:hu}=Set.prototype,Ua=(r,e)=>{for(let t of e)t&&hu.call(r,t)},dr=({[di]:r,value:e})=>{let t=r.getAttributeNode("class");t?t.value=e:lr(r,new ue(r.ownerDocument,"class",e))},gs=class extends Set{constructor(e){super(),this[di]=e;let t=e.getAttributeNode("class");t&&Ua(this,t.value.split(/\s+/))}get length(){return this.size}get value(){return[...this].join(" ")}add(...e){Ua(this,e),dr(this)}contains(e){return this.has(e)}remove(...e){for(let t of e)this.delete(t);dr(this)}toggle(e,t){if(this.has(e)){if(t)return!0;this.delete(e),dr(this)}else if(t||arguments.length===1)return super.add(e),dr(this),!0;return!1}replace(e,t){return this.has(e)?(this.delete(e),super.add(t),dr(this),!0):!1}supports(){return!0}};var Ss=new WeakMap,Ii=r=>[...r.keys()].filter(e=>e!==X),Ri=r=>{let e=Ss.get(r).getAttributeNode("style");if((!e||e[Lt]||r.get(X)!==e)&&(r.clear(),e)){r.set(X,e);for(let t of e[L].split(/\s*;\s*/)){let[s,...n]=t.split(":");if(n.length>0){s=s.trim();let i=n.join(":").trim();s&&i&&r.set(s,i)}}}return e},fs={get(r,e){return e in du?r[e]:(Ri(r),e==="length"?Ii(r).length:/^\d+$/.test(e)?Ii(r)[e]:r.get(qt(e)))},set(r,e,t){if(e==="cssText")r[e]=t;else{let s=Ri(r);if(t==null?r.delete(qt(e)):r.set(qt(e),t),!s){let n=Ss.get(r);s=n.ownerDocument.createAttribute("style"),n.setAttributeNode(s),r.set(X,s)}s[Lt]=!1,s[L]=r.toString()}return!0}},pr=class extends Map{constructor(e){return super(),Ss.set(this,e),new Proxy(this,fs)}get cssText(){return this.toString()}set cssText(e){Ss.get(this).setAttribute("style",e)}getPropertyValue(e){let t=this[X];return fs.get(t,e)}setProperty(e,t){let s=this[X];fs.set(s,e,t)}removeProperty(e){let t=this[X];fs.set(t,e,null)}[Symbol.iterator](){let e=Ii(this[X]),{length:t}=e,s=0;return{next(){let n=s===t;return{done:n,value:n?null:e[s++]}}}}get[X](){return this}toString(){let e=this[X];Ri(e);let t=[];return e.forEach(pu,t),t.join(";")}},{prototype:du}=pr;function pu(r,e){e!==X&&this.push(`${e}:${r}`)}var ae=class{static get BUBBLING_PHASE(){return 3}static get AT_TARGET(){return 2}static get CAPTURING_PHASE(){return 1}static get NONE(){return 0}constructor(e,t={}){this.type=e,this.bubbles=!!t.bubbles,this.cancelBubble=!1,this._stopImmediatePropagationFlag=!1,this.cancelable=!!t.cancelable,this.eventPhase=this.NONE,this.timeStamp=Date.now(),this.defaultPrevented=!1,this.originalTarget=null,this.returnValue=null,this.srcElement=null,this.target=null,this._path=[]}get BUBBLING_PHASE(){return 3}get AT_TARGET(){return 2}get CAPTURING_PHASE(){return 1}get NONE(){return 0}preventDefault(){this.defaultPrevented=!0}composedPath(){return this._path}stopPropagation(){this.cancelBubble=!0}stopImmediatePropagation(){this.stopPropagation(),this._stopImmediatePropagationFlag=!0}};var Ft=class extends Array{constructor(e){super(),this.ownerElement=e}getNamedItem(e){return this.ownerElement.getAttributeNode(e)}setNamedItem(e){this.ownerElement.setAttributeNode(e),this.unshift(e)}removeNamedItem(e){let t=this.getNamedItem(e);this.ownerElement.removeAttribute(e),this.splice(this.indexOf(t),1)}item(e){return e<this.length?this[e]:null}getNamedItemNS(e,t){return this.getNamedItem(t)}setNamedItemNS(e,t){return this.setNamedItem(t)}removeNamedItemNS(e,t){return this.removeNamedItem(t)}};var Ct=class extends ht{constructor(e){super(e.ownerDocument,"#shadow-root",11),this.host=e}get innerHTML(){return ds(this)}set innerHTML(e){ps(this,e)}};var mu={get(r,e){return e in r?r[e]:r.find(({name:t})=>t===e)}},Ha=(r,e,t)=>{if("ownerSVGElement"in e){let s=r.createElementNS(St,t);return s.ownerSVGElement=e.ownerSVGElement,s}return r.createElement(t)},gu=({localName:r,ownerDocument:e})=>e[Ae].voidElements.test(r),Pe=class extends Bt{constructor(e,t){super(e,t,1),this[it]=null,this[Kr]=null,this[Yr]=null}get isConnected(){return ns(this)}get parentElement(){return is(this)}get previousSibling(){return Qe(this)}get nextSibling(){return Re(this)}get namespaceURI(){return"http://www.w3.org/1999/xhtml"}get previousElementSibling(){return os(this)}get nextElementSibling(){return Ut(this)}before(...e){as(this,e)}after(...e){cs(this,e)}replaceWith(...e){ls(this,e)}remove(){us(this[U],this,this[x][b])}get id(){return g.get(this,"id")}set id(e){g.set(this,"id",e)}get className(){return this.classList.value}set className(e){let{classList:t}=this;t.clear(),t.add(...e.split(/\s+/))}get nodeName(){return ir(this)}get tagName(){return ir(this)}get classList(){return this[it]||(this[it]=new gs(this))}get dataset(){return this[Kr]||(this[Kr]=new hr(this))}get nonce(){return g.get(this,"nonce")}set nonce(e){g.set(this,"nonce",e)}get style(){return this[Yr]||(this[Yr]=new pr(this))}get tabIndex(){return Ie.get(this,"tabindex")||-1}set tabIndex(e){Ie.set(this,"tabindex",e)}get innerText(){let e=[],{[b]:t,[x]:s}=this;for(;t!==s;)t.nodeType===3?e.push(t.textContent.replace(/\s+/g," ")):e.length&&t[b]!=s&&ca.has(t.tagName)&&e.push(`
`),t=t[b];return e.join("")}get textContent(){let e=[],{[b]:t,[x]:s}=this;for(;t!==s;)t.nodeType===3&&e.push(t.textContent),t=t[b];return e.join("")}set textContent(e){this.replaceChildren(),e&&this.appendChild(new he(this.ownerDocument,e))}get innerHTML(){return ds(this)}set innerHTML(e){ps(this,e)}get outerHTML(){return this.toString()}set outerHTML(e){let t=this.ownerDocument.createElement("");t.innerHTML=e,this.replaceWith(...t.childNodes)}get attributes(){let e=new Ft(this),t=this[b];for(;t.nodeType===2;)e.push(t),t=t[b];return new Proxy(e,mu)}focus(){this.dispatchEvent(new ae("focus"))}getAttribute(e){if(e==="class")return this.className;let t=this.getAttributeNode(e);return t&&t.value}getAttributeNode(e){let t=this[b];for(;t.nodeType===2;){if(t.name===e)return t;t=t[b]}return null}getAttributeNames(){let e=new Q,t=this[b];for(;t.nodeType===2;)e.push(t.name),t=t[b];return e}hasAttribute(e){return!!this.getAttributeNode(e)}hasAttributes(){return this[b].nodeType===2}removeAttribute(e){e==="class"&&this[it]&&this[it].clear();let t=this[b];for(;t.nodeType===2;){if(t.name===e){_i(this,t);return}t=t[b]}}removeAttributeNode(e){let t=this[b];for(;t.nodeType===2;){if(t===e){_i(this,t);return}t=t[b]}}setAttribute(e,t){if(e==="class")this.className=t;else{let s=this.getAttributeNode(e);s?s.value=t:lr(this,new ue(this.ownerDocument,e,t))}}setAttributeNode(e){let{name:t}=e,s=this.getAttributeNode(t);if(s!==e){s&&this.removeAttributeNode(s);let{ownerElement:n}=e;n&&n.removeAttributeNode(e),lr(this,e)}return s}toggleAttribute(e,t){return this.hasAttribute(e)?t?!0:(this.removeAttribute(e),!1):t||arguments.length===1?(this.setAttribute(e,""),!0):!1}get shadowRoot(){if(Ue.has(this)){let{mode:e,shadowRoot:t}=Ue.get(this);if(e==="open")return t}return null}attachShadow(e){if(Ue.has(this))throw new Error("operation not supported");let t=new Ct(this);return t.append(...this.childNodes),Ue.set(this,{mode:e.mode,shadowRoot:t}),t}matches(e){return Da(this,e)}closest(e){let t=this,s=ur(t,e);for(;t&&!s(t);)t=t.parentElement;return t}insertAdjacentElement(e,t){let{parentElement:s}=this;switch(e){case"beforebegin":if(s){s.insertBefore(t,this);break}return null;case"afterbegin":this.insertBefore(t,this.firstChild);break;case"beforeend":this.insertBefore(t,null);break;case"afterend":if(s){s.insertBefore(t,this.nextSibling);break}return null}return t}insertAdjacentHTML(e,t){let s=this.ownerDocument.createElement("template");s.innerHTML=t,this.insertAdjacentElement(e,s.content)}insertAdjacentText(e,t){let s=this.ownerDocument.createTextNode(t);this.insertAdjacentElement(e,s)}cloneNode(e=!1){let{ownerDocument:t,localName:s}=this,n=u=>{u.parentNode=o,ce(c,u),c=u},i=Ha(t,this,s),o=i,c=i,{[b]:l,[x]:a}=this;for(;l!==a&&(e||l.nodeType===2);){switch(l.nodeType){case-1:ce(c,o[x]),c=o[x],o=o.parentNode;break;case 1:{let u=Ha(t,l,l.localName);n(u),o=u;break}case 2:{let u=l.cloneNode(e);u.ownerElement=o,n(u);break}case 3:case 8:n(l.cloneNode(e));break}l=l[b]}return ce(c,i[x]),i}toString(){let e=[],{[x]:t}=this,s={[b]:this},n=!1;do switch(s=s[b],s.nodeType){case 2:{let i=" "+s;switch(i){case" id":case" class":case" style":break;default:e.push(i)}break}case-1:{let i=s[Z];n?("ownerSVGElement"in i?e.push(" />"):gu(i)?e.push(ct(i)?">":" />"):e.push(`></${i.localName}>`),n=!1):e.push(`</${i.localName}>`);break}case 1:n&&e.push(">"),s.toString!==this.toString?(e.push(s.toString()),s=s[x],n=!1):(e.push(`<${s.localName}`),n=!0);break;case 3:case 8:e.push((n?">":"")+s),n=!1;break}while(s!==t);return e.join("")}toJSON(){let e=[];return Ti(this,e),e}getAttributeNS(e,t){return this.getAttribute(t)}getElementsByTagNameNS(e,t){return this.getElementsByTagName(t)}hasAttributeNS(e,t){return this.hasAttribute(t)}removeAttributeNS(e,t){this.removeAttribute(t)}setAttributeNS(e,t,s){this.setAttribute(t,s)}setAttributeNodeNS(e){return this.setAttributeNode(e)}};var ki=new WeakMap,fu={get(r,e){return r[e]},set(r,e,t){return r[e]=t,!0}},dt=class extends Pe{constructor(e,t,s=null){super(e,t),this.ownerSVGElement=s}get className(){return ki.has(this)||ki.set(this,new Proxy({baseVal:"",animVal:""},fu)),ki.get(this)}set className(e){let{classList:t}=this;t.clear(),t.add(...e.split(/\s+/))}get namespaceURI(){return"http://www.w3.org/2000/svg"}getAttribute(e){return e==="class"?[...this.classList].join(" "):super.getAttribute(e)}setAttribute(e,t){if(e==="class")this.className=t;else if(e==="style"){let{className:s}=this;s.baseVal=s.animVal=t}super.setAttribute(e,t)}};var de=()=>{throw new TypeError("Illegal constructor")};function Pi(){de()}Y(Pi,ue);Pi.prototype=ue.prototype;function Li(){de()}Y(Li,Ze);Li.prototype=Ze.prototype;function Oi(){de()}Y(Oi,Be);Oi.prototype=Be.prototype;function Di(){de()}Y(Di,bt);Di.prototype=bt.prototype;function Mi(){de()}Y(Mi,ke);Mi.prototype=ke.prototype;function Gi(){de()}Y(Gi,Pe);Gi.prototype=Pe.prototype;function Ui(){de()}Y(Ui,le);Ui.prototype=le.prototype;function Hi(){de()}Y(Hi,Ct);Hi.prototype=Ct.prototype;function Bi(){de()}Y(Bi,he);Bi.prototype=he.prototype;function qi(){de()}Y(qi,dt);qi.prototype=dt.prototype;var Ba={Attr:Pi,CharacterData:Li,Comment:Oi,DocumentFragment:Di,DocumentType:Mi,Element:Gi,Node:Ui,ShadowRoot:Hi,Text:Bi,SVGElement:qi};var mr=new WeakMap,h={get(r,e){return mr.has(r)&&mr.get(r)[e]||null},set(r,e,t){mr.has(r)||mr.set(r,{});let s=mr.get(r),n=e.slice(2);s[e]&&r.removeEventListener(n,s[e],!1),(s[e]=t)&&r.addEventListener(n,t,!1)}},d=class extends Pe{static get observedAttributes(){return[]}constructor(e=null,t=""){super(e,t);let s=!e,n;if(s){let{constructor:i}=this;if(!or.has(i))throw new Error("unable to initialize this Custom Element");({ownerDocument:e,localName:t,options:n}=or.get(i))}if(e[at]){let{element:i,values:o}=e[at];e[at]=null;for(let[c,l]of o)i[c]=l;return i}s&&(this.ownerDocument=this[x].ownerDocument=e,this.localName=t,Ye.set(this,{connected:!1}),n.is&&this.setAttribute("is",n.is))}blur(){this.dispatchEvent(new ae("blur"))}click(){this.dispatchEvent(new ae("click"))}get accessKeyLabel(){let{accessKey:e}=this;return e&&`Alt+Shift+${e}`}get isContentEditable(){return this.hasAttribute("contenteditable")}get contentEditable(){return k.get(this,"contenteditable")}set contentEditable(e){k.set(this,"contenteditable",e)}get draggable(){return k.get(this,"draggable")}set draggable(e){k.set(this,"draggable",e)}get hidden(){return k.get(this,"hidden")}set hidden(e){k.set(this,"hidden",e)}get spellcheck(){return k.get(this,"spellcheck")}set spellcheck(e){k.set(this,"spellcheck",e)}get accessKey(){return g.get(this,"accesskey")}set accessKey(e){g.set(this,"accesskey",e)}get dir(){return g.get(this,"dir")}set dir(e){g.set(this,"dir",e)}get lang(){return g.get(this,"lang")}set lang(e){g.set(this,"lang",e)}get title(){return g.get(this,"title")}set title(e){g.set(this,"title",e)}get onabort(){return h.get(this,"onabort")}set onabort(e){h.set(this,"onabort",e)}get onblur(){return h.get(this,"onblur")}set onblur(e){h.set(this,"onblur",e)}get oncancel(){return h.get(this,"oncancel")}set oncancel(e){h.set(this,"oncancel",e)}get oncanplay(){return h.get(this,"oncanplay")}set oncanplay(e){h.set(this,"oncanplay",e)}get oncanplaythrough(){return h.get(this,"oncanplaythrough")}set oncanplaythrough(e){h.set(this,"oncanplaythrough",e)}get onchange(){return h.get(this,"onchange")}set onchange(e){h.set(this,"onchange",e)}get onclick(){return h.get(this,"onclick")}set onclick(e){h.set(this,"onclick",e)}get onclose(){return h.get(this,"onclose")}set onclose(e){h.set(this,"onclose",e)}get oncontextmenu(){return h.get(this,"oncontextmenu")}set oncontextmenu(e){h.set(this,"oncontextmenu",e)}get oncuechange(){return h.get(this,"oncuechange")}set oncuechange(e){h.set(this,"oncuechange",e)}get ondblclick(){return h.get(this,"ondblclick")}set ondblclick(e){h.set(this,"ondblclick",e)}get ondrag(){return h.get(this,"ondrag")}set ondrag(e){h.set(this,"ondrag",e)}get ondragend(){return h.get(this,"ondragend")}set ondragend(e){h.set(this,"ondragend",e)}get ondragenter(){return h.get(this,"ondragenter")}set ondragenter(e){h.set(this,"ondragenter",e)}get ondragleave(){return h.get(this,"ondragleave")}set ondragleave(e){h.set(this,"ondragleave",e)}get ondragover(){return h.get(this,"ondragover")}set ondragover(e){h.set(this,"ondragover",e)}get ondragstart(){return h.get(this,"ondragstart")}set ondragstart(e){h.set(this,"ondragstart",e)}get ondrop(){return h.get(this,"ondrop")}set ondrop(e){h.set(this,"ondrop",e)}get ondurationchange(){return h.get(this,"ondurationchange")}set ondurationchange(e){h.set(this,"ondurationchange",e)}get onemptied(){return h.get(this,"onemptied")}set onemptied(e){h.set(this,"onemptied",e)}get onended(){return h.get(this,"onended")}set onended(e){h.set(this,"onended",e)}get onerror(){return h.get(this,"onerror")}set onerror(e){h.set(this,"onerror",e)}get onfocus(){return h.get(this,"onfocus")}set onfocus(e){h.set(this,"onfocus",e)}get oninput(){return h.get(this,"oninput")}set oninput(e){h.set(this,"oninput",e)}get oninvalid(){return h.get(this,"oninvalid")}set oninvalid(e){h.set(this,"oninvalid",e)}get onkeydown(){return h.get(this,"onkeydown")}set onkeydown(e){h.set(this,"onkeydown",e)}get onkeypress(){return h.get(this,"onkeypress")}set onkeypress(e){h.set(this,"onkeypress",e)}get onkeyup(){return h.get(this,"onkeyup")}set onkeyup(e){h.set(this,"onkeyup",e)}get onload(){return h.get(this,"onload")}set onload(e){h.set(this,"onload",e)}get onloadeddata(){return h.get(this,"onloadeddata")}set onloadeddata(e){h.set(this,"onloadeddata",e)}get onloadedmetadata(){return h.get(this,"onloadedmetadata")}set onloadedmetadata(e){h.set(this,"onloadedmetadata",e)}get onloadstart(){return h.get(this,"onloadstart")}set onloadstart(e){h.set(this,"onloadstart",e)}get onmousedown(){return h.get(this,"onmousedown")}set onmousedown(e){h.set(this,"onmousedown",e)}get onmouseenter(){return h.get(this,"onmouseenter")}set onmouseenter(e){h.set(this,"onmouseenter",e)}get onmouseleave(){return h.get(this,"onmouseleave")}set onmouseleave(e){h.set(this,"onmouseleave",e)}get onmousemove(){return h.get(this,"onmousemove")}set onmousemove(e){h.set(this,"onmousemove",e)}get onmouseout(){return h.get(this,"onmouseout")}set onmouseout(e){h.set(this,"onmouseout",e)}get onmouseover(){return h.get(this,"onmouseover")}set onmouseover(e){h.set(this,"onmouseover",e)}get onmouseup(){return h.get(this,"onmouseup")}set onmouseup(e){h.set(this,"onmouseup",e)}get onmousewheel(){return h.get(this,"onmousewheel")}set onmousewheel(e){h.set(this,"onmousewheel",e)}get onpause(){return h.get(this,"onpause")}set onpause(e){h.set(this,"onpause",e)}get onplay(){return h.get(this,"onplay")}set onplay(e){h.set(this,"onplay",e)}get onplaying(){return h.get(this,"onplaying")}set onplaying(e){h.set(this,"onplaying",e)}get onprogress(){return h.get(this,"onprogress")}set onprogress(e){h.set(this,"onprogress",e)}get onratechange(){return h.get(this,"onratechange")}set onratechange(e){h.set(this,"onratechange",e)}get onreset(){return h.get(this,"onreset")}set onreset(e){h.set(this,"onreset",e)}get onresize(){return h.get(this,"onresize")}set onresize(e){h.set(this,"onresize",e)}get onscroll(){return h.get(this,"onscroll")}set onscroll(e){h.set(this,"onscroll",e)}get onseeked(){return h.get(this,"onseeked")}set onseeked(e){h.set(this,"onseeked",e)}get onseeking(){return h.get(this,"onseeking")}set onseeking(e){h.set(this,"onseeking",e)}get onselect(){return h.get(this,"onselect")}set onselect(e){h.set(this,"onselect",e)}get onshow(){return h.get(this,"onshow")}set onshow(e){h.set(this,"onshow",e)}get onstalled(){return h.get(this,"onstalled")}set onstalled(e){h.set(this,"onstalled",e)}get onsubmit(){return h.get(this,"onsubmit")}set onsubmit(e){h.set(this,"onsubmit",e)}get onsuspend(){return h.get(this,"onsuspend")}set onsuspend(e){h.set(this,"onsuspend",e)}get ontimeupdate(){return h.get(this,"ontimeupdate")}set ontimeupdate(e){h.set(this,"ontimeupdate",e)}get ontoggle(){return h.get(this,"ontoggle")}set ontoggle(e){h.set(this,"ontoggle",e)}get onvolumechange(){return h.get(this,"onvolumechange")}set onvolumechange(e){h.set(this,"onvolumechange",e)}get onwaiting(){return h.get(this,"onwaiting")}set onwaiting(e){h.set(this,"onwaiting",e)}get onauxclick(){return h.get(this,"onauxclick")}set onauxclick(e){h.set(this,"onauxclick",e)}get ongotpointercapture(){return h.get(this,"ongotpointercapture")}set ongotpointercapture(e){h.set(this,"ongotpointercapture",e)}get onlostpointercapture(){return h.get(this,"onlostpointercapture")}set onlostpointercapture(e){h.set(this,"onlostpointercapture",e)}get onpointercancel(){return h.get(this,"onpointercancel")}set onpointercancel(e){h.set(this,"onpointercancel",e)}get onpointerdown(){return h.get(this,"onpointerdown")}set onpointerdown(e){h.set(this,"onpointerdown",e)}get onpointerenter(){return h.get(this,"onpointerenter")}set onpointerenter(e){h.set(this,"onpointerenter",e)}get onpointerleave(){return h.get(this,"onpointerleave")}set onpointerleave(e){h.set(this,"onpointerleave",e)}get onpointermove(){return h.get(this,"onpointermove")}set onpointermove(e){h.set(this,"onpointermove",e)}get onpointerout(){return h.get(this,"onpointerout")}set onpointerout(e){h.set(this,"onpointerout",e)}get onpointerover(){return h.get(this,"onpointerover")}set onpointerover(e){h.set(this,"onpointerover",e)}get onpointerup(){return h.get(this,"onpointerup")}set onpointerup(e){h.set(this,"onpointerup",e)}};var qa="template",gr=class extends d{constructor(e){super(e,qa);let t=this.ownerDocument.createDocumentFragment();(this[rr]=t)[X]=this}get content(){if(this.hasChildNodes()&&!this[rr].hasChildNodes())for(let e of this.childNodes)this[rr].appendChild(e.cloneNode(!0));return this[rr]}};O(qa,gr);var ys=class extends d{constructor(e,t="html"){super(e,t)}};var{toString:Su}=d.prototype,qe=class extends d{get innerHTML(){return this.textContent}set innerHTML(e){this.textContent=e}toString(){return Su.call(this.cloneNode()).replace(/></,`>${this.textContent}<`)}};var Fa="script",fr=class extends qe{constructor(e,t=Fa){super(e,t)}get type(){return g.get(this,"type")}set type(e){g.set(this,"type",e)}get src(){return g.get(this,"src")}set src(e){g.set(this,"src",e)}get defer(){return k.get(this,"defer")}set defer(e){k.set(this,"defer",e)}get crossOrigin(){return g.get(this,"crossorigin")}set crossOrigin(e){g.set(this,"crossorigin",e)}get nomodule(){return k.get(this,"nomodule")}set nomodule(e){k.set(this,"nomodule",e)}get referrerPolicy(){return g.get(this,"referrerpolicy")}set referrerPolicy(e){g.set(this,"referrerpolicy",e)}get nonce(){return g.get(this,"nonce")}set nonce(e){g.set(this,"nonce",e)}get async(){return k.get(this,"async")}set async(e){k.set(this,"async",e)}get text(){return this.textContent}set text(e){this.textContent=e}};O(Fa,fr);var vs=class extends d{constructor(e,t="frame"){super(e,t)}};var $a="iframe",Sr=class extends d{constructor(e,t=$a){super(e,t)}get src(){return g.get(this,"src")}set src(e){g.set(this,"src",e)}get srcdoc(){return g.get(this,"srcdoc")}set srcdoc(e){g.set(this,"srcdoc",e)}get name(){return g.get(this,"name")}set name(e){g.set(this,"name",e)}get allow(){return g.get(this,"allow")}set allow(e){g.set(this,"allow",e)}get allowFullscreen(){return k.get(this,"allowfullscreen")}set allowFullscreen(e){k.set(this,"allowfullscreen",e)}get referrerPolicy(){return g.get(this,"referrerpolicy")}set referrerPolicy(e){g.set(this,"referrerpolicy",e)}get loading(){return g.get(this,"loading")}set loading(e){g.set(this,"loading",e)}};O($a,Sr);var bs=class extends d{constructor(e,t="object"){super(e,t)}};var Cs=class extends d{constructor(e,t="head"){super(e,t)}};var Es=class extends d{constructor(e,t="body"){super(e,t)}};var mc=Ne(pc(),1);var gc="style",br=class extends qe{constructor(e,t=gc){super(e,t),this[ft]=null}get sheet(){let e=this[ft];return e!==null?e:this[ft]=(0,mc.parse)(this.textContent)}get innerHTML(){return super.innerHTML||""}set innerHTML(e){super.textContent=e,this[ft]=null}get innerText(){return super.innerText||""}set innerText(e){super.textContent=e,this[ft]=null}get textContent(){return super.textContent||""}set textContent(e){super.textContent=e,this[ft]=null}};O(gc,br);var Ls=class extends d{constructor(e,t="time"){super(e,t)}};var Os=class extends d{constructor(e,t="fieldset"){super(e,t)}};var Ds=class extends d{constructor(e,t="embed"){super(e,t)}};var Ms=class extends d{constructor(e,t="hr"){super(e,t)}};var Gs=class extends d{constructor(e,t="progress"){super(e,t)}};var Us=class extends d{constructor(e,t="p"){super(e,t)}};var Hs=class extends d{constructor(e,t="table"){super(e,t)}};var Bs=class extends d{constructor(e,t="frameset"){super(e,t)}};var qs=class extends d{constructor(e,t="li"){super(e,t)}};var Fs=class extends d{constructor(e,t="base"){super(e,t)}};var $s=class extends d{constructor(e,t="datalist"){super(e,t)}};var fc="input",Cr=class extends d{constructor(e,t=fc){super(e,t)}get autofocus(){return k.get(this,"autofocus")||-1}set autofocus(e){k.set(this,"autofocus",e)}get disabled(){return k.get(this,"disabled")}set disabled(e){k.set(this,"disabled",e)}get name(){return this.getAttribute("name")}set name(e){this.setAttribute("name",e)}get placeholder(){return this.getAttribute("placeholder")}set placeholder(e){this.setAttribute("placeholder",e)}get type(){return this.getAttribute("type")}set type(e){this.setAttribute("type",e)}get value(){return g.get(this,"value")}set value(e){g.set(this,"value",e)}};O(fc,Cr);var Vs=class extends d{constructor(e,t="param"){super(e,t)}};var Ws=class extends d{constructor(e,t="media"){super(e,t)}};var js=class extends d{constructor(e,t="audio"){super(e,t)}};var Sc="h1",Er=class extends d{constructor(e,t=Sc){super(e,t)}};O([Sc,"h2","h3","h4","h5","h6"],Er);var zs=class extends d{constructor(e,t="dir"){super(e,t)}};var Js=class extends d{constructor(e,t="quote"){super(e,t)}};var Cc=Ne(bc(),1);var{createCanvas:yu}=Cc.default,Ec="canvas",Tr=class extends d{constructor(e,t=Ec){super(e,t),this[ge]=yu(300,150)}get width(){return this[ge].width}set width(e){Ie.set(this,"width",e),this[ge].width=e}get height(){return this[ge].height}set height(e){Ie.set(this,"height",e),this[ge].height=e}getContext(e){return this[ge].getContext(e)}toDataURL(...e){return this[ge].toDataURL(...e)}};O(Ec,Tr);var Xs=class extends d{constructor(e,t="legend"){super(e,t)}};var Tc="option",_r=class extends d{constructor(e,t=Tc){super(e,t)}get value(){return g.get(this,"value")}set value(e){g.set(this,"value",e)}get selected(){return k.get(this,"selected")}set selected(e){var s;let t=(s=this.parentElement)==null?void 0:s.querySelector("option[selected]");t&&t!==this&&(t.selected=!1),k.set(this,"selected",e)}};O(Tc,_r);var Ks=class extends d{constructor(e,t="span"){super(e,t)}};var Ys=class extends d{constructor(e,t="meter"){super(e,t)}};var Qs=class extends d{constructor(e,t="video"){super(e,t)}};var Zs=class extends d{constructor(e,t="td"){super(e,t)}};var _c="title",xr=class extends qe{constructor(e,t=_c){super(e,t)}};O(_c,xr);var en=class extends d{constructor(e,t="output"){super(e,t)}};var tn=class extends d{constructor(e,t="tr"){super(e,t)}};var rn=class extends d{constructor(e,t="data"){super(e,t)}};var sn=class extends d{constructor(e,t="menu"){super(e,t)}};var xc="select",wr=class extends d{constructor(e,t=xc){super(e,t)}get options(){let e=new Q,{firstElementChild:t}=this;for(;t;)t.tagName==="OPTGROUP"?e.push(...t.children):e.push(t),t=t.nextElementSibling;return e}get disabled(){return k.get(this,"disabled")}set disabled(e){k.set(this,"disabled",e)}get name(){return this.getAttribute("name")}set name(e){this.setAttribute("name",e)}get value(){var e;return(e=this.querySelector("option[selected]"))==null?void 0:e.value}};O(xc,wr);var nn=class extends d{constructor(e,t="br"){super(e,t)}};var wc="button",Nr=class extends d{constructor(e,t=wc){super(e,t)}get disabled(){return k.get(this,"disabled")}set disabled(e){k.set(this,"disabled",e)}get name(){return this.getAttribute("name")}set name(e){this.setAttribute("name",e)}get type(){return this.getAttribute("type")}set type(e){this.setAttribute("type",e)}};O(wc,Nr);var on=class extends d{constructor(e,t="map"){super(e,t)}};var an=class extends d{constructor(e,t="optgroup"){super(e,t)}};var cn=class extends d{constructor(e,t="dl"){super(e,t)}};var Nc="textarea",Ar=class extends qe{constructor(e,t=Nc){super(e,t)}get disabled(){return k.get(this,"disabled")}set disabled(e){k.set(this,"disabled",e)}get name(){return this.getAttribute("name")}set name(e){this.setAttribute("name",e)}get placeholder(){return this.getAttribute("placeholder")}set placeholder(e){this.setAttribute("placeholder",e)}get type(){return this.getAttribute("type")}set type(e){this.setAttribute("type",e)}get value(){return this.textContent}set value(e){this.textContent=e}};O(Nc,Ar);var ln=class extends d{constructor(e,t="font"){super(e,t)}};var un=class extends d{constructor(e,t="div"){super(e,t)}};var Ac="link",Ir=class extends d{constructor(e,t=Ac){super(e,t)}get disabled(){return k.get(this,"disabled")}set disabled(e){k.set(this,"disabled",e)}get href(){return g.get(this,"href")}set href(e){g.set(this,"href",e)}get hreflang(){return g.get(this,"hreflang")}set hreflang(e){g.set(this,"hreflang",e)}get media(){return g.get(this,"media")}set media(e){g.set(this,"media",e)}get rel(){return g.get(this,"rel")}set rel(e){g.set(this,"rel",e)}get type(){return g.get(this,"type")}set type(e){g.set(this,"type",e)}};O(Ac,Ir);var hn=class extends d{constructor(e,t="slot"){super(e,t)}};var dn=class extends d{constructor(e,t="form"){super(e,t)}};var Ic="img",_t=class extends d{constructor(e,t=Ic){super(e,t)}get alt(){return g.get(this,"alt")}set alt(e){g.set(this,"alt",e)}get sizes(){return g.get(this,"sizes")}set sizes(e){g.set(this,"sizes",e)}get src(){return g.get(this,"src")}set src(e){g.set(this,"src",e)}get srcset(){return g.get(this,"srcset")}set srcset(e){g.set(this,"srcset",e)}get title(){return g.get(this,"title")}set title(e){g.set(this,"title",e)}get width(){return Ie.get(this,"width")}set width(e){Ie.set(this,"width",e)}get height(){return Ie.get(this,"height")}set height(e){Ie.set(this,"height",e)}};O(Ic,_t);var pn=class extends d{constructor(e,t="pre"){super(e,t)}};var mn=class extends d{constructor(e,t="ul"){super(e,t)}};var Rc="meta",Rr=class extends d{constructor(e,t=Rc){super(e,t)}get name(){return g.get(this,"name")}set name(e){g.set(this,"name",e)}get httpEquiv(){return g.get(this,"http-equiv")}set httpEquiv(e){g.set(this,"http-equiv",e)}get content(){return g.get(this,"content")}set content(e){g.set(this,"content",e)}get charset(){return g.get(this,"charset")}set charset(e){g.set(this,"charset",e)}get media(){return g.get(this,"media")}set media(e){g.set(this,"media",e)}};O(Rc,Rr);var gn=class extends d{constructor(e,t="picture"){super(e,t)}};var fn=class extends d{constructor(e,t="area"){super(e,t)}};var Sn=class extends d{constructor(e,t="ol"){super(e,t)}};var yn=class extends d{constructor(e,t="caption"){super(e,t)}};var kc="a",kr=class extends d{constructor(e,t=kc){super(e,t)}get href(){return encodeURI(g.get(this,"href"))}set href(e){g.set(this,"href",decodeURI(e))}get download(){return encodeURI(g.get(this,"download"))}set download(e){g.set(this,"download",decodeURI(e))}get target(){return g.get(this,"target")}set target(e){g.set(this,"target",e)}get type(){return g.get(this,"type")}set type(e){g.set(this,"type",e)}};O(kc,kr);var vn=class extends d{constructor(e,t="label"){super(e,t)}};var bn=class extends d{constructor(e,t="unknown"){super(e,t)}};var Cn=class extends d{constructor(e,t="mod"){super(e,t)}};var En=class extends d{constructor(e,t="details"){super(e,t)}};var Pc="source",Pr=class extends d{constructor(e,t=Pc){super(e,t)}get src(){return g.get(this,"src")}set src(e){g.set(this,"src",e)}get srcset(){return g.get(this,"srcset")}set srcset(e){g.set(this,"srcset",e)}get sizes(){return g.get(this,"sizes")}set sizes(e){g.set(this,"sizes",e)}get type(){return g.get(this,"type")}set type(e){g.set(this,"type",e)}};O(Pc,Pr);var Tn=class extends d{constructor(e,t="track"){super(e,t)}};var _n=class extends d{constructor(e,t="marquee"){super(e,t)}};var Lc={HTMLElement:d,HTMLTemplateElement:gr,HTMLHtmlElement:ys,HTMLScriptElement:fr,HTMLFrameElement:vs,HTMLIFrameElement:Sr,HTMLObjectElement:bs,HTMLHeadElement:Cs,HTMLBodyElement:Es,HTMLStyleElement:br,HTMLTimeElement:Ls,HTMLFieldSetElement:Os,HTMLEmbedElement:Ds,HTMLHRElement:Ms,HTMLProgressElement:Gs,HTMLParagraphElement:Us,HTMLTableElement:Hs,HTMLFrameSetElement:Bs,HTMLLIElement:qs,HTMLBaseElement:Fs,HTMLDataListElement:$s,HTMLInputElement:Cr,HTMLParamElement:Vs,HTMLMediaElement:Ws,HTMLAudioElement:js,HTMLHeadingElement:Er,HTMLDirectoryElement:zs,HTMLQuoteElement:Js,HTMLCanvasElement:Tr,HTMLLegendElement:Xs,HTMLOptionElement:_r,HTMLSpanElement:Ks,HTMLMeterElement:Ys,HTMLVideoElement:Qs,HTMLTableCellElement:Zs,HTMLTitleElement:xr,HTMLOutputElement:en,HTMLTableRowElement:tn,HTMLDataElement:rn,HTMLMenuElement:sn,HTMLSelectElement:wr,HTMLBRElement:nn,HTMLButtonElement:Nr,HTMLMapElement:on,HTMLOptGroupElement:an,HTMLDListElement:cn,HTMLTextAreaElement:Ar,HTMLFontElement:ln,HTMLDivElement:un,HTMLLinkElement:Ir,HTMLSlotElement:hn,HTMLFormElement:dn,HTMLImageElement:_t,HTMLPreElement:pn,HTMLUListElement:mn,HTMLMetaElement:Rr,HTMLPictureElement:gn,HTMLAreaElement:fn,HTMLOListElement:Sn,HTMLTableCaptionElement:yn,HTMLAnchorElement:kr,HTMLLabelElement:vn,HTMLUnknownElement:bn,HTMLModElement:Cn,HTMLDetailsElement:En,HTMLSourceElement:Pr,HTMLTrackElement:Tn,HTMLMarqueeElement:_n};var xn={test:()=>!0},Oc={"text/html":{docType:"<!DOCTYPE html>",ignoreCase:!0,voidElements:/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i},"image/svg+xml":{docType:'<?xml version="1.0" encoding="utf-8"?>',ignoreCase:!1,voidElements:xn},"text/xml":{docType:'<?xml version="1.0" encoding="utf-8"?>',ignoreCase:!1,voidElements:xn},"application/xml":{docType:'<?xml version="1.0" encoding="utf-8"?>',ignoreCase:!1,voidElements:xn},"application/xhtml+xml":{docType:'<?xml version="1.0" encoding="utf-8"?>',ignoreCase:!1,voidElements:xn}};var Wt=class extends ae{constructor(e,t={}){super(e,t),this.detail=t.detail}};var Lr=class extends ae{constructor(e,t={}){super(e,t),this.inputType=t.inputType,this.data=t.data,this.dataTransfer=t.dataTransfer,this.isComposing=t.isComposing||!1,this.ranges=t.ranges}};var Dc=r=>class extends _t{constructor(t,s){switch(super(r),arguments.length){case 1:this.height=t,this.width=t;break;case 2:this.height=s,this.width=t;break}}};var Mc=({[Z]:r,[x]:e},t=null)=>{Qr(r[U],e[b]);do{let s=ee(r),n=s===e?s:s[b];t?t.insertBefore(r,t[x]):r.remove(),r=n}while(r!==e)},jt=class{constructor(){this[Z]=null,this[x]=null,this.commonAncestorContainer=null}insertNode(e){this[x].parentNode.insertBefore(e,this[Z])}selectNode(e){this[Z]=e,this[x]=ee(e)}surroundContents(e){e.replaceChildren(this.extractContents())}setStartBefore(e){this[Z]=e}setStartAfter(e){this[Z]=e.nextSibling}setEndBefore(e){this[x]=ee(e.previousSibling)}setEndAfter(e){this[x]=ee(e)}cloneContents(){let{[Z]:e,[x]:t}=this,s=e.ownerDocument.createDocumentFragment();for(;e!==t;)s.insertBefore(e.cloneNode(!0),s[x]),e=ee(e),e!==t&&(e=e[b]);return s}deleteContents(){Mc(this)}extractContents(){let e=this[Z].ownerDocument.createDocumentFragment();return Mc(this,e),e}createContextualFragment(e){let t=this.commonAncestorContainer.createElement("template");return t.innerHTML=e,this.selectNode(t.content),t.content}cloneRange(){let e=new jt;return e[Z]=this[Z],e[x]=this[x],e}};var vu=({nodeType:r},e)=>{switch(r){case 1:return e&mi;case 3:return e&gi;case 8:return e&fi}return 0},wn=class{constructor(e,t=pi){this.root=e,this.currentNode=e,this.whatToShow=t;let{[b]:s,[x]:n}=e;if(e.nodeType===9){let{documentElement:o}=e;s=o,n=o[x]}let i=[];for(;s!==n;)vu(s,t)&&i.push(s),s=s[b];this[X]={i:0,nodes:i}}nextNode(){let e=this[X];return this.currentNode=e.i<e.nodes.length?e.nodes[e.i++]:null,this.currentNode}};var Gc=(r,e,t)=>{let{[b]:s,[x]:n}=e;return r.call({ownerDocument:e,[b]:s,[x]:n},t)},Hc=pa({},Ba,Lc,{CustomEvent:Wt,Event:ae,EventTarget:ut,InputEvent:Lr,NamedNodeMap:Ft,NodeList:Q}),Nn=new WeakMap,Se=class extends ht{constructor(e){super(null,"#document",9),this[oe]={active:!1,registry:null},this[Ge]={active:!1,class:null},this[Ae]=Oc[e],this[ot]=null,this[sr]=null,this[Dt]=null,this[ge]=null,this[at]=null}get defaultView(){return Nn.has(this)||Nn.set(this,new Proxy(globalThis,{set:(e,t,s)=>{switch(t){case"addEventListener":case"removeEventListener":case"dispatchEvent":this[Ot][t]=s;break;default:e[t]=s;break}return!0},get:(e,t)=>{switch(t){case"addEventListener":case"removeEventListener":case"dispatchEvent":if(!this[Ot]){let s=this[Ot]=new ut;s.dispatchEvent=s.dispatchEvent.bind(s),s.addEventListener=s.addEventListener.bind(s),s.removeEventListener=s.removeEventListener.bind(s)}return this[Ot][t];case"document":return this;case"navigator":return{userAgent:"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36"};case"window":return Nn.get(this);case"customElements":return this[oe].registry||(this[oe]=new Zr(this)),this[oe];case"performance":return Uc.performance;case"DOMParser":return this[sr];case"Image":return this[ge]||(this[ge]=Dc(this)),this[ge];case"MutationObserver":return this[Ge].class||(this[Ge]=new rs(this)),this[Ge].class}return this[Dt]&&this[Dt][t]||Hc[t]||e[t]}})),Nn.get(this)}get doctype(){let e=this[ot];if(e)return e;let{firstChild:t}=this;return t&&t.nodeType===10?this[ot]=t:null}set doctype(e){if(/^([a-z:]+)(\s+system|\s+public(\s+"([^"]+)")?)?(\s+"([^"]+)")?/i.test(e)){let{$1:t,$4:s,$6:n}=RegExp;this[ot]=new ke(this,t,s,n),Ke(this,this[ot],this[b])}}get documentElement(){return this.firstElementChild}get isConnected(){return!0}_getParent(){return this[Ot]}createAttribute(e){return new ue(this,e)}createComment(e){return new Be(this,e)}createDocumentFragment(){return new bt(this)}createDocumentType(e,t,s){return new ke(this,e,t,s)}createElement(e){return new Pe(this,e)}createRange(){let e=new jt;return e.commonAncestorContainer=this,e}createTextNode(e){return new he(this,e)}createTreeWalker(e,t=-1){return new wn(e,t)}createNodeIterator(e,t=-1){return this.createTreeWalker(e,t)}createEvent(e){let t=ma(e==="Event"?new ae(""):new Wt(""));return t.initEvent=t.initCustomEvent=(s,n=!1,i=!1,o)=>{ga(t,{type:{value:s},canBubble:{value:n},cancelable:{value:i},detail:{value:o}})},t}cloneNode(e=!1){let{constructor:t,[oe]:s,[ot]:n}=this,i=new t;if(i[oe]=s,e){let o=i[x],{childNodes:c}=this;for(let{length:l}=c,a=0;a<l;a++)i.insertBefore(c[a].cloneNode(!0),o);n&&(i[ot]=c[0])}return i}importNode(e){let t=1<arguments.length&&!!arguments[1],s=e.cloneNode(t),{[oe]:n}=this,{active:i}=n,o=c=>{let{ownerDocument:l,nodeType:a}=c;c.ownerDocument=this,i&&l!==this&&a===1&&n.upgrade(c)};if(o(s),t)switch(s.nodeType){case 1:case 11:{let{[b]:c,[x]:l}=s;for(;c!==l;)c.nodeType===1&&o(c),c=c[b];break}}return s}toString(){return this.childNodes.join("")}querySelector(e){return Gc(super.querySelector,this,e)}querySelectorAll(e){return Gc(super.querySelectorAll,this,e)}getElementsByTagNameNS(e,t){return this.getElementsByTagName(t)}createAttributeNS(e,t){return this.createAttribute(t)}createElementNS(e,t,s){return e===St?new dt(this,t,null):this.createElement(t,s)}};Y(Hc.Document=function(){de()},Se).prototype=Se.prototype;var bu=(r,e,t,s)=>{if(!e&&Gt.has(t)){let o=Gt.get(t);return new o(r,t)}let{[oe]:{active:n,registry:i}}=r;if(n){let o=e?s.is:t;if(i.has(o)){let{Class:c}=i.get(o),l=new c(r,t);return Ye.set(l,{connected:!1}),l}}return new d(r,t)},Or=class extends Se{constructor(){super("text/html")}get all(){let e=new Q,{[b]:t,[x]:s}=this;for(;t!==s;){switch(t.nodeType){case 1:e.push(t);break}t=t[b]}return e}get head(){let{documentElement:e}=this,{firstElementChild:t}=e;return(!t||t.tagName!=="HEAD")&&(t=this.createElement("head"),e.prepend(t)),t}get body(){let{head:e}=this,{nextElementSibling:t}=e;return(!t||t.tagName!=="BODY")&&(t=this.createElement("body"),e.after(t)),t}get title(){let{head:e}=this,t=e.getElementsByTagName("title").shift();return t?t.textContent:""}set title(e){let{head:t}=this,s=t.getElementsByTagName("title").shift();s?s.textContent=e:t.insertBefore(this.createElement("title"),t.firstChild).textContent=e}createElement(e,t){let s=!!(t&&t.is),n=bu(this,s,e,t);return s&&n.setAttribute("is",t.is),n}};var An=class extends Se{constructor(){super("image/svg+xml")}toString(){return this[Ae].docType+super.toString()}};var In=class extends Se{constructor(){super("text/xml")}toString(){return this[Ae].docType+super.toString()}};var zt=class{parseFromString(e,t,s=null){let n=!1,i;return t==="text/html"?(n=!0,i=new Or):t==="image/svg+xml"?i=new An:i=new In,i[sr]=zt,s&&(i[Dt]=s),n&&e==="..."&&(e="<!doctype html><html><head></head><body></body></html>"),e?ts(i,n,e):i}};var{parse:JE}=JSON;var Bc=(r,e=null)=>new zt().parseFromString(r,"text/html",e).defaultView;function Cu(){de()}Y(Cu,Se).prototype=Se.prototype;var Fc=r=>r.trim().replace(/(\n){4,}/g,`


`).replace(/ {3,}/g,"  ").replace(/\t/g,"").replace(/\n+(\s*\n)*/g,`
`),Eu=r=>{if(!r)return{title:"Could not parse the page.",body:"Could not parse the page.",success:!1};let e=new qc.Readability(r).parse();if(!e||!e.textContent)return{title:"Could not parse the page.",body:"Could not parse the page.",success:!1};let t=Fc(Hr(e.textContent));return{title:e.title,body:t,success:!0}};async function yT(r,e="",t=!1){let s=e;if(!s){let o=await Qi(r,{withSnapshot:t,autoFixUrl:!0});if(o.success)s=o.html;else return{title:"Could not fetch the page.",body:o.html||"Could not fetch the page: Make sure the URL is correct.",url:r,success:!1}}let n=Bc(s).document,i=Eu(n);return{url:r,...i}}async function Qi(r,e={}){let{withSnapshot:t,autoFixUrl:s}=e,n="",i;try{let o=r.startsWith("http")?r:`https://${r}`;if(s){let l=new URL(o),a=l.host;a.split(".").length===2&&!a.startsWith("www")&&(l.host=`www.${l.host}`,o=l.toString())}if(t){let l=await Tu(o);if(l.success)return n=l.content,{html:n,success:!0}}let c="error";(o.startsWith("http://www.baidu.com/link?url=")||o.startsWith("https://www.baidu.com/link?url="))&&(c="follow"),i=await fetch(o,{redirect:c})}catch(o){return s?Qi(r,{withSnapshot:t,autoFixUrl:!1}):{html:`Could not fetch the page: ${o}.
Make sure the URL is correct.`,success:!1}}return i.ok?(n=await i.text(),{html:n,success:!0}):{html:`Could not fetch the page: ${i.status} ${i.statusText}`,success:!1}}async function Tu(r){try{let e=new URL(r).host;if(e.includes("youtube")||e.includes("facebook")||e.includes("instagram"))return{success:!1,content:"Unable to request the snapshot of this url"};let t="https://webcache.googleusercontent.com/search?&strip=1&vwsrc=0&q=cache:"+encodeURIComponent(r),s=await fetch(t,{redirect:"error"});return s.ok&&s.status===200?{success:!0,content:await s.text()}:{success:!1,content:"Unable to request the snapshot of this url"}}catch(e){return{success:!1,content:"Unable to request the snapshot of this url"}}}var vT=async(r,e=!0)=>{try{if(e){let t=await lo(r,{redirect:"follow"},{responseType:"text",proxyTargetHost:r.includes("bing.com")?"https://bing.com":void 0}),s=t.responseInfo||{};if(!s.ok){let n=s.type==="opaqueredirect"?301:s.status;throw{status:n,statusText:`Failed to fetch: ${n} ${s.statusText}`}}return{status:s.status,html:t.data,url:s.url||r,success:!0}}else{let t=await fetch(r,{redirect:"follow"});if(!t.ok){let s=t.type==="opaqueredirect"?301:t.status;throw{status:s,statusText:`Failed to fetch: ${s} ${t.statusText}`}}return{status:t.status,html:await t.text(),url:t.url,success:!0}}}catch(t){return t.status===301||t.status===429?{status:301,html:"",url:r,success:!1}:{status:404,html:`Could not fetch the page: ${t.message}.
Make sure the URL is correct.`,url:r,success:!1}}};async function bT(r){let e="";try{return e=(await Qi(r,{autoFixUrl:!0})).html,e=Fc(e),e.length>8e3&&(e=e.slice(0,8e3)),{html:e,url:r,success:!0}}catch(t){return{html:`Could not fetch the page: ${t}.
Make sure the URL is correct.`,url:r,success:!1}}}export{Bc as a,Eu as b,yT as c,vT as d,bT as e,Ru as f,Vc as g,Bn as h,jn as i,wh as j,Nh as k,Jn as l,Xn as m,Yn as n,jr as o,Qt as p,ni as q,ii as r,ai as s,ci as t,ta as u};
