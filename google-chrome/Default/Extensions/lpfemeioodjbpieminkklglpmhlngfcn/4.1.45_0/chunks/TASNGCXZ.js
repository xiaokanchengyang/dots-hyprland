import{a as se,h as ie,j as ae}from"./CMW645QK.js";import{a as Pe}from"./DR4YQWOZ.js";import{a as re,b as v,e as ne}from"./IBXKRLTS.js";import{e as Y,h as N}from"./QJN7YJH3.js";import{a as H}from"./SSXGEXEV.js";import{b as Q,d as fe,e as he}from"./YJUUDRKB.js";import{K as ue,U as le,W as me,ba as Oe,l as q,m as pe,q as ce}from"./7E6GGIST.js";import{na as K,w as V,za as de}from"./EUSDRET5.js";import{a as g}from"./BXPPDSGN.js";import{a as oe}from"./IWA7K7OR.js";import{c as te}from"./KHXRDVYA.js";import{a as Ue}from"./XXRKTLQP.js";import{f as h}from"./3PS7M655.js";var ye={PromptApp:ie,PromptRunner:ae,WebAccessToolbar:se,GlobalSnackbar:"webchatgpt-snackbar"};function Ce(t){var e,o;return t&&ye[t]&&((o=(e=document.querySelector(`#${ye[t]}`))==null?void 0:e.shadowRoot)==null?void 0:o.querySelector("div:first-of-type"))||document.body}function Fe(t){for(let e of t){let o=document.querySelector(e);if(o)return o}}var Ge=t=>{let{containerId:e,presetContainerElement:o,shadowRootId:i,presetShadowRootElement:m,webComponent:y=!0}=t,f="customElements"in window,c=document.createElement(f&&y?`webchatgpt-custom-element-${H()}`:"div");i&&(c.id=i),m&&m(c);let d=c.attachShadow({mode:"open"}),u=document.createElement("style");e&&(u.id=`${e}-emotion-style`);let s=document.createElement("div");return e&&(s.id=e),o&&o(c),d.appendChild(u),d.appendChild(s),{container:s,shadowRoot:c,emotionRoot:u}};function ze(t,e){e.parentNode.insertBefore(t,e.nextSibling)}function we(t,e){var o,i;return(i=(o=document.querySelector(`#${t}`))==null?void 0:o.shadowRoot)==null?void 0:i.querySelector(e)}var J=h(g());var Z=h(Ue());var Se=Q({key:"AuthModalShowState",default:!1}),Te=Q({key:"AuthParamsState",default:{ref:""}});var I=h(g());var x=h(g());function We(t){let e=(0,x.useRef)(),o=(0,x.useRef)(!1),i=(0,x.useRef)(!1);o.current&&(i.current=!0),(0,x.useEffect)(()=>{if(!o.current)return o.current=!0,e.current=t(),()=>{i.current&&e.current&&e.current()}},[])}var Ee=We;var Re=h(g()),Ae=t=>{(0,Re.useEffect)(()=>{let e=()=>{t()};return window.addEventListener("focus",e),()=>{window.removeEventListener("focus",e)}},[])};var F=(t=!0)=>{let[e,o]=(0,I.useState)(null),[i,m]=(0,I.useState)(!1),[y,f]=(0,I.useState)(!1);Ee(()=>{f(!0),Y().then(u=>{u&&o(u),m(!0),f(!1)}).catch(()=>{m(!0),f(!1)})}),Ae(()=>{t&&Y().then(u=>{o(u)})});let c=(0,I.useMemo)(()=>!!e,[e]),d=(0,I.useMemo)(()=>e?N(e):"free",[e]);return{isLogin:c,userInfo:e,loaded:i,loading:y,currentUserPlan:d}};var ge="AUTH_MODAL_CALLBACK",Be=new oe({runtime:"client"}),Ne=()=>{let{isLogin:t,userInfo:e}=F(),[o,i]=fe(Te),m=he(Se),y=(0,J.useCallback)((c,d)=>{let{resolveWithClose:u=!1,timeout:s}=d||{};return re(new Promise(C=>{if(t&&e){C({isLogin:t,userInfo:e});return}let E=a=>{let{isLogin:w,userInfo:k,reason:_}=a.detail;u&&_==="close"?C({isLogin:w,userInfo:k}):_==="auth"&&C({isLogin:w,userInfo:k}),window.removeEventListener(ge,E)};window.addEventListener(ge,E),i(c),m(!0)}),s!=null?s:1e3*60*5,{isLogin:!1})},[t,e]);return{syncAppAuthStatusPromise:(0,J.useCallback)(async()=>{if(t&&e)return{isLogin:t,userInfo:e};let{ref:c}=o;return await Be.postMessage({event:"Client_openAuthClientTab",data:{ref:c||"webchatgpt-search-with-free-ai"}}),new Promise(async d=>{let u=async s=>{let{event:C,data:E}=s;if(!(s!=null&&s.id&&s.id!==te))switch(C){case"Client_authDone":{let{data:a}=E;return Z.default.runtime.onMessage.removeListener(u),d({isLogin:!!a.userInfo,userInfo:a.userInfo}),{success:!0,data:{},message:"ok"}}break}};Z.default.runtime.onMessage.addListener(u)})},[o,t,e]),waitAuthModalPromise:y}},ct=Ne;var p=h(g());var j=h(g()),L=h(V()),De=t=>{let{src:e,alt:o,width:i,height:m,skeletonHeight:y}=t,[f,c]=j.default.useState(!1),[,d]=j.default.useState(!1);return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("img",{src:e,alt:o,width:f?i:0,height:f?m:0,onLoad:()=>{c(!0)},onError:()=>{c(!0),d(!0)}}),!f&&(0,L.jsx)(le,{variant:"rounded",height:y||m,width:i||"100%"})]})},Ie=De;var Le=h(g());var ke=t=>(0,Le.useMemo)(()=>{let e=ne(t);return{title:e.title,description:e.description,ctaButtonText:e.ctaButtonText,ctaButtonLink:e.ctaButtonLink,ctaButtonOnClick:e.ctaButtonOnClick,imageUrl:e.imageUrl,videoUrl:e.videoUrl,sceneType:t}},[t]);var l=h(V()),_e="MAXAI_PERMISSION_WRAPPER_TOGGLE_EVENT",G="MAXAI_PERMISSION_WRAPPER_CUSTOM_EVENT";var He=t=>{let{sceneType:e,allowedRoles:o,mountContainerName:i,onPermission:m,BoxProps:y,TooltipProps:f,children:c,id:d,preAuth:u}=t,s=ke(e),[C,E]=(0,p.useState)(void 0),a=(0,p.useMemo)(()=>C||s,[s,C]),{currentUserPlan:w,userInfo:k,isLogin:_}=F(),[be,b]=(0,p.useState)(!1),D=(0,p.useRef)(d!=null?d:H());(0,p.useEffect)(()=>{let n=P=>{P.detail.id!==D.current&&b(P.detail.open)};return window.addEventListener(G,n),()=>{window.removeEventListener(G,n)}},[]),(0,p.useEffect)(()=>{let n=P=>{P.detail.id===D.current&&b(P.detail.open)};return window.addEventListener(_e,n),()=>{window.removeEventListener(_e,n)}},[]);let xe=(0,p.useMemo)(()=>!!o.find(n=>n===w),[w,o]),ee=(0,p.useCallback)(async()=>{if(k&&_)return N(k);if(!_&&u){let n=await u();if(n)return N(n)}return null},[_,u,k]),Me=(0,p.useMemo)(()=>i?Array.isArray(i)?we(i[0],i[1]):Ce(i):document.body,[i]);return xe?(0,l.jsx)(l.Fragment,{children:c}):(0,l.jsx)(me,{arrow:!0,open:be,PopperProps:{container:Me,sx:{"& > div":{maxWidth:320,p:1}}},title:(0,l.jsx)(ce.default,{mouseEvent:"onMouseDown",onClickAway:()=>{b(!1)},children:(0,l.jsxs)(de,{spacing:1,component:"div",onClick:n=>{n.stopPropagation()},children:[a.videoUrl&&(0,l.jsx)(Pe,{borderRadius:4,youtubeLink:a.videoUrl}),!a.videoUrl&&a.imageUrl&&(0,l.jsx)(q,{sx:{width:"100%",height:"auto",borderRadius:"4px",overflow:"hidden","& img":{width:"100%",height:"auto"}},children:(0,l.jsx)(Ie,{height:140,src:a.imageUrl,alt:`${a.title} img`})}),(0,l.jsx)(K,{variant:"custom",fontSize:"16px",fontWeight:600,textAlign:"left",color:"rgba(255,255,255,.87)",children:a.title}),(0,l.jsx)(K,{variant:"custom",fontSize:"14px",fontWeight:400,textAlign:"left",color:"rgba(255,255,255,.87)",children:a.description}),a.ctaButtonText&&(0,l.jsx)(ue,{target:"_blank",href:a.ctaButtonLink,onClick:n=>{var P;n.preventDefault(),window.open(a.ctaButtonLink,"_blank"),(P=a.ctaButtonOnClick)==null||P.call(a,n),b(!1),v("click",s.sceneType)},children:(0,l.jsx)(pe,{fullWidth:!0,variant:"contained",children:a.ctaButtonText})})]})}),...f,children:(0,l.jsx)(q,{...y,children:(0,l.jsx)(q,{children:p.default.Children.map(c,n=>{if(p.default.isValidElement(n)){let P={...n.props,...n.props.onClick&&{onClick:async(r,...R)=>{var U,O,S,W,T,B;let A=!1;(U=r==null?void 0:r.stopPropagation)==null||U.call(r),(O=r==null?void 0:r.preventDefault)==null||O.call(r);let M=await ee();if(o.includes(M||w)){(W=(S=n.props)==null?void 0:S.onClick)==null||W.call(S,r,...R);return}if(m){let{success:X,cardSettings:$}=await m(M||w,s,[r,...R]);E({...s,...$}),A=X}let z=new CustomEvent(G,{detail:{id:D.current,open:!1}});window.dispatchEvent(z),b(!A),A?(B=(T=n.props)==null?void 0:T.onClick)==null||B.call(T,r,...R):v("show",s.sceneType)}},...n.props.onChange&&{onChange:async(r,...R)=>{var U,O,S,W,T,B;let A=!1;(U=r==null?void 0:r.stopPropagation)==null||U.call(r),(O=r==null?void 0:r.preventDefault)==null||O.call(r);let M=await ee();if(o.includes(M||w)){(W=(S=n.props)==null?void 0:S.onChange)==null||W.call(S,r,...R);return}if(m){let{success:X,cardSettings:$}=await m(M||w,s,[r,...R]);E({...s,...$}),A=X}let z=new CustomEvent(G,{detail:{id:D.current,open:!1}});window.dispatchEvent(z),b(!A),A?(B=(T=n.props)==null?void 0:T.onChange)==null||B.call(T,r,...R):v("show",s.sceneType)}}};return p.default.cloneElement(n,P)}return n})})})})},Ut=He;export{Ce as a,Fe as b,Ge as c,ze as d,Se as e,Ee as f,F as g,ge as h,ct as i,Ut as j};
