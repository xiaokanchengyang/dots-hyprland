new Vue({el:"#pageContainer",data:{tabList:[],capturedImage:"",imageHTML:"",defaultFilename:Date.now()+".png",totalWidth:100,totalHeight:100},mounted:function(){"chrome-extension:"===location.protocol&&chrome.tabs.query({currentWindow:!0,active:!0},t=>{let e=t.filter(t=>t.active)[0];chrome.runtime.sendMessage({type:"fh-dynamic-any-thing",thing:"request-page-content",tabId:e.id}).then(t=>{t&&t.content&&this.showResult(t.content)})})},methods:{showResult:function(t){if(t&&t.screenshots){this.totalWidth=t.totalWidth,this.totalHeight=t.totalHeight;let e=document.querySelector("#imageEditor>canvas").getContext("2d");t.screenshots.forEach(t=>{let o=new Image;o.dx=t.left,o.dy=t.top,o.onload=function(t){e.drawImage(this,this.dx,this.dy,this.width,this.height)},o.src=t.dataUri}),this.defaultFilename=t.filename,this.$nextTick(()=>{this.$refs.resultBox.scrollIntoView()})}},save:function(){chrome.permissions.request({permissions:["downloads"]},t=>{t?chrome.downloads.download({url:document.querySelector("#imageEditor>canvas").toDataURL(),saveAs:!0,conflictAction:"overwrite",filename:this.defaultFilename}):alert("必须接受授权，才能正常下载！")})}}});