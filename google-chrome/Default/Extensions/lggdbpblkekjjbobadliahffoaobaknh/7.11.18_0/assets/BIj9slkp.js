import{am as o,al as r}from"./SHnOzo4l.js";import{i as R,s as P,g as F,a as u,m as f,e as y}from"./CavFI0yr.js";import{W as D}from"./Cil-fwZs.js";import{d as B}from"./bTMwkpkr.js";import{i as C}from"./Cjbr4oTZ.js";import{B as S}from"./CfHFiLj0.js";import{v as G}from"./D8aEg3BZ.js";import{r as O}from"./BjgJiouD.js";const m=4;function V(t){if(!t)return null;const e=(window.visualViewport?.scale??1)*window.devicePixelRatio,n=window.visualViewport?.offsetLeft??0,i=window.visualViewport?.offsetTop??0;let l=(t.x-m-n)*e,s=(t.y-m-i)*e,a=(t.width+m*2)*e,p=(t.height+m*2)*e;if(!C()){const b=window.innerWidth*e,T=window.innerHeight*e;l=Math.max(l,m),s=Math.max(s,m),a=Math.min(a,b-l-m),p=Math.min(p,T-s-m)}return{width:Math.round(a),height:Math.round(p),x:Math.round(l),y:Math.round(s)}}function $(t){return t?!!(t instanceof HTMLInputElement&&t.value&&v(t.value)||v(t.textContent??"")):!1}const v=t=>/submit|save|purchase|buy|delete|confirm/.test(t.toLowerCase()),U=(t,e)=>{if(!t||!e)return null;const n=e.x+e.width/2,i=e.y+e.height/2;return{center:document.elementsFromPoint(n,i).indexOf(t)}},_=450;class x{targetBounds;eventId=G();mergeEventId=null;timestamp=new Date().getTime();isInModal=!1;role=null;isAuthAction=!1;isHighStakesAction=!1;targetDetails=null;viewportPositions=null;constructor(e){this.targetBounds=e?.getBoundingClientRect()??null,this.isInModal=!!R(e)||!!P(e),this.viewportPositions=U(e,this.targetBounds),this.role=e?F(e):null,this.isAuthAction=B(),this.isHighStakesAction=$(e)}shouldReplacePrevious(e){return this.targetIsSame(e)}get isSensitive(){const e=this.target;return e instanceof HTMLInputElement&&e.type==="password"}get isBlurred(){const e=this.target,n=e.getAttribute(S),i=!!e.closest(`[${S}=true]`);return n||i}async toJson({tabUrl:e,snapshot:n,lastTangoEvent:i,fallbackCssSelectorGeneration:l}={}){const s=this.composeStepText(),a=this.composeTitleDetails();return this.targetDetails=i&&this.shouldReuseTargetDetails(i)&&!l?i.targetDetails:await D(this.target,{tabUrl:e,cssSelectors:l?!1:_}),{targetDetails:{...this.targetDetails,computedLabels:[],eventType:this.event.type,selectedLabel:{label:s.label,type:s.type}},titleDetails:a,eventId:this.eventId,mergeEventId:this.mergeEventId,bounds:this.targetDetails.bounds?V(this.targetDetails.bounds):null,parentBounds:this.targetDetails.parent?.bounds?V(this.targetDetails.parent.bounds):null,timestamp:this.timestamp,action:this.getType(),stepText:s.label,stepTitle:a?this.computeStepTitle(a):null,url:this.targetDetails.baseURI,screenshotPixelRatio:window.devicePixelRatio,isFlexible:this.isFlexible(),isAuthAction:this.isAuthAction,isHighStakesAction:this.isHighStakesAction,snapshot:n}}computeStepTitle(e){let n=e.template;for(const i of e.variables){const l=i.currentSetting===o.Generic?i.genericValue:i.specificValue;n=n.replace(`{{${i.name}}}`,l??"")}return n}getType(){return this.event.type}shouldReuseTargetDetails(e){return!!e&&!!e.targetDetails&&this.targetIsSame(e)&&this.targetHasSameParent(e)}targetHasSameParent(e){return!!e.target&&!!this.target?.parentElement?.isSameNode(e.target.parentElement)}targetIsSame(e){return!!e.target&&!!this.target?.isSameNode(e.target)}}function W(t){switch(t.tagName.toLowerCase()){case"link":case"a":return"link";case"span":case"p":return"text";case"button":return"button";case"div":return"element";case"picture":case"svg":case"img":return"image";case"ol":case"ul":return"list";case"li":return"option";case"input":return"input";case"textarea":return"text area";case"select":return"dropdown";default:return"element"}}class A extends x{constructor(e,n){super(n),this.event=e,this.target=n}shouldReplacePrevious(e){return e instanceof A&&e.event.type==="dragover"?!0:super.shouldReplacePrevious(e)}shouldIgnore(){return!1}composeStepText(){const e=this.target;let n="element";return e&&(n=W(e)),{label:`Drag highlighted ${n}`,type:r.MANUAL}}composeTitleDetails(){return null}isFlexible(){return!1}getType(){return"drag"}}const q=100,X=1,z="[role],[aria-label],[aria-labelledby],[aria-describedby],[aria-haspopup]",w={menuitem:"menu item",button:"button",option:"option",select:"select",switch:"switch",cell:"cell",row:"row",searchbox:"search box",slider:"slider",tab:"tab"},Y=t=>t.charCodeAt(0)>126||t.charCodeAt(0)<32,c=t=>{const e=(t?.innerText??"").trim(),n=e.split(`
`).map(i=>i.trim());return n.length>1?n[0].length<2&&n[1].length>2?n[1]:`${n[0]}…`:e},I=t=>{const e=[],n=t.labels?[...t.labels].find(i=>!!i.innerText):null;if(n&&e.push({label:c(n),type:r.LABEL}),t.previousElementSibling&&t.previousElementSibling.nodeName==="LABEL"&&t.previousElementSibling.innerText){const i=t.previousElementSibling;e.push(i.innerText.length>q?{label:"",type:r.LABEL}:{label:c(i),type:r.LABEL})}return e},E=t=>{const e=[],n=t.attributes.getNamedItem("aria-labelledby")?.nodeValue,i=t.attributes.getNamedItem("aria-label")?.nodeValue,l=t.attributes.getNamedItem("aria-haspopup")?.nodeValue,s=t.attributes.getNamedItem("aria-describedby")?.nodeValue,a=t.attributes.getNamedItem("role")?.nodeValue;if(n||s){const p=document.getElementById((n||s).split(" ")[0]);p&&!t.contains(p)&&e.push(...d(p))}return i&&e.push({label:i,type:r.ARIALABEL}),a&&(t.innerText?e.push({label:c(t),type:r.INNERTEXT}):w[a]&&e.push({label:w[a],type:r.ARIALABEL})),l&&e.push({label:"dropdown trigger",type:r.MANUAL}),e},M=t=>{const e=[],n=t.closest(z);if(n){const i=E(n);i[0]&&e.push(i[0])}return e},d=t=>{let e=[];switch(t.constructor){case HTMLSelectElement:{const n=t,i=I(n);n.options&&n.options[n.selectedIndex]?.text&&(i[0]&&e.push({label:`${n.options[n.selectedIndex].text} from ${i[0].label}`,type:r.OPTION}),e.push({label:n.options[n.selectedIndex].text,type:r.OPTION})),i[0]&&e.push({label:`${n.value} from ${i[0].label}`,type:r.VALUE}),e.push({label:n.value,type:r.VALUE});break}case HTMLTextAreaElement:case HTMLInputElement:{const n=t,i=I(n),l=E(n);n.type==="password"&&e.push({label:"password field",type:r.MANUAL}),i[0]&&e.push(i[0]),l[0]&&e.push(l[0]),(n.type==="button"||n.type==="submit")&&n.value&&e.push({label:n.value,type:r.VALUE}),n.name&&e.push({label:n.name,type:r.NAME}),n.placeholder&&e.push({label:n.placeholder,type:r.PLACEHOLDER}),!e.some(s=>s.type===r.VALUE)&&n.value&&e.push({label:n.value,type:r.VALUE});break}case HTMLImageElement:{const n=t;n.alt&&e.push({label:n.alt,type:r.ALTTEXT}),e.push({label:"image",type:r.MANUAL});break}case HTMLSpanElement:case HTMLLabelElement:case HTMLAnchorElement:case HTMLHeadingElement:case HTMLButtonElement:{const n=t,i=E(n);if(n.querySelector("i")&&i[0]&&e.push(i[0]),n.getAttribute("role")==="combobox"&&n.id){const l=document.querySelector(`[for="${n.id}"]`);l&&!t.contains(l)&&e.push(...d(l))}if(n.innerText&&e.push({label:c(n),type:r.INNERTEXT}),n.title&&e.push({label:n.title,type:r.TITLE}),i[0]&&!e.includes(i[0])&&e.push(i[0]),t instanceof HTMLButtonElement&&t.labels[0]&&e.push(...d(t.labels[0])),e.length===0){const l=M(n);l[0]&&e.push(l[0])}break}case SVGElement:case SVGSVGElement:case SVGCircleElement:case SVGEllipseElement:case SVGRectElement:case SVGLineElement:case SVGTitleElement:{t.parentElement&&e.push(...d(t.parentElement));break}default:{const n=t,i=E(n);if(i[0]&&e.push(i[0]),e.length===0){const l=M(n);l[0]&&e.push(l[0])}e.length===0&&n.innerText&&e.push({label:c(n),type:r.INNERTEXT});break}}return e},L=(t,e=0)=>{try{const n=d(t);if(e<X&&(n.length===0||typeof n[0].label!="string"||Y(n[0].label))&&t.parentElement&&t.tagName!=="BUTTON")return L(t.parentElement,e+1);if(n[0])return{...n[0]}}catch(n){const i=new Error(`An error occurred while attempting to get a label: ${n}`);O(i,{extra:{elementTagName:t.tagName,level:e}})}return{label:"highlight",type:r.NONE}};let j=[u.button,u.menuitem,u.link];const J=(t,e)=>{if(e&&!j.includes(e))return!1;const n=t.closest('[role="menuitem"],[role="gridcell"],td');if(!n)return!1;if(n.hasAttribute("data-date"))return!0;const i=t.closest('[role="grid"],table');return g(t)||g(n)||g(i)||g(i?.parentElement??null)},g=t=>{if(!t)return!1;const e=t.className.toLowerCase(),n=/date[-]?picker|calendar|muipickers|datecell/;return n.test(e)||n.test(t.id)},K=t=>{if(t instanceof HTMLInputElement&&(t.type==="button"||t.type==="submit")&&t.value.length)return t.value;const e=c(t);return e.length?e:null},H=t=>t?t instanceof HTMLFieldSetElement?t.querySelector("legend"):f(t,document,!1):null,Q=(t,e)=>!!(e||t instanceof HTMLInputElement&&t.name&&[...document.querySelectorAll(`[name="${t.name}"]`)].length>1||t.closest("table")),N=30,h=t=>(t=t.trim(),t=t.replace(/^[*]|[:*]$/g,""),t=t.length>=N?`${t.slice(0,N-2).trim()}…`:t,t),Z=t=>{const e=t.closest("td");if(!e)return null;const n=e.closest("table");if(!n)return null;const i=Array.prototype.indexOf.call(e.parentNode?.children,e);return n.querySelector(`thead th:nth-child(${i+1})`)};function ee(t,e){if(!t)return null;if(J(t,e))return{template:"Pick {{value}}",specificValue:c(t),genericValue:h("a date")||"an option",setting:o.Generic,isFlexible:!0};switch(e){case u.textbox:{const n=f(t,document);let i=c(n);const l="Type {{value}}",s=o.Generic;if(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement){if(t.getAttribute("type")==="password")return{template:l,specificValue:"",genericValue:"password",setting:s,isFlexible:!1};if(!i.length&&t.placeholder){if(/ /.test(t.placeholder.trim()))return{template:t.placeholder,genericValue:"",specificValue:"",setting:s,isFlexible:!1};i=t.placeholder}}return i.length||(i=t.getAttribute("aria-label")??""),{template:l,specificValue:"",genericValue:h(i)||"in text field",setting:s,isFlexible:!1}}case u.searchbox:{const n=f(t,document),i="Search {{value}}";let l=c(n);const s=t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement,a=s?t.value.trim():"";return!l.length||s&&l===t.placeholder?{template:i,specificValue:a.length?`“${a}”`:"",genericValue:a.length?"":"anything",setting:a.length?o.Specific:o.Generic,isFlexible:!1}:{template:i,specificValue:"",genericValue:h(l)||"in text field",setting:o.Generic,isFlexible:!1}}case u.combobox:{const n=f(t,document);let i=c(n);i.length||(i=t.getAttribute("aria-label")??"");const s=t instanceof HTMLInputElement&&t.type!=="button"?"Search {{value}}":"Click on {{value}}";if(e===u.combobox&&!i.length){const a=Z(t);return{template:s,specificValue:"",genericValue:c(a||t)||"anything",setting:o.Generic,isFlexible:!1}}return{template:s,specificValue:"",genericValue:h(i)||"in text field",setting:o.Generic,isFlexible:!1}}case u.option:case u.listitem:{const n=t.closest('[role="listbox"],[role="list"],[role="group"]');let i=c(t),l="";if(n){const a=f(n,document);l=c(a);const p=n.getAttribute("aria-label");if(!l.length&&p?.length&&(l=p),!l.length&&n.id){const b=document.querySelector(`[aria-owns="${n.id}"],[aria-controls="${n.id}"]`);if(b){const T=f(b,document);l=c(T)}}return{template:"Select {{value}}",specificValue:i,genericValue:h(l)||"an option",setting:o.Generic,isFlexible:!0}}const s=t.closest('[role="button"]');if(s){const a=f(s,document);return{template:"Click on {{value}}",specificValue:"",genericValue:h(c(a))||"an option",setting:o.Generic,isFlexible:!1}}return null}case u.select:{const n=f(t,document);let i=c(n),l="";if(t instanceof HTMLSelectElement){const s=t.options[t.selectedIndex];l=c(s)}return{template:"Select {{value}}",specificValue:l,genericValue:h(i)||"an option",setting:o.Generic,isFlexible:!1}}case u.radio:{const n=f(t,document);let i="";const l=y(t),s=H(l);return i=c(s),{template:"Select {{value}}",specificValue:c(n??t),genericValue:h(i)||"an option",setting:o.Generic,isFlexible:!0}}case u.link:{if(!P(t))return null;const i=K(t),l="an option",s=!1;return{template:"Click on {{value}}",specificValue:i||"link",genericValue:h(l)||"an option",setting:s?o.Generic:o.Specific,isFlexible:s}}case u.checkbox:{const n=f(t,document),i=y(t),l=H(i),s=c(l),a=Q(t,i);return{template:"Select {{value}}",specificValue:c(n??t)||"checkbox",genericValue:h(s)||"an option",setting:a?o.Generic:o.Specific,isFlexible:a}}case u.button:{if(!t.getAttribute("aria-haspopup"))return null;const n=f(t,document);return n?{template:"Click on {{value}}",specificValue:"",genericValue:h(c(n))||"an option",setting:o.Generic,isFlexible:!1}:null}default:return null}}class k extends x{constructor(e,n){super(n),this.event=e,this.target=n,this.titleDetails=ee(this.target,this.role)}maxElementSize=.98;titleDetails;shouldReplacePrevious(e){return e instanceof k&&this.hasSamePosition(e)?!0:super.shouldReplacePrevious(e)}shouldIgnore(e){const n=this.target;return!!(!n||this.isBiggerThanMaxElementSize()||e instanceof A&&this.timestamp-e.timestamp<500||n instanceof HTMLLabelElement||n instanceof HTMLOptionElement||n instanceof HTMLSelectElement||n.shadowRoot)}composeStepText(){if(!this.target)return{label:"Click on highlight",type:r.NONE};const{label:e,type:n}=L(this.target);return this.event.type==="auxclick"?{label:`Right click on ${e}`,type:n}:{label:`Click on ${e}`,type:n}}composeTitleDetails(){const e=this.titleDetails;return e?{template:e.template,variables:[{name:"value",currentSetting:e.setting,genericValue:e.genericValue,specificValue:e.specificValue}]}:null}isFlexible(){return this.titleDetails?.isFlexible===!0}hasSamePosition(e){return this.event.clientX===e.event.clientX&&this.event.clientY===e.event.clientY}isBiggerThanMaxElementSize(){const e=(this.targetBounds?.width||0)/window.innerWidth,n=(this.targetBounds?.height||0)/window.innerHeight;return e>this.maxElementSize&&n>this.maxElementSize}calculatePercentageCoordinate(){return!(this.event instanceof MouseEvent)||!window.innerWidth||!window.innerHeight?[null,null]:[this.event.clientX/window.innerWidth*100,this.event.clientY/window.innerHeight*100]}}function te(t){return t.charAt(0).toUpperCase()+t.slice(1)}class ue extends x{constructor(e,n){super(n),this.event=e,this.target=n}composeStepText(){if(this.target instanceof Element){const{label:e,type:n}=L(this.target);return{label:`${te(this.event.type)} ${e}`,type:n}}return{label:"",type:r.NONE}}composeTitleDetails(){return null}isFlexible(){return!1}shouldIgnore(){return this.event.type==="select"&&!(this.event instanceof UIEvent)}}function pe(t){requestAnimationFrame(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{requestAnimationFrame(t)})})})}export{x as T,L as a,k as b,te as c,U as d,A as e,ee as f,W as g,ue as h,pe as r};
//# sourceMappingURL=BIj9slkp.js.map
