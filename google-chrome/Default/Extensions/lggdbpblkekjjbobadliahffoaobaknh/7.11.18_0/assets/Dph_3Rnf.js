import{j as g}from"./CMhnKYCA.js";import{r as t}from"./bVFUYZgl.js";import{b as h,o as w}from"./BjgJiouD.js";import{W as T,a as f,M as o}from"./SHnOzo4l.js";const E=e=>{const a=e?.tier,r=e?.workflowLimitation?.count,n=e?.workflowLimitation?.limit;return!!(a===T.Starter&&r&&n&&r>=n)};function k(e,a){const r=a||window.chrome.runtime?.onMessage,n=t.useRef();t.useEffect(()=>{n.current=e},[e]),t.useEffect(()=>{if(!(r&&r.addListener))return;const c=(...l)=>n.current(...l);return r.addListener(c),()=>{r.removeListener(c)}},[r])}const p=t.createContext({});function S(){const[e,a]=t.useState(null),[r,n]=t.useState(!0),[u,c]=t.useState([]),l=!!e?.token;async function i(s){await f({name:o.SwitchWorkspace,workspaceId:s}),f({name:o.CheckUser}).then(m=>{m&&a(m.user)})}t.useEffect(()=>{f({name:o.CheckUser}).then(s=>{s&&(a(s.user),c(s.workspaces??[]),n(!1))})},[]),t.useEffect(()=>{h(e)},[e]),k(s=>{if(s.message.name===o.WorkspacesFound){if(!s.message.workspaces?.length)return;c(s.message.workspaces)}if(s.message.name===o.CheckUser){if(s.message.user===void 0)return;a(s.message.user)}}),t.useEffect(()=>{e?.id&&f({name:o.RefreshWorkspaces}).then(s=>{s?.workspaces&&c(s.workspaces)})},[e?.id]);const L=t.useCallback(()=>f({name:o.VerifyUserToken}),[]),d=u.map(s=>{const m=E(s);return{...s,limitReached:m}});return{currentWorkspace:d?.find(s=>s.id===e?.currentWorkspaceId),hasToken:l,loading:r,switchWorkspace:i,user:e,verifyToken:L,workspaces:d,createHomeUrl:()=>{let s=w.webUrl;return e&&(s+=`?workspaceId=${e.currentWorkspaceId}`),s}}}const B=({children:e})=>{const a=S();return g.jsx(p.Provider,{value:a,children:e})},D=()=>t.useContext(p),F=t.createContext({featureFlags:{}}),P=({children:e})=>{const[a,r]=t.useState({}),[n,u]=t.useState(!1),c={featureFlagsLoaded:n,featureFlags:a};t.useEffect(()=>{f({name:o.FeatureFlags}).then(i=>{i&&(u(!0),r(i.featureFlags))})},[]);const l=t.useCallback(i=>{i.message.name===o.FeatureFlags&&i.message.featureFlags&&(u(!0),r(i.message.featureFlags))},[]);return k(l),g.jsx(F.Provider,{value:c,children:e})},y=e=>{const{featureFlags:a,featureFlagsLoaded:r}=t.useContext(F);if(r)return a[e]||!1};var C=(e=>(e.ATTRIBUTES="attributes",e.BOUNDS="bounds",e.CSS_SELECTOR="cssSelector",e.LABEL="label",e.LABELLED_BY="labelledBy",e.PARENT="parent",e.OFFSET_TOP="offsetTop",e.ICON="icon",e))(C||{}),W=(e=>(e.Success="success",e.ElementHidden="elementHidden",e.NoTargetDetails="noTargetDetails",e.NoElements="noElements",e.ScoreTooLow="scoreTooLow",e.DifferentDomain="differentDomain",e.AccessRequired="accessRequired",e))(W||{});export{B as A,P as F,D as a,y as b,W as e,C as r,k as u};
//# sourceMappingURL=Dph_3Rnf.js.map
