import{j as e}from"./CMhnKYCA.js";import{b as Ee,u as A,E as tt,o as st,c as nt,d as ot,e as rt,f as it,g as at,t as ct,C as lt,D as dt,a as ut,K as pt}from"./DyC068QH.js";import{r as i}from"./bVFUYZgl.js";import{a as G,e as le,u as mt,b as ge}from"./Dph_3Rnf.js";import{a as Te,u as de}from"./BIl7BGEd.js";import{w as Ce,y as Ie,_ as Se,G as ft,z as gt,A as ht,B as xt,v as he,c as vt,b as bt,j as yt,m as wt,L as jt,t as Et}from"./CpygsGpn.js";import{f as Pe}from"./XELyL0QY.js";import{i as ke,s as Le}from"./CavFI0yr.js";import{f as o,b as Tt}from"./DlLMD6w7.js";import{G as De,d as v,l as k,U as Re,X as Ct,A as Me,T as It,C as Oe,t as St,Y as Pt,n as kt,ac as Lt}from"./Cm1H3WaY.js";import{A as se}from"./ChlyaM6j.js";import{A as z,s as ne,a as V,M as K,O as xe,F as ve,b as Dt,R as be}from"./SHnOzo4l.js";import{a as Rt,P as C,E as Mt,t as ye,b as ze,h as oe,c as re,m as Ot,d as ie,i as zt}from"./BTyHENqi.js";import{m as B,s as S,a as P,b as Nt}from"./DieEiE9e.js";import{i as Ne}from"./Cjbr4oTZ.js";import{P as $t}from"./Af4S84iP.js";import{d as $e}from"./QipNwzXz.js";import{l as Ae}from"./BAD7DE-7.js";import{o as At,s as Ht}from"./BjgJiouD.js";import"./Cpj98o6Y.js";import"./yXRVlCQS.js";import"./D8aEg3BZ.js";import"./DgxwHEyS.js";import"./wJ2w6DWc.js";import"./CqgvlWIA.js";import"./DvGmMwA7.js";import"./Cil-fwZs.js";import"./CTuBfHaM.js";import"./uDekdLYy.js";import"./BsnvV3p5.js";import"./XaMN_HiL.js";import"./CfHFiLj0.js";import"./CRTsvRaD.js";import"./CRUnMUWV.js";import"./D_5xdqhq.js";import"./bTMwkpkr.js";const He=n=>B.jsx(Ae,{icon:B.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%",fill:"none",viewBox:"0 0 40 40",children:B.jsx("path",{fill:"currentColor",d:"M18.333 30c0 1.833-1.5 3.333-3.333 3.333A3.343 3.343 0 0 1 11.667 30c0-1.833 1.5-3.333 3.333-3.333 1.833 0 3.333 1.5 3.333 3.333ZM15 16.667A3.343 3.343 0 0 0 11.667 20c0 1.833 1.5 3.333 3.333 3.333 1.833 0 3.333-1.5 3.333-3.333 0-1.833-1.5-3.333-3.333-3.333Zm0-10A3.343 3.343 0 0 0 11.667 10c0 1.833 1.5 3.333 3.333 3.333 1.833 0 3.333-1.5 3.333-3.333 0-1.833-1.5-3.333-3.333-3.333Zm10 6.666c1.833 0 3.333-1.5 3.333-3.333 0-1.833-1.5-3.333-3.333-3.333A3.343 3.343 0 0 0 21.667 10c0 1.833 1.5 3.333 3.333 3.333Zm0 3.334A3.343 3.343 0 0 0 21.667 20c0 1.833 1.5 3.333 3.333 3.333 1.833 0 3.333-1.5 3.333-3.333 0-1.833-1.5-3.333-3.333-3.333Zm0 10A3.343 3.343 0 0 0 21.667 30c0 1.833 1.5 3.333 3.333 3.333 1.833 0 3.333-1.5 3.333-3.333 0-1.833-1.5-3.333-3.333-3.333Z"})}),...n});He.displayName="IconDragIndicator";const Fe=n=>B.jsx(Ae,{icon:B.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%",fill:"none",viewBox:"0 0 40 40",children:B.jsx("path",{fill:"currentColor",d:"M20 3.333C10.8 3.333 3.333 10.8 3.333 20c0 9.2 7.467 16.667 16.667 16.667 9.2 0 16.667-7.467 16.667-16.667C36.667 10.8 29.2 3.333 20 3.333Zm0 30C12.65 33.333 6.667 27.35 6.667 20 6.667 12.65 12.65 6.667 20 6.667c7.35 0 13.333 5.983 13.333 13.333 0 7.35-5.983 13.333-13.333 13.333Zm-1.667-5.666a1 1 0 0 1 1-1h1.334a1 1 0 0 1 1 1V29a1 1 0 0 1-1 1h-1.334a1 1 0 0 1-1-1v-1.333Zm2.684-17.6a6.67 6.67 0 0 0-7.384 4.65c-.3.966.434 1.95 1.45 1.95h.334c.683 0 1.233-.484 1.466-1.117.534-1.483 2.117-2.5 3.834-2.133 1.583.333 2.75 1.883 2.616 3.5-.166 2.233-2.7 2.716-4.083 4.8 0 .016-.017.016-.017.033-.016.033-.033.05-.05.083-.15.25-.3.534-.416.834-.017.05-.05.083-.067.133-.017.033-.017.067-.033.117a5.7 5.7 0 0 0-.265 1.086c-.079.547.379.997.931.997h1.334c.552 0 .983-.456 1.133-.988a3.57 3.57 0 0 1 .333-.795c.034-.05.05-.1.084-.15.133-.234.3-.45.466-.65.017-.017.034-.05.05-.067.167-.2.35-.383.55-.567 1.6-1.516 3.767-2.75 3.317-5.933-.4-2.9-2.683-5.35-5.583-5.783Z"})}),...n});Fe.displayName="IconQuestionCircleOutline";const Ue=(n,t)=>{const s=i.useRef(null);return i.useEffect(()=>{const r=l=>{const a=Rt(l,s.current);n(a)};return t?(document.addEventListener("pointerdown",r),document.addEventListener("keydown",r)):(document.removeEventListener("pointerdown",r),document.removeEventListener("keydown",r)),()=>{document.removeEventListener("pointerdown",r),document.removeEventListener("keydown",r)}},[n,t]),s},_e=n=>{const{onClick:t,onDrag:s,onDragEnd:r,onDragStart:l,isUnread:a}=n,u=Te({onClick:t,onDrag:s,onDragEnd:r,onDragStart:l}),c={initial:{scale:.83},hover:{scale:1}};return e.jsx(De,{show:a,radius:"full",variant:"secondary",children:e.jsx(v,{as:k.button,css:{borderRadius:o.radii.full,width:C,height:C,cursor:"pointer",userSelect:"none",boxShadow:"0px 1px 3px 0px rgba(37, 31, 45, 0.1), 0px 1px 2px -1px rgba(37, 31, 45, 0.1)"},"data-unread":a,ref:u,variants:c,style:{border:`2px solid ${a?o.colors.orange300:o.colors.gray100}`},children:e.jsx(Re,{variant:"icon",size:"xs"})})})},Ft=Tt(v,{unset:"all",width:Mt,overflow:"hidden",position:"relative",marginTop:"-16px",borderRadius:o.radii.md,bg:o.colors.white,border:`1px solid ${o.colors.gray200}`,boxShadow:"0px 4px 6px -1px rgba(37, 31, 45, 0.1), 0px 2px 4px -2px rgba(37, 31, 45, 0.1)",textAlign:"left","& p":{my:0}}),Xe=n=>{const{children:t,css:s,showDropdownModalCallout:r}=n;return de(),e.jsxs(Ft,{children:[e.jsx(v,{css:{...s},children:t}),r?e.jsxs(S,{alignItems:"center",css:{p:o.space[2],bg:o.colors.blue100},gap:"2",children:[e.jsx(Ct,{color:o.colors.blue500.value,size:12}),e.jsx(P,{css:{color:o.colors.blue500},size:"2",children:"Keep going! Your Nugget is active â€” just type and pin it."})]}):null]})},Ut=(n,t)=>{i.useEffect(()=>{n&&t()},[n,t])},_t=n=>{const{pinData:t,onBlur:s}=n,r=i.useRef(null),l=i.useRef(null),[a,u]=i.useState(!1),[c,h]=i.useState(!1),[d,m]=i.useState(void 0),{currentWorkspace:y}=G(),[,p]=Ee(),b=d?`kl:${y?.id}:${ye(p)}:${d.value}`:`kl:${y?.id}:${ye(p)}`,{isVisuallyHidden:D,isOn:R,toggleKL:M}=A(),w=Ue(x=>{x&&s()},!!t),{targetDetails:g,workflow:H,rawScreenshotURL:F,target:U}=t,W={attributes:g?.attributes,baseURI:g?.baseURI||void 0,bounds:g?.bounds?JSON.stringify(g.bounds):void 0,domain:Ce().toLowerCase(),iframeURI:g?.iframeURI||void 0,labelledBy:g?.labelledBy?JSON.stringify(g.labelledBy):void 0,location:Ie().split("?")[0],offsetTop:g?.offsetTop||void 0,parent:g?.parent?JSON.stringify(g.parent):void 0,resolved:!1,tag:g?.tag||void 0,text:g?.text||void 0,xPath:g?.xPath||void 0,windowHeight:g?.windowHeight||void 0,windowWidth:g?.windowWidth||void 0},Y=i.useMemo(()=>ze(g),[g]),N=()=>{h(!0)},J=x=>{if(!x){ne(se.UserGroupUnassignedFromNugget,{room_id:b});return}ne(se.UserGroupAssignedToNugget,{room_id:b,user_group_id:x.value}),m(x)};return i.useLayoutEffect(()=>{let x,_=!1;if(!Y)return Pe({targetDetails:g}).then(ae=>{if(_)return;const $=ae?.status===le.Success?ae.element:null;if(oe($,r.current,!0),re(w.current,l.current),$){const T=!!ke($)||!!Le($);u(T)}w.current&&(w.current.style.transform=`translate(${-C/2}px, ${(r.current?.offsetHeight??0)-C/2}px)`),x=()=>{r.current&&(oe($,r.current,!0),re(w.current,l.current))},window.addEventListener("scroll",x,!0)}),()=>{_=!0,window.removeEventListener("scroll",x,!0)}},[w,g,Y]),i.useEffect(()=>{const x=r.current;return x&&(x.addEventListener("click",N),x.addEventListener("focus",N)),()=>{x&&(x.removeEventListener("click",N),x.removeEventListener("focus",N))}},[]),i.useEffect(()=>{R||M()},[R,M]),Ut(Y,s),e.jsx(Me,{children:D?null:e.jsx(Se,{id:b,initialPresence:{},children:e.jsx(v,{ref:r,as:k.div,initial:!1,animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeOut"},css:{position:"fixed",transition:"opacity 0.3s ease-in-out",zIndex:z-1,fontFamily:o.fonts.sans,fontSize:o.fontSizes[2],pointerEvents:"none"},children:e.jsxs(v,{ref:w,css:{display:"inline-block",position:"relative",pointerEvents:"auto"},children:[e.jsx(_e,{isUnread:!1}),e.jsx(v,{css:{position:"absolute"},ref:l,children:e.jsx(Xe,{css:{pt:20,px:12,pb:12,'& [role="textbox"], & [role="combobox"]':{px:o.space[2],pb:o.space[2]}},showDropdownModalCallout:a&&c,children:e.jsx(tt,{autoFocus:!0,defaultTangos:H&&[H],metadata:W,onSubmit:s,rawScreenshotURL:F,showTangoSelector:!0,showVisibilityOptions:!0,target:U,selectedUserGroup:d,onUserGroupChange:J})})})]})})})})},Ke=n=>{const{children:t}=n,s=i.useRef(null),r=Ne(),l=a=>{s.current&&(s.current.style.opacity="1",s.current.style.left=`${Math.min(a.clientX+20,window.innerWidth-s.current.offsetWidth)}px`,s.current.style.top=`${Math.min(a.clientY+20,window.innerHeight-s.current.offsetHeight)}px`)};return i.useEffect(()=>{if(r){const a=u=>{const c=window.frameElement?.getBoundingClientRect();window.parent.postMessage({type:"iframeMouseMove",mouseEvent:{clientX:u.clientX+(c?.left||0),clientY:u.clientY+(c?.top||0)}},"*")};return document.addEventListener("mousemove",a),()=>{document.removeEventListener("mousemove",a)}}else{document.addEventListener("mousemove",l);const a=u=>{u.data.type==="iframeMouseMove"&&l(u.data.mouseEvent)};return window.addEventListener("message",a),()=>{document.removeEventListener("mousemove",l),window.removeEventListener("message",a)}}},[r]),e.jsx(S,{direction:"column",justifyContent:"center",id:"shortcut-tooltip",ref:s,css:{position:"fixed",zIndex:z,py:o.space[2],px:12,flexShrink:0,borderRadius:o.radii.xs,bg:o.colors.white,border:`1px solid ${o.colors.gray200}`,boxShadow:"0px 4px 6px -1px rgba(37, 31, 45, 0.1), 0px 2px 4px -2px rgba(37, 31, 45, 0.1)",transition:"opacity 0.2s ease-in-out",opacity:0},gap:"1",children:t})},Xt=()=>e.jsxs(Ke,{children:[e.jsx(P,{as:"p",css:{color:o.colors.gray700,m:0},size:"1",weight:"med",children:"Click to pin"}),e.jsx(P,{as:"p",css:{color:o.colors.gray600,m:0},size:"1",children:"Shift-Click to navigate"}),e.jsx(P,{as:"p",css:{color:o.colors.gray600,m:0},size:"1",children:'Press "Esc" to cancel'})]}),Kt=()=>{const{toggleResolvedThreadPopup:n}=A(),t=s=>{s.preventDefault(),n(),V({name:K.OpenSidePanel,view:"kl",eventSource:"KL - resolved thread popup"})};return e.jsx($t,{width:352,minWidth:352,showHeader:!1,padding:"0px",overflow:"hidden",children:e.jsxs(S,{justifyContent:"between",alignItems:"center",css:{width:"100%",boxSizing:"border-box",padding:o.space[5],position:"relative",textAlign:"center"},direction:"column",children:[e.jsxs(S,{css:{mb:o.space[6],width:"100%"},justifyContent:"between",alignItems:"center",children:[e.jsx(It,{}),e.jsx(Oe,{"aria-label":"Search","data-testid":"search-button",onClick:n,children:e.jsx(St,{})})]}),e.jsxs(S,{alignItems:"center",direction:"column",gap:"4",children:[e.jsx(Pt,{color:o.colors.green500.value,size:24}),e.jsxs(v,{css:{mb:o.space[2]},children:[e.jsx(P,{css:{color:o.colors.gray700},size:"4",children:"This nugget was resolved."}),e.jsx(P,{as:"p",css:{mb:0,mt:o.space[1],color:o.colors.gray600},size:"2",children:"Resolved nuggets can be viewed by opening your side panel."})]}),e.jsx(Nt,{fullWidth:!0,onPointerDown:t,children:"Open side panel"})]})]})})},Bt=()=>{const[n,t]=i.useState(Date.now()),s=$e(()=>t(Date.now()),1e3);return i.useEffect(()=>{const r=new MutationObserver(a=>{a.some(c=>c.type==="childList"&&(c.addedNodes.length>0||c.removedNodes.length>0)||c.type==="attributes")&&s()}),l=document.querySelector("body");return r.observe(l,{attributes:!0,childList:!0,subtree:!0}),()=>r.disconnect()},[s]),n},Wt=()=>e.jsxs(Ke,{children:[e.jsxs(P,{as:"p",css:{color:o.colors.gray700,m:0},size:"2",weight:"med",children:["Drag to place"," ",e.jsx(st,{css:{verticalAlign:"middle"},color:o.colors.gray500.value,size:"16"})]}),e.jsx(P,{as:"p",css:{color:o.colors.gray500,m:0},size:"1",children:"Press 'Esc' to exit"})]}),Yt=n=>!!n.text,Vt=n=>{if(!n)return n;const{content:t}=n,s=t.filter(r=>r.type!=="paragraph"||r.children.filter(l=>Yt(l)&&l.text.trim()!=="").length>0);return{...n,content:s}},Gt=n=>{const{thread:t,onClick:s}=n,r=t.comments.filter(d=>!d.deletedAt),l=r.length-1,a=Array.from(new Set(r.map(d=>d.userId))),u=t.metadata.tangos?JSON.parse(t.metadata.tangos):[],c={initial:{display:"none",opacity:0,scale:.85,zIndex:0,transition:{scale:{delay:.3},display:{delay:.3}}},hover:{display:"block",opacity:1,scale:1,zIndex:10,transition:{scale:{delay:.5},opacity:{delay:.5},duration:.25}}},h={initial:{opacity:0},hover:{opacity:1,transition:{delay:.25}}};return e.jsxs(v,{as:k.button,css:{unset:"all",marginTop:"-8px",borderRadius:o.radii.md,bg:o.colors.white,border:`1px solid ${o.colors.gray200}`,boxShadow:"0px 4px 6px -1px rgba(37, 31, 45, 0.1), 0px 2px 4px -2px rgba(37, 31, 45, 0.1)",py:12,px:o.space[4],width:220,maxHeight:190,cursor:"pointer",textAlign:"left","& p":{my:o.space[1]}},onClick:s,variants:c,children:[e.jsxs(v,{as:k.div,variants:h,children:[e.jsx(nt,{userId:t.comments[0].userId,size:"1"}),e.jsx(P,{css:{color:o.colors.gray600,"@supports (-webkit-line-clamp: 3)":{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"initial",display:"-webkit-box","-webkit-line-clamp":"3","-webkit-box-orient":"vertical"}},size:"1",weight:"reg",children:e.jsx(ot,{body:Vt(t.comments[0].body),components:{Mention:({userId:d})=>e.jsx(rt,{userId:d,size:"1"}),Link:({href:d,children:m})=>e.jsx(it,{href:d,size:"1",children:m})}})})]}),u.length>0?e.jsx(e.Fragment,{children:u.slice(0,2).map(d=>e.jsxs(S,{alignItems:"center",css:{mt:o.space[1],mb:o.space[1]},gap:"2",children:[d.apps?e.jsx(ft,{apps:d.apps,size:"xs"}):null,e.jsx(P,{css:{color:o.colors.purple600},size:"1",truncate:!0,weight:"med",children:d.name})]},d.workflowId))}):null,l>0?e.jsxs(S,{alignItems:"center",css:{mt:6},gap:"2",children:[e.jsx(S,{css:{gap:2},children:a.slice(0,3).map(d=>e.jsx(at,{userId:d,size:"xs"},d))}),e.jsxs(P,{css:{color:o.colors.gray600},size:"1",weight:"med",children:[l," ",l>1?"replies":"reply"]})]}):null]})},Zt=n=>{const{thread:t}=n,s=i.useRef(null),r=i.useRef(null),l=i.useRef(!1),[a,u]=i.useState(!1),[c,h]=i.useState(!1),[d,m]=i.useState(t.metadata.placement?JSON.parse(t.metadata.placement):{x:0,y:1}),[y,p]=i.useState(!1),b=i.useRef({x:0,y:0}),{user:D}=G(),{userId:R,currentWorkspaceId:M,draggedThreadId:w,toggleDrag:g,expandedThreadId:H,handlePinClick:F,shouldScrollExpandedThreadInView:U,toggleScrollExpandedThreadInView:W}=A(),Y=gt(),N=ht(),{status:J,unreadSince:x}=xt(t.id),_=Y?.id===t.comments[0].userId,$=i.useMemo(()=>{if(J!=="subscribed")return;if(x===null)return t.comments.findIndex(j=>j.body);const f=t.comments.findIndex(j=>j.body&&j.createdAt>x);return f>=0&&f<t.comments.length?f:void 0},[J,t.comments,x])!==void 0,T=H===t.id,ce=w===t.id,We=Bt(),L=Ue(f=>{f&&(h(!1),F(t.id))},T),q=Ot(t.metadata),ue=()=>{ne(se.NuggetClicked,{nugget_id:t.id,room_id:t.roomId,url:t.metadata.location,email:D?.email}),h(!1),F(t.id)},Ye=()=>{ne(se.NuggetHovered,{nugget_id:t.id,room_id:t.roomId,url:t.metadata.location,email:D?.email})},Ve=()=>{_&&(g(t.id),p(!0))},Ge=f=>{if(!_||!s.current||!L.current)return;const{x:j,y:I}=f,E=s.current.offsetWidth,O=s.current.offsetHeight,X=-C/2,ee=-C/2,Qe=d.x*E+j-C/2,et=d.y*O+I-C/2,me=ie(Qe,X,E-C/2),fe=ie(et,ee,O-C/2);L.current.style.transform=`translate(${me}px, ${fe}px)`,b.current={x:me,y:fe}},Ze=()=>{if(!_||!s.current||!L.current)return;const f=L.current.style.transform,j=s.current.offsetWidth,I=s.current.offsetHeight;if(!f)m({x:0,y:1}),N({threadId:t.id,metadata:{placement:JSON.stringify({x:0,y:1})}});else{const{x:E,y:O}=b.current,X=(E+C/2)/j,ee=(O+C/2)/I;m({x:X,y:ee}),N({threadId:t.id,metadata:{placement:JSON.stringify({x:X,y:ee})}})}p(!1),g(null)},Q=()=>{h(!0)},pe=i.useMemo(()=>ze(q),[q]),Je=i.useCallback($e((f,j,I,E)=>{ct(f,j,I,E)},300),[t]);i.useLayoutEffect(()=>{let f,j=!1;if(!pe)return Pe({targetDetails:q}).then(I=>{if(j)return;const E=I.status===le.Success||I.status===le.ElementHidden?I.element:null;if(E&&T){const O=!!ke(E)||!!Le(E);u(O)}oe(E,s.current,T),re(L.current,r.current),T&&U&&(E?.scrollIntoView({behavior:"instant",block:"end"}),W()),l.current||(Je(M,R,t,I),l.current=!0),f=()=>{!s.current||T&&a||(oe(E,s.current,T),re(L.current,r.current))},window.addEventListener("scroll",f,!0)}),()=>{j=!0,window.removeEventListener("scroll",f,!0)}},[We,T,L,U,q,W]),i.useLayoutEffect(()=>{const f=s.current,j=L.current;!f||!j||setTimeout(()=>{const I=f.offsetWidth,E=f.offsetHeight,O=d.x*I-C/2,X=d.y*E-C/2;j.style.transform=`translate(${O}px, ${X}px)`},0)},[L,s,d.x,d.y]),i.useEffect(()=>{const f=s.current;return f&&(f.addEventListener("click",Q),f.addEventListener("focus",Q)),()=>{f&&(f.removeEventListener("click",Q),f.removeEventListener("focus",Q))}},[]),de([T]);const qe={initial:{transition:{delay:1}},hover:{zIndex:z-1}};return pe?null:e.jsxs(e.Fragment,{children:[e.jsx(v,{ref:s,id:t.id,css:{position:"fixed",pointerEvents:"none",transition:"opacity 0.3s ease-in-out, background-color 0.3s ease-in-out",fontFamily:o.fonts.sans,fontSize:o.fontSizes[2],borderRadius:o.radii.xs},style:{backgroundColor:ce?`${o.colors.orange500.value}30`:"transparent"},children:e.jsxs(v,{ref:L,as:k.div,initial:T?"hover":"initial",animate:T?"hover":"initial",css:{display:"inline-block",position:"relative",pointerEvents:"auto"},variants:qe,whileHover:"hover",onMouseEnter:Ye,children:[e.jsx(_e,{isUnread:$,onClick:ue,onDrag:Ge,onDragEnd:Ze,onDragStart:Ve}),e.jsxs(v,{css:{position:"absolute"},ref:r,children:[t&&!T&&!ce?e.jsx(Gt,{onClick:ue,thread:t}):null,t&&T?e.jsx(Xe,{showDropdownModalCallout:a&&c,children:e.jsx(lt,{isPinnedInDropdownOrModal:a,maxHeight:454,thread:t})}):null]})]})}),ce&&!y?e.jsx(Wt,{}):null]})},Jt=n=>zt(window.location.href,n.metadata.wildcard),qt=()=>{const{isVisuallyHidden:n,hiddenThreads:t}=A(),{currentWorkspace:s}=G(),r=he({query:{metadata:{deleted:void 0,resolved:!1,location:Ie().split("?")[0],displayOption:void 0}}}),l=he({query:{metadata:{deleted:void 0,resolved:!1,domain:Ce().toLowerCase(),displayOption:dt.Wildcard}}}),a=c=>!t.includes(c.id)&&c.roomId.includes(s?.id??""),u=n?[]:[...r.threads,...l.threads.filter(Jt)].filter(a);return e.jsx(Me,{children:u.map(c=>e.jsx(Se,{id:c.roomId,initialPresence:{},children:e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeOut"},children:e.jsx(Zt,{thread:c})})},c.id))})},we=0,Qt=0,je=100,es=100,ts=()=>{const[n,t]=i.useState(At[xe.ToolbarPosition]),[s,r]=i.useState(!1),l=n.x>50?"right":"left",a=i.useCallback(m=>{const y=ie(m.x/window.innerWidth*100,we,je),p=ie(m.y/window.innerHeight*100,Qt,es);return[y,p]},[]),u=m=>{const[y,p]=a({x:m.clientX,y:m.clientY});t({x:y,y:p}),r(!0)},c=i.useCallback(m=>{if(!s)return;const[y,p]=a({x:m.clientX,y:m.clientY});t({x:y,y:p})},[a,s]),h=i.useCallback(m=>{if(!s)return;const[y,p]=a({x:m.clientX,y:m.clientY});let b={x:we,y:p};y>50&&(b={x:je,y:p}),t(b),Ht(xe.ToolbarPosition,b),V({name:K.ToolbarPosition,data:b}),r(!1)},[a,s]),d=i.useCallback(m=>{m.message.name===K.ToolbarPosition&&t(m.message.data)},[]);return mt(d),i.useEffect(()=>(s?(window.addEventListener("mousemove",c),window.addEventListener("mouseup",h)):(window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",h)),()=>{window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",h)}),[c,h,s]),{toolbarPosition:n,isDraggingToolbar:s,onToolbarDragStart:u,snapSide:l}},Be=i.createContext(void 0),ss=({children:n})=>{const t=ts();return e.jsx(Be.Provider,{value:t,children:n})},Z=()=>i.useContext(Be),te=n=>{const{active:t,children:s,label:r,onClick:l,...a}=n,{snapSide:u}=Z(),c=u==="right",h=Te({onClick:l});return e.jsx(kt,{content:r,portalled:!1,side:c?"left":"right",sideOffset:16,children:e.jsx(Oe,{ref:h,size:"sm",...a,"aria-label":r,style:{backgroundColor:t?o.colors.orange100.value:void 0,borderColor:t?o.colors.orange300.value:void 0,color:t?o.colors.orange500.value:void 0},children:s})})},ns=()=>{const{isDraggingToolbar:n}=Z();return e.jsxs(e.Fragment,{children:[e.jsx(v,{as:k.div,initial:{width:0},animate:{width:n?6:0},transition:{delay:.2},css:{position:"fixed",height:"100dvh",top:0,left:0,bg:o.colors.orange300,zIndex:z-1}}),e.jsx(v,{as:k.div,initial:{width:0},animate:{width:n?6:0},transition:{delay:.2},css:{position:"fixed",height:"100dvh",top:0,right:0,bg:o.colors.orange300,zIndex:z-1}}),n?e.jsx(v,{style:{position:"fixed",top:0,left:0,zIndex:z-1,width:"100dvw",height:"100dvh",backgroundColor:"transparent"}}):null]})},os=()=>{const{isDraggingToolbar:n,toolbarPosition:t,snapSide:s}=Z(),r=s==="left",l=s==="right";return e.jsx(v,{as:k.div,initial:{width:0},animate:{width:n?6:0},transition:{delay:.2},css:{position:"fixed",height:150,bg:o.colors.orange500,zIndex:z-1,borderRadius:o.radii.xs},style:{visibility:n?"visible":"hidden",top:`${t.y}%`,left:r?0:"unset",right:l?0:"unset",transform:`translateY(-${t.y}%)`}})},rs=()=>e.jsxs(e.Fragment,{children:[e.jsx(ns,{}),e.jsx(os,{})]}),is=n=>{const{children:t,forceReveal:s}=n,{isAddingComment:r}=A(),{isDraggingToolbar:l,snapSide:a}=Z(),u=a==="right",c=i.useRef(null),h=i.useCallback(()=>{const p=c.current;p&&(p.style.setProperty("--dot-scale","1.6"),p.style.setProperty("--dot-x",u?"3px":"-3px"))},[u]),d=i.useCallback(()=>{const p=c.current;p&&(p.style.setProperty("--dot-scale","1.0"),p.style.setProperty("--dot-x",u?"5px":"-5px"))},[u]),m=i.useCallback(p=>{const b=c.current;if(b){const{left:D,top:R,width:M,height:w}=b.getBoundingClientRect(),g=p.clientX,H=p.clientY,F=Math.abs(g-(D+M/2)),U=Math.abs(H-(R+w/2));Math.sqrt(F**2+U**2)<=100?h():d()}},[h,d]),y=i.useCallback(()=>{d()},[d]);return i.useEffect(()=>(document.addEventListener("mousemove",m),document.addEventListener("mouseleave",y),()=>{document.removeEventListener("mousemove",m),document.removeEventListener("mouseleave",y)}),[m,y]),e.jsxs(S,{as:k.div,alignItems:"center",initial:!1,animate:s||l||r?"shown":"hidden",css:{width:12,height:150},style:{flexDirection:u?"row":"row-reverse",justifyContent:u?"end":"start"},whileHover:"shown",children:[e.jsx(v,{ref:c,css:{position:"absolute"},style:{opacity:l?0:1},children:e.jsx(De,{css:{transform:"translateX(var(--dot-x, 0))",transition:"transform 0.3s ease-in-out, width 0.3s ease-in-out, height 0.3s ease-in-out"},radius:"full",variant:"secondary",children:e.jsx(v,{css:{background:o.colors.orange500,borderRadius:o.radii.full,size:"calc(var(--dot-scale, 1) * 10px)",transform:"translateX(var(--dot-x, 0))",transition:"transform 0.3s ease-in-out, width 0.3s ease-in-out, height 0.3s ease-in-out"}})})}),t]},a)},as=n=>{const{children:t,forceReveal:s}=n,{isDraggingToolbar:r,onToolbarDragStart:l,toolbarPosition:a,snapSide:u}=Z(),c=u==="right",h={hidden:{x:c?100:-100,transition:{duration:.3,ease:"easeInOut",delay:.3}},shown:{x:c?2:-2,transition:{duration:.3,ease:"easeInOut"}}};return e.jsxs(e.Fragment,{children:[e.jsx(v,{css:{position:"fixed",zIndex:z,pointerEvents:"auto"},style:{top:`${a.y}%`,left:`${a.x}%`,transform:`translateX(-${a.x}%) translateY(-${a.y}%)`},children:e.jsx(is,{forceReveal:s,children:e.jsx(S,{as:k.div,alignItems:"start",css:{p:o.space[2],boxShadow:"0px 10px 15px -3px rgba(37, 31, 45, 0.1), 0px 4px 6px -4px rgba(37, 31, 45, 0.1)"},gap:"1",style:{flexDirection:a.x>50?"row":"row-reverse",cursor:r?"move":"initial",border:r?`4px solid ${o.colors.orange500.value}`:`1px solid ${o.colors.gray200.value}`,background:r?o.colors.orange100.value:o.colors.white.value,borderTopRightRadius:c?0:o.radii.sm.value,borderBottomRightRadius:c?0:o.radii.sm.value,borderTopLeftRadius:c?o.radii.sm.value:0,borderBottomLeftRadius:c?o.radii.sm.value:0},variants:h,children:e.jsxs(S,{alignItems:"center",css:{gap:12},direction:"column",justifyContent:"between",children:[t,e.jsx(v,{css:{alignSelf:"baseline",cursor:"move",transform:"rotate(90deg)"},onMouseDown:l,children:e.jsx(He,{color:r?o.colors.orange500.value:o.colors.gray500.value})})]})})})}),e.jsx(rs,{})]})},cs=()=>{const{isOn:n,toggleKL:t,isAddingComment:s}=A(),r=ge(ve.KL_PILOT),l=ge(ve.KL_LAUNCH),{user:a}=G(),u=vt(Dt.Creator),{preferences:c}=bt(),h=yt(),[d,m]=i.useState(!1),y=`${h?.klFeedbackURL}&email=${a?.email}`,p=()=>{m(!0)},b=()=>{m(!1)},D=()=>{window.open(y,"_blank")},R=()=>{V({name:K.OpenSidePanel,eventSource:"Kl - Toolbar - View Tangos"})},M=()=>{if(s){V({name:K.NavigateTo,route:be.Hidden});return}V({name:K.NavigateTo,route:be.NewPin})};return Ne()||!r&&!l||!u||!c.klController?null:e.jsx(ss,{children:e.jsxs(as,{forceReveal:d,children:[e.jsx(te,{label:"Open Tango",onKeyDown:w=>{w.key==="Enter"&&R()},onClick:R,onFocus:p,onBlur:b,children:e.jsx(Re,{variant:"icon",size:"xs"})}),e.jsx(te,{active:s,label:"Pin Nugget",onKeyDown:w=>{w.key==="Enter"&&M()},onClick:M,onFocus:p,onBlur:b,children:e.jsx(wt,{})}),e.jsx(te,{label:n?"Hide all Nuggets":"Show all Nuggets",onKeyDown:w=>{w.key==="Enter"&&t()},onClick:t,onFocus:p,onBlur:b,children:n?e.jsx(ut,{}):e.jsx(Lt,{})}),r?e.jsx(te,{label:"Give feedback",onKeyDown:w=>{w.key==="Enter"&&D()},onClick:D,onFocus:p,onBlur:b,children:e.jsx(Fe,{})}):null]})})},ls=()=>{const[n,t]=i.useState(!1),s=i.useCallback(()=>{const r=document.visibilityState==="visible";t(r)},[]);return i.useLayoutEffect(()=>(s(),document.addEventListener("visibilitychange",s),()=>{document.removeEventListener("visibilitychange",s)}),[s]),n},ds=()=>{const{isOn:n,shouldShowResolvedThreadPopup:t,shouldShowShortcutTooltip:s,clearCommentPinData:r,commentPinData:l}=A(),a=ls();return e.jsxs(i.Suspense,{fallback:null,children:[a?e.jsxs(e.Fragment,{children:[t?e.jsx(Kt,{}):null,s?e.jsx(Xt,{}):null,n?e.jsx(qt,{}):null]}):null,l?e.jsx(_t,{onBlur:r,pinData:l}):null]})},us=()=>{const{currentWorkspace:n,loading:t}=G(),[s]=Ee();return de(),e.jsx(jt,{...Et,children:e.jsxs(pt,{children:[n&&!t?e.jsx(ds,{},s):null,e.jsx(cs,{})]},n?.id)})},Vs=us;export{Vs as default};
//# sourceMappingURL=B3HicAE1.js.map
