!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=791)}({104:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ajax=t.serialize=void 0,t.serialize=function(e){return"?"+Object.keys(e).reduce((function(t,n){return t.push(n+"="+encodeURIComponent(e[n])),t}),[]).join("&")},t.ajax=function(e){var t=e.method,n=e.url,r=e.body,o=e.headers;return new Promise((function(e,a){var i=new XMLHttpRequest;i.onreadystatechange=function(){4===this.readyState&&(this.status<299&&this.status>=200?e({body:this.responseText,responseUrl:this.responseURL}):a(this.responseText))},i.onerror=function(){a("XHR error")},i.open(t||"GET",n,!0),o&&Object.keys(o).forEach((function(e){i.setRequestHeader(e,o[e])})),i.send(r)}))}},105:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteDB=t.setDB=t.getDB=t.bgSet=t.set=t.get=void 0;var a=n(119);t.get=function(e,t){return new Promise((function(n){chrome.storage.sync.get(e,(function(r){return null!=r&&null!=r[e]||null==t?n(null==r?null:r[e]):n(t)}))}))},t.set=function(e,t){return new Promise((function(n){var r={};r[e]=t,chrome.storage.sync.set(r,n)}))},t.bgSet=function(e,t){return r(void 0,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,a.sendMessageToBackground({job:"set",value:{key:e,value:t}})];case 1:return n.sent(),[2]}}))}))},t.getDB=function(e){return new Promise((function(t,n){var r=window.indexedDB.open("NooBox",1);r.onupgradeneeded=function(){r.result.createObjectStore("Store",{keyPath:"key"})},r.onsuccess=function(){var o=r.result.transaction("Store","readwrite").objectStore("Store").get(e);o.onsuccess=function(){o.result?t(o.result.value):t(null)},o.onerror=function(e){console.log("getDB fail"),n(e)}}}))},t.setDB=function(e,t){return new Promise((function(n,r){var o=window.indexedDB.open("NooBox",1);o.onupgradeneeded=function(){o.result.createObjectStore("Store",{keyPath:"key"})},o.onsuccess=function(){var a=o.result.transaction("Store","readwrite").objectStore("Store").put({key:e,value:t});a.onsuccess=function(){n("set !")},a.onerror=function(e){console.log("setDB fail"),r(e)}}}))},t.deleteDB=function(e){return new Promise((function(t,n){var r=indexedDB.open("NooBox",1);r.onupgradeneeded=function(){r.result.createObjectStore("Store",{keyPath:"key"})},r.onsuccess=function(){var o=r.result.transaction("Store","readwrite").objectStore("Store").delete(e);o.onsuccess=function(){t()},o.onerror=function(e){console.log("deleteDB fail"),n(e)}}}))}},119:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendMessageToBackground=void 0,t.sendMessageToBackground=function(e){return new Promise((function(t){chrome.runtime.sendMessage(JSON.parse(JSON.stringify(e)),(function(e){var n=chrome.runtime.lastError;return n&&console.error(n),t(e)}))}))}},121:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clone=void 0,t.clone=function(e){return JSON.parse(JSON.stringify(e))}},144:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseImageSearch=void 0;var a=n(201),i=n(105),s=n(797),c=function(){function e(e){this.domParser=new DOMParser,this.engine=e}return e.prototype.search=function(e,t,n){return r(this,void 0,void 0,(function(){var r,a=this;return o(this,(function(o){switch(o.label){case 0:return[4,i.get("imageSearchUrl_"+this.engine)];case 1:if(!o.sent())return n.engineStatus[this.engine]="disabled",this.updateSearchResult(t,n),[2];n.engineStatus[this.engine]="loading",this.updateSearchResult(t,n),o.label=2;case 2:return o.trys.push([2,4,,5]),[4,this.searchInternal(e,n,(function(){a.updateSearchResult(t,n)}))];case 3:return o.sent(),n.engineStatus[this.engine]="loaded",this.updateSearchResult(t,n),[3,5];case 4:return r=o.sent(),console.error(r),n.engineStatus[this.engine]="error",this.updateSearchResult(t,n),[3,5];case 5:return[2]}}))}))},e.prototype.searchInternal=function(e,t,n){return r(this,void 0,void 0,(function(){return o(this,(function(e){throw new Error("Method must be override")}))}))},e.prototype.updateSearchResult=function(e,t){a.imageSearchDao.add({id:e,createdAt:Date.now(),result:t}).then((function(){s.sendMessageToFrontend({job:"image_result_update",value:{cursor:e}}).catch(console.error)}))},e}();t.BaseImageSearch=c},201:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.imageSearchDao=void 0;var a=function(e){function t(){return e.call(this,"ImageSearch")||this}return o(t,e),t}(n(205).IndexedDbDao);t.imageSearchDao=new a},202:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.logEvent=t.logPageView=void 0;var a=n(104),i=n(59),s=!1;t.logPageView=function(){return r(void 0,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return e={ainoob:Math.random(),path:i.NOOBOX_VERSION,referrer:"",sr:screen.width+"x"+screen.height,title:"background",type:"pageview",ua:navigator.userAgent,ul:navigator.language},[4,a.ajax({url:i.BELLO_URL+a.serialize(e)})];case 1:return t.sent(),[2]}}))}))},t.logEvent=function(e){if("object"==typeof window){s||(s=!0,t.logPageView().catch(console.error));var n={action:e.action,ainoob:Math.random(),category:e.category,label:e.label,path:i.NOOBOX_VERSION,sr:screen.width+"x"+screen.height,type:"event",ua:navigator.userAgent,ul:navigator.language,value:e.value||0};a.ajax({url:i.BELLO_URL+a.serialize(n)}).catch(console.error)}}},203:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getActiveTab=void 0,t.getActiveTab=function(){return new Promise((function(e){chrome.tabs.query({active:!0,lastFocusedWindow:!0},(function(t){t[0]?e(t[0]):e(null)}))}))}},204:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useChrome=void 0,t.useChrome=function(){window.browser&&(console.log("using chrome instead of browser"),window.chrome=window.browser,console.log("done using chrome instead of browser"))}},205:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedDbDao=void 0;var a=function(){function e(e){var t=this;this.dbName="",this.getDBRequest=function(){var e=indexedDB.open(t.dbName,1);return e.onerror=function(e){throw e},e.onupgradeneeded=function(){e.result.createObjectStore(t.dbName,{keyPath:"id"}).createIndex("createdAt","createdAt",{unique:!1})},e},this.dbName=e}return e.prototype.count=function(){var e=this;return new Promise((function(t,n){var r=e.getDBRequest();r.onsuccess=function(){var o=r.result,a=o.transaction(e.dbName,"readonly").objectStore(e.dbName).count();a.onsuccess=function(e){e.target.result?(t(e.target.result),o.close()):(t(0),o.close())},a.onerror=function(e){console.error("countDB fail"),n(e)}}}))},e.prototype.get=function(e,t){var n=this;return new Promise((function(r,o){var a=n.getDBRequest();a.onsuccess=function(){var i=a.result,s=i.transaction(n.dbName,"readonly").objectStore(n.dbName),c=void 0===t||"id"===t?s.get(e):s.index(t).get(e);c.onsuccess=function(e){e.target.result?(r(e.target.result),i.close()):(r(null),i.close())},c.onerror=function(e){console.error("getDB fail"),o(e)}}}))},e.prototype.add=function(e){var t=this;return new Promise((function(n,r){var o=t.getDBRequest();o.onsuccess=function(){var a=o.result,i=a.transaction(t.dbName,"readwrite").objectStore(t.dbName).put(e);i.onsuccess=function(){n("set !"),a.close()},i.onerror=function(e){console.error("setDB fail"),r(e),a.close()}}}))},e.prototype.remove=function(e){var t=this;return new Promise((function(n,r){var o=t.getDBRequest();o.onsuccess=function(){var a=o.result,i=a.transaction(t.dbName,"readwrite").objectStore(t.dbName).delete(e);i.onsuccess=function(){n(),a.close()},i.onerror=function(e){console.error("deleteDB fail"),r(e),a.close()}}}))},e.prototype.clear=function(){var e=this;return new Promise((function(t,n){var r=e.getDBRequest();r.onsuccess=function(){var o=r.result,a=o.transaction(e.dbName,"readwrite").objectStore(e.dbName).clear();a.onsuccess=function(){t(),o.close()},a.onerror=function(e){console.error("deleteDB fail"),n(e),o.close()}}}))},e.prototype.iterate=function(e){var t=e.type,n=e.direction,a=e.size,i=e.key;return r(this,void 0,void 0,(function(){var e=this;return o(this,(function(s){return[2,new Promise((function(s,c){return r(e,void 0,void 0,(function(){var e,r=this;return o(this,(function(o){return(e=this.getDBRequest()).onsuccess=function(){var o=e.result.transaction(r.dbName,"readonly").objectStore(r.dbName),u=null;i&&(u="backward"===n?IDBKeyRange.upperBound(i,!0):IDBKeyRange.lowerBound(i,!0));var l="backward"===n?"prev":"next",h=void 0===t||"id"===t?o.openCursor(u,l):o.index(t).openCursor(u,l),f=[];h.onsuccess=function(e){var t=e.target.result;f.length<a&&t&&f.push(t.value),f.length<a&&t?t.continue():s({hasNext:!!t,recordList:f})},h.onerror=function(e){console.error("failed"),c(e)}},[2]}))}))}))]}))}))},e}();t.IndexedDbDao=a},206:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Options=t.defaultOptions=void 0;var a=n(121),i=n(59),s=n(105);t.defaultOptions={autoRefresh:!0,displayMode:1,sortBy:"relevance",extractImages:!0,history:!0,imageSearch:!0,imageSearchNewTabFront:!0,imageSearchUrl_ascii2d:!1,imageSearchUrl_baidu:!0,imageSearchUrl_bing:!0,imageSearchUrl_google:!0,imageSearchUrl_iqdb:!1,imageSearchUrl_saucenao:!1,imageSearchUrl_sogou:!1,imageSearchUrl_tineye:!0,imageSearchUrl_yandex:!0,screenshotSearch:!0,preload_all_images:!1,userId:(Math.random().toString(36)+"00000000000000000").slice(2,19)+(Math.random().toString(36)+"00000000000000000").slice(2,19),videoControl:!1};var c=function(){function e(e,n){this.options=a.clone(t.defaultOptions),this.image=e,this.videoControl=n,this.init().catch(console.error)}return e.prototype.getOptions=function(){return a.clone(this.options)},e.prototype.set=function(e,t){return r(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,s.set(e,t)];case 1:return n.sent(),this.options[e]=t,"videoControl"===e||e.startsWith(i.HTML5_VIDEO_CONTROL_OPTION_KEY_PREFIX)?this.videoControl.notifyVideoControlSwitch(e.substr(i.HTML5_VIDEO_CONTROL_OPTION_KEY_PREFIX.length),t):"screenshotSearch"===e?this.image.updateScreenshotSearchContextMenu().catch(console.error):"extractImages"===e?this.image.updateExtractImageContextMenu().catch(console.error):"imageSearch"===e&&this.image.updateImageSearchContextMenu().catch(console.error),[2]}}))}))},e.prototype.init=function(){return r(this,void 0,void 0,(function(){var e,n,r,a,i,c,u;return o(this,(function(o){switch(o.label){case 0:e=Object.keys(t.defaultOptions),n=0,r=e,o.label=1;case 1:return n<r.length?(a=r[n],[4,s.get(a)]):[3,7];case 2:return null!=(i=o.sent())&&"{}"!==JSON.stringify(i)?[3,4]:[4,s.set(a,t.defaultOptions[a])];case 3:o.sent(),o.label=4;case 4:return c=this.options,u=a,[4,s.get(a)];case 5:c[u]=o.sent(),o.label=6;case 6:return n++,[3,1];case 7:return[4,this.image.init()];case 8:return o.sent(),[2]}}))}))},e}();t.Options=c},448:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AutoRefresh=t.defaultTabStatus=void 0;var r=n(202),o=n(121);t.defaultTabStatus={firstTimeInterval:0,handler:null,interval:6e3,isFirstTimeInterval:!1,lastRefreshedAt:null};var a=function(){function e(){this.tabs={}}return e.prototype.clear=function(e){var t=this.getSetting(e);t.handler&&clearInterval(t.handler),t.handler=null,this.tabs[e]=t},e.prototype.delete=function(e){this.update({tabId:e,active:!1}),delete this.tabs[e]},e.prototype.update=function(e){var t=this,n=e.tabId,o=e.active,a=e.startAt,i=e.shouldLogEvent,s=e.interval;if(n){this.clear(n);var c="stop",u=this.getSetting(n),l=u.handler;u.interval=s||u.interval;var h=s=u.interval;return o&&(c=l?"updateInterval":"start",u.lastRefreshedAt=(new Date).getTime(),a&&(h=(s-a)%s,u.isFirstTimeInterval=!0,u.firstTimeInterval=h,u.lastRefreshedAt=u.lastRefreshedAt-a),l=setInterval((function(){t.performAutoRefresh(n)}),h),u.handler=l),this.tabs[n]=u,i&&r.logEvent({action:c,category:"Options"}),this.getSetting(n)}},e.prototype.getSetting=function(e){return this.tabs[e]||o.clone(t.defaultTabStatus)},e.prototype.performAutoRefresh=function(e){var t=this;chrome.tabs.reload(e,{},(function(){console.log("refresh")}));var n=this.getSetting(e);n.lastRefreshedAt=(new Date).getTime(),n.isFirstTimeInterval&&(this.clear(e),n.isFirstTimeInterval=!1,n.handler=setInterval((function(){t.performAutoRefresh(e)}),n.interval)),this.tabs[e]=n},e}();t.AutoRefresh=a},449:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.openSearchResultTab=void 0;var a=n(450),i=n(105),s=n(451);t.openSearchResultTab=function(e){return r(void 0,void 0,void 0,(function(){var t,n,r;return o(this,(function(o){switch(o.label){case 0:return[4,s.generateNewTabUrl("searchResult.html")];case 1:return t=o.sent(),n=a.createNewTab,r={},[4,i.get("imageSearchNewTabFront")];case 2:return[4,n.apply(void 0,[(r.active=o.sent(),r.url=t+"#/"+e,r)])];case 3:return o.sent(),[2]}}))}))}},450:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.createNewTab=void 0,t.createNewTab=function(e){return new Promise((function(t){chrome.tabs.create(e,(function(e){return r(void 0,void 0,void 0,(function(){return o(this,(function(n){return chrome.tabs.onUpdated.addListener((function n(r,o){"complete"===o.status&&r===e.id&&(chrome.tabs.onUpdated.removeListener(n),t())})),[2]}))}))}))}))}},451:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateNewTabUrl=void 0,t.generateNewTabUrl=function(e){return new Promise((function(t){t(chrome.runtime.getURL(e))}))}},452:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stringOrArrayBufferToString=void 0,t.stringOrArrayBufferToString=function(e){return"string"==typeof e?e:String.fromCharCode.apply(null,new Uint16Array(e))}},453:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHostnameFromUrl=void 0,t.getHostnameFromUrl=function(e){var t=document.createElement("a");return t.href=e,t.hostname}},59:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ENGINE_WEIGHTS=t.getEngineOptionKey=t.ENGINE_OPTION_KEY_PREFIX=t.getEngineImageUrl=t.ENGINE_LIST=t.HTML5_VIDEO_CONTROL_OPTION_KEY_PREFIX=t.NOOBOX_VERSION=t.BELLO_URL=void 0,t.BELLO_URL="https://ainoob.com/bello/noobox",t.NOOBOX_VERSION=chrome.runtime.getManifest().version,t.HTML5_VIDEO_CONTROL_OPTION_KEY_PREFIX="videoControl_website_",t.ENGINE_LIST=["google","baidu","yandex","tineye","bing","saucenao","ascii2d","iqdb"],t.getEngineImageUrl=function(e){return"images/engineLogos/"+e+".png"},t.ENGINE_OPTION_KEY_PREFIX="imageSearchUrl_",t.getEngineOptionKey=function(e){return t.ENGINE_OPTION_KEY_PREFIX+e},t.ENGINE_WEIGHTS={ascii2d:-69,baidu:28,bing:28,google:33,iqdb:-100,saucenao:10,tineye:28,yandex:25}},789:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.voidFunc=void 0,t.voidFunc=function(){window.bello=Math.random()}},791:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(202),i=n(203),s=n(204),c=n(448),u=n(792),l=n(206),h=n(805);s.useChrome();var f=new c.AutoRefresh,d=new u.Image,p=new h.VideoControl,g=new l.Options(d,p);window.options=g,chrome.commands.onCommand.addListener((function(e){return r(void 0,void 0,void 0,(function(){var t,n,r;return o(this,(function(o){switch(o.label){case 0:switch(e){case"screenshotSearch":return[3,1]}return[3,4];case 1:return n=(t=d).screenshotSearch,r=[null],[4,i.getActiveTab()];case 2:return[4,n.apply(t,r.concat([o.sent()]))];case 3:return o.sent(),[3,5];case 4:console.error("Unknown command: "+e),o.label=5;case 5:return[2]}}))}))})),chrome.runtime.onMessage.addListener((function(e,t,n){switch(e.job){case"analytics":return a.logEvent(e.value),n(null);case"getCurrentTabAutoRefreshStatus":var r=e.value.tabId;return n(f.getSetting(r));case"updateAutoRefresh":return n(f.update(e.value));case"urlDownloadZip":var o=e.value.files;return d.downloadExtractImages(t,o),n(null);case"beginImageSearch":var i=e.value.base64OrUrl;return d.beginImageSearch(i).catch(console.error),n(null);case"videoControl":return p.notifyAllToPerformSelfCheck(),n(null);case"set":var s=e.value,c=s.key,u=s.value;n({key:c,value:u}),g.set(c,u).catch(console.error);break;case"getOptions":return n(g.getOptions())}})),chrome.tabs.onRemoved.addListener((function(e){f.delete(e)}))},792:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Image=void 0;var a=n(201),i=n(104),s=n(202),c=n(793),u=n(59),l=n(794),h=n(105),f=n(795),d=n(83),p=n(449),g=n(452),b=n(789),m=n(796),y=n(798),v=n(799),w=n(800),_=n(801),S=n(802),I=n(803),x=n(804),O=function(){function e(){this.imageUploadUrl="",this.imageDownloadUrl="",this.imageServerUrl="https://ainoob.com/api/get/imageServers/",this.imageSearchHandle=null,this.extractImageHandle=null,this.screenshotSearchHandle=null,this.imageSearchMap={ascii2d:new m.Ascii2dImageSearch("ascii2d"),baidu:new y.BaiduImageSearch("baidu"),bing:new v.BingImageSearch("bing"),iqdb:new _.IqdbImageSearch("iqdb"),saucenao:new S.SauceNaoImageSearch("saucenao"),tineye:new I.TineyeImageSearch("tineye"),google:new w.GoogleImageSearch("google"),yandex:new x.YandexImageSearch("yandex")},this.updateImageUploadUrl("ainoob.com"),this.updateImageDownloadUrl("ainoob.com"),this.migrateHistory().catch(console.error)}return e.prototype.init=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.updateImageSearchContextMenu()];case 1:return e.sent(),[4,this.updateExtractImageContextMenu()];case 2:return e.sent(),[4,this.updateScreenshotSearchContextMenu()];case 3:return e.sent(),[4,this.getImageServer()];case 4:return e.sent(),[2]}}))}))},e.prototype.updateImageSearchContextMenu=function(){return r(this,void 0,void 0,(function(){var e=this;return o(this,(function(t){switch(t.label){case 0:return[4,h.get("imageSearch")];case 1:return t.sent()?this.imageSearchHandle=chrome.contextMenus.create({contexts:["image"],id:"imageSearch",onclick:function(t){e.beginImageSearch(t.srcUrl).catch(console.error)},title:d.getI18nMessage("search_this_image")}):this.imageSearchHandle&&(chrome.contextMenus.remove(this.imageSearchHandle),this.imageSearchHandle=null),[2]}}))}))},e.prototype.updateExtractImageContextMenu=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,h.get("extractImages")];case 1:return e.sent()?this.extractImageHandle=chrome.contextMenus.create({contexts:["all"],id:"extractImages",onclick:this.extractImages,title:d.getI18nMessage("extract_images")}):this.extractImageHandle&&(chrome.contextMenus.remove(this.extractImageHandle),this.extractImageHandle=null),[2]}}))}))},e.prototype.updateScreenshotSearchContextMenu=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,h.get("screenshotSearch")];case 1:return e.sent()?this.screenshotSearchHandle=chrome.contextMenus.create({contexts:["all"],id:"screenshotSearch",onclick:this.screenshotSearch,title:d.getI18nMessage("screenshot_search")}):this.screenshotSearchHandle&&(chrome.contextMenus.remove(this.screenshotSearchHandle),this.screenshotSearchHandle=null),[2]}}))}))},e.prototype.downloadExtractImages=function(e,t){s.logEvent({action:"run",category:"downloadExtractImages"});var n=new window.JSZip,r=t.length,o=t.length,a=0,i=t[a],c=new window.FileReader;function u(s){if(s){var h=g.stringOrArrayBufferToString(s),d=(h.slice(0,20).match(/image\/(\w*)/)||["",""])[1],p=l.convertDataUriToBinary(h);n.file(i.name+"."+d,p,{base64:!1})}else o--;r--,chrome.tabs.sendMessage(e.tab.id,{job:"downloadRemaining",remains:r,total:o},b.voidFunc),0===r?n.generateAsync({type:"blob"}).then((function(e){window.saveAs(e,"NooBox.zip")})):"data"===(i=t[++a]).url.slice(0,4)?u(i.url):f.fetchImageBlob(i.url,(function(e){e?c.readAsDataURL(e):u()}))}c.onloadend=function(){u(c.result)},"data"===i.url.slice(0,4)?u(i.url):f.fetchImageBlob(i.url,(function(e){e?c.readAsDataURL(e):u()}))},e.prototype.beginImageSearch=function(e){return r(this,void 0,void 0,(function(){var t,n,l,f,d,g,b,m,y=this;return o(this,(function(v){switch(v.label){case 0:return[4,h.getDB("imageCursor")];case 1:return t=v.sent()||0,t++,[4,h.setDB("imageCursor",t)];case 2:return v.sent(),l=c.checkUrlOrBase64(e),f={base64:"base64"===l?e:"",engineLink:{},engineStatus:{},searchImageInfo:[],searchResult:[],url:"url"===l?e:""},[4,a.imageSearchDao.add({id:t,createdAt:Date.now(),result:f})];case 3:return v.sent(),[4,p.openSearchResultTab(t)];case 4:if(v.sent(),"base64"!==l)return[3,10];s.logEvent({action:"dataURI",category:"imageSearch"}),d={method:"POST",body:JSON.stringify({data:e}),headers:{"Content-Type":"application/json"},url:this.imageUploadUrl},v.label=5;case 5:return v.trys.push([5,7,,9]),g=this.imageDownloadUrl,[4,i.ajax(d)];case 6:return n=g+v.sent().body,[3,9];case 7:return b=v.sent(),console.error(b),console.log("having error, switch to default server"),this.updateImageUploadUrl("ainoob.com"),this.updateImageDownloadUrl("ainoob.com"),m=this.imageDownloadUrl,[4,i.ajax(d)];case 8:return n=m+v.sent().body,[3,9];case 9:return[3,11];case 10:"url"===l&&(s.logEvent({action:"url",category:"imageSearch"}),n=e),v.label=11;case 11:return u.ENGINE_LIST.forEach((function(e){return r(y,void 0,void 0,(function(){return o(this,(function(r){return this.imageSearchMap[e].search(n,t,f).catch(console.error),[2]}))}))})),[2]}}))}))},e.prototype.screenshotSearch=function(e,t){return r(this,void 0,void 0,(function(){return o(this,(function(e){return chrome.tabs.sendMessage(t.id,"loaded",(function(e){"yes"===e?chrome.tabs.captureVisibleTab(t.windowId,(function(e){chrome.tabs.sendMessage(t.id,{data:e,job:"screenshotSearch"})})):chrome.tabs.captureVisibleTab(t.windowId,(function(e){chrome.tabs.executeScript(t.id,{file:"thirdParty/jquery.min.js"},(function(){chrome.runtime.lastError?chrome.notifications.create("screenshotFailed",{iconUrl:"/images/icon_128.png",message:d.getI18nMessage("ls_2"),title:d.getI18nMessage("ls_1"),type:"basic"},(function(e){console.debug(e)})):chrome.tabs.executeScript(t.id,{file:"contentScript/screenshotSearch.js"},(function(){chrome.tabs.sendMessage(t.id,{data:e,job:"screenshotSearch"})}))}))}))})),[2]}))}))},e.prototype.migrateHistory=function(){return r(this,void 0,void 0,(function(){var e,t,n,r;return o(this,(function(o){switch(o.label){case 0:return[4,h.getDB("migratedV1")];case 1:return o.sent()?(console.log("skip migrating V1"),[2]):[4,h.getDB("imageCursor")];case 2:e=o.sent(),t=Date.now(),n=0,o.label=3;case 3:return n<=e?[4,h.getDB(n)]:[3,7];case 4:return(r=o.sent())&&(r.base64||r.url)?[4,a.imageSearchDao.add({id:n,createdAt:t+n,result:r})]:[3,6];case 5:o.sent(),o.label=6;case 6:return n++,[3,3];case 7:return[4,h.setDB("migratedV1",!0)];case 8:return o.sent(),console.log("migratedV1"),[2]}}))}))},e.prototype.updateImageUploadUrl=function(e){this.imageUploadUrl="https://"+e+"/api/uploadImage/"},e.prototype.updateImageDownloadUrl=function(e){this.imageDownloadUrl="https://"+e+"/api/getImage/"},e.prototype.getImageServer=function(){return r(this,void 0,void 0,(function(){var e,t,n,a,s=this;return o(this,(function(c){switch(c.label){case 0:return n=(t=JSON).parse,[4,i.ajax({url:this.imageServerUrl})];case 1:return e=n.apply(t,[c.sent().body]),a=null,"/search",e.forEach((function(e){return r(s,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return t=(new Date).getTime(),[4,i.ajax({url:"https://"+e+"/search"})];case 1:return n.sent(),console.log("fetched after "+((new Date).getTime()-t)+"ms: "+e),a||(a=e,this.updateImageUploadUrl(e),this.updateImageDownloadUrl(e)),[2]}}))}))})),[2]}}))}))},e.prototype.extractImages=function(e,t){s.logEvent({action:"run",category:"extractImages"}),chrome.tabs.sendMessage(t.id,{job:"extractImages"},{frameId:e.frameId},(function(e){e||chrome.notifications.create("extractImages",{iconUrl:"/images/icon_128.png",message:d.getI18nMessage("ls_4"),title:d.getI18nMessage("extractImages"),type:"basic"},(function(e){console.debug(e)})),chrome.runtime.lastError&&console.error("Last error:",chrome.runtime.lastError)}))},e}();t.Image=O},793:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkUrlOrBase64=void 0;var r=/^\s*data:([a-z]+\/[a-z]+(;[a-z\-]+\=[a-z\-]+)?)?(;base64)?,[a-z0-9\!\$\&\'\,\(\)\*\+\,\;\=\-\.\_\~\:\@\/\?\%\s]*\s*$/i,o=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;t.checkUrlOrBase64=function(e){return e.match(r)?"base64":e.match(o)?"url":"unknown"}},794:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertDataUriToBinary=void 0;t.convertDataUriToBinary=function(e){try{for(var t=e.indexOf(";base64,")+";base64,".length,n=e.substring(t),r=(i=window.atob(n)).length,o=new Uint8Array(new ArrayBuffer(r)),a=0;a<r;a++)o[a]=i.charCodeAt(a);return o}catch(o){try{t=(e=e.replace(/%2/g,"/")).indexOf(";base64,")+";base64,".length,n=e.substring(t),r=(i=window.atob(n)).length;for(var i,s=new Uint8Array(new ArrayBuffer(r)),c=0;c<r;c++)s[c]=i.charCodeAt(c);return s}catch(e){throw console.error(e),new Error("failed to convertDataUriToBinary")}}}},795:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchImageBlob=void 0,t.fetchImageBlob=function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=function(){if(4===n.readyState)if(200===this.status){var e=new window.Blob([this.response],{type:"image/png"});t&&t(e)}else console.error("fetchImageBlob receive error code: "+this.status),t()},n.onerror=function(e){t(),console.error("fetchImageBlob failed "+e)},n.send()}},796:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Ascii2dImageSearch=void 0;var s=n(104),c=n(59),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.searchInternal=function(e,t,n){return a(this,void 0,void 0,(function(){var r,o,a,c,u;return i(this,(function(i){switch(i.label){case 0:return(r=new FormData).append("uri",e),[4,s.ajax({url:"https://ascii2d.net/search/uri",method:"POST",body:r})];case 1:return o=i.sent(),a=o.body,c=o.responseUrl,t.engineLink[this.engine]=c,n(),u=this.domParser.parseFromString(a,"text/html"),this.getResults(u,t),[2]}}))}))},t.prototype.getResults=function(e,t){for(var n=e.getElementsByClassName("item-box"),r=0;r<n.length;r++){var o={title:"Possible Match",thumbUrl:"",imageUrl:"",sourceUrl:"",imageInfo:{},searchEngine:"ascii2d",description:"",weight:c.ENGINE_WEIGHTS.ascii2d-r+Math.random()},a=n[r],i=a.getElementsByClassName("image-box");if(i.length>0){var s=i[0].getElementsByTagName("img")[0];if(s){var u=s.getAttribute("src")||"";o.thumbUrl=""===u?"":"https://ascii2d.net"+u,o.imageUrl=""===u?"":"https://ascii2d.net"+u}}var l=a.getElementsByClassName("info-box");if(l.length>0){var h=l[0],f=h.getElementsByTagName("small")[0];if(f){var d=f.innerHTML.split(" ")[0].split("x");o.imageInfo.width=parseInt(d[0],0),o.imageInfo.height=parseInt(d[1],0)}var p=h.getElementsByTagName("a");p[0]&&(o.title=p[0].innerHTML,o.sourceUrl=p[0].getAttribute("href")),p[1]&&(o.description="Author: "+p[1].innerHTML)}t.searchResult.push(o)}},t}(n(144).BaseImageSearch);t.Ascii2dImageSearch=u},797:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendMessageToFrontend=void 0,t.sendMessageToFrontend=function(e){return new Promise((function(t){var n=chrome.extension.getViews({type:"popup"}),r=chrome.extension.getViews({type:"tab"});if(0===n.length&&0===r.length)return t();chrome.runtime.sendMessage(JSON.parse(JSON.stringify(e)),(function(e){var n=chrome.runtime.lastError;return n&&console.error(n),t(e)}))}))}},798:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.BaiduImageSearch=void 0;var s=n(104),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.searchInternal=function(e,t,n){return a(this,void 0,void 0,(function(){var r,o,a,c,u,l;return i(this,(function(i){switch(i.label){case 0:return(r=new FormData).append("image",e),[4,s.ajax({url:"https://graph.baidu.com/upload",method:"POST",body:r})];case 1:return o=i.sent().body,a=JSON.parse(o).data,t.engineLink[this.engine]=a.url,n(),c=a.sign,[4,s.ajax({url:"https://graph.baidu.com/ajax/pcsame?sign="+c+"&limit=10",method:"POST"})];case 2:return u=i.sent(),"object"==typeof(l=JSON.parse(u.body))&&this.getResults(l,t),[2]}}))}))},t.prototype.getResults=function(e,t){for(var n=e.data.list,r=0;r<n.length;r++){var o={title:"Possible Match",thumbUrl:"",imageUrl:"",sourceUrl:"",imageInfo:{},searchEngine:"baidu",description:"",weight:28-r+Math.random()};o.title=n[r].title||"",o.imageUrl=n[r].image_src||"",o.sourceUrl=n[r].url||"",o.thumbUrl=n[r].image_src||"",o.imageInfo.height=n[r].height,o.imageInfo.width=n[r].width,o.description=n[r].abstract||"",t.searchResult.push(o)}},t}(n(144).BaseImageSearch);t.BaiduImageSearch=c},799:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.BingImageSearch=void 0;var s=n(104),c=n(59),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.searchInternal=function(e,t,n){return a(this,void 0,void 0,(function(){var r,o,a,c,u;return i(this,(function(i){switch(i.label){case 0:return(r=new URLSearchParams).append("view","detailv2"),r.append("iss","sbi"),r.append("FORM","SBIIRP"),r.append("q","imgurl:"+e),r.append("idpbck","1"),[4,s.ajax({url:"https://www.bing.com/images/search?"+r.toString(),method:"GET"})];case 1:return o=i.sent(),a=o.body,c=o.responseUrl,t.engineLink[this.engine]=c,n(),[4,this.fetchResult(e,a)];case 2:return u=i.sent(),this.getResults(u,t),[2]}}))}))},t.prototype.getResults=function(e,t){var n=e.imageBasedRelatedSearches,r=e.relatedSearches,o=e.visuallySimilarImages;n&&n.value.slice(0,15).forEach((function(e,n){var r={title:e.text,thumbUrl:e.thumbnail.url,imageUrl:e.thumbnail.url,sourceUrl:e.webSearchUrl,imageInfo:{},searchEngine:"bing",description:"",weight:c.ENGINE_WEIGHTS.bing-n+Math.random()};t.searchResult.push(r)})),r&&r.value.slice(0,15).forEach((function(e,n){var r={title:e.text,thumbUrl:e.thumbnail.url,imageUrl:e.thumbnail.url,sourceUrl:e.webSearchUrl,imageInfo:{},searchEngine:"bing",description:"",weight:c.ENGINE_WEIGHTS.bing-n+Math.random()};t.searchResult.push(r)})),o&&o.value.slice(0,15).forEach((function(e,n){var r={title:e.name,thumbUrl:e.contentUrl,imageUrl:e.contentUrl,sourceUrl:e.hostPageUrl,imageInfo:{height:e.height,width:e.width},searchEngine:"bing",description:"",weight:c.ENGINE_WEIGHTS.bing-n+Math.random()};t.searchResult.push(r)}))},t.prototype.fetchResult=function(e,t){return a(this,void 0,void 0,(function(){var n,r,o,a,c;return i(this,(function(i){switch(i.label){case 0:return n=this.getSKeyAndIG(t),r=n.skey,o=n.ig,(a=new URLSearchParams).append("modules","brq,objectdetection,objectrecognition,imagebasedrelatedsearches,relatedsearches,image,caption,similarimages,similarproducts"),a.append("imgurl",e),a.append("rshighlight","true"),a.append("textDecorations","true"),a.append("internalFeatures","share"),a.append("skey",r),a.append("safeSearch","Strict"),a.append("IG",o),a.append("IID","idpins"),a.append("SFX","1"),"https://www.bing.com/images/api/custom/details?",[4,s.ajax({url:"https://www.bing.com/images/api/custom/details?"+a.toString(),method:"GET"})];case 1:return c=i.sent(),[2,JSON.parse(c.body)]}}))}))},t.prototype.getSKeyAndIG=function(e){var t,n,r=e.indexOf('IG:"'),o=e.indexOf('",EventID'),a=e.indexOf("skey="),i=e.indexOf("&amp;");if(-1!==r&&-1!==o){var s=e.substring(r,o);t=s.substring(s.indexOf('"')+1,s.length)}if(-1!==a&&-1!==i){var c=e.substring(a,i);n=c.substring(c.indexOf("=")+1,c.length)}if(!t||!n)throw new Error("Missing ig & skey");return{ig:t,skey:n}},t}(n(144).BaseImageSearch);t.BingImageSearch=u},800:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.GoogleImageSearch=void 0;var s=n(104),c=n(59),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.searchInternal=function(e,t,n){return a(this,void 0,void 0,(function(){var r,o,a,c,u;return i(this,(function(i){switch(i.label){case 0:return[4,this.getActualUrl(e)];case 1:return(r=i.sent())?[4,s.ajax({url:r})]:[2];case 2:return o=i.sent(),a=o.body,c=o.responseUrl,t.engineLink[this.engine]=c,n(),u=this.domParser.parseFromString(a,"text/html"),window.d=u,this.getKeyword(u,t),n(),this.getResults(u,t),[2]}}))}))},t.prototype.getActualUrl=function(e){return a(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return[4,s.ajax({url:"https://lens.google.com/uploadbyurl?url="+e})];case 1:return t=r.sent().body,(n=t.match(/(https:\/\/www\.google\.com\/search\?tbs\\u003d[^"]*)/))?[2,n[1].replace("\\u003d","=")]:[2,null]}}))}))},t.prototype.getKeyword=function(e,t){var n=e.getElementById("topstuff");if(n){var r=n.getElementsByClassName("card-section");if(r.length>0){var o=r[0].getElementsByTagName("a");if(o.length>0){var a=o[o.length-1].text,i={engine:this.engine,keyword:a,keywordLink:"https://www.google.com/search?q="+encodeURIComponent(a)};t.searchImageInfo.push(i)}}}},t.prototype.getResults=function(e,t){for(var n=e.getElementsByClassName("g"),r=0;r<n.length;r++){var o={title:"",thumbUrl:"",imageUrl:"",sourceUrl:"",imageInfo:{},searchEngine:"google",description:"",weight:c.ENGINE_WEIGHTS.google-r+Math.random()},a=n[r],i=a.getElementsByTagName("a");o.sourceUrl=i[0].getAttribute("href");var s=i[0].childNodes;s.length>1&&(o.title=s[1].innerText),o.title||(o.title=i[0].childNodes.innerText);var u=a.getElementsByTagName("span"),l="";u.length>0&&(l=u[u.length-1].innerText),o.imageInfo.width=-1,o.imageInfo.height=-1;for(var h=0;h<u.length;h++){var f=u[h].innerText;if(f){var d=f.match(/(\d+)  (\d+)/);d&&(o.imageInfo.width=Number.parseInt(d[1],10),o.imageInfo.height=Number.parseInt(d[2],10))}}o.description=l,t.searchResult.push(o)}},t}(n(144).BaseImageSearch);t.GoogleImageSearch=u},801:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.IqdbImageSearch=void 0;var s=n(104),c=n(59),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.searchInternal=function(e,t,n){return a(this,void 0,void 0,(function(){var r,o,a,c;return i(this,(function(i){switch(i.label){case 0:return[4,s.ajax({url:"https://iqdb.org/?url="+e})];case 1:return r=i.sent(),o=r.body,a=r.responseUrl,t.engineLink[this.engine]=a,n(),c=this.domParser.parseFromString(o,"text/html"),this.getResults(c,t),[2]}}))}))},t.prototype.getResults=function(e,t){var n=e.getElementsByClassName("pages");if(n.length>0)for(var r=0;r<n.length;r++)for(var o=n[r].getElementsByTagName("div"),a=0;a<o.length;a++){var i=o.item(a);if(i){var s=i.getElementsByTagName("th")[0];if(null==s||"Possible match"===s.innerHTML){var u={title:"Possible Match",thumbUrl:"",imageUrl:"",sourceUrl:"",imageInfo:{},searchEngine:"iqdb",description:"",weight:c.ENGINE_WEIGHTS.iqdb-r+Math.random()},l=i.getElementsByTagName("td"),h=l[0].getElementsByTagName("a")[0];if(h){var f=h.getAttribute("href")||"";-1!==f.indexOf("http")?f="http:"+f.substring(f.indexOf("//"),f.length):-1===f.indexOf("https")&&(f="https:"+f),u.sourceUrl=""===f?"":f;var d=h.getElementsByTagName("img")[0];if(d){var p=d.getAttribute("src")||"";u.thumbUrl=""===p?"":"http://iqdb.org/"+p,u.imageUrl=""===p?"":"http://iqdb.org/"+p}}var g=l[2].innerHTML;if(g){var b=g.split(" ")[0].split("");u.imageInfo.width=parseInt(b[0],0),u.imageInfo.height=parseInt(b[1],0)}var m=l[3].innerHTML;m&&(u.description=m),t.searchResult.push(u)}}}},t}(n(144).BaseImageSearch);t.IqdbImageSearch=u},802:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.SauceNaoImageSearch=void 0;var s=n(104),c=n(59),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.searchInternal=function(e,t,n){return a(this,void 0,void 0,(function(){var r,o,a,c;return i(this,(function(i){switch(i.label){case 0:return[4,s.ajax({url:"https://saucenao.com/search.php?db=999&url="+e})];case 1:return r=i.sent(),o=r.body,a=r.responseUrl,t.engineLink[this.engine]=a,n(),c=this.domParser.parseFromString(o,"text/html"),this.getResults(c,t),[2]}}))}))},t.prototype.getResults=function(e,t){var n=e.getElementsByClassName("result");if(n.length>0)for(var r=1;r<n.length;r++){var o={title:"",thumbUrl:"",imageUrl:"",sourceUrl:"",imageInfo:{},searchEngine:"saucenao",description:"",weight:c.ENGINE_WEIGHTS.saucenao-r+Math.random()},a=n[r],i=a.getElementsByClassName("resultimage")[0];if(i){var s=i.getElementsByTagName("a")[0];s&&(o.sourceUrl=s.getAttribute("href")||"");var u=i.getElementsByTagName("img")[0];u&&(o.thumbUrl=u.getAttribute("data-src")||u.getAttribute("src")||"",o.imageUrl=u.getAttribute("data-src")||u.getAttribute("src")||"")}var l=a.getElementsByClassName("resultcontent")[0];if(l){var h=l.getElementsByTagName("strong")[0];h&&(o.title=h.innerHTML)}o.imageInfo.height=-1,o.imageInfo.width=-1,t.searchResult.push(o)}},t}(n(144).BaseImageSearch);t.SauceNaoImageSearch=u},803:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.TineyeImageSearch=void 0;var s=n(104),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.searchInternal=function(e,t,n){return a(this,void 0,void 0,(function(){var r,o,a;return i(this,(function(i){switch(i.label){case 0:return(r=new FormData).append("url",e),[4,s.ajax({url:"https://tineye.com/search",method:"POST",body:r})];case 1:throw o=i.sent(),a=o.body.match(/var base_url = "\/result\/(.*)";/)[1],t.engineLink[this.engine]="https://tineye.com/search/"+a,n(),new Error("Tineye is no longer supported")}}))}))},t}(n(144).BaseImageSearch);t.TineyeImageSearch=c},804:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.YandexImageSearch=void 0;var s=n(104),c=n(59),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.searchInternal=function(e,t,n){return a(this,void 0,void 0,(function(){var r,o,a,c;return i(this,(function(i){switch(i.label){case 0:return[4,s.ajax({url:"https://yandex.com/images/search?source=collections&rpt=imageview&url="+e})];case 1:return r=i.sent(),o=r.body,a=r.responseUrl,t.engineLink[this.engine]=a,n(),c=this.domParser.parseFromString(o,"text/html"),this.getKeyword(c,t),this.getResults(c,t),[2]}}))}))},t.prototype.getKeyword=function(e,t){var n=e.getElementsByClassName("CbirObjectResponse-Content"),r={engine:this.engine,keyword:"",keywordLink:""};if(0!==n.length){var o=n[0].getElementsByTagName("h2");o.length>0&&(r.keyword=o[0].innerHTML,r.keywordLink="https://yandex.com/search/?text="+encodeURIComponent(r.keyword)),t.searchImageInfo.push(r)}},t.prototype.getResults=function(e,t){var n=e.getElementsByClassName("CbirSites-Items");if(n.length>0)for(var r=n[0].getElementsByTagName("li"),o=0;o<r.length;o++){var a={title:"",thumbUrl:"",imageUrl:"",sourceUrl:"",imageInfo:{},searchEngine:"yandex",description:"",weight:c.ENGINE_WEIGHTS.yandex-o+Math.random()};a.title="Yandex";var i=r[o],s=i.getElementsByClassName("CbirSites-ItemThumb");if(s.length>0){var u=s[0];a.thumbUrl=a.imageUrl=u.getElementsByTagName("a")[0].href;var l=u.getElementsByClassName("Thumb-Mark")[0].innerText.split("").map((function(e){return e.trim()}));a.imageInfo.width=l[0],a.imageInfo.height=l[1]}a.title=i.getElementsByClassName("CbirSites-ItemTitle")[0].getElementsByTagName("a")[0].innerText,a.sourceUrl=i.getElementsByClassName("CbirSites-ItemTitle")[0].getElementsByTagName("a")[0].href,t.searchResult.push(a)}},t}(n(144).BaseImageSearch);t.YandexImageSearch=u},805:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VideoControl=void 0;var r=n(453),o=n(789),a=function(){function e(){}return e.prototype.notifyAllToPerformSelfCheck=function(){chrome.tabs.query({},(function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];chrome.tabs.sendMessage(r.id,{job:"videoControlContentScriptSelfCheck"},o.voidFunc)}}))},e.prototype.notifyVideoControlSwitch=function(e,t){chrome.tabs.query({},(function(n){for(var a=0,i=n;a<i.length;a++){var s=i[a];s.url&&r.getHostnameFromUrl(s.url)===e&&chrome.tabs.sendMessage(s.id,{job:"videoControlContentScriptSwitch",value:{enabled:t}},o.voidFunc)}}))},e}();t.VideoControl=a},83:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getI18nMessage=void 0,t.getI18nMessage=function(e,t,n){return n&&n>1&&t?chrome.i18n.getMessage(t):chrome.i18n.getMessage(e)}}});