var background=function(exports){"use strict";function getRandomUInt32(){let e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]}function getUUID(){return crypto.randomUUID()}function createRandomString(){const e=new Uint32Array(28);return crypto.getRandomValues(e),Array.from(e,(e=>("0"+e.toString(16)).slice(-2))).join("")}async function createCodeChallenge(e){const t=await crypto.subtle.digest("SHA-256",(new TextEncoder).encode(e));return btoa(String.fromCharCode(...new Uint8Array(t))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function parseJwtToken(e){try{return JSON.parse(atob(e.split(".")[1]))}catch(e){return null}}function isAccessTokenExpired(e){try{const t=parseJwtToken(e);if(t.exp&&Date.now()/1e3<t.exp-5)return!1}catch(e){console.error("Error decoding token:",e)}return!0}const supportedLanguages=[{langCode:"DE",langCodeForSpeech:"de-DE",supportsFormality:!0},{langCode:"EN-GB",langCodeForSpeech:"en",voice:"Google UK English Male"},{langCode:"EN-US",langCodeForSpeech:"en",voice:"Google UK English Male"},{langCode:"FR",langCodeForSpeech:"fr-FR",voice:"Thomas",supportsFormality:!0},{langCode:"ES",langCodeForSpeech:"es-ES",voice:"Google espaÃ±ol",label:"ES",supportsFormality:!0},{langCode:"IT",langCodeForSpeech:"it-IT",supportsFormality:!0},{langCode:"ID",langCodeForSpeech:"id-ID"},{langCode:"PL",langCodeForSpeech:"pl-PL",supportsFormality:!0},{langCode:"NL",langCodeForSpeech:"nl-NL",voice:"Google Nederlands",label:"NL",supportsFormality:!0},{langCode:"AR",langCodeForSpeech:"ar-AR"},{langCode:"BG",langCodeForSpeech:"bg-BG"},{langCode:"CS",langCodeForSpeech:"cs-CZ"},{langCode:"DA",langCodeForSpeech:"da-DK"},{langCode:"EL",langCodeForSpeech:"el-GR"},{langCode:"ET",langCodeForSpeech:"et"},{langCode:"FI",langCodeForSpeech:"fi-FI",voice:"Satu"},{langCode:"HU",langCodeForSpeech:"hu-HU"},{langCode:"JA",langCodeForSpeech:"ja-JP",supportsFormality:!0},{langCode:"KO",langCodeForSpeech:"ko-KR"},{langCode:"LT",langCodeForSpeech:"lt"},{langCode:"LV",langCodeForSpeech:"lv"},{langCode:"NB",langCodeForSpeech:"nb-NO"},{langCode:"PT-BR",langCodeForSpeech:"pt-PT",supportsFormality:!0},{langCode:"PT-PT",langCodeForSpeech:"pt-PT",supportsFormality:!0},{langCode:"RO",langCodeForSpeech:"ro-RO"},{langCode:"RU",langCodeForSpeech:"ru-RU",supportsFormality:!0},{langCode:"SK",langCodeForSpeech:"sk-SK"},{langCode:"SL",langCodeForSpeech:"sl"},{langCode:"SV",langCodeForSpeech:"sv-SE"},{langCode:"TR",langCodeForSpeech:"tr-TR"},{langCode:"UK",langCodeForSpeech:"uk-UA"},{langCode:"ZH",langCodeForSpeech:"zh-CN"},{langCode:"ZH-HANT",langCodeForSpeech:"zh-HANT"}],SUPPORTED_WRITE_LANGUAGES=["EN-GB","EN-US","EN","DE","FR","ES"],WRITE_LANGS_WITHOUT_SENTENCE_ALTERNATIVES=["ES","FR"],defaultLanguage="EN",languageStatus={UNDEFINED:0,ALWAYS_TRANSLATE:1,NEVER_TRANSLATE:2},TRANSLATION_TRIGGER={inline:"inline",automatic:"automatic",manual:"manual",input:"input",input_alternatives:"input_alternatives"},USER_TYPE={notLoggedIn:1,loggedInPro:2,loggedInFree:3},CHARACTER_LIMITS_TRANSLATOR={notLoggedIn:1500,loggedInFree:5e3},CHARACTER_LIMITS_WRITE={notLoggedIn:2e3,loggedInFree:2e3},EXTENSION_CONTEXT={defaultPopup:1,fptInjectedPopup:2,inlineTooltipPopup:3},EXTENSION_OPENED_FROM={extensionIcon:1,fptAutoInject:2},LOGO_CLICKED_FROM={defaultPopup:1,injectedFptPopup:2,inlinePopup:3},NOTIFICATION_TYPES={hintKeyboardShortcut:"HINT_KEYBOARD_SHORTCUT",inputTranslation:"INPUT_TRANSLATION",inlineTranslation:"INLINE_TRANSLATION",fullPageTranslation:"FULL_PAGE_TRANSLATION",accountSuccessfullyCreated:"ACCOUNT_SUCCESSFULLY_CREATED",successfullyLoggedIn:"SUCCESSFULLY_LOGGED_IN",glidesPreventAssetLoss:"GSLIDES_WARNING_TO_AVOID_ASSET_LOSS",showAdsForMSAddins:"SHOW_ADS_FOR_MS_ADDINS"},UI_LOCATIONS={inlineTranslationTriggerIcon:"INLINE_TRANSLATION_TRIGGER_ICON",inlineTranslationSettingsIcon:"INLINE_TRANSLATION_SETTINGS_ICON",inlineTranslationSettingPopup:"INLINE_TRANSLATION_SETTING_POPUP",inputTranslationTriggerIcon:"INPUT_TRANSLATION_TRIGGER_ICON",inputImproveTriggerIcon:"INPUT_IMPROVE_TRIGGER_ICON",inputTranslationSettingsIcon:"INPUT_TRANSLATION_SETTINGS_ICON",inputTranslationSettingPopup:"INPUT_TRANSLATION_SETTING_POPUP",settingsPageFPT:"SETTINGS_PAGE_FPT",settingsPageReading:"SETTINGS_PAGE_READING",settingsPageWriting:"SETTINGS_PAGE_WRITING",settingsPageIntegrations:"SETTINGS_PAGE_INTEGRATIONS",fptHideModal:"FPT_HIDE_MODAL",inputTranslationReadMoreLink:"INPUT_TRANSLATION_READ_MORE_LINK",inlineTranslationReadMoreLink:"INLINE_TRANSLATION_READ_MORE_LINK",fptTranslationReadMoreLink:"FPT_TRANSLATION_READ_MORE_LINK",extensionHubToggleSwitch:"EXTENSION_HUB_TOGGLE_SWITCH",hubCustomizeShortcut:"HUB_CUSTOMIZE_SHORTCUT",hubLoginButton:"HUB_LOGIN_BUTTON",hubUpgradeToProLink:"HUB_UPGRADE_TO_PRO_LINK",hubTryProLink:"HUB_TRY_PRO_LINK",hubTryWriteProLink:"HUB_TRY_WRITE_PRO_LINK",settingsPageCustomizeShortcutButton:"SETTINGS_PAGE_CUSTOMIZE_SHORTCUT_BUTTON",hubFPTEnableCheckbox:"HUB_FPT_ENABLE_CHECKBOX",hubFPTDisableCheckbox:"HUB_FPT_DISABLE_CHECKBOX",deeplWriteIcon:"DEEPL_WRITE_ICON",gmailOnboardingPopup:"gmailOnboardingPopup",gmailOnboardingIcon:"gmailOnboardingIcon",gmailCharLimitLogin:"gmailCharLimitLogin",gmailFeedbackSurvey:"gmailFeedbackSurvey",hubViewIntegrations:"HUB_VIEW_INTEGRATIONS",hubCloseCustomizationsWidget:"HUB_CLOSE_CUSTOMIZATIONS_WIDGET",gslidesFeedbackSurvey:"GSLIDES_FEEDBACK_SURVEY",gslidesCharLimitLogin:"GSLIDES_CHAR_LIMIT_LOGIN",zendeskTryProLink:"ZENDESK_TRY_PRO_LINK",onboardingSignUp:"ONBOARDING_SIGN_UP",onboardingSkipSignUp:"ONBOARDING_SKIP_SIGN_UP",onboardingLoginLink:"ONBOARDING_LOGIN_LINK",onboardingSeeAllIntegrations:"ONBOARDING_SEE_ALL_INTEGRATIONS",iconToggleInHubTranslator:"ICON_TOGGLE_IN_HUB_TRANSLATOR",iconToggleInHubWrite:"ICON_TOGGLE_IN_HUB_WRITE",manageIconSettings:"MANAGE_ICON_SETTINGS",writeLanguageSwitchedInHub:"WRITE_LANGUAGE_SWITCHED_IN_HUB",writeLanguageSwitchedInSettings:"WRITE_LANGUAGE_SWITCHED_IN_SETTINGS"},SHORTCUT_TYPES={triggerTranslation:"trigger-translation",changeLanguage:"change-language"},UI_ACTION={clickOnShortcutNotifiction:"CLICK_ON_SHORTCUT_NOTIFICATION",clickOnInlineTranslationShowAlternatives:"CLICK_ON_INLINE_TRANSLATION_SHOW_ALTERNATIVES",clickOnInlineTranslationCloseIcon:"CLICK_ON_INLINE_TRANSLATION_CLOSE_ICON",clickOnLogoutMenuEntry:"CLICK_ON_LOGOUT_MENU_ENTRY",clickOnReviewWindowCloseAction:"CLICK_ON_REVIEW_WINDOW_CLOSE_ACTION"},SETTING_TYPES={disablePerSite:"DISABLE_PER_SITE",disableEverywhere:"DISABLE_EVERYWHERE",enableEverywhere:"ENABLE_EVERYWHERE",enablePerSite:"ENABLE_PER_SITE"},UI_FUNCTIONS={inputTranslation:"INPUT_TRANSLATION",inlineTranslation:"INLINE_TRANSLATION",fullPageTranslation:"FULL_PAGE_TRANSLATION",gdocs:"GDOCS"},INLINE_POSITION_TYPES={top:1,right:2,bottom:3,left:4},ONBOARDING_STEP_CHANGE_TRIGGERS={openPage:"OPEN_PAGE",backButton:"BACK_BUTTON",nextButton:"NEXT_BUTTON",navigation:"NAVIGATION"},ORIGIN_STORE={unspecified:0,chrome:1,edge:2,local:3,firefox:4},ORIGIN_STORE_URLS={chrome:"cofdbpoegempjloogbagkncekinflcnj",edge:"fancfknaplihpclbhbpclnmmjcjanbaf",local:"ocpdpnakdghopjcifldjidbdmfobmmoi",firefox:"firefox-extension@deepl.com"},LANDING_ON_WEBSITE_DAP_IDS={deepl:1,linguee:2,google_translate:3,word_365:4,power_point_365:5,jira:6,confluence:7,gmail:8},SHOW_REVIEW_POPUP_AFTER_TRANSLATIONS=5,PLATFORM_BEHAVIOURS={default:"DEFAULT",gdocs:"GDOCS",zendesk:"ZENDESK",whatsappWeb:"WHATSAPP_WEB",twitter:"TWITTER",gmail:"GMAIL",gslides:"GSLIDES",linkedIn:"LINKEDIN"},TEXT_PROCESSING_MODE={translate:"translate",write:"write"},LOGOUT_TRIGGER={user:"USER",extension:"EXTENSION"},ZENDESK_CUSTOMIZATION_EVENT_TYPE={OPEN_TICKET:"OPEN_TICKET",DETECT_TICKET_LANGUAGE:"DETECT_TICKET_LANGUAGE",SWITCH_TICKET_LANGUAGE:"SWITCH_TICKET_LANGUAGE",ENABLE_AUTOTRANSLATE:"ENABLE_AUTOTRANSLATE",DISABLE_AUTOTRANSLATE:"DISABLE_AUTOTRANSLATE",TRANSLATE_MESSAGE:"TRANSLATE_MESSAGE",TRANSLATE_INPUT:"TRANSLATE_INPUT",ERROR:"ERROR"},SESSION_TYPE_TRIGGER={translation:"TRANSLATION",login:"LOGIN"},WHATSAPP_TRANSLATOR_TYPE={chat:"CHAT",message:"MESSAGE"},SERVICE_NAME={TRANSLATOR:"TRANSLATOR",WRITE:"WRITE",API:"API",DOC_TRANSLATOR:"DOC_TRANSLATOR"},SERVICE_LEVEL$1={free:"free",pro:"pro",none:"none"},DEEPL_WRITE_EVENT_TYPE={TEXT_REFINEMENT_REQUEST:"TEXT_REFINEMENT_REQUEST",GDOCS_INSERT_COPY:"GDOCS_INSERT_COPY",GDOCS_DISCARD_COPY:"GDOCS_DISCARD_COPY",GDOCS_CHAR_LIMIT_REACHED:"GDOCS_CHAR_LIMIT_REACHED",RESULT_ACCEPTED:"RESULT_ACCEPTED",RESULT_REVERTED:"RESULT_REVERTED",GET_ALTERNATIVES_FOR_INPUT:"GET_ALTERNATIVES_FOR_INPUT",ERROR:"ERROR"},DEEPL_TRANSLATE_EVENT_TYPE={RESULT_ACCEPTED:"RESULT_ACCEPTED",RESULT_REVERTED:"RESULT_REVERTED",ERROR:"ERROR"},DEEPL_ALTERNATIVE_EVENT_TYPE={ALTERNATIVES_OPENED:"ALTERNATIVES_OPENED",SEGMENTATION_SELECTED:"SEGMENTATION_SELECTED",ALTERNATIVE_SELECTED:"ALTERNATIVE_SELECTED"},GMAIL_ACTION_TYPE={READING_VIEW_TRANSLATE:"READING_VIEW_TRANSLATE",COMPOSE_VIEW_TRANSLATE:"COMPOSE_VIEW_TRANSLATE",COMPOSE_VIEW_IMPROVE:"COMPOSE_VIEW_IMPROVE"},UPGRADE_NOTIFICATION_TYPE={ANONYMOUS_USER_LIMIT_EXCEEDED:"ANONYMOUS_USER_LIMIT_EXCEEDED",FREE_ACCOUNT_LIMIT_EXCEEDED:"FREE_ACCOUNT_LIMIT_EXCEEDED",WRITE_ANONYMOUS_USER_LIMIT_EXCEEDED:"WRITE_ANONYMOUS_USER_LIMIT_EXCEEDED",WRITE_FREE_ACCOUNT_LIMIT_EXCEEDED:"WRITE_FREE_ACCOUNT_LIMIT_EXCEEDED"},UPGRADE_NOTIFICATION_ACTION={PRO_TRIAL:"PRO_TRIAL",LOGIN:"LOGIN",SIGNUP:"SIGNUP"},ALTERNATIVES_SEGMENTATION_MODE={WORD:"word",SENTENCE:"sentence"},OIDC_SESSION_TYPE={none:"None",pro:"Pro",free:"Free"},WRITE_STYLE_NAMES={simple:"simple",business:"business",academic:"academic",casual:"casual",enthusiastic:"enthusiastic",friendly:"friendly",confident:"confident",diplomatic:"diplomatic"},BROWSER_NAMES={chrome:"Chrome",edge:"Edge",brave:"Brave",firefox:"Firefox",opera:"Opera",safari:"Safari"};function isMac(){const e=navigator?.userAgentData?.platform||navigator?.platform||void 0;return e&&-1!==e?.toUpperCase().indexOf("MAC")}function isChromiumBrowser(e){return e===BROWSER_NAMES.chrome||e===BROWSER_NAMES.edge||e===BROWSER_NAMES.brave||e===BROWSER_NAMES.opera}function getBrowserVersion(e,t){let n;try{switch(e){case BROWSER_NAMES.chrome:case BROWSER_NAMES.brave:n=t.split("Chrome/")[1].split(" ")[0];break;case BROWSER_NAMES.edge:n=t.split("Edg/")[1].split(" ")[0];break;case BROWSER_NAMES.firefox:n=t.split("Firefox/")[1].split(" ")[0];break;case BROWSER_NAMES.opera:n=t.split("OPR/")[1].split(" ")[0];break;case BROWSER_NAMES.safari:n=t.split("Version/")[1].split(" ")[0]}}catch(t){console.error(`Could not get the browsers (${e}) version from user agent`,t)}try{!n&&navigator?.userAgentData&&isChromiumBrowser(e)&&(n=getChromiumBrand(e).version)}catch(t){console.error(`Could not get the chromium browsers (${e}) version`,t)}return n&&"string"==typeof n?n:"unknown_browser_version"}function getChromiumBrand(e){if(!navigator.userAgentData||!e)return;const t=new RegExp(`${e}`,"i");return navigator.userAgentData.brands.filter((e=>t.test(e.brand)))[0]}function getPlatformMetaData(){const e=navigator?.userAgent||"unknown_user_agent",t=navigator?.userAgentData?.platform||navigator?.platform||"unknown_platform";let n="unknown_browser",r="unknown_browser_version";const o=navigator?.language||"unknown_browser_language";try{const t=e.match(/chrome|chromium|crios/i),o=e.match(/edg/i)||getChromiumBrand(BROWSER_NAMES.edge),a=e.match(/firefox|fxios/i),i=e.match(/opr\//i)||getChromiumBrand(BROWSER_NAMES.opera),s=e.match(/safari/i),c=getChromiumBrand(BROWSER_NAMES.brave);t?(n=BROWSER_NAMES.chrome,o&&(n=BROWSER_NAMES.edge),i&&(n=BROWSER_NAMES.opera),c&&(n=BROWSER_NAMES.brave)):o?n=BROWSER_NAMES.edge:a?n=BROWSER_NAMES.firefox:i?n=BROWSER_NAMES.opera:s&&(n=BROWSER_NAMES.safari),r=getBrowserVersion(n,e)}catch(e){console.error("Could not get the name of the brower",e)}return{userAgent:e,platform:t,browser:n,browserVersion:r,browserLang:o}}function isFirefoxExtension(){if({IS_PROD:!0,BASE_URLS:{dapApi:"https://s.deepl.com/chrome/statistics",toolingApiPro:"https://api.deepl.com/jsonrpc?client=chrome-extension,1.26.1",toolingApi:"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.26.1",toolingWriteApiPro:"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.26.1",toolingWriteApi:"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.26.1",classicApi:"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.26.1",classicApiPro:"https://api.deepl.com/jsonrpc?client=chrome-extension,1.26.1",classicApiWrite:"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.26.1",classicApiWritePro:"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.26.1",classicApiGlossary:"https://api.deepl.com/termbases/jsonrpc?client=chrome-extension,1.26.1",login:"https://www.deepl.com/auth/login",token:"https://w.deepl.com/oidc/token",logout:"https://www.deepl.com/auth/logout",feedbackSurvey:"https://deepl.typeform.com/to/MkMfP2Y6",newFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_cMvbeX0WZGvkKGi",firefoxFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_eyfDZqQmXuNTFOK",uninstallSurvey:"https://deepl.qualtrics.com/jfe/form/SV_eJxAD8c7J5hqSRU",gslidesFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_9XBLSAbDmLq5emO",deeplPro:"https://www.deepl.com/pro",deeplProWrite:"https://www.deepl.com/pro-write",deeplTranslator:"https://www.deepl.com/translator",deeplDoctrans:"https://www.deepl.com/translator/files",deeplTermsOfServiceFree:"https://www.deepl.com/en/pro-license?tab=free",deeplCreateAccount:"https://www.deepl.com/signup",extensionStorePage:"https://bit.ly/DeepL-Chrome",supportArticle:"https://support.deepl.com/hc/articles/4407580229522",deeplSupport:"https://support.deepl.com/hc",chromeWebstore:"https://chrome.google.com/webstore/detail/deepl-translate-reading-w/cofdbpoegempjloogbagkncekinflcnj",edgeWebstore:"https://microsoftedge.microsoft.com/addons/detail/deepl-translate-reading-/fancfknaplihpclbhbpclnmmjcjanbaf",firefoxWebstore:"https://addons.mozilla.org/en-US/firefox/addon/deepl-translate",firefoxShortcutDocs:"https://support.mozilla.org/kb/manage-extension-shortcuts-firefox",firefoxPrivacyPolicy:"https://addons.mozilla.org/en-US/firefox/addon/deepl-translate/privacy/",clientStateApi:"https://w.deepl.com/web",experimentsEndpoint:"https://s.deepl.com/chrome/experiments",gmailFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_db8ItFTmYBcZjYW",customerSegmentationSurveyFree:"https://deepl.qualtrics.com/jfe/form/SV_3LbBcdg4mjQuCCq?desc=TG-2071",customerSegmentationSurveyPro:"https://deepl.qualtrics.com/jfe/form/SV_3LbBcdg4mjQuCCq?desc=TG-2070",arabicSurvey:"https://deepl.qualtrics.com/jfe/form/SV_ekTrC2ePp0wn7xQ",msAddinsDeepLAds:"https://www.deepl.com/en/microsoft-365"},APP_VERSION:"1.26.1",FEATURE_FLAGS:{TRANSLATE_INPUT:!0,PAGE_TRANSLATION:!0,IMPROVE_WRITING:!0,DOCUMENT_TRANSLATION:!0,RECOMMEND_TO_A_FRIEND:!0,PRO_LOGIN:!0,WEBPAGE_CUSTOMIZER:!0,GDOCS_INTEGRATION:!0,ZENDESK_INTEGRATION:!0,GMAIL_INTEGRATION:!0,GSLIDES_INTEGRATION:!0,ON_INSTALL_ONBOARDING:!0,WHATSAPP_TRANSLATE_ALL_CHAT:!1,DEEPL_WRITE_GENERAL:!1,DEEPL_WRITE_GDOCS:!0,SHOW_CUSTOMER_SEGMENTATION_SURVEY:!1,ARABIC_SURVEY:!0,REVIEW_UI_WITH_ITA:!1}}.browserBuild)return{IS_PROD:!0,BASE_URLS:{dapApi:"https://s.deepl.com/chrome/statistics",toolingApiPro:"https://api.deepl.com/jsonrpc?client=chrome-extension,1.26.1",toolingApi:"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.26.1",toolingWriteApiPro:"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.26.1",toolingWriteApi:"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.26.1",classicApi:"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.26.1",classicApiPro:"https://api.deepl.com/jsonrpc?client=chrome-extension,1.26.1",classicApiWrite:"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.26.1",classicApiWritePro:"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.26.1",classicApiGlossary:"https://api.deepl.com/termbases/jsonrpc?client=chrome-extension,1.26.1",login:"https://www.deepl.com/auth/login",token:"https://w.deepl.com/oidc/token",logout:"https://www.deepl.com/auth/logout",feedbackSurvey:"https://deepl.typeform.com/to/MkMfP2Y6",newFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_cMvbeX0WZGvkKGi",firefoxFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_eyfDZqQmXuNTFOK",uninstallSurvey:"https://deepl.qualtrics.com/jfe/form/SV_eJxAD8c7J5hqSRU",gslidesFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_9XBLSAbDmLq5emO",deeplPro:"https://www.deepl.com/pro",deeplProWrite:"https://www.deepl.com/pro-write",deeplTranslator:"https://www.deepl.com/translator",deeplDoctrans:"https://www.deepl.com/translator/files",deeplTermsOfServiceFree:"https://www.deepl.com/en/pro-license?tab=free",deeplCreateAccount:"https://www.deepl.com/signup",extensionStorePage:"https://bit.ly/DeepL-Chrome",supportArticle:"https://support.deepl.com/hc/articles/4407580229522",deeplSupport:"https://support.deepl.com/hc",chromeWebstore:"https://chrome.google.com/webstore/detail/deepl-translate-reading-w/cofdbpoegempjloogbagkncekinflcnj",edgeWebstore:"https://microsoftedge.microsoft.com/addons/detail/deepl-translate-reading-/fancfknaplihpclbhbpclnmmjcjanbaf",firefoxWebstore:"https://addons.mozilla.org/en-US/firefox/addon/deepl-translate",firefoxShortcutDocs:"https://support.mozilla.org/kb/manage-extension-shortcuts-firefox",firefoxPrivacyPolicy:"https://addons.mozilla.org/en-US/firefox/addon/deepl-translate/privacy/",clientStateApi:"https://w.deepl.com/web",experimentsEndpoint:"https://s.deepl.com/chrome/experiments",gmailFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_db8ItFTmYBcZjYW",customerSegmentationSurveyFree:"https://deepl.qualtrics.com/jfe/form/SV_3LbBcdg4mjQuCCq?desc=TG-2071",customerSegmentationSurveyPro:"https://deepl.qualtrics.com/jfe/form/SV_3LbBcdg4mjQuCCq?desc=TG-2070",arabicSurvey:"https://deepl.qualtrics.com/jfe/form/SV_ekTrC2ePp0wn7xQ",msAddinsDeepLAds:"https://www.deepl.com/en/microsoft-365"},APP_VERSION:"1.26.1",FEATURE_FLAGS:{TRANSLATE_INPUT:!0,PAGE_TRANSLATION:!0,IMPROVE_WRITING:!0,DOCUMENT_TRANSLATION:!0,RECOMMEND_TO_A_FRIEND:!0,PRO_LOGIN:!0,WEBPAGE_CUSTOMIZER:!0,GDOCS_INTEGRATION:!0,ZENDESK_INTEGRATION:!0,GMAIL_INTEGRATION:!0,GSLIDES_INTEGRATION:!0,ON_INSTALL_ONBOARDING:!0,WHATSAPP_TRANSLATE_ALL_CHAT:!1,DEEPL_WRITE_GENERAL:!1,DEEPL_WRITE_GDOCS:!0,SHOW_CUSTOMER_SEGMENTATION_SURVEY:!1,ARABIC_SURVEY:!0,REVIEW_UI_WITH_ITA:!1}}.browserBuild.toLowerCase()===BROWSER_NAMES.firefox.toLowerCase();const e=chrome.runtime.getURL("");return getPlatformMetaData().browser===BROWSER_NAMES.firefox||/moz-extension:\/\//gm.test(e)}function getWebSpeechAPIVoices(){return new Promise(((e,t)=>{if("speechSynthesis"in window){const t=speechSynthesis.getVoices();t.length>0?e(t):speechSynthesis.onvoiceschanged=()=>{const t=speechSynthesis.getVoices();e(t)}}else t(new Error("SpeechSynthesis not supported"))}))}function speakTextWithWebSpeechAPI(e,t,n){const r=new SpeechSynthesisUtterance(e);r.lang=t,r.onend=function(){n()},speechSynthesis.speak(r)}const URL_ACTIONS={share_feedback_survey:"DOCS_GOOGLE_COM_FEEDBACK_FORM",new_share_feedback_survey:"NEW_FEEDBACK_FORM",try_DeepL_Pro:"DEEPL_COM_PRO",try_DeepL_Pro_Write:"DEEPL_COM_PRO_WRITE",show_more_translation:"DEEPL_COM_TRANSLATOR",deepl_translator_home:"DEEPL_COM_HOMEPAGE",deepl_write_home:"DEEPL_COM_WRITE",deepl_terms_of_service_free:"DEEPL_COM_TERMS_OF_SERVICE_FREE",deepl_create_account:"DEEPL_CREATE_ACCOUNT",deepl_translator_docs:"DEEPL_COM_DOCTRANS",shortcut_settings:"SHORTCUT_SETTINGS",support_article:"SUPPORT_ARTICLE",chrome_write_a_review:"CHROME_WRITE_A_REVIEW",edge_write_a_review:"EDGE_WRITE_A_REVIEW",gmail_feedback_survey:"GMAIL_FEEDBACK_SURVEY",gslides_feedback_survey:"GSLIDES_FEEDBACK_SURVEY",firefox_write_a_review:"FIREFOX_WRITE_A_REVIEW",external:{whatsapp:"EXTERNAL_WHATSAPP",twitter:"EXTERNAL_TWITTER",youtube:"EXTERNAL_YOUTUBE",facebook:"EXTERNAL_FACEBOOK",github:"EXTERNAL_GITHUB",discord:"EXTERNAL_DISCORD",telegram:"EXTERNAL_TELEGRAM",reddit:"EXTERNAL_REDDIT",gmail:"EXTERNAL_GMAIL",gdocs:"EXTERNAL_GDOCS",gslides:"EXTERNAL_GSLIDES",linkedIn:"EXTERNAL_LINKEDIN",msOffice:"EXTERNAL_MS_OFFICE"},deepl_support:"DEEPL_SUPPORT",firefox_feedback_survey:"FIREFOX_FEEDBACK_SURVEY",firefox_shortcut_docs:"FIREFOX_SHORTCUT_DOCS",firefox_privacy_policy:"FIREFOX_PRIVACY_POLICY",customer_segmentation_survey_free:"CUSTOMER_SEGMENTATION_SURVEY_FREE",customer_segmentation_survey_pro:"CUSTOMER_SEGMENTATION_SURVEY_PRO",arabic_survey:"ARABIC_SURVEY",ms_office_addins_ads:"ADDINS_ADS"},URL_LIST={DOCS_GOOGLE_COM_FEEDBACK_FORM:"https://deepl.typeform.com/to/MkMfP2Y6",NEW_FEEDBACK_FORM:"https://deepl.qualtrics.com/jfe/form/SV_cMvbeX0WZGvkKGi",DEEPL_COM_PRO:"https://www.deepl.com/pro",DEEPL_COM_PRO_WRITE:"https://www.deepl.com/pro-write",DEEPL_COM_TRANSLATOR:"https://www.deepl.com/translator",DEEPL_COM_WRITE:{dapApi:"https://s.deepl.com/chrome/statistics",toolingApiPro:"https://api.deepl.com/jsonrpc?client=chrome-extension,1.26.1",toolingApi:"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.26.1",toolingWriteApiPro:"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.26.1",toolingWriteApi:"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.26.1",classicApi:"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.26.1",classicApiPro:"https://api.deepl.com/jsonrpc?client=chrome-extension,1.26.1",classicApiWrite:"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.26.1",classicApiWritePro:"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.26.1",classicApiGlossary:"https://api.deepl.com/termbases/jsonrpc?client=chrome-extension,1.26.1",login:"https://www.deepl.com/auth/login",token:"https://w.deepl.com/oidc/token",logout:"https://www.deepl.com/auth/logout",feedbackSurvey:"https://deepl.typeform.com/to/MkMfP2Y6",newFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_cMvbeX0WZGvkKGi",firefoxFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_eyfDZqQmXuNTFOK",uninstallSurvey:"https://deepl.qualtrics.com/jfe/form/SV_eJxAD8c7J5hqSRU",gslidesFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_9XBLSAbDmLq5emO",deeplPro:"https://www.deepl.com/pro",deeplProWrite:"https://www.deepl.com/pro-write",deeplTranslator:"https://www.deepl.com/translator",deeplDoctrans:"https://www.deepl.com/translator/files",deeplTermsOfServiceFree:"https://www.deepl.com/en/pro-license?tab=free",deeplCreateAccount:"https://www.deepl.com/signup",extensionStorePage:"https://bit.ly/DeepL-Chrome",supportArticle:"https://support.deepl.com/hc/articles/4407580229522",deeplSupport:"https://support.deepl.com/hc",chromeWebstore:"https://chrome.google.com/webstore/detail/deepl-translate-reading-w/cofdbpoegempjloogbagkncekinflcnj",edgeWebstore:"https://microsoftedge.microsoft.com/addons/detail/deepl-translate-reading-/fancfknaplihpclbhbpclnmmjcjanbaf",firefoxWebstore:"https://addons.mozilla.org/en-US/firefox/addon/deepl-translate",firefoxShortcutDocs:"https://support.mozilla.org/kb/manage-extension-shortcuts-firefox",firefoxPrivacyPolicy:"https://addons.mozilla.org/en-US/firefox/addon/deepl-translate/privacy/",clientStateApi:"https://w.deepl.com/web",experimentsEndpoint:"https://s.deepl.com/chrome/experiments",gmailFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_db8ItFTmYBcZjYW",customerSegmentationSurveyFree:"https://deepl.qualtrics.com/jfe/form/SV_3LbBcdg4mjQuCCq?desc=TG-2071",customerSegmentationSurveyPro:"https://deepl.qualtrics.com/jfe/form/SV_3LbBcdg4mjQuCCq?desc=TG-2070",arabicSurvey:"https://deepl.qualtrics.com/jfe/form/SV_ekTrC2ePp0wn7xQ",msAddinsDeepLAds:"https://www.deepl.com/en/microsoft-365"}.deeplWrite,DEEPL_COM_DOCTRANS:"https://www.deepl.com/translator/files",DEEPL_COM_TERMS_OF_SERVICE_FREE:"https://www.deepl.com/en/pro-license?tab=free",DEEPL_CREATE_ACCOUNT:"https://www.deepl.com/signup",SHORTCUT_SETTINGS:"chrome://extensions/shortcuts",SUPPORT_ARTICLE:"https://support.deepl.com/hc/articles/4407580229522",CHROME_WEBSTORE:"https://chrome.google.com/webstore/detail/deepl-translate-reading-w/cofdbpoegempjloogbagkncekinflcnj",FIREFOX_WEBSTORE:"https://addons.mozilla.org/en-US/firefox/addon/deepl-translate",EDGE_WEBSTORE:"https://microsoftedge.microsoft.com/addons/detail/deepl-translate-reading-/fancfknaplihpclbhbpclnmmjcjanbaf",GMAIL_FEEDBACK_SURVEY:"https://deepl.qualtrics.com/jfe/form/SV_db8ItFTmYBcZjYW",GSLIDES_FEEDBACK_SURVEY:"https://deepl.qualtrics.com/jfe/form/SV_9XBLSAbDmLq5emO",EXTERNAL:{WHATSAPP:"https://web.whatsapp.com",TWITTER:"https://www.twitter.com",YOUTUBE:"https://www.youtube.com",FACEBOOK:"https://www.facebook.com",GITHUB:"https://www.github.com",DISCORD:"https://www.discord.com",TELEGRAM:"https://web.telegram.org",REDDIT:"https://www.reddit.com",GMAIL:"https://www.gmail.com",GDOCS:"https://docs.google.com",GSLIDES:"https://slides.google.com",LINKEDIN:"https://www.linkedin.com/",MSOFFICE:"https://www.office.com/"},DEEPL_SUPPORT:"https://support.deepl.com/hc",FIREFOX_FEEDBACK:"https://deepl.qualtrics.com/jfe/form/SV_eyfDZqQmXuNTFOK",FIREFOX_SHORTCUT_DOCS:"https://support.mozilla.org/kb/manage-extension-shortcuts-firefox",FIREFOX_PRIVACY_POLICY:"https://addons.mozilla.org/en-US/firefox/addon/deepl-translate/privacy/",CUSTOMER_SEGMENTATION_SURVEY_FREE:"https://deepl.qualtrics.com/jfe/form/SV_3LbBcdg4mjQuCCq?desc=TG-2071",CUSTOMER_SEGMENTATION_SURVEY_PRO:"https://deepl.qualtrics.com/jfe/form/SV_3LbBcdg4mjQuCCq?desc=TG-2070",ARABIC_SURVEY:"https://deepl.qualtrics.com/jfe/form/SV_ekTrC2ePp0wn7xQ",MSOFFICE_ADDINS_ADS:"https://www.deepl.com/en/microsoft-365"};function getExternalUrl(e){const{destination:t,...n}=e;if(void 0!==t)switch(t){case URL_ACTIONS.share_feedback_survey:return URL_LIST.DOCS_GOOGLE_COM_FEEDBACK_FORM;case URL_ACTIONS.new_share_feedback_survey:return URL_LIST.NEW_FEEDBACK_FORM;case URL_ACTIONS.try_DeepL_Pro:return n?.utmContent?addParamsToURL(URL_LIST.DEEPL_COM_PRO,[["utm_source","browser_extension"],["utm_medium","chrome"],["utm_content",n?.utmContent]]):URL_LIST.DEEPL_COM_PRO;case URL_ACTIONS.try_DeepL_Pro_Write:return n?.utmContent?addParamsToURL(URL_LIST.DEEPL_COM_PRO_WRITE,[["utm_source","browser_extension"],["utm_medium","chrome"],["utm_content",n?.utmContent]]):URL_LIST.DEEPL_COM_PRO_WRITE;case URL_ACTIONS.show_more_translation:return n?getShareURL(n):void console.error("Invalid action.");case URL_ACTIONS.deepl_translator_home:return n?.utmContent?addParamsToURL(URL_LIST.DEEPL_COM_TRANSLATOR,[["utm_source","browser_extension"],["utm_medium","chrome"],["utm_content",n?.utmContent]]):URL_LIST.DEEPL_COM_TRANSLATOR;case URL_ACTIONS.deepl_write_home:return n?.utmContent?addParamsToURL(URL_LIST.DEEPL_COM_WRITE,[["utm_source","browser_extension"],["utm_medium","chrome"],["utm_content",n?.utmContent]]):URL_LIST.DEEPL_COM_WRITE;case URL_ACTIONS.deepl_translator_docs:return n?.utmContent?addParamsToURL(URL_LIST.DEEPL_COM_DOCTRANS,[["utm_source","browser_extension"],["utm_medium","chrome"],["utm_content",n?.utmContent]]):URL_LIST.DEEPL_COM_DOCTRANS;case URL_ACTIONS.deepl_terms_of_service_free:return URL_LIST.DEEPL_COM_TERMS_OF_SERVICE_FREE;case URL_ACTIONS.shortcut_settings:return URL_LIST.SHORTCUT_SETTINGS;case URL_ACTIONS.support_article:return URL_LIST.SUPPORT_ARTICLE;case URL_ACTIONS.external.whatsapp:return URL_LIST.EXTERNAL.WHATSAPP;case URL_ACTIONS.external.twitter:return URL_LIST.EXTERNAL.TWITTER;case URL_ACTIONS.external.youtube:return URL_LIST.EXTERNAL.YOUTUBE;case URL_ACTIONS.external.facebook:return URL_LIST.EXTERNAL.FACEBOOK;case URL_ACTIONS.external.github:return URL_LIST.EXTERNAL.GITHUB;case URL_ACTIONS.external.discord:return URL_LIST.EXTERNAL.DISCORD;case URL_ACTIONS.external.telegram:return URL_LIST.EXTERNAL.TELEGRAM;case URL_ACTIONS.external.reddit:return URL_LIST.EXTERNAL.REDDIT;case URL_ACTIONS.external.gmail:return URL_LIST.EXTERNAL.GMAIL;case URL_ACTIONS.external.gdocs:return URL_LIST.EXTERNAL.GDOCS;case URL_ACTIONS.external.gslides:return URL_LIST.EXTERNAL.GSLIDES;case URL_ACTIONS.external.linkedIn:return URL_LIST.EXTERNAL.LINKEDIN;case URL_ACTIONS.external.msOffice:return URL_LIST.EXTERNAL.MSOFFICE;case URL_ACTIONS.deepl_support:return URL_LIST.DEEPL_SUPPORT;case URL_ACTIONS.chrome_write_a_review:return URL_LIST.CHROME_WEBSTORE;case URL_ACTIONS.edge_write_a_review:return URL_LIST.EDGE_WEBSTORE;case URL_ACTIONS.gmail_feedback_survey:return URL_LIST.GMAIL_FEEDBACK_SURVEY;case URL_ACTIONS.gslides_feedback_survey:return URL_LIST.GSLIDES_FEEDBACK_SURVEY;case URL_ACTIONS.firefox_write_a_review:return URL_LIST.FIREFOX_WEBSTORE;case URL_ACTIONS.firefox_privacy_policy:return URL_LIST.FIREFOX_PRIVACY_POLICY;case URL_ACTIONS.firefox_feedback_survey:return URL_LIST.FIREFOX_FEEDBACK;case URL_ACTIONS.firefox_shortcut_docs:return URL_LIST.FIREFOX_SHORTCUT_DOCS;case URL_ACTIONS.deepl_create_account:if(n){let e=[];if(n.utmContent){e=[...[["utm_source","browser_extension"],["utm_medium","chrome"],["utm_content",n.utmContent]]]}if(n.redirectToOnboarding&&!isFirefoxExtension()){const t=`${chrome.runtime.getURL("")}onboarding.html`;e.push(["redirectUri",t])}return addParamsToURL(URL_LIST.DEEPL_CREATE_ACCOUNT,e)}return URL_LIST.DEEPL_CREATE_ACCOUNT;case URL_ACTIONS.customer_segmentation_survey_free:return URL_LIST.CUSTOMER_SEGMENTATION_SURVEY_FREE;case URL_ACTIONS.customer_segmentation_survey_pro:return URL_LIST.CUSTOMER_SEGMENTATION_SURVEY_PRO;case URL_ACTIONS.arabic_survey:return URL_LIST.ARABIC_SURVEY;case URL_ACTIONS.ms_office_addins_ads:return URL_LIST.MSOFFICE_ADDINS_ADS;default:return}}function redirectToExternalURL(e){const t=getExternalUrl(e),{openInSameTab:n}=e;if(!t)return;const r=validateURL(t);n?chrome.tabs.query({active:!0,currentWindow:!0},(function(e){const t=e[0];chrome.tabs.update(t.id,{url:r})})):chrome.tabs.create({url:r,active:!0})}function getShareURL({sourceLang:e,targetLang:t,textToShare:n}){if(!e||!t||!n)return"";const r=new URL(URL_LIST.DEEPL_COM_TRANSLATOR);let o=`${e.toLowerCase()}/${t.toLowerCase()}/${encodeURIComponent(n)}`;return r.hash=o,r.href}function validateURL(e){return new URL(e).href}function addParamsToURL(e,t){if(0===t.length||!e)return;const n=new URL(e);return t.forEach((e=>{2===e.length&&n.searchParams.append(e[0],e[1])})),n.href}const objectToString=Object.prototype.toString;function isError(e){switch(objectToString.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return isInstanceOf(e,Error)}}function isBuiltin(e,t){return objectToString.call(e)===`[object ${t}]`}function isErrorEvent$2(e){return isBuiltin(e,"ErrorEvent")}function isDOMError(e){return isBuiltin(e,"DOMError")}function isDOMException(e){return isBuiltin(e,"DOMException")}function isString(e){return isBuiltin(e,"String")}function isParameterizedString(e){return"object"==typeof e&&null!==e&&"__sentry_template_string__"in e&&"__sentry_template_values__"in e}function isPrimitive(e){return null===e||isParameterizedString(e)||"object"!=typeof e&&"function"!=typeof e}function isPlainObject(e){return isBuiltin(e,"Object")}function isEvent(e){return"undefined"!=typeof Event&&isInstanceOf(e,Event)}function isElement$2(e){return"undefined"!=typeof Element&&isInstanceOf(e,Element)}function isRegExp(e){return isBuiltin(e,"RegExp")}function isThenable(e){return Boolean(e&&e.then&&"function"==typeof e.then)}function isSyntheticEvent(e){return isPlainObject(e)&&"nativeEvent"in e&&"preventDefault"in e&&"stopPropagation"in e}function isNaN$1(e){return"number"==typeof e&&e!=e}function isInstanceOf(e,t){try{return e instanceof t}catch(e){return!1}}function isVueViewModel(e){return!("object"!=typeof e||null===e||!e.__isVue&&!e._isVue)}function truncate(e,t=0){return"string"!=typeof e||0===t||e.length<=t?e:`${e.slice(0,t)}...`}function snipLine(e,t){let n=e;const r=n.length;if(r<=150)return n;t>r&&(t=r);let o=Math.max(t-60,0);o<5&&(o=0);let a=Math.min(o+140,r);return a>r-5&&(a=r),a===r&&(o=Math.max(a-140,0)),n=n.slice(o,a),o>0&&(n=`'{snip} ${n}`),a<r&&(n+=" {snip}"),n}function safeJoin(e,t){if(!Array.isArray(e))return"";const n=[];for(let t=0;t<e.length;t++){const r=e[t];try{isVueViewModel(r)?n.push("[VueViewModel]"):n.push(String(r))}catch(e){n.push("[value cannot be serialized]")}}return n.join(t)}function isMatchingPattern(e,t,n=!1){return!!isString(e)&&(isRegExp(t)?t.test(e):!!isString(t)&&(n?e===t:e.includes(t)))}function stringMatchesSomePattern(e,t=[],n=!1){return t.some((t=>isMatchingPattern(e,t,n)))}function applyAggregateErrorsToEvent(e,t,n=250,r,o,a,i){if(!(a.exception&&a.exception.values&&i&&isInstanceOf(i.originalException,Error)))return;const s=a.exception.values.length>0?a.exception.values[a.exception.values.length-1]:void 0;s&&(a.exception.values=truncateAggregateExceptions(aggregateExceptionsFromError(e,t,o,i.originalException,r,a.exception.values,s,0),n))}function aggregateExceptionsFromError(e,t,n,r,o,a,i,s){if(a.length>=n+1)return a;let c=[...a];if(isInstanceOf(r[o],Error)){applyExceptionGroupFieldsForParentException(i,s);const a=e(t,r[o]),l=c.length;applyExceptionGroupFieldsForChildException(a,o,l,s),c=aggregateExceptionsFromError(e,t,n,r[o],o,[a,...c],a,l)}return Array.isArray(r.errors)&&r.errors.forEach(((r,a)=>{if(isInstanceOf(r,Error)){applyExceptionGroupFieldsForParentException(i,s);const l=e(t,r),u=c.length;applyExceptionGroupFieldsForChildException(l,`errors[${a}]`,u,s),c=aggregateExceptionsFromError(e,t,n,r,o,[l,...c],l,u)}})),c}function applyExceptionGroupFieldsForParentException(e,t){e.mechanism=e.mechanism||{type:"generic",handled:!0},e.mechanism={...e.mechanism,..."AggregateError"===e.type&&{is_exception_group:!0},exception_id:t}}function applyExceptionGroupFieldsForChildException(e,t,n,r){e.mechanism=e.mechanism||{type:"generic",handled:!0},e.mechanism={...e.mechanism,type:"chained",source:t,exception_id:n,parent_id:r}}function truncateAggregateExceptions(e,t){return e.map((e=>(e.value&&(e.value=truncate(e.value,t)),e)))}function isGlobalObj(e){return e&&e.Math==Math?e:void 0}const GLOBAL_OBJ="object"==typeof globalThis&&isGlobalObj(globalThis)||"object"==typeof window&&isGlobalObj(window)||"object"==typeof self&&isGlobalObj(self)||"object"==typeof global&&isGlobalObj(global)||function(){return this}()||{};function getGlobalObject(){return GLOBAL_OBJ}function getGlobalSingleton(e,t,n){const r=n||GLOBAL_OBJ,o=r.__SENTRY__=r.__SENTRY__||{};return o[e]||(o[e]=t())}const WINDOW$c=getGlobalObject(),DEFAULT_MAX_STRING_LENGTH=80;function htmlTreeAsString(e,t={}){if(!e)return"<unknown>";try{let n=e;const r=5,o=[];let a=0,i=0;const s=" > ",c=s.length;let l;const u=Array.isArray(t)?t:t.keyAttrs,d=!Array.isArray(t)&&t.maxStringLength||DEFAULT_MAX_STRING_LENGTH;for(;n&&a++<r&&(l=_htmlElementAsString(n,u),!("html"===l||a>1&&i+o.length*c+l.length>=d));)o.push(l),i+=l.length,n=n.parentNode;return o.reverse().join(s)}catch(e){return"<unknown>"}}function _htmlElementAsString(e,t){const n=e,r=[];let o,a,i,s,c;if(!n||!n.tagName)return"";if(WINDOW$c.HTMLElement&&n instanceof HTMLElement&&n.dataset&&n.dataset.sentryComponent)return n.dataset.sentryComponent;r.push(n.tagName.toLowerCase());const l=t&&t.length?t.filter((e=>n.getAttribute(e))).map((e=>[e,n.getAttribute(e)])):null;if(l&&l.length)l.forEach((e=>{r.push(`[${e[0]}="${e[1]}"]`)}));else if(n.id&&r.push(`#${n.id}`),o=n.className,o&&isString(o))for(a=o.split(/\s+/),c=0;c<a.length;c++)r.push(`.${a[c]}`);const u=["aria-label","type","name","title","alt"];for(c=0;c<u.length;c++)i=u[c],s=n.getAttribute(i),s&&r.push(`[${i}="${s}"]`);return r.join("")}function getLocationHref(){try{return WINDOW$c.document.location.href}catch(e){return""}}function getDomElement(e){return WINDOW$c.document&&WINDOW$c.document.querySelector?WINDOW$c.document.querySelector(e):null}function getComponentName(e){if(!WINDOW$c.HTMLElement)return null;let t=e;for(let e=0;e<5;e++){if(!t)return null;if(t instanceof HTMLElement&&t.dataset.sentryComponent)return t.dataset.sentryComponent;t=t.parentNode}return null}const DEBUG_BUILD$6="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__,PREFIX="Sentry Logger ",CONSOLE_LEVELS=["debug","info","warn","error","log","assert","trace"],originalConsoleMethods={};function consoleSandbox(e){if(!("console"in GLOBAL_OBJ))return e();const t=GLOBAL_OBJ.console,n={},r=Object.keys(originalConsoleMethods);r.forEach((e=>{const r=originalConsoleMethods[e];n[e]=t[e],t[e]=r}));try{return e()}finally{r.forEach((e=>{t[e]=n[e]}))}}function makeLogger(){let e=!1;const t={enable:()=>{e=!0},disable:()=>{e=!1},isEnabled:()=>e};return DEBUG_BUILD$6?CONSOLE_LEVELS.forEach((n=>{t[n]=(...t)=>{e&&consoleSandbox((()=>{GLOBAL_OBJ.console[n](`${PREFIX}[${n}]:`,...t)}))}})):CONSOLE_LEVELS.forEach((e=>{t[e]=()=>{}})),t}const logger=makeLogger(),DSN_REGEX=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function isValidProtocol(e){return"http"===e||"https"===e}function dsnToString(e,t=!1){const{host:n,path:r,pass:o,port:a,projectId:i,protocol:s,publicKey:c}=e;return`${s}://${c}${t&&o?`:${o}`:""}@${n}${a?`:${a}`:""}/${r?`${r}/`:r}${i}`}function dsnFromString(e){const t=DSN_REGEX.exec(e);if(!t)return void consoleSandbox((()=>{console.error(`Invalid Sentry Dsn: ${e}`)}));const[n,r,o="",a,i="",s]=t.slice(1);let c="",l=s;const u=l.split("/");if(u.length>1&&(c=u.slice(0,-1).join("/"),l=u.pop()),l){const e=l.match(/^\d+/);e&&(l=e[0])}return dsnFromComponents({host:a,pass:o,path:c,projectId:l,port:i,protocol:n,publicKey:r})}function dsnFromComponents(e){return{protocol:e.protocol,publicKey:e.publicKey||"",pass:e.pass||"",host:e.host,port:e.port||"",path:e.path||"",projectId:e.projectId}}function validateDsn(e){if(!DEBUG_BUILD$6)return!0;const{port:t,projectId:n,protocol:r}=e;return!["protocol","publicKey","host","projectId"].find((t=>!e[t]&&(logger.error(`Invalid Sentry Dsn: ${t} missing`),!0)))&&(n.match(/^\d+$/)?isValidProtocol(r)?!t||!isNaN(parseInt(t,10))||(logger.error(`Invalid Sentry Dsn: Invalid port ${t}`),!1):(logger.error(`Invalid Sentry Dsn: Invalid protocol ${r}`),!1):(logger.error(`Invalid Sentry Dsn: Invalid projectId ${n}`),!1))}function makeDsn(e){const t="string"==typeof e?dsnFromString(e):dsnFromComponents(e);if(t&&validateDsn(t))return t}class SentryError extends Error{constructor(e,t="warn"){super(e),this.message=e,this.name=new.target.prototype.constructor.name,Object.setPrototypeOf(this,new.target.prototype),this.logLevel=t}}function fill(e,t,n){if(!(t in e))return;const r=e[t],o=n(r);"function"==typeof o&&markFunctionWrapped(o,r),e[t]=o}function addNonEnumerableProperty(e,t,n){try{Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0})}catch(n){DEBUG_BUILD$6&&logger.log(`Failed to add non-enumerable property "${t}" to object`,e)}}function markFunctionWrapped(e,t){try{const n=t.prototype||{};e.prototype=t.prototype=n,addNonEnumerableProperty(e,"__sentry_original__",t)}catch(e){}}function getOriginalFunction(e){return e.__sentry_original__}function urlEncode(e){return Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&")}function convertToPlainObject(e){if(isError(e))return{message:e.message,name:e.name,stack:e.stack,...getOwnProperties(e)};if(isEvent(e)){const t={type:e.type,target:serializeEventTarget(e.target),currentTarget:serializeEventTarget(e.currentTarget),...getOwnProperties(e)};return"undefined"!=typeof CustomEvent&&isInstanceOf(e,CustomEvent)&&(t.detail=e.detail),t}return e}function serializeEventTarget(e){try{return isElement$2(e)?htmlTreeAsString(e):Object.prototype.toString.call(e)}catch(e){return"<unknown>"}}function getOwnProperties(e){if("object"==typeof e&&null!==e){const t={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}return{}}function extractExceptionKeysForMessage(e,t=40){const n=Object.keys(convertToPlainObject(e));if(n.sort(),!n.length)return"[object has no keys]";if(n[0].length>=t)return truncate(n[0],t);for(let e=n.length;e>0;e--){const r=n.slice(0,e).join(", ");if(!(r.length>t))return e===n.length?r:truncate(r,t)}return""}function dropUndefinedKeys(e){return _dropUndefinedKeys(e,new Map)}function _dropUndefinedKeys(e,t){if(isPojo(e)){const n=t.get(e);if(void 0!==n)return n;const r={};t.set(e,r);for(const n of Object.keys(e))void 0!==e[n]&&(r[n]=_dropUndefinedKeys(e[n],t));return r}if(Array.isArray(e)){const n=t.get(e);if(void 0!==n)return n;const r=[];return t.set(e,r),e.forEach((e=>{r.push(_dropUndefinedKeys(e,t))})),r}return e}function isPojo(e){if(!isPlainObject(e))return!1;try{const t=Object.getPrototypeOf(e).constructor.name;return!t||"Object"===t}catch(e){return!0}}const STACKTRACE_FRAME_LIMIT=50,WEBPACK_ERROR_REGEXP=/\(error: (.*)\)/,STRIP_FRAME_REGEXP=/captureMessage|captureException/;function createStackParser(...e){const t=e.sort(((e,t)=>e[0]-t[0])).map((e=>e[1]));return(e,n=0)=>{const r=[],o=e.split("\n");for(let e=n;e<o.length;e++){const n=o[e];if(n.length>1024)continue;const a=WEBPACK_ERROR_REGEXP.test(n)?n.replace(WEBPACK_ERROR_REGEXP,"$1"):n;if(!a.match(/\S*Error: /)){for(const e of t){const t=e(a);if(t){r.push(t);break}}if(r.length>=STACKTRACE_FRAME_LIMIT)break}}return stripSentryFramesAndReverse(r)}}function stackParserFromStackParserOptions(e){return Array.isArray(e)?createStackParser(...e):e}function stripSentryFramesAndReverse(e){if(!e.length)return[];const t=Array.from(e);return/sentryWrapped/.test(t[t.length-1].function||"")&&t.pop(),t.reverse(),STRIP_FRAME_REGEXP.test(t[t.length-1].function||"")&&(t.pop(),STRIP_FRAME_REGEXP.test(t[t.length-1].function||"")&&t.pop()),t.slice(0,STACKTRACE_FRAME_LIMIT).map((e=>({...e,filename:e.filename||t[t.length-1].filename,function:e.function||"?"})))}const defaultFunctionName="<anonymous>";function getFunctionName(e){try{return e&&"function"==typeof e&&e.name||defaultFunctionName}catch(e){return defaultFunctionName}}const handlers$2={},instrumented$1={};function addHandler$1(e,t){handlers$2[e]=handlers$2[e]||[],handlers$2[e].push(t)}function maybeInstrument(e,t){instrumented$1[e]||(t(),instrumented$1[e]=!0)}function triggerHandlers$1(e,t){const n=e&&handlers$2[e];if(n)for(const r of n)try{r(t)}catch(t){DEBUG_BUILD$6&&logger.error(`Error while triggering instrumentation handler.\nType: ${e}\nName: ${getFunctionName(r)}\nError:`,t)}}function addConsoleInstrumentationHandler(e){const t="console";addHandler$1(t,e),maybeInstrument(t,instrumentConsole)}function instrumentConsole(){"console"in GLOBAL_OBJ&&CONSOLE_LEVELS.forEach((function(e){e in GLOBAL_OBJ.console&&fill(GLOBAL_OBJ.console,e,(function(t){return originalConsoleMethods[e]=t,function(...t){triggerHandlers$1("console",{args:t,level:e});const n=originalConsoleMethods[e];n&&n.apply(GLOBAL_OBJ.console,t)}}))}))}function uuid4(){const e=GLOBAL_OBJ,t=e.crypto||e.msCrypto;let n=()=>16*Math.random();try{if(t&&t.randomUUID)return t.randomUUID().replace(/-/g,"");t&&t.getRandomValues&&(n=()=>{const e=new Uint8Array(1);return t.getRandomValues(e),e[0]})}catch(e){}return([1e7]+1e3+4e3+8e3+1e11).replace(/[018]/g,(e=>(e^(15&n())>>e/4).toString(16)))}function getFirstException(e){return e.exception&&e.exception.values?e.exception.values[0]:void 0}function getEventDescription(e){const{message:t,event_id:n}=e;if(t)return t;const r=getFirstException(e);return r?r.type&&r.value?`${r.type}: ${r.value}`:r.type||r.value||n||"<unknown>":n||"<unknown>"}function addExceptionTypeValue(e,t,n){const r=e.exception=e.exception||{},o=r.values=r.values||[],a=o[0]=o[0]||{};a.value||(a.value=t||""),a.type||(a.type=n||"Error")}function addExceptionMechanism(e,t){const n=getFirstException(e);if(!n)return;const r=n.mechanism;if(n.mechanism={type:"generic",handled:!0,...r,...t},t&&"data"in t){const e={...r&&r.data,...t.data};n.mechanism.data=e}}function addContextToFrame(e,t,n=5){if(void 0===t.lineno)return;const r=e.length,o=Math.max(Math.min(r-1,t.lineno-1),0);t.pre_context=e.slice(Math.max(0,o-n),o).map((e=>snipLine(e,0))),t.context_line=snipLine(e[Math.min(r-1,o)],t.colno||0),t.post_context=e.slice(Math.min(o+1,r),o+1+n).map((e=>snipLine(e,0)))}function checkOrSetAlreadyCaught(e){if(e&&e.__sentry_captured__)return!0;try{addNonEnumerableProperty(e,"__sentry_captured__",!0)}catch(e){}return!1}function arrayify(e){return Array.isArray(e)?e:[e]}const WINDOW$b=GLOBAL_OBJ,DEBOUNCE_DURATION=1e3;let debounceTimerID,lastCapturedEventType,lastCapturedEventTargetId;function addClickKeypressInstrumentationHandler(e){addHandler$1("dom",e),maybeInstrument("dom",instrumentDOM)}function instrumentDOM(){if(!WINDOW$b.document)return;const e=triggerHandlers$1.bind(null,"dom"),t=makeDOMEventHandler(e,!0);WINDOW$b.document.addEventListener("click",t,!1),WINDOW$b.document.addEventListener("keypress",t,!1),["EventTarget","Node"].forEach((t=>{const n=WINDOW$b[t]&&WINDOW$b[t].prototype;n&&n.hasOwnProperty&&n.hasOwnProperty("addEventListener")&&(fill(n,"addEventListener",(function(t){return function(n,r,o){if("click"===n||"keypress"==n)try{const r=this,a=r.__sentry_instrumentation_handlers__=r.__sentry_instrumentation_handlers__||{},i=a[n]=a[n]||{refCount:0};if(!i.handler){const r=makeDOMEventHandler(e);i.handler=r,t.call(this,n,r,o)}i.refCount++}catch(e){}return t.call(this,n,r,o)}})),fill(n,"removeEventListener",(function(e){return function(t,n,r){if("click"===t||"keypress"==t)try{const n=this,o=n.__sentry_instrumentation_handlers__||{},a=o[t];a&&(a.refCount--,a.refCount<=0&&(e.call(this,t,a.handler,r),a.handler=void 0,delete o[t]),0===Object.keys(o).length&&delete n.__sentry_instrumentation_handlers__)}catch(e){}return e.call(this,t,n,r)}})))}))}function isSimilarToLastCapturedEvent(e){if(e.type!==lastCapturedEventType)return!1;try{if(!e.target||e.target._sentryId!==lastCapturedEventTargetId)return!1}catch(e){}return!0}function shouldSkipDOMEvent(e,t){return"keypress"===e&&(!t||!t.tagName||"INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName&&!t.isContentEditable)}function makeDOMEventHandler(e,t=!1){return n=>{if(!n||n._sentryCaptured)return;const r=getEventTarget$1(n);if(shouldSkipDOMEvent(n.type,r))return;addNonEnumerableProperty(n,"_sentryCaptured",!0),r&&!r._sentryId&&addNonEnumerableProperty(r,"_sentryId",uuid4());const o="keypress"===n.type?"input":n.type;if(!isSimilarToLastCapturedEvent(n)){e({event:n,name:o,global:t}),lastCapturedEventType=n.type,lastCapturedEventTargetId=r?r._sentryId:void 0}clearTimeout(debounceTimerID),debounceTimerID=WINDOW$b.setTimeout((()=>{lastCapturedEventTargetId=void 0,lastCapturedEventType=void 0}),DEBOUNCE_DURATION)}}function getEventTarget$1(e){try{return e.target}catch(e){return null}}const WINDOW$a=getGlobalObject();function supportsFetch(){if(!("fetch"in WINDOW$a))return!1;try{return new Headers,new Request("http://www.example.com"),new Response,!0}catch(e){return!1}}function isNativeFetch(e){return e&&/^function fetch\(\)\s+\{\s+\[native code\]\s+\}$/.test(e.toString())}function supportsNativeFetch(){if("string"==typeof EdgeRuntime)return!0;if(!supportsFetch())return!1;if(isNativeFetch(WINDOW$a.fetch))return!0;let e=!1;const t=WINDOW$a.document;if(t&&"function"==typeof t.createElement)try{const n=t.createElement("iframe");n.hidden=!0,t.head.appendChild(n),n.contentWindow&&n.contentWindow.fetch&&(e=isNativeFetch(n.contentWindow.fetch)),t.head.removeChild(n)}catch(e){DEBUG_BUILD$6&&logger.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",e)}return e}function supportsReportingObserver(){return"ReportingObserver"in WINDOW$a}function addFetchInstrumentationHandler(e){const t="fetch";addHandler$1(t,e),maybeInstrument(t,instrumentFetch)}function instrumentFetch(){supportsNativeFetch()&&fill(GLOBAL_OBJ,"fetch",(function(e){return function(...t){const{method:n,url:r}=parseFetchArgs(t),o={args:t,fetchData:{method:n,url:r},startTimestamp:Date.now()};return triggerHandlers$1("fetch",{...o}),e.apply(GLOBAL_OBJ,t).then((e=>(triggerHandlers$1("fetch",{...o,endTimestamp:Date.now(),response:e}),e)),(e=>{throw triggerHandlers$1("fetch",{...o,endTimestamp:Date.now(),error:e}),e}))}}))}function hasProp(e,t){return!!e&&"object"==typeof e&&!!e[t]}function getUrlFromResource(e){return"string"==typeof e?e:e?hasProp(e,"url")?e.url:e.toString?e.toString():"":""}function parseFetchArgs(e){if(0===e.length)return{method:"GET",url:""};if(2===e.length){const[t,n]=e;return{url:getUrlFromResource(t),method:hasProp(n,"method")?String(n.method).toUpperCase():"GET"}}const t=e[0];return{url:getUrlFromResource(t),method:hasProp(t,"method")?String(t.method).toUpperCase():"GET"}}let _oldOnErrorHandler=null;function addGlobalErrorInstrumentationHandler(e){const t="error";addHandler$1(t,e),maybeInstrument(t,instrumentError)}function instrumentError(){_oldOnErrorHandler=GLOBAL_OBJ.onerror,GLOBAL_OBJ.onerror=function(e,t,n,r,o){return triggerHandlers$1("error",{column:r,error:o,line:n,msg:e,url:t}),!(!_oldOnErrorHandler||_oldOnErrorHandler.__SENTRY_LOADER__)&&_oldOnErrorHandler.apply(this,arguments)},GLOBAL_OBJ.onerror.__SENTRY_INSTRUMENTED__=!0}let _oldOnUnhandledRejectionHandler=null;function addGlobalUnhandledRejectionInstrumentationHandler(e){const t="unhandledrejection";addHandler$1(t,e),maybeInstrument(t,instrumentUnhandledRejection)}function instrumentUnhandledRejection(){_oldOnUnhandledRejectionHandler=GLOBAL_OBJ.onunhandledrejection,GLOBAL_OBJ.onunhandledrejection=function(e){return triggerHandlers$1("unhandledrejection",e),!(_oldOnUnhandledRejectionHandler&&!_oldOnUnhandledRejectionHandler.__SENTRY_LOADER__)||_oldOnUnhandledRejectionHandler.apply(this,arguments)},GLOBAL_OBJ.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}const WINDOW$9=getGlobalObject();function supportsHistory(){const e=WINDOW$9.chrome,t=e&&e.app&&e.app.runtime,n="history"in WINDOW$9&&!!WINDOW$9.history.pushState&&!!WINDOW$9.history.replaceState;return!t&&n}const WINDOW$8=GLOBAL_OBJ;let lastHref;function addHistoryInstrumentationHandler(e){const t="history";addHandler$1(t,e),maybeInstrument(t,instrumentHistory)}function instrumentHistory(){if(!supportsHistory())return;const e=WINDOW$8.onpopstate;function t(e){return function(...t){const n=t.length>2?t[2]:void 0;if(n){const e=lastHref,t=String(n);lastHref=t;triggerHandlers$1("history",{from:e,to:t})}return e.apply(this,t)}}WINDOW$8.onpopstate=function(...t){const n=WINDOW$8.location.href,r=lastHref;lastHref=n;if(triggerHandlers$1("history",{from:r,to:n}),e)try{return e.apply(this,t)}catch(e){}},fill(WINDOW$8.history,"pushState",t),fill(WINDOW$8.history,"replaceState",t)}const WINDOW$7=GLOBAL_OBJ,SENTRY_XHR_DATA_KEY="__sentry_xhr_v3__";function addXhrInstrumentationHandler(e){addHandler$1("xhr",e),maybeInstrument("xhr",instrumentXHR)}function instrumentXHR(){if(!WINDOW$7.XMLHttpRequest)return;const e=XMLHttpRequest.prototype;fill(e,"open",(function(e){return function(...t){const n=Date.now(),r=isString(t[0])?t[0].toUpperCase():void 0,o=parseUrl$1(t[1]);if(!r||!o)return e.apply(this,t);this[SENTRY_XHR_DATA_KEY]={method:r,url:o,request_headers:{}},"POST"===r&&o.match(/sentry_key/)&&(this.__sentry_own_request__=!0);const a=()=>{const e=this[SENTRY_XHR_DATA_KEY];if(e&&4===this.readyState){try{e.status_code=this.status}catch(e){}triggerHandlers$1("xhr",{args:[r,o],endTimestamp:Date.now(),startTimestamp:n,xhr:this})}};return"onreadystatechange"in this&&"function"==typeof this.onreadystatechange?fill(this,"onreadystatechange",(function(e){return function(...t){return a(),e.apply(this,t)}})):this.addEventListener("readystatechange",a),fill(this,"setRequestHeader",(function(e){return function(...t){const[n,r]=t,o=this[SENTRY_XHR_DATA_KEY];return o&&isString(n)&&isString(r)&&(o.request_headers[n.toLowerCase()]=r),e.apply(this,t)}})),e.apply(this,t)}})),fill(e,"send",(function(e){return function(...t){const n=this[SENTRY_XHR_DATA_KEY];if(!n)return e.apply(this,t);void 0!==t[0]&&(n.body=t[0]);return triggerHandlers$1("xhr",{args:[n.method,n.url],startTimestamp:Date.now(),xhr:this}),e.apply(this,t)}}))}function parseUrl$1(e){if(isString(e))return e;try{return e.toString()}catch(e){}}function isBrowserBundle(){return"undefined"!=typeof __SENTRY_BROWSER_BUNDLE__&&!!__SENTRY_BROWSER_BUNDLE__}function getSDKSource(){return"npm"}function isNodeEnv(){return!isBrowserBundle()&&"[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)}function dynamicRequire(e,t){return e.require(t)}function loadModule(e){let t;try{t=dynamicRequire(module,e)}catch(e){}try{const{cwd:n}=dynamicRequire(module,"process");t=dynamicRequire(module,`${n()}/node_modules/${e}`)}catch(e){}return t}function isBrowser(){return"undefined"!=typeof window&&(!isNodeEnv()||isElectronNodeRenderer())}function isElectronNodeRenderer(){return void 0!==GLOBAL_OBJ.process&&"renderer"===GLOBAL_OBJ.process.type}function memoBuilder(){const e="function"==typeof WeakSet,t=e?new WeakSet:[];return[function(n){if(e)return!!t.has(n)||(t.add(n),!1);for(let e=0;e<t.length;e++){if(t[e]===n)return!0}return t.push(n),!1},function(n){if(e)t.delete(n);else for(let e=0;e<t.length;e++)if(t[e]===n){t.splice(e,1);break}}]}function normalize(e,t=100,n=1/0){try{return visit("",e,t,n)}catch(e){return{ERROR:`**non-serializable** (${e})`}}}function normalizeToSize(e,t=3,n=102400){const r=normalize(e,t);return jsonSize(r)>n?normalizeToSize(e,t-1,n):r}function visit(e,t,n=1/0,r=1/0,o=memoBuilder()){const[a,i]=o;if(null==t||["number","boolean","string"].includes(typeof t)&&!isNaN$1(t))return t;const s=stringifyValue(e,t);if(!s.startsWith("[object "))return s;if(t.__sentry_skip_normalization__)return t;const c="number"==typeof t.__sentry_override_normalization_depth__?t.__sentry_override_normalization_depth__:n;if(0===c)return s.replace("object ","");if(a(t))return"[Circular ~]";const l=t;if(l&&"function"==typeof l.toJSON)try{return visit("",l.toJSON(),c-1,r,o)}catch(e){}const u=Array.isArray(t)?[]:{};let d=0;const p=convertToPlainObject(t);for(const e in p){if(!Object.prototype.hasOwnProperty.call(p,e))continue;if(d>=r){u[e]="[MaxProperties ~]";break}const t=p[e];u[e]=visit(e,t,c-1,r,o),d++}return i(t),u}function stringifyValue(e,t){try{if("domain"===e&&t&&"object"==typeof t&&t._events)return"[Domain]";if("domainEmitter"===e)return"[DomainEmitter]";if("undefined"!=typeof global&&t===global)return"[Global]";if("undefined"!=typeof window&&t===window)return"[Window]";if("undefined"!=typeof document&&t===document)return"[Document]";if(isVueViewModel(t))return"[VueViewModel]";if(isSyntheticEvent(t))return"[SyntheticEvent]";if("number"==typeof t&&t!=t)return"[NaN]";if("function"==typeof t)return`[Function: ${getFunctionName(t)}]`;if("symbol"==typeof t)return`[${String(t)}]`;if("bigint"==typeof t)return`[BigInt: ${String(t)}]`;const n=getConstructorName(t);return/^HTML(\w*)Element$/.test(n)?`[HTMLElement: ${n}]`:`[object ${n}]`}catch(e){return`**non-serializable** (${e})`}}function getConstructorName(e){const t=Object.getPrototypeOf(e);return t?t.constructor.name:"null prototype"}function utf8Length(e){return~-encodeURI(e).split(/%..|./).length}function jsonSize(e){return utf8Length(JSON.stringify(e))}function normalizeArray(e,t){let n=0;for(let t=e.length-1;t>=0;t--){const r=e[t];"."===r?e.splice(t,1):".."===r?(e.splice(t,1),n++):n&&(e.splice(t,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}const splitPathRe=/^(\S+:\\|\/?)([\s\S]*?)((?:\.{1,2}|[^/\\]+?|)(\.[^./\\]*|))(?:[/\\]*)$/;function splitPath(e){const t=e.length>1024?`<truncated>${e.slice(-1024)}`:e,n=splitPathRe.exec(t);return n?n.slice(1):[]}function resolve(...e){let t="",n=!1;for(let r=e.length-1;r>=-1&&!n;r--){const o=r>=0?e[r]:"/";o&&(t=`${o}/${t}`,n="/"===o.charAt(0))}return t=normalizeArray(t.split("/").filter((e=>!!e)),!n).join("/"),(n?"/":"")+t||"."}function trim(e){let t=0;for(;t<e.length&&""===e[t];t++);let n=e.length-1;for(;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}function relative(e,t){e=resolve(e).slice(1),t=resolve(t).slice(1);const n=trim(e.split("/")),r=trim(t.split("/")),o=Math.min(n.length,r.length);let a=o;for(let e=0;e<o;e++)if(n[e]!==r[e]){a=e;break}let i=[];for(let e=a;e<n.length;e++)i.push("..");return i=i.concat(r.slice(a)),i.join("/")}function basename(e,t){let n=splitPath(e)[2];return t&&n.slice(-1*t.length)===t&&(n=n.slice(0,n.length-t.length)),n}var States;function resolvedSyncPromise(e){return new SyncPromise((t=>{t(e)}))}function rejectedSyncPromise(e){return new SyncPromise(((t,n)=>{n(e)}))}!function(e){e[e.PENDING=0]="PENDING";e[e.RESOLVED=1]="RESOLVED";e[e.REJECTED=2]="REJECTED"}(States||(States={}));class SyncPromise{constructor(e){SyncPromise.prototype.__init.call(this),SyncPromise.prototype.__init2.call(this),SyncPromise.prototype.__init3.call(this),SyncPromise.prototype.__init4.call(this),this._state=States.PENDING,this._handlers=[];try{e(this._resolve,this._reject)}catch(e){this._reject(e)}}then(e,t){return new SyncPromise(((n,r)=>{this._handlers.push([!1,t=>{if(e)try{n(e(t))}catch(e){r(e)}else n(t)},e=>{if(t)try{n(t(e))}catch(e){r(e)}else r(e)}]),this._executeHandlers()}))}catch(e){return this.then((e=>e),e)}finally(e){return new SyncPromise(((t,n)=>{let r,o;return this.then((t=>{o=!1,r=t,e&&e()}),(t=>{o=!0,r=t,e&&e()})).then((()=>{o?n(r):t(r)}))}))}__init(){this._resolve=e=>{this._setResult(States.RESOLVED,e)}}__init2(){this._reject=e=>{this._setResult(States.REJECTED,e)}}__init3(){this._setResult=(e,t)=>{this._state===States.PENDING&&(isThenable(t)?t.then(this._resolve,this._reject):(this._state=e,this._value=t,this._executeHandlers()))}}__init4(){this._executeHandlers=()=>{if(this._state===States.PENDING)return;const e=this._handlers.slice();this._handlers=[],e.forEach((e=>{e[0]||(this._state===States.RESOLVED&&e[1](this._value),this._state===States.REJECTED&&e[2](this._value),e[0]=!0)}))}}}function makePromiseBuffer(e){const t=[];function n(e){return t.splice(t.indexOf(e),1)[0]}return{$:t,add:function(r){if(!(void 0===e||t.length<e))return rejectedSyncPromise(new SentryError("Not adding Promise because buffer limit was reached."));const o=r();return-1===t.indexOf(o)&&t.push(o),o.then((()=>n(o))).then(null,(()=>n(o).then(null,(()=>{})))),o},drain:function(e){return new SyncPromise(((n,r)=>{let o=t.length;if(!o)return n(!0);const a=setTimeout((()=>{e&&e>0&&n(!1)}),e);t.forEach((e=>{resolvedSyncPromise(e).then((()=>{--o||(clearTimeout(a),n(!0))}),r)}))}))}}}function parseCookie(e){const t={};let n=0;for(;n<e.length;){const r=e.indexOf("=",n);if(-1===r)break;let o=e.indexOf(";",n);if(-1===o)o=e.length;else if(o<r){n=e.lastIndexOf(";",r-1)+1;continue}const a=e.slice(n,r).trim();if(void 0===t[a]){let n=e.slice(r+1,o).trim();34===n.charCodeAt(0)&&(n=n.slice(1,-1));try{t[a]=-1!==n.indexOf("%")?decodeURIComponent(n):n}catch(e){t[a]=n}}n=o+1}return t}function parseUrl(e){if(!e)return{};const t=e.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!t)return{};const n=t[6]||"",r=t[8]||"";return{host:t[4],path:t[5],protocol:t[2],search:n,hash:r,relative:t[5]+n+r}}function stripUrlQueryAndFragment(e){return e.split(/[\?#]/,1)[0]}function getNumberOfUrlSegments(e){return e.split(/\\?\//).filter((e=>e.length>0&&","!==e)).length}const DEFAULT_INCLUDES={ip:!1,request:!0,transaction:!0,user:!0},DEFAULT_REQUEST_INCLUDES=["cookies","data","headers","method","query_string","url"],DEFAULT_USER_INCLUDES=["id","username","email"];function extractPathForTransaction(e,t={}){const n=e.method&&e.method.toUpperCase();let r="",o="url";t.customRoute||e.route?(r=t.customRoute||`${e.baseUrl||""}${e.route&&e.route.path}`,o="route"):(e.originalUrl||e.url)&&(r=stripUrlQueryAndFragment(e.originalUrl||e.url||""));let a="";return t.method&&n&&(a+=n),t.method&&t.path&&(a+=" "),t.path&&r&&(a+=r),[a,o]}function extractTransaction(e,t){switch(t){case"path":return extractPathForTransaction(e,{path:!0})[0];case"handler":return e.route&&e.route.stack&&e.route.stack[0]&&e.route.stack[0].name||"<anonymous>";default:return extractPathForTransaction(e,{path:!0,method:!0,customRoute:e._reconstructedRoute?e._reconstructedRoute:void 0})[0]}}function extractUserData(e,t){const n={};return(Array.isArray(t)?t:DEFAULT_USER_INCLUDES).forEach((t=>{e&&t in e&&(n[t]=e[t])})),n}function extractRequestData(e,t){const{include:n=DEFAULT_REQUEST_INCLUDES,deps:r}=t||{},o={},a=e.headers||{},i=e.method,s=a.host||e.hostname||e.host||"<no host>",c="https"===e.protocol||e.socket&&e.socket.encrypted?"https":"http",l=e.originalUrl||e.url||"",u=l.startsWith(c)?l:`${c}://${s}${l}`;return n.forEach((t=>{switch(t){case"headers":o.headers=a,n.includes("cookies")||delete o.headers.cookie;break;case"method":o.method=i;break;case"url":o.url=u;break;case"cookies":o.cookies=e.cookies||a.cookie&&parseCookie(a.cookie)||{};break;case"query_string":o.query_string=extractQueryParams(e,r);break;case"data":if("GET"===i||"HEAD"===i)break;void 0!==e.body&&(o.data=isString(e.body)?e.body:JSON.stringify(normalize(e.body)));break;default:({}).hasOwnProperty.call(e,t)&&(o[t]=e[t])}})),o}function addRequestDataToEvent(e,t,n){const r={...DEFAULT_INCLUDES,...n&&n.include};if(r.request){const o=Array.isArray(r.request)?extractRequestData(t,{include:r.request,deps:n&&n.deps}):extractRequestData(t,{deps:n&&n.deps});e.request={...e.request,...o}}if(r.user){const n=t.user&&isPlainObject(t.user)?extractUserData(t.user,r.user):{};Object.keys(n).length&&(e.user={...e.user,...n})}if(r.ip){const n=t.ip||t.socket&&t.socket.remoteAddress;n&&(e.user={...e.user,ip_address:n})}return r.transaction&&!e.transaction&&(e.transaction=extractTransaction(t,r.transaction)),e}function extractQueryParams(e,t){let n=e.originalUrl||e.url||"";if(n){n.startsWith("/")&&(n=`http://dogs.are.great${n}`);try{return e.query||"undefined"!=typeof URL&&new URL(n).search.slice(1)||t&&t.url&&t.url.parse(n).query||void 0}catch(e){return}}}const validSeverityLevels=["fatal","error","warning","log","info","debug"];function severityLevelFromString(e){return"warn"===e?"warning":validSeverityLevels.includes(e)?e:"log"}const ONE_SECOND_IN_MS=1e3;function dateTimestampInSeconds(){return Date.now()/ONE_SECOND_IN_MS}function createUnixTimestampInSecondsFunc(){const{performance:e}=GLOBAL_OBJ;if(!e||!e.now)return dateTimestampInSeconds;const t=Date.now()-e.now(),n=null==e.timeOrigin?t:e.timeOrigin;return()=>(n+e.now())/ONE_SECOND_IN_MS}const timestampInSeconds=createUnixTimestampInSecondsFunc(),browserPerformanceTimeOrigin=(()=>{const{performance:e}=GLOBAL_OBJ;if(!e||!e.now)return;const t=36e5,n=e.now(),r=Date.now(),o=e.timeOrigin?Math.abs(e.timeOrigin+n-r):t,a=o<t,i=e.timing&&e.timing.navigationStart,s="number"==typeof i?Math.abs(i+n-r):t;return a||s<t?o<=s?e.timeOrigin:i:r})(),BAGGAGE_HEADER_NAME="baggage",SENTRY_BAGGAGE_KEY_PREFIX="sentry-",SENTRY_BAGGAGE_KEY_PREFIX_REGEX=/^sentry-/,MAX_BAGGAGE_STRING_LENGTH=8192;function baggageHeaderToDynamicSamplingContext(e){if(!isString(e)&&!Array.isArray(e))return;let t={};if(Array.isArray(e))t=e.reduce(((e,t)=>{const n=baggageHeaderToObject(t);for(const t of Object.keys(n))e[t]=n[t];return e}),{});else{if(!e)return;t=baggageHeaderToObject(e)}const n=Object.entries(t).reduce(((e,[t,n])=>{if(t.match(SENTRY_BAGGAGE_KEY_PREFIX_REGEX)){e[t.slice(SENTRY_BAGGAGE_KEY_PREFIX.length)]=n}return e}),{});return Object.keys(n).length>0?n:void 0}function dynamicSamplingContextToSentryBaggageHeader(e){if(!e)return;return objectToBaggageHeader(Object.entries(e).reduce(((e,[t,n])=>(n&&(e[`${SENTRY_BAGGAGE_KEY_PREFIX}${t}`]=n),e)),{}))}function baggageHeaderToObject(e){return e.split(",").map((e=>e.split("=").map((e=>decodeURIComponent(e.trim()))))).reduce(((e,[t,n])=>(e[t]=n,e)),{})}function objectToBaggageHeader(e){if(0!==Object.keys(e).length)return Object.entries(e).reduce(((e,[t,n],r)=>{const o=`${encodeURIComponent(t)}=${encodeURIComponent(n)}`,a=0===r?o:`${e},${o}`;return a.length>MAX_BAGGAGE_STRING_LENGTH?(DEBUG_BUILD$6&&logger.warn(`Not adding key: ${t} with val: ${n} to baggage header due to exceeding baggage size limits.`),e):a}),"")}const TRACEPARENT_REGEXP=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function extractTraceparentData$1(e){if(!e)return;const t=e.match(TRACEPARENT_REGEXP);if(!t)return;let n;return"1"===t[3]?n=!0:"0"===t[3]&&(n=!1),{traceId:t[1],parentSampled:n,parentSpanId:t[2]}}function tracingContextFromHeaders(e,t){const n=extractTraceparentData$1(e),r=baggageHeaderToDynamicSamplingContext(t),{traceId:o,parentSpanId:a,parentSampled:i}=n||{};return n?{traceparentData:n,dynamicSamplingContext:r||{},propagationContext:{traceId:o||uuid4(),parentSpanId:a||uuid4().substring(16),spanId:uuid4().substring(16),sampled:i,dsc:r||{}}}:{traceparentData:n,dynamicSamplingContext:void 0,propagationContext:{traceId:o||uuid4(),spanId:uuid4().substring(16)}}}function propagationContextFromHeaders(e,t){const n=extractTraceparentData$1(e),r=baggageHeaderToDynamicSamplingContext(t),{traceId:o,parentSpanId:a,parentSampled:i}=n||{};return n?{traceId:o||uuid4(),parentSpanId:a||uuid4().substring(16),spanId:uuid4().substring(16),sampled:i,dsc:r||{}}:{traceId:o||uuid4(),spanId:uuid4().substring(16)}}function generateSentryTraceHeader(e=uuid4(),t=uuid4().substring(16),n){let r="";return void 0!==n&&(r=n?"-1":"-0"),`${e}-${t}${r}`}function createEnvelope(e,t=[]){return[e,t]}function addItemToEnvelope(e,t){const[n,r]=e;return[n,[...r,t]]}function forEachEnvelopeItem(e,t){const n=e[1];for(const e of n){if(t(e,e[0].type))return!0}return!1}function envelopeContainsItemType(e,t){return forEachEnvelopeItem(e,((e,n)=>t.includes(n)))}function encodeUTF8(e,t){return(t||new TextEncoder).encode(e)}function serializeEnvelope(e,t){const[n,r]=e;let o=JSON.stringify(n);function a(e){"string"==typeof o?o="string"==typeof e?o+e:[encodeUTF8(o,t),e]:o.push("string"==typeof e?encodeUTF8(e,t):e)}for(const e of r){const[t,n]=e;if(a(`\n${JSON.stringify(t)}\n`),"string"==typeof n||n instanceof Uint8Array)a(n);else{let e;try{e=JSON.stringify(n)}catch(t){e=JSON.stringify(normalize(n))}a(e)}}return"string"==typeof o?o:concatBuffers(o)}function concatBuffers(e){const t=e.reduce(((e,t)=>e+t.length),0),n=new Uint8Array(t);let r=0;for(const t of e)n.set(t,r),r+=t.length;return n}function parseEnvelope(e,t,n){let r="string"==typeof e?t.encode(e):e;function o(e){const t=r.subarray(0,e);return r=r.subarray(e+1),t}function a(){let e=r.indexOf(10);return e<0&&(e=r.length),JSON.parse(n.decode(o(e)))}const i=a(),s=[];for(;r.length;){const e=a(),t="number"==typeof e.length?e.length:void 0;s.push([e,t?o(t):a()])}return[i,s]}function createAttachmentEnvelopeItem(e,t){const n="string"==typeof e.data?encodeUTF8(e.data,t):e.data;return[dropUndefinedKeys({type:"attachment",length:n.length,filename:e.filename,content_type:e.contentType,attachment_type:e.attachmentType}),n]}const ITEM_TYPE_TO_DATA_CATEGORY_MAP={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",statsd:"metric_bucket"};function envelopeItemTypeToDataCategory(e){return ITEM_TYPE_TO_DATA_CATEGORY_MAP[e]}function getSdkMetadataForEnvelopeHeader(e){if(!e||!e.sdk)return;const{name:t,version:n}=e.sdk;return{name:t,version:n}}function createEventEnvelopeHeaders(e,t,n,r){const o=e.sdkProcessingMetadata&&e.sdkProcessingMetadata.dynamicSamplingContext;return{event_id:e.event_id,sent_at:(new Date).toISOString(),...t&&{sdk:t},...!!n&&r&&{dsn:dsnToString(r)},...o&&{trace:dropUndefinedKeys({...o})}}}function createClientReportEnvelope(e,t,n){return createEnvelope(t?{dsn:t}:{},[[{type:"client_report"},{timestamp:n||dateTimestampInSeconds(),discarded_events:e}]])}const DEFAULT_RETRY_AFTER=6e4;function parseRetryAfterHeader(e,t=Date.now()){const n=parseInt(`${e}`,10);if(!isNaN(n))return 1e3*n;const r=Date.parse(`${e}`);return isNaN(r)?DEFAULT_RETRY_AFTER:r-t}function disabledUntil(e,t){return e[t]||e.all||0}function isRateLimited(e,t,n=Date.now()){return disabledUntil(e,t)>n}function updateRateLimits(e,{statusCode:t,headers:n},r=Date.now()){const o={...e},a=n&&n["x-sentry-rate-limits"],i=n&&n["retry-after"];if(a)for(const e of a.trim().split(",")){const[t,n,,,a]=e.split(":",5),i=parseInt(t,10),s=1e3*(isNaN(i)?60:i);if(n)for(const e of n.split(";"))"metric_bucket"===e&&a&&!a.split(";").includes("custom")||(o[e]=r+s);else o.all=r+s}else i?o.all=r+parseRetryAfterHeader(i,r):429===t&&(o.all=r+6e4);return o}function parseStackFrames$1(e,t){return e(t.stack||"",1)}function exceptionFromError$1(e,t){const n={type:t.name||t.constructor.name,value:t.message},r=parseStackFrames$1(e,t);return r.length&&(n.stacktrace={frames:r}),n}function _nullishCoalesce(e,t){return null!=e?e:t()}function _optionalChain(e){let t,n=e[0],r=1;for(;r<e.length;){const o=e[r],a=e[r+1];if(r+=2,("optionalAccess"===o||"optionalCall"===o)&&null==n)return;"access"===o||"optionalAccess"===o?(t=n,n=a(n)):"call"!==o&&"optionalCall"!==o||(n=a(((...e)=>n.call(t,...e))),t=void 0)}return n}const DEBUG_BUILD$5="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__,DEFAULT_ENVIRONMENT="production";function getGlobalEventProcessors(){return getGlobalSingleton("globalEventProcessors",(()=>[]))}function addGlobalEventProcessor(e){getGlobalEventProcessors().push(e)}function notifyEventProcessors(e,t,n,r=0){return new SyncPromise(((o,a)=>{const i=e[r];if(null===t||"function"!=typeof i)o(t);else{const s=i({...t},n);DEBUG_BUILD$5&&i.id&&null===s&&logger.log(`Event processor "${i.id}" dropped event`),isThenable(s)?s.then((t=>notifyEventProcessors(e,t,n,r+1).then(o))).then(null,a):notifyEventProcessors(e,s,n,r+1).then(o).then(null,a)}}))}function makeSession$1(e){const t=timestampInSeconds(),n={sid:uuid4(),init:!0,timestamp:t,started:t,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>sessionToJSON(n)};return e&&updateSession$1(n,e),n}function updateSession$1(e,t={}){if(t.user&&(!e.ipAddress&&t.user.ip_address&&(e.ipAddress=t.user.ip_address),e.did||t.did||(e.did=t.user.id||t.user.email||t.user.username)),e.timestamp=t.timestamp||timestampInSeconds(),t.abnormal_mechanism&&(e.abnormal_mechanism=t.abnormal_mechanism),t.ignoreDuration&&(e.ignoreDuration=t.ignoreDuration),t.sid&&(e.sid=32===t.sid.length?t.sid:uuid4()),void 0!==t.init&&(e.init=t.init),!e.did&&t.did&&(e.did=`${t.did}`),"number"==typeof t.started&&(e.started=t.started),e.ignoreDuration)e.duration=void 0;else if("number"==typeof t.duration)e.duration=t.duration;else{const t=e.timestamp-e.started;e.duration=t>=0?t:0}t.release&&(e.release=t.release),t.environment&&(e.environment=t.environment),!e.ipAddress&&t.ipAddress&&(e.ipAddress=t.ipAddress),!e.userAgent&&t.userAgent&&(e.userAgent=t.userAgent),"number"==typeof t.errors&&(e.errors=t.errors),t.status&&(e.status=t.status)}function closeSession(e,t){let n={};t?n={status:t}:"ok"===e.status&&(n={status:"exited"}),updateSession$1(e,n)}function sessionToJSON(e){return dropUndefinedKeys({sid:`${e.sid}`,init:e.init,started:new Date(1e3*e.started).toISOString(),timestamp:new Date(1e3*e.timestamp).toISOString(),status:e.status,errors:e.errors,did:"number"==typeof e.did||"string"==typeof e.did?`${e.did}`:void 0,duration:e.duration,abnormal_mechanism:e.abnormal_mechanism,attrs:{release:e.release,environment:e.environment,ip_address:e.ipAddress,user_agent:e.userAgent}})}const TRACE_FLAG_NONE=0,TRACE_FLAG_SAMPLED=1;function spanToTraceContext(e){const{spanId:t,traceId:n}=e.spanContext(),{data:r,op:o,parent_span_id:a,status:i,tags:s,origin:c}=spanToJSON(e);return dropUndefinedKeys({data:r,op:o,parent_span_id:a,span_id:t,status:i,tags:s,trace_id:n,origin:c})}function spanToTraceHeader(e){const{traceId:t,spanId:n}=e.spanContext();return generateSentryTraceHeader(t,n,spanIsSampled(e))}function spanTimeInputToSeconds(e){return"number"==typeof e?ensureTimestampInSeconds(e):Array.isArray(e)?e[0]+e[1]/1e9:e instanceof Date?ensureTimestampInSeconds(e.getTime()):timestampInSeconds()}function ensureTimestampInSeconds(e){return e>9999999999?e/1e3:e}function spanToJSON(e){return spanIsSpanClass(e)?e.getSpanJSON():"function"==typeof e.toJSON?e.toJSON():{}}function spanIsSpanClass(e){return"function"==typeof e.getSpanJSON}function spanIsSampled(e){const{traceFlags:t}=e.spanContext();return Boolean(t&TRACE_FLAG_SAMPLED)}function prepareEvent(e,t,n,r,o,a){const{normalizeDepth:i=3,normalizeMaxBreadth:s=1e3}=e,c={...t,event_id:t.event_id||n.event_id||uuid4(),timestamp:t.timestamp||dateTimestampInSeconds()},l=n.integrations||e.integrations.map((e=>e.name));applyClientOptions(c,e),applyIntegrationsMetadata(c,l),void 0===t.type&&applyDebugIds(c,e.stackParser);const u=getFinalScope(r,n.captureContext);n.mechanism&&addExceptionMechanism(c,n.mechanism);const d=o&&o.getEventProcessors?o.getEventProcessors():[],p=getGlobalScope().getScopeData();if(a){mergeScopeData(p,a.getScopeData())}if(u){mergeScopeData(p,u.getScopeData())}const g=[...n.attachments||[],...p.attachments];g.length&&(n.attachments=g),applyScopeDataToEvent(c,p);return notifyEventProcessors([...d,...getGlobalEventProcessors(),...p.eventProcessors],c,n).then((e=>(e&&applyDebugMeta(e),"number"==typeof i&&i>0?normalizeEvent(e,i,s):e)))}function applyClientOptions(e,t){const{environment:n,release:r,dist:o,maxValueLength:a=250}=t;"environment"in e||(e.environment="environment"in t?n:DEFAULT_ENVIRONMENT),void 0===e.release&&void 0!==r&&(e.release=r),void 0===e.dist&&void 0!==o&&(e.dist=o),e.message&&(e.message=truncate(e.message,a));const i=e.exception&&e.exception.values&&e.exception.values[0];i&&i.value&&(i.value=truncate(i.value,a));const s=e.request;s&&s.url&&(s.url=truncate(s.url,a))}const debugIdStackParserCache$1=new WeakMap;function applyDebugIds(e,t){const n=GLOBAL_OBJ._sentryDebugIds;if(!n)return;let r;const o=debugIdStackParserCache$1.get(t);o?r=o:(r=new Map,debugIdStackParserCache$1.set(t,r));const a=Object.keys(n).reduce(((e,o)=>{let a;const i=r.get(o);i?a=i:(a=t(o),r.set(o,a));for(let t=a.length-1;t>=0;t--){const r=a[t];if(r.filename){e[r.filename]=n[o];break}}return e}),{});try{e.exception.values.forEach((e=>{e.stacktrace.frames.forEach((e=>{e.filename&&(e.debug_id=a[e.filename])}))}))}catch(e){}}function applyDebugMeta(e){const t={};try{e.exception.values.forEach((e=>{e.stacktrace.frames.forEach((e=>{e.debug_id&&(e.abs_path?t[e.abs_path]=e.debug_id:e.filename&&(t[e.filename]=e.debug_id),delete e.debug_id)}))}))}catch(e){}if(0===Object.keys(t).length)return;e.debug_meta=e.debug_meta||{},e.debug_meta.images=e.debug_meta.images||[];const n=e.debug_meta.images;Object.keys(t).forEach((e=>{n.push({type:"sourcemap",code_file:e,debug_id:t[e]})}))}function applyIntegrationsMetadata(e,t){t.length>0&&(e.sdk=e.sdk||{},e.sdk.integrations=[...e.sdk.integrations||[],...t])}function normalizeEvent(e,t,n){if(!e)return null;const r={...e,...e.breadcrumbs&&{breadcrumbs:e.breadcrumbs.map((e=>({...e,...e.data&&{data:normalize(e.data,t,n)}})))},...e.user&&{user:normalize(e.user,t,n)},...e.contexts&&{contexts:normalize(e.contexts,t,n)},...e.extra&&{extra:normalize(e.extra,t,n)}};return e.contexts&&e.contexts.trace&&r.contexts&&(r.contexts.trace=e.contexts.trace,e.contexts.trace.data&&(r.contexts.trace.data=normalize(e.contexts.trace.data,t,n))),e.spans&&(r.spans=e.spans.map((e=>{const r=spanToJSON(e).data;return r&&(e.data=normalize(r,t,n)),e}))),r}function getFinalScope(e,t){if(!t)return e;const n=e?e.clone():new Scope;return n.update(t),n}function parseEventHintOrCaptureContext(e){if(e)return hintIsScopeOrFunction(e)||hintIsScopeContext(e)?{captureContext:e}:e}function hintIsScopeOrFunction(e){return e instanceof Scope||"function"==typeof e}const captureContextKeys=["user","level","extra","contexts","tags","fingerprint","requestSession","propagationContext"];function hintIsScopeContext(e){return Object.keys(e).some((e=>captureContextKeys.includes(e)))}function captureException(e,t){return getCurrentHub().captureException(e,parseEventHintOrCaptureContext(t))}function captureMessage(e,t){const n="string"==typeof t?t:void 0,r="string"!=typeof t?{captureContext:t}:void 0;return getCurrentHub().captureMessage(e,n,r)}function captureEvent(e,t){return getCurrentHub().captureEvent(e,t)}function configureScope(e){getCurrentHub().configureScope(e)}function addBreadcrumb(e,t){getCurrentHub().addBreadcrumb(e,t)}function setContext(e,t){getCurrentHub().setContext(e,t)}function setExtras(e){getCurrentHub().setExtras(e)}function setExtra(e,t){getCurrentHub().setExtra(e,t)}function setTags(e){getCurrentHub().setTags(e)}function setTag(e,t){getCurrentHub().setTag(e,t)}function setUser(e){getCurrentHub().setUser(e)}function withScope(...e){const t=getCurrentHub();if(2===e.length){const[n,r]=e;return n?t.withScope((()=>(t.getStackTop().scope=n,r(n)))):t.withScope(r)}return t.withScope(e[0])}function withIsolationScope(e){return runWithAsyncContext((()=>e(getIsolationScope())))}function withActiveSpan(e,t){return withScope((n=>(n.setSpan(e),t(n))))}function startTransaction(e,t){return getCurrentHub().startTransaction({...e},t)}async function flush(e){const t=getClient();return t?t.flush(e):(DEBUG_BUILD$5&&logger.warn("Cannot flush events. No client defined."),Promise.resolve(!1))}async function close(e){const t=getClient();return t?t.close(e):(DEBUG_BUILD$5&&logger.warn("Cannot flush events and disable SDK. No client defined."),Promise.resolve(!1))}function lastEventId(){return getCurrentHub().lastEventId()}function getClient(){return getCurrentHub().getClient()}function isInitialized(){return!!getClient()}function getCurrentScope(){return getCurrentHub().getScope()}function startSession(e){const t=getClient(),n=getIsolationScope(),r=getCurrentScope(),{release:o,environment:a=DEFAULT_ENVIRONMENT}=t&&t.getOptions()||{},{userAgent:i}=GLOBAL_OBJ.navigator||{},s=makeSession$1({release:o,environment:a,user:r.getUser()||n.getUser(),...i&&{userAgent:i},...e}),c=n.getSession();return c&&"ok"===c.status&&updateSession$1(c,{status:"exited"}),endSession(),n.setSession(s),r.setSession(s),s}function endSession(){const e=getIsolationScope(),t=getCurrentScope(),n=t.getSession()||e.getSession();n&&closeSession(n),_sendSessionUpdate(),e.setSession(),t.setSession()}function _sendSessionUpdate(){const e=getIsolationScope(),t=getCurrentScope(),n=getClient(),r=t.getSession()||e.getSession();r&&n&&n.captureSession&&n.captureSession(r)}function captureSession(e=!1){e?endSession():_sendSessionUpdate()}function getRootSpan(e){return e.transaction}function getDynamicSamplingContextFromClient(e,t,n){const r=t.getOptions(),{publicKey:o}=t.getDsn()||{},{segment:a}=n&&n.getUser()||{},i=dropUndefinedKeys({environment:r.environment||DEFAULT_ENVIRONMENT,release:r.release,user_segment:a,public_key:o,trace_id:e});return t.emit&&t.emit("createDsc",i),i}function getDynamicSamplingContextFromSpan(e){const t=getClient();if(!t)return{};const n=getDynamicSamplingContextFromClient(spanToJSON(e).trace_id||"",t,getCurrentScope()),r=getRootSpan(e);if(!r)return n;const o=r&&r._frozenDynamicSamplingContext;if(o)return o;const{sampleRate:a,source:i}=r.metadata;null!=a&&(n.sample_rate=`${a}`);const s=spanToJSON(r);return i&&"url"!==i&&(n.transaction=s.description),n.sampled=String(spanIsSampled(r)),t.emit&&t.emit("createDsc",n),n}function applyScopeDataToEvent(e,t){const{fingerprint:n,span:r,breadcrumbs:o,sdkProcessingMetadata:a}=t;applyDataToEvent(e,t),r&&applySpanToEvent(e,r),applyFingerprintToEvent(e,n),applyBreadcrumbsToEvent(e,o),applySdkMetadataToEvent(e,a)}function mergeScopeData(e,t){const{extra:n,tags:r,user:o,contexts:a,level:i,sdkProcessingMetadata:s,breadcrumbs:c,fingerprint:l,eventProcessors:u,attachments:d,propagationContext:p,transactionName:g,span:h}=t;mergeAndOverwriteScopeData(e,"extra",n),mergeAndOverwriteScopeData(e,"tags",r),mergeAndOverwriteScopeData(e,"user",o),mergeAndOverwriteScopeData(e,"contexts",a),mergeAndOverwriteScopeData(e,"sdkProcessingMetadata",s),i&&(e.level=i),g&&(e.transactionName=g),h&&(e.span=h),c.length&&(e.breadcrumbs=[...e.breadcrumbs,...c]),l.length&&(e.fingerprint=[...e.fingerprint,...l]),u.length&&(e.eventProcessors=[...e.eventProcessors,...u]),d.length&&(e.attachments=[...e.attachments,...d]),e.propagationContext={...e.propagationContext,...p}}function mergeAndOverwriteScopeData(e,t,n){if(n&&Object.keys(n).length){e[t]={...e[t]};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[t][r]=n[r])}}function applyDataToEvent(e,t){const{extra:n,tags:r,user:o,contexts:a,level:i,transactionName:s}=t,c=dropUndefinedKeys(n);c&&Object.keys(c).length&&(e.extra={...c,...e.extra});const l=dropUndefinedKeys(r);l&&Object.keys(l).length&&(e.tags={...l,...e.tags});const u=dropUndefinedKeys(o);u&&Object.keys(u).length&&(e.user={...u,...e.user});const d=dropUndefinedKeys(a);d&&Object.keys(d).length&&(e.contexts={...d,...e.contexts}),i&&(e.level=i),s&&(e.transaction=s)}function applyBreadcrumbsToEvent(e,t){const n=[...e.breadcrumbs||[],...t];e.breadcrumbs=n.length?n:void 0}function applySdkMetadataToEvent(e,t){e.sdkProcessingMetadata={...e.sdkProcessingMetadata,...t}}function applySpanToEvent(e,t){e.contexts={trace:spanToTraceContext(t),...e.contexts};const n=getRootSpan(t);if(n){e.sdkProcessingMetadata={dynamicSamplingContext:getDynamicSamplingContextFromSpan(t),...e.sdkProcessingMetadata};const r=spanToJSON(n).description;r&&(e.tags={transaction:r,...e.tags})}}function applyFingerprintToEvent(e,t){e.fingerprint=e.fingerprint?arrayify(e.fingerprint):[],t&&(e.fingerprint=e.fingerprint.concat(t)),e.fingerprint&&!e.fingerprint.length&&delete e.fingerprint}const DEFAULT_MAX_BREADCRUMBS=100;let globalScope;class Scope{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext=generatePropagationContext()}static clone(e){return e?e.clone():new Scope}clone(){const e=new Scope;return e._breadcrumbs=[...this._breadcrumbs],e._tags={...this._tags},e._extra={...this._extra},e._contexts={...this._contexts},e._user=this._user,e._level=this._level,e._span=this._span,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._requestSession=this._requestSession,e._attachments=[...this._attachments],e._sdkProcessingMetadata={...this._sdkProcessingMetadata},e._propagationContext={...this._propagationContext},e._client=this._client,e}setClient(e){this._client=e}getClient(){return this._client}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,segment:void 0,username:void 0},this._session&&updateSession$1(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(e){return this._requestSession=e,this}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,t){return this._tags={...this._tags,[e]:t},this._notifyScopeListeners(),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,t){return this._extra={...this._extra,[e]:t},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,t){return null===t?delete this._contexts[e]:this._contexts[e]=t,this._notifyScopeListeners(),this}setSpan(e){return this._span=e,this._notifyScopeListeners(),this}getSpan(){return this._span}getTransaction(){const e=this._span;return e&&e.transaction}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;const t="function"==typeof e?e(this):e;if(t instanceof Scope){const e=t.getScopeData();this._tags={...this._tags,...e.tags},this._extra={...this._extra,...e.extra},this._contexts={...this._contexts,...e.contexts},e.user&&Object.keys(e.user).length&&(this._user=e.user),e.level&&(this._level=e.level),e.fingerprint.length&&(this._fingerprint=e.fingerprint),t.getRequestSession()&&(this._requestSession=t.getRequestSession()),e.propagationContext&&(this._propagationContext=e.propagationContext)}else if(isPlainObject(t)){const t=e;this._tags={...this._tags,...t.tags},this._extra={...this._extra,...t.extra},this._contexts={...this._contexts,...t.contexts},t.user&&(this._user=t.user),t.level&&(this._level=t.level),t.fingerprint&&(this._fingerprint=t.fingerprint),t.requestSession&&(this._requestSession=t.requestSession),t.propagationContext&&(this._propagationContext=t.propagationContext)}return this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._span=void 0,this._session=void 0,this._notifyScopeListeners(),this._attachments=[],this._propagationContext=generatePropagationContext(),this}addBreadcrumb(e,t){const n="number"==typeof t?t:DEFAULT_MAX_BREADCRUMBS;if(n<=0)return this;const r={timestamp:dateTimestampInSeconds(),...e},o=this._breadcrumbs;return o.push(r),this._breadcrumbs=o.length>n?o.slice(-n):o,this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}getAttachments(){return this.getScopeData().attachments}clearAttachments(){return this._attachments=[],this}getScopeData(){const{_breadcrumbs:e,_attachments:t,_contexts:n,_tags:r,_extra:o,_user:a,_level:i,_fingerprint:s,_eventProcessors:c,_propagationContext:l,_sdkProcessingMetadata:u,_transactionName:d,_span:p}=this;return{breadcrumbs:e,attachments:t,contexts:n,tags:r,extra:o,user:a,level:i,fingerprint:s||[],eventProcessors:c,propagationContext:l,sdkProcessingMetadata:u,transactionName:d,span:p}}applyToEvent(e,t={},n=[]){applyScopeDataToEvent(e,this.getScopeData());return notifyEventProcessors([...n,...getGlobalEventProcessors(),...this._eventProcessors],e,t)}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata={...this._sdkProcessingMetadata,...e},this}setPropagationContext(e){return this._propagationContext=e,this}getPropagationContext(){return this._propagationContext}captureException(e,t){const n=t&&t.event_id?t.event_id:uuid4();if(!this._client)return logger.warn("No client configured on scope - will not capture exception!"),n;const r=new Error("Sentry syntheticException");return this._client.captureException(e,{originalException:e,syntheticException:r,...t,event_id:n},this),n}captureMessage(e,t,n){const r=n&&n.event_id?n.event_id:uuid4();if(!this._client)return logger.warn("No client configured on scope - will not capture message!"),r;const o=new Error(e);return this._client.captureMessage(e,t,{originalException:e,syntheticException:o,...n,event_id:r},this),r}captureEvent(e,t){const n=t&&t.event_id?t.event_id:uuid4();return this._client?(this._client.captureEvent(e,{...t,event_id:n},this),n):(logger.warn("No client configured on scope - will not capture event!"),n)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach((e=>{e(this)})),this._notifyingListeners=!1)}}function getGlobalScope(){return globalScope||(globalScope=new Scope),globalScope}function generatePropagationContext(){return{traceId:uuid4(),spanId:uuid4().substring(16)}}const SDK_VERSION="7.116.0",API_VERSION=parseFloat(SDK_VERSION),DEFAULT_BREADCRUMBS=100;class Hub{constructor(e,t,n,r=API_VERSION){let o,a;this._version=r,t?o=t:(o=new Scope,o.setClient(e)),n?a=n:(a=new Scope,a.setClient(e)),this._stack=[{scope:o}],e&&this.bindClient(e),this._isolationScope=a}isOlderThan(e){return this._version<e}bindClient(e){const t=this.getStackTop();t.client=e,t.scope.setClient(e),e&&e.setupIntegrations&&e.setupIntegrations()}pushScope(){const e=this.getScope().clone();return this.getStack().push({client:this.getClient(),scope:e}),e}popScope(){return!(this.getStack().length<=1)&&!!this.getStack().pop()}withScope(e){const t=this.pushScope();let n;try{n=e(t)}catch(e){throw this.popScope(),e}return isThenable(n)?n.then((e=>(this.popScope(),e)),(e=>{throw this.popScope(),e})):(this.popScope(),n)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStack(){return this._stack}getStackTop(){return this._stack[this._stack.length-1]}captureException(e,t){const n=this._lastEventId=t&&t.event_id?t.event_id:uuid4(),r=new Error("Sentry syntheticException");return this.getScope().captureException(e,{originalException:e,syntheticException:r,...t,event_id:n}),n}captureMessage(e,t,n){const r=this._lastEventId=n&&n.event_id?n.event_id:uuid4(),o=new Error(e);return this.getScope().captureMessage(e,t,{originalException:e,syntheticException:o,...n,event_id:r}),r}captureEvent(e,t){const n=t&&t.event_id?t.event_id:uuid4();return e.type||(this._lastEventId=n),this.getScope().captureEvent(e,{...t,event_id:n}),n}lastEventId(){return this._lastEventId}addBreadcrumb(e,t){const{scope:n,client:r}=this.getStackTop();if(!r)return;const{beforeBreadcrumb:o=null,maxBreadcrumbs:a=DEFAULT_BREADCRUMBS}=r.getOptions&&r.getOptions()||{};if(a<=0)return;const i={timestamp:dateTimestampInSeconds(),...e},s=o?consoleSandbox((()=>o(i,t))):i;null!==s&&(r.emit&&r.emit("beforeAddBreadcrumb",s,t),n.addBreadcrumb(s,a))}setUser(e){this.getScope().setUser(e),this.getIsolationScope().setUser(e)}setTags(e){this.getScope().setTags(e),this.getIsolationScope().setTags(e)}setExtras(e){this.getScope().setExtras(e),this.getIsolationScope().setExtras(e)}setTag(e,t){this.getScope().setTag(e,t),this.getIsolationScope().setTag(e,t)}setExtra(e,t){this.getScope().setExtra(e,t),this.getIsolationScope().setExtra(e,t)}setContext(e,t){this.getScope().setContext(e,t),this.getIsolationScope().setContext(e,t)}configureScope(e){const{scope:t,client:n}=this.getStackTop();n&&e(t)}run(e){const t=makeMain(this);try{e(this)}finally{makeMain(t)}}getIntegration(e){const t=this.getClient();if(!t)return null;try{return t.getIntegration(e)}catch(t){return DEBUG_BUILD$5&&logger.warn(`Cannot retrieve integration ${e.id} from the current Hub`),null}}startTransaction(e,t){const n=this._callExtensionMethod("startTransaction",e,t);if(DEBUG_BUILD$5&&!n){this.getClient()?logger.warn("Tracing extension 'startTransaction' has not been added. Call 'addTracingExtensions' before calling 'init':\nSentry.addTracingExtensions();\nSentry.init({...});\n"):logger.warn("Tracing extension 'startTransaction' is missing. You should 'init' the SDK before calling 'startTransaction'")}return n}traceHeaders(){return this._callExtensionMethod("traceHeaders")}captureSession(e=!1){if(e)return this.endSession();this._sendSessionUpdate()}endSession(){const e=this.getStackTop().scope,t=e.getSession();t&&closeSession(t),this._sendSessionUpdate(),e.setSession()}startSession(e){const{scope:t,client:n}=this.getStackTop(),{release:r,environment:o=DEFAULT_ENVIRONMENT}=n&&n.getOptions()||{},{userAgent:a}=GLOBAL_OBJ.navigator||{},i=makeSession$1({release:r,environment:o,user:t.getUser(),...a&&{userAgent:a},...e}),s=t.getSession&&t.getSession();return s&&"ok"===s.status&&updateSession$1(s,{status:"exited"}),this.endSession(),t.setSession(i),i}shouldSendDefaultPii(){const e=this.getClient(),t=e&&e.getOptions();return Boolean(t&&t.sendDefaultPii)}_sendSessionUpdate(){const{scope:e,client:t}=this.getStackTop(),n=e.getSession();n&&t&&t.captureSession&&t.captureSession(n)}_callExtensionMethod(e,...t){const n=getMainCarrier().__SENTRY__;if(n&&n.extensions&&"function"==typeof n.extensions[e])return n.extensions[e].apply(this,t);DEBUG_BUILD$5&&logger.warn(`Extension method ${e} couldn't be found, doing nothing.`)}}function getMainCarrier(){return GLOBAL_OBJ.__SENTRY__=GLOBAL_OBJ.__SENTRY__||{extensions:{},hub:void 0},GLOBAL_OBJ}function makeMain(e){const t=getMainCarrier(),n=getHubFromCarrier(t);return setHubOnCarrier(t,e),n}function getCurrentHub(){const e=getMainCarrier();if(e.__SENTRY__&&e.__SENTRY__.acs){const t=e.__SENTRY__.acs.getCurrentHub();if(t)return t}return getGlobalHub(e)}function getIsolationScope(){return getCurrentHub().getIsolationScope()}function getGlobalHub(e=getMainCarrier()){return hasHubOnCarrier(e)&&!getHubFromCarrier(e).isOlderThan(API_VERSION)||setHubOnCarrier(e,new Hub),getHubFromCarrier(e)}function runWithAsyncContext(e,t={}){const n=getMainCarrier();return n.__SENTRY__&&n.__SENTRY__.acs?n.__SENTRY__.acs.runWithAsyncContext(e,t):e()}function hasHubOnCarrier(e){return!!(e&&e.__SENTRY__&&e.__SENTRY__.hub)}function getHubFromCarrier(e){return getGlobalSingleton("hub",(()=>new Hub),e)}function setHubOnCarrier(e,t){if(!e)return!1;return(e.__SENTRY__=e.__SENTRY__||{}).hub=t,!0}function getActiveTransaction(e){return(e||getCurrentHub()).getScope().getTransaction()}const extractTraceparentData=extractTraceparentData$1;let errorsInstrumented=!1;function registerErrorInstrumentation(){errorsInstrumented||(errorsInstrumented=!0,addGlobalErrorInstrumentationHandler(errorCallback),addGlobalUnhandledRejectionInstrumentationHandler(errorCallback))}function errorCallback(){const e=getActiveTransaction();if(e){const t="internal_error";DEBUG_BUILD$5&&logger.log(`[Tracing] Transaction: ${t} -> Global error occured`),e.setStatus(t)}}var SpanStatus;function getSpanStatusFromHttpCode(e){if(e<400&&e>=100)return"ok";if(e>=400&&e<500)switch(e){case 401:return"unauthenticated";case 403:return"permission_denied";case 404:return"not_found";case 409:return"already_exists";case 413:return"failed_precondition";case 429:return"resource_exhausted";default:return"invalid_argument"}if(e>=500&&e<600)switch(e){case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline_exceeded";default:return"internal_error"}return"unknown_error"}errorCallback.tag="sentry_tracingErrorCallback",function(e){e.Ok="ok";e.DeadlineExceeded="deadline_exceeded";e.Unauthenticated="unauthenticated";e.PermissionDenied="permission_denied";e.NotFound="not_found";e.ResourceExhausted="resource_exhausted";e.InvalidArgument="invalid_argument";e.Unimplemented="unimplemented";e.Unavailable="unavailable";e.InternalError="internal_error";e.UnknownError="unknown_error";e.Cancelled="cancelled";e.AlreadyExists="already_exists";e.FailedPrecondition="failed_precondition";e.Aborted="aborted";e.OutOfRange="out_of_range";e.DataLoss="data_loss"}(SpanStatus||(SpanStatus={}));const spanStatusfromHttpCode=getSpanStatusFromHttpCode;function setHttpStatus(e,t){e.setTag("http.status_code",String(t)),e.setData("http.response.status_code",t);const n=getSpanStatusFromHttpCode(t);"unknown_error"!==n&&e.setStatus(n)}function handleCallbackErrors(e,t,n=(()=>{})){let r;try{r=e()}catch(e){throw t(e),n(),e}return maybeHandlePromiseRejection(r,t,n)}function maybeHandlePromiseRejection(e,t,n){return isThenable(e)?e.then((e=>(n(),e)),(e=>{throw t(e),n(),e})):(n(),e)}function hasTracingEnabled(e){if("boolean"==typeof __SENTRY_TRACING__&&!__SENTRY_TRACING__)return!1;const t=getClient(),n=e||t&&t.getOptions();return!!n&&(n.enableTracing||"tracesSampleRate"in n||"tracesSampler"in n)}function trace(e,t,n=(()=>{}),r=(()=>{})){const o=getCurrentHub(),a=getCurrentScope(),i=a.getSpan(),s=normalizeContext(e),c=createChildSpanOrTransaction(o,{parentSpan:i,spanContext:s,forceTransaction:!1,scope:a});return a.setSpan(c),handleCallbackErrors((()=>t(c)),(e=>{c&&c.setStatus("internal_error"),n(e,c)}),(()=>{c&&c.end(),a.setSpan(i),r()}))}function startSpan(e,t){const n=normalizeContext(e);return runWithAsyncContext((()=>withScope(e.scope,(r=>{const o=getCurrentHub(),a=r.getSpan(),i=e.onlyIfParent&&!a?void 0:createChildSpanOrTransaction(o,{parentSpan:a,spanContext:n,forceTransaction:e.forceTransaction,scope:r});return handleCallbackErrors((()=>t(i)),(()=>{if(i){const{status:e}=spanToJSON(i);e&&"ok"!==e||i.setStatus("internal_error")}}),(()=>i&&i.end()))}))))}function startSpanManual(e,t){const n=normalizeContext(e);return runWithAsyncContext((()=>withScope(e.scope,(r=>{const o=getCurrentHub(),a=r.getSpan(),i=e.onlyIfParent&&!a?void 0:createChildSpanOrTransaction(o,{parentSpan:a,spanContext:n,forceTransaction:e.forceTransaction,scope:r});function s(){i&&i.end()}return handleCallbackErrors((()=>t(i,s)),(()=>{if(i&&i.isRecording()){const{status:e}=spanToJSON(i);e&&"ok"!==e||i.setStatus("internal_error")}}))}))))}function startInactiveSpan(e){if(!hasTracingEnabled())return;const t=normalizeContext(e),n=getCurrentHub(),r=e.scope?e.scope.getSpan():getActiveSpan();if(e.onlyIfParent&&!r)return;const o=(e.scope||getCurrentScope()).clone();return createChildSpanOrTransaction(n,{parentSpan:r,spanContext:t,forceTransaction:e.forceTransaction,scope:o})}function getActiveSpan(){return getCurrentScope().getSpan()}const continueTrace=({sentryTrace:e,baggage:t},n)=>{const r=getCurrentScope(),{traceparentData:o,dynamicSamplingContext:a,propagationContext:i}=tracingContextFromHeaders(e,t);r.setPropagationContext(i),DEBUG_BUILD$5&&o&&logger.log(`[Tracing] Continuing trace ${o.traceId}.`);const s={...o,metadata:dropUndefinedKeys({dynamicSamplingContext:a})};return n?runWithAsyncContext((()=>n(s))):s};function createChildSpanOrTransaction(e,{parentSpan:t,spanContext:n,forceTransaction:r,scope:o}){if(!hasTracingEnabled())return;const a=getIsolationScope();let i;if(t&&!r)i=t.startChild(n);else if(t){const r=getDynamicSamplingContextFromSpan(t),{traceId:o,spanId:a}=t.spanContext(),s=spanIsSampled(t);i=e.startTransaction({traceId:o,parentSpanId:a,parentSampled:s,...n,metadata:{dynamicSamplingContext:r,...n.metadata}})}else{const{traceId:t,dsc:r,parentSpanId:s,sampled:c}={...a.getPropagationContext(),...o.getPropagationContext()};i=e.startTransaction({traceId:t,parentSpanId:s,parentSampled:c,...n,metadata:{dynamicSamplingContext:r,...n.metadata}})}return o.setSpan(i),setCapturedScopesOnSpan(i,o,a),i}function normalizeContext(e){if(e.startTime){const t={...e};return t.startTimestamp=spanTimeInputToSeconds(e.startTime),delete t.startTime,t}return e}const SCOPE_ON_START_SPAN_FIELD="_sentryScope",ISOLATION_SCOPE_ON_START_SPAN_FIELD="_sentryIsolationScope";function setCapturedScopesOnSpan(e,t,n){e&&(addNonEnumerableProperty(e,ISOLATION_SCOPE_ON_START_SPAN_FIELD,n),addNonEnumerableProperty(e,SCOPE_ON_START_SPAN_FIELD,t))}function getCapturedScopesOnSpan(e){return{scope:e[SCOPE_ON_START_SPAN_FIELD],isolationScope:e[ISOLATION_SCOPE_ON_START_SPAN_FIELD]}}let SPAN_METRIC_SUMMARY;function getMetricStorageForSpan(e){return SPAN_METRIC_SUMMARY?SPAN_METRIC_SUMMARY.get(e):void 0}function getMetricSummaryJsonForSpan(e){const t=getMetricStorageForSpan(e);if(!t)return;const n={};for(const[,[e,r]]of t)n[e]||(n[e]=[]),n[e].push(dropUndefinedKeys(r));return n}function updateMetricSummaryOnActiveSpan(e,t,n,r,o,a){const i=getActiveSpan();if(i){const s=getMetricStorageForSpan(i)||new Map,c=`${e}:${t}@${r}`,l=s.get(a);if(l){const[,e]=l;s.set(a,[c,{min:Math.min(e.min,n),max:Math.max(e.max,n),count:e.count+=1,sum:e.sum+=n,tags:e.tags}])}else s.set(a,[c,{min:n,max:n,count:1,sum:n,tags:o}]);SPAN_METRIC_SUMMARY||(SPAN_METRIC_SUMMARY=new WeakMap),SPAN_METRIC_SUMMARY.set(i,s)}}const SEMANTIC_ATTRIBUTE_SENTRY_SOURCE="sentry.source",SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE="sentry.sample_rate",SEMANTIC_ATTRIBUTE_SENTRY_OP="sentry.op",SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN="sentry.origin",SEMANTIC_ATTRIBUTE_PROFILE_ID="profile_id";class SpanRecorder{constructor(e=1e3){this._maxlen=e,this.spans=[]}add(e){this.spans.length>this._maxlen?e.spanRecorder=void 0:this.spans.push(e)}}class Span{constructor(e={}){this._traceId=e.traceId||uuid4(),this._spanId=e.spanId||uuid4().substring(16),this._startTime=e.startTimestamp||timestampInSeconds(),this.tags=e.tags?{...e.tags}:{},this.data=e.data?{...e.data}:{},this.instrumenter=e.instrumenter||"sentry",this._attributes={},this.setAttributes({[SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN]:e.origin||"manual",[SEMANTIC_ATTRIBUTE_SENTRY_OP]:e.op,...e.attributes}),this._name=e.name||e.description,e.parentSpanId&&(this._parentSpanId=e.parentSpanId),"sampled"in e&&(this._sampled=e.sampled),e.status&&(this._status=e.status),e.endTimestamp&&(this._endTime=e.endTimestamp),void 0!==e.exclusiveTime&&(this._exclusiveTime=e.exclusiveTime),this._measurements=e.measurements?{...e.measurements}:{}}get name(){return this._name||""}set name(e){this.updateName(e)}get description(){return this._name}set description(e){this._name=e}get traceId(){return this._traceId}set traceId(e){this._traceId=e}get spanId(){return this._spanId}set spanId(e){this._spanId=e}set parentSpanId(e){this._parentSpanId=e}get parentSpanId(){return this._parentSpanId}get sampled(){return this._sampled}set sampled(e){this._sampled=e}get attributes(){return this._attributes}set attributes(e){this._attributes=e}get startTimestamp(){return this._startTime}set startTimestamp(e){this._startTime=e}get endTimestamp(){return this._endTime}set endTimestamp(e){this._endTime=e}get status(){return this._status}set status(e){this._status=e}get op(){return this._attributes[SEMANTIC_ATTRIBUTE_SENTRY_OP]}set op(e){this.setAttribute(SEMANTIC_ATTRIBUTE_SENTRY_OP,e)}get origin(){return this._attributes[SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN]}set origin(e){this.setAttribute(SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN,e)}spanContext(){const{_spanId:e,_traceId:t,_sampled:n}=this;return{spanId:e,traceId:t,traceFlags:n?TRACE_FLAG_SAMPLED:TRACE_FLAG_NONE}}startChild(e){const t=new Span({...e,parentSpanId:this._spanId,sampled:this._sampled,traceId:this._traceId});t.spanRecorder=this.spanRecorder,t.spanRecorder&&t.spanRecorder.add(t);const n=getRootSpan(this);if(t.transaction=n,DEBUG_BUILD$5&&n){const r=`[Tracing] Starting '${e&&e.op||"< unknown op >"}' span on transaction '${spanToJSON(t).description||"< unknown name >"}' (${n.spanContext().spanId}).`;logger.log(r),this._logMessage=r}return t}setTag(e,t){return this.tags={...this.tags,[e]:t},this}setData(e,t){return this.data={...this.data,[e]:t},this}setAttribute(e,t){void 0===t?delete this._attributes[e]:this._attributes[e]=t}setAttributes(e){Object.keys(e).forEach((t=>this.setAttribute(t,e[t])))}setStatus(e){return this._status=e,this}setHttpStatus(e){return setHttpStatus(this,e),this}setName(e){this.updateName(e)}updateName(e){return this._name=e,this}isSuccess(){return"ok"===this._status}finish(e){return this.end(e)}end(e){if(this._endTime)return;const t=getRootSpan(this);if(DEBUG_BUILD$5&&t&&t.spanContext().spanId!==this._spanId){const e=this._logMessage;e&&logger.log(e.replace("Starting","Finishing"))}this._endTime=spanTimeInputToSeconds(e)}toTraceparent(){return spanToTraceHeader(this)}toContext(){return dropUndefinedKeys({data:this._getData(),description:this._name,endTimestamp:this._endTime,op:this.op,parentSpanId:this._parentSpanId,sampled:this._sampled,spanId:this._spanId,startTimestamp:this._startTime,status:this._status,tags:this.tags,traceId:this._traceId})}updateWithContext(e){return this.data=e.data||{},this._name=e.name||e.description,this._endTime=e.endTimestamp,this.op=e.op,this._parentSpanId=e.parentSpanId,this._sampled=e.sampled,this._spanId=e.spanId||this._spanId,this._startTime=e.startTimestamp||this._startTime,this._status=e.status,this.tags=e.tags||{},this._traceId=e.traceId||this._traceId,this}getTraceContext(){return spanToTraceContext(this)}getSpanJSON(){return dropUndefinedKeys({data:this._getData(),description:this._name,op:this._attributes[SEMANTIC_ATTRIBUTE_SENTRY_OP],parent_span_id:this._parentSpanId,span_id:this._spanId,start_timestamp:this._startTime,status:this._status,tags:Object.keys(this.tags).length>0?this.tags:void 0,timestamp:this._endTime,trace_id:this._traceId,origin:this._attributes[SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN],_metrics_summary:getMetricSummaryJsonForSpan(this),profile_id:this._attributes[SEMANTIC_ATTRIBUTE_PROFILE_ID],exclusive_time:this._exclusiveTime,measurements:Object.keys(this._measurements).length>0?this._measurements:void 0})}isRecording(){return!this._endTime&&!!this._sampled}toJSON(){return this.getSpanJSON()}_getData(){const{data:e,_attributes:t}=this,n=Object.keys(e).length>0,r=Object.keys(t).length>0;if(n||r)return n&&r?{...e,...t}:n?e:t}}class Transaction extends Span{constructor(e,t){super(e),this._contexts={},this._hub=t||getCurrentHub(),this._name=e.name||"",this._metadata={...e.metadata},this._trimEnd=e.trimEnd,this.transaction=this;const n=this._metadata.dynamicSamplingContext;n&&(this._frozenDynamicSamplingContext={...n})}get name(){return this._name}set name(e){this.setName(e)}get metadata(){return{source:"custom",spanMetadata:{},...this._metadata,...this._attributes[SEMANTIC_ATTRIBUTE_SENTRY_SOURCE]&&{source:this._attributes[SEMANTIC_ATTRIBUTE_SENTRY_SOURCE]},...this._attributes[SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE]&&{sampleRate:this._attributes[SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE]}}}set metadata(e){this._metadata=e}setName(e,t="custom"){this._name=e,this.setAttribute(SEMANTIC_ATTRIBUTE_SENTRY_SOURCE,t)}updateName(e){return this._name=e,this}initSpanRecorder(e=1e3){this.spanRecorder||(this.spanRecorder=new SpanRecorder(e)),this.spanRecorder.add(this)}setContext(e,t){null===t?delete this._contexts[e]:this._contexts[e]=t}setMeasurement(e,t,n=""){this._measurements[e]={value:t,unit:n}}setMetadata(e){this._metadata={...this._metadata,...e}}end(e){const t=spanTimeInputToSeconds(e),n=this._finishTransaction(t);if(n)return this._hub.captureEvent(n)}toContext(){return dropUndefinedKeys({...super.toContext(),name:this._name,trimEnd:this._trimEnd})}updateWithContext(e){return super.updateWithContext(e),this._name=e.name||"",this._trimEnd=e.trimEnd,this}getDynamicSamplingContext(){return getDynamicSamplingContextFromSpan(this)}setHub(e){this._hub=e}getProfileId(){if(void 0!==this._contexts&&void 0!==this._contexts.profile)return this._contexts.profile.profile_id}_finishTransaction(e){if(void 0!==this._endTime)return;this._name||(DEBUG_BUILD$5&&logger.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this._name="<unlabeled transaction>"),super.end(e);const t=this._hub.getClient();if(t&&t.emit&&t.emit("finishTransaction",this),!0!==this._sampled)return DEBUG_BUILD$5&&logger.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled."),void(t&&t.recordDroppedEvent("sample_rate","transaction"));const n=this.spanRecorder?this.spanRecorder.spans.filter((e=>e!==this&&spanToJSON(e).timestamp)):[];if(this._trimEnd&&n.length>0){const e=n.map((e=>spanToJSON(e).timestamp)).filter(Boolean);this._endTime=e.reduce(((e,t)=>e>t?e:t))}const{scope:r,isolationScope:o}=getCapturedScopesOnSpan(this),{metadata:a}=this,{source:i}=a,s={contexts:{...this._contexts,trace:spanToTraceContext(this)},spans:n,start_timestamp:this._startTime,tags:this.tags,timestamp:this._endTime,transaction:this._name,type:"transaction",sdkProcessingMetadata:{...a,capturedSpanScope:r,capturedSpanIsolationScope:o,...dropUndefinedKeys({dynamicSamplingContext:getDynamicSamplingContextFromSpan(this)})},_metrics_summary:getMetricSummaryJsonForSpan(this),...i&&{transaction_info:{source:i}}};return Object.keys(this._measurements).length>0&&(DEBUG_BUILD$5&&logger.log("[Measurements] Adding measurements to transaction",JSON.stringify(this._measurements,void 0,2)),s.measurements=this._measurements),DEBUG_BUILD$5&&logger.log(`[Tracing] Finishing ${this.op} transaction: ${this._name}.`),s}}const TRACING_DEFAULTS={idleTimeout:1e3,finalTimeout:3e4,heartbeatInterval:5e3},FINISH_REASON_TAG="finishReason",IDLE_TRANSACTION_FINISH_REASONS=["heartbeatFailed","idleTimeout","documentHidden","finalTimeout","externalFinish","cancelled"];class IdleTransactionSpanRecorder extends SpanRecorder{constructor(e,t,n,r){super(r),this._pushActivity=e,this._popActivity=t,this.transactionSpanId=n}add(e){if(e.spanContext().spanId!==this.transactionSpanId){const t=e.end;e.end=(...n)=>(this._popActivity(e.spanContext().spanId),t.apply(e,n)),void 0===spanToJSON(e).timestamp&&this._pushActivity(e.spanContext().spanId)}super.add(e)}}class IdleTransaction extends Transaction{constructor(e,t,n=TRACING_DEFAULTS.idleTimeout,r=TRACING_DEFAULTS.finalTimeout,o=TRACING_DEFAULTS.heartbeatInterval,a=!1,i=!1){super(e,t),this._idleHub=t,this._idleTimeout=n,this._finalTimeout=r,this._heartbeatInterval=o,this._onScope=a,this.activities={},this._heartbeatCounter=0,this._finished=!1,this._idleTimeoutCanceledPermanently=!1,this._beforeFinishCallbacks=[],this._finishReason=IDLE_TRANSACTION_FINISH_REASONS[4],this._autoFinishAllowed=!i,a&&(DEBUG_BUILD$5&&logger.log(`Setting idle transaction on scope. Span ID: ${this.spanContext().spanId}`),t.getScope().setSpan(this)),i||this._restartIdleTimeout(),setTimeout((()=>{this._finished||(this.setStatus("deadline_exceeded"),this._finishReason=IDLE_TRANSACTION_FINISH_REASONS[3],this.end())}),this._finalTimeout)}end(e){const t=spanTimeInputToSeconds(e);if(this._finished=!0,this.activities={},"ui.action.click"===this.op&&this.setAttribute(FINISH_REASON_TAG,this._finishReason),this.spanRecorder){DEBUG_BUILD$5&&logger.log("[Tracing] finishing IdleTransaction",new Date(1e3*t).toISOString(),this.op);for(const e of this._beforeFinishCallbacks)e(this,t);this.spanRecorder.spans=this.spanRecorder.spans.filter((e=>{if(e.spanContext().spanId===this.spanContext().spanId)return!0;spanToJSON(e).timestamp||(e.setStatus("cancelled"),e.end(t),DEBUG_BUILD$5&&logger.log("[Tracing] cancelling span since transaction ended early",JSON.stringify(e,void 0,2)));const{start_timestamp:n,timestamp:r}=spanToJSON(e),o=n&&n<t,a=(this._finalTimeout+this._idleTimeout)/1e3,i=r&&n&&r-n<a;if(DEBUG_BUILD$5){const t=JSON.stringify(e,void 0,2);o?i||logger.log("[Tracing] discarding Span since it finished after Transaction final timeout",t):logger.log("[Tracing] discarding Span since it happened after Transaction was finished",t)}return o&&i})),DEBUG_BUILD$5&&logger.log("[Tracing] flushing IdleTransaction")}else DEBUG_BUILD$5&&logger.log("[Tracing] No active IdleTransaction");if(this._onScope){const e=this._idleHub.getScope();e.getTransaction()===this&&e.setSpan(void 0)}return super.end(e)}registerBeforeFinishCallback(e){this._beforeFinishCallbacks.push(e)}initSpanRecorder(e){if(!this.spanRecorder){const t=e=>{this._finished||this._pushActivity(e)},n=e=>{this._finished||this._popActivity(e)};this.spanRecorder=new IdleTransactionSpanRecorder(t,n,this.spanContext().spanId,e),DEBUG_BUILD$5&&logger.log("Starting heartbeat"),this._pingHeartbeat()}this.spanRecorder.add(this)}cancelIdleTimeout(e,{restartOnChildSpanChange:t}={restartOnChildSpanChange:!0}){this._idleTimeoutCanceledPermanently=!1===t,this._idleTimeoutID&&(clearTimeout(this._idleTimeoutID),this._idleTimeoutID=void 0,0===Object.keys(this.activities).length&&this._idleTimeoutCanceledPermanently&&(this._finishReason=IDLE_TRANSACTION_FINISH_REASONS[5],this.end(e)))}setFinishReason(e){this._finishReason=e}sendAutoFinishSignal(){this._autoFinishAllowed||(DEBUG_BUILD$5&&logger.log("[Tracing] Received finish signal for idle transaction."),this._restartIdleTimeout(),this._autoFinishAllowed=!0)}_restartIdleTimeout(e){this.cancelIdleTimeout(),this._idleTimeoutID=setTimeout((()=>{this._finished||0!==Object.keys(this.activities).length||(this._finishReason=IDLE_TRANSACTION_FINISH_REASONS[1],this.end(e))}),this._idleTimeout)}_pushActivity(e){this.cancelIdleTimeout(void 0,{restartOnChildSpanChange:!this._idleTimeoutCanceledPermanently}),DEBUG_BUILD$5&&logger.log(`[Tracing] pushActivity: ${e}`),this.activities[e]=!0,DEBUG_BUILD$5&&logger.log("[Tracing] new activities count",Object.keys(this.activities).length)}_popActivity(e){if(this.activities[e]&&(DEBUG_BUILD$5&&logger.log(`[Tracing] popActivity ${e}`),delete this.activities[e],DEBUG_BUILD$5&&logger.log("[Tracing] new activities count",Object.keys(this.activities).length)),0===Object.keys(this.activities).length){const e=timestampInSeconds();this._idleTimeoutCanceledPermanently?this._autoFinishAllowed&&(this._finishReason=IDLE_TRANSACTION_FINISH_REASONS[5],this.end(e)):this._restartIdleTimeout(e+this._idleTimeout/1e3)}}_beat(){if(this._finished)return;const e=Object.keys(this.activities).join("");e===this._prevHeartbeatString?this._heartbeatCounter++:this._heartbeatCounter=1,this._prevHeartbeatString=e,this._heartbeatCounter>=3?this._autoFinishAllowed&&(DEBUG_BUILD$5&&logger.log("[Tracing] Transaction finished because of no change for 3 heart beats"),this.setStatus("deadline_exceeded"),this._finishReason=IDLE_TRANSACTION_FINISH_REASONS[0],this.end()):this._pingHeartbeat()}_pingHeartbeat(){DEBUG_BUILD$5&&logger.log(`pinging Heartbeat -> current counter: ${this._heartbeatCounter}`),setTimeout((()=>{this._beat()}),this._heartbeatInterval)}}function sampleTransaction(e,t,n){if(!hasTracingEnabled(t))return e.sampled=!1,e;if(void 0!==e.sampled)return e.setAttribute(SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE,Number(e.sampled)),e;let r;return"function"==typeof t.tracesSampler?(r=t.tracesSampler(n),e.setAttribute(SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE,Number(r))):void 0!==n.parentSampled?r=n.parentSampled:void 0!==t.tracesSampleRate?(r=t.tracesSampleRate,e.setAttribute(SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE,Number(r))):(r=1,e.setAttribute(SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE,r)),isValidSampleRate$1(r)?r?(e.sampled=Math.random()<r,e.sampled?(DEBUG_BUILD$5&&logger.log(`[Tracing] starting ${e.op} transaction - ${spanToJSON(e).description}`),e):(DEBUG_BUILD$5&&logger.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(r)})`),e)):(DEBUG_BUILD$5&&logger.log("[Tracing] Discarding transaction because "+("function"==typeof t.tracesSampler?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0")),e.sampled=!1,e):(DEBUG_BUILD$5&&logger.warn("[Tracing] Discarding transaction because of invalid sample rate."),e.sampled=!1,e)}function isValidSampleRate$1(e){return isNaN$1(e)||"number"!=typeof e&&"boolean"!=typeof e?(DEBUG_BUILD$5&&logger.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(e)} of type ${JSON.stringify(typeof e)}.`),!1):!(e<0||e>1)||(DEBUG_BUILD$5&&logger.warn(`[Tracing] Given sample rate is invalid. Sample rate must be between 0 and 1. Got ${e}.`),!1)}function traceHeaders(){const e=this.getScope().getSpan();return e?{"sentry-trace":spanToTraceHeader(e)}:{}}function _startTransaction(e,t){const n=this.getClient(),r=n&&n.getOptions()||{},o=r.instrumenter||"sentry",a=e.instrumenter||"sentry";o!==a&&(DEBUG_BUILD$5&&logger.error(`A transaction was started with instrumenter=\`${a}\`, but the SDK is configured with the \`${o}\` instrumenter.\nThe transaction will not be sampled. Please use the ${o} instrumentation to start transactions.`),e.sampled=!1);let i=new Transaction(e,this);return i=sampleTransaction(i,r,{name:e.name,parentSampled:e.parentSampled,transactionContext:e,attributes:{...e.data,...e.attributes},...t}),i.isRecording()&&i.initSpanRecorder(r._experiments&&r._experiments.maxSpans),n&&n.emit&&n.emit("startTransaction",i),i}function startIdleTransaction(e,t,n,r,o,a,i,s=!1){const c=e.getClient(),l=c&&c.getOptions()||{};let u=new IdleTransaction(t,e,n,r,i,o,s);return u=sampleTransaction(u,l,{name:t.name,parentSampled:t.parentSampled,transactionContext:t,attributes:{...t.data,...t.attributes},...a}),u.isRecording()&&u.initSpanRecorder(l._experiments&&l._experiments.maxSpans),c&&c.emit&&c.emit("startTransaction",u),u}function addTracingExtensions(){const e=getMainCarrier();e.__SENTRY__&&(e.__SENTRY__.extensions=e.__SENTRY__.extensions||{},e.__SENTRY__.extensions.startTransaction||(e.__SENTRY__.extensions.startTransaction=_startTransaction),e.__SENTRY__.extensions.traceHeaders||(e.__SENTRY__.extensions.traceHeaders=traceHeaders),registerErrorInstrumentation())}function setMeasurement(e,t,n){const r=getActiveTransaction();r&&r.setMeasurement(e,t,n)}function enhanceEventWithSdkInfo(e,t){return t?(e.sdk=e.sdk||{},e.sdk.name=e.sdk.name||t.name,e.sdk.version=e.sdk.version||t.version,e.sdk.integrations=[...e.sdk.integrations||[],...t.integrations||[]],e.sdk.packages=[...e.sdk.packages||[],...t.packages||[]],e):e}function createSessionEnvelope(e,t,n,r){const o=getSdkMetadataForEnvelopeHeader(n);return createEnvelope({sent_at:(new Date).toISOString(),...o&&{sdk:o},...!!r&&t&&{dsn:dsnToString(t)}},["aggregates"in e?[{type:"sessions"},e]:[{type:"session"},e.toJSON()]])}function createEventEnvelope(e,t,n,r){const o=getSdkMetadataForEnvelopeHeader(n),a=e.type&&"replay_event"!==e.type?e.type:"event";enhanceEventWithSdkInfo(e,n&&n.sdk);const i=createEventEnvelopeHeaders(e,o,r,t);delete e.sdkProcessingMetadata;return createEnvelope(i,[[{type:a},e]])}const SENTRY_API_VERSION="7";function getBaseApiEndpoint(e){const t=e.protocol?`${e.protocol}:`:"",n=e.port?`:${e.port}`:"";return`${t}//${e.host}${n}${e.path?`/${e.path}`:""}/api/`}function _getIngestEndpoint(e){return`${getBaseApiEndpoint(e)}${e.projectId}/envelope/`}function _encodedAuth(e,t){return urlEncode({sentry_key:e.publicKey,sentry_version:SENTRY_API_VERSION,...t&&{sentry_client:`${t.name}/${t.version}`}})}function getEnvelopeEndpointWithUrlEncodedAuth(e,t={}){const n="string"==typeof t?t:t.tunnel,r="string"!=typeof t&&t._metadata?t._metadata.sdk:void 0;return n||`${_getIngestEndpoint(e)}?${_encodedAuth(e,r)}`}function getReportDialogEndpoint(e,t){const n=makeDsn(e);if(!n)return"";const r=`${getBaseApiEndpoint(n)}embed/error-page/`;let o=`dsn=${dsnToString(n)}`;for(const e in t)if("dsn"!==e&&"onClose"!==e)if("user"===e){const e=t.user;if(!e)continue;e.name&&(o+=`&name=${encodeURIComponent(e.name)}`),e.email&&(o+=`&email=${encodeURIComponent(e.email)}`)}else o+=`&${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`;return`${r}?${o}`}const installedIntegrations=[];function filterDuplicates(e){const t={};return e.forEach((e=>{const{name:n}=e,r=t[n];r&&!r.isDefaultInstance&&e.isDefaultInstance||(t[n]=e)})),Object.keys(t).map((e=>t[e]))}function getIntegrationsToSetup(e){const t=e.defaultIntegrations||[],n=e.integrations;let r;t.forEach((e=>{e.isDefaultInstance=!0})),r=Array.isArray(n)?[...t,...n]:"function"==typeof n?arrayify(n(t)):t;const o=filterDuplicates(r),a=findIndex(o,(e=>"Debug"===e.name));if(-1!==a){const[e]=o.splice(a,1);o.push(e)}return o}function setupIntegrations(e,t){const n={};return t.forEach((t=>{t&&setupIntegration(e,t,n)})),n}function afterSetupIntegrations(e,t){for(const n of t)n&&n.afterAllSetup&&n.afterAllSetup(e)}function setupIntegration(e,t,n){if(n[t.name])DEBUG_BUILD$5&&logger.log(`Integration skipped because it was already installed: ${t.name}`);else{if(n[t.name]=t,-1===installedIntegrations.indexOf(t.name)&&(t.setupOnce(addGlobalEventProcessor,getCurrentHub),installedIntegrations.push(t.name)),t.setup&&"function"==typeof t.setup&&t.setup(e),e.on&&"function"==typeof t.preprocessEvent){const n=t.preprocessEvent.bind(t);e.on("preprocessEvent",((t,r)=>n(t,r,e)))}if(e.addEventProcessor&&"function"==typeof t.processEvent){const n=t.processEvent.bind(t),r=Object.assign(((t,r)=>n(t,r,e)),{id:t.name});e.addEventProcessor(r)}DEBUG_BUILD$5&&logger.log(`Integration installed: ${t.name}`)}}function addIntegration(e){const t=getClient();t&&t.addIntegration?t.addIntegration(e):DEBUG_BUILD$5&&logger.warn(`Cannot add integration "${e.name}" because no SDK Client is available.`)}function findIndex(e,t){for(let n=0;n<e.length;n++)if(!0===t(e[n]))return n;return-1}function convertIntegrationFnToClass(e,t){return Object.assign((function(...e){return t(...e)}),{id:e})}function defineIntegration(e){return e}function getBucketKey(e,t,n,r){return`${e}${t}${n}${Object.entries(dropUndefinedKeys(r)).sort(((e,t)=>e[0].localeCompare(t[0])))}`}function simpleHash(e){let t=0;for(let n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t&=t}return t>>>0}function serializeMetricBuckets(e){let t="";for(const n of e){const e=Object.entries(n.tags),r=e.length>0?`|#${e.map((([e,t])=>`${e}:${t}`)).join(",")}`:"";t+=`${n.name}@${n.unit}:${n.metric}|${n.metricType}${r}|T${n.timestamp}\n`}return t}function sanitizeUnit(e){return e.replace(/[^\w]+/gi,"_")}function sanitizeMetricKey(e){return e.replace(/[^\w\-.]+/gi,"_")}function sanitizeTagKey(e){return e.replace(/[^\w\-./]+/gi,"")}const tagValueReplacements=[["\n","\\n"],["\r","\\r"],["\t","\\t"],["\\","\\\\"],["|","\\u{7c}"],[",","\\u{2c}"]];function getCharOrReplacement(e){for(const[t,n]of tagValueReplacements)if(e===t)return n;return e}function sanitizeTagValue(e){return[...e].reduce(((e,t)=>e+getCharOrReplacement(t)),"")}function sanitizeTags(e){const t={};for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)){t[sanitizeTagKey(n)]=sanitizeTagValue(String(e[n]))}return t}function createMetricEnvelope(e,t,n,r){const o={sent_at:(new Date).toISOString()};n&&n.sdk&&(o.sdk={name:n.sdk.name,version:n.sdk.version}),r&&t&&(o.dsn=dsnToString(t));return createEnvelope(o,[createMetricEnvelopeItem(e)])}function createMetricEnvelopeItem(e){const t=serializeMetricBuckets(e);return[{type:"statsd",length:t.length},t]}const ALREADY_SEEN_ERROR="Not capturing exception because it's already been captured.";class BaseClient{constructor(e){if(this._options=e,this._integrations={},this._integrationsInitialized=!1,this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],e.dsn?this._dsn=makeDsn(e.dsn):DEBUG_BUILD$5&&logger.warn("No DSN provided, client will not send events."),this._dsn){const t=getEnvelopeEndpointWithUrlEncodedAuth(this._dsn,e);this._transport=e.transport({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this),...e.transportOptions,url:t})}}captureException(e,t,n){if(checkOrSetAlreadyCaught(e))return void(DEBUG_BUILD$5&&logger.log(ALREADY_SEEN_ERROR));let r=t&&t.event_id;return this._process(this.eventFromException(e,t).then((e=>this._captureEvent(e,t,n))).then((e=>{r=e}))),r}captureMessage(e,t,n,r){let o=n&&n.event_id;const a=isParameterizedString(e)?e:String(e),i=isPrimitive(e)?this.eventFromMessage(a,t,n):this.eventFromException(e,n);return this._process(i.then((e=>this._captureEvent(e,n,r))).then((e=>{o=e}))),o}captureEvent(e,t,n){if(t&&t.originalException&&checkOrSetAlreadyCaught(t.originalException))return void(DEBUG_BUILD$5&&logger.log(ALREADY_SEEN_ERROR));let r=t&&t.event_id;const o=(e.sdkProcessingMetadata||{}).capturedSpanScope;return this._process(this._captureEvent(e,t,o||n).then((e=>{r=e}))),r}captureSession(e){"string"!=typeof e.release?DEBUG_BUILD$5&&logger.warn("Discarded session because of missing or non-string release"):(this.sendSession(e),updateSession$1(e,{init:!1}))}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(e){const t=this._transport;return t?(this.metricsAggregator&&this.metricsAggregator.flush(),this._isClientDoneProcessing(e).then((n=>t.flush(e).then((e=>n&&e))))):resolvedSyncPromise(!0)}close(e){return this.flush(e).then((e=>(this.getOptions().enabled=!1,this.metricsAggregator&&this.metricsAggregator.close(),e)))}getEventProcessors(){return this._eventProcessors}addEventProcessor(e){this._eventProcessors.push(e)}setupIntegrations(e){(e&&!this._integrationsInitialized||this._isEnabled()&&!this._integrationsInitialized)&&this._setupIntegrations()}init(){this._isEnabled()&&this._setupIntegrations()}getIntegrationById(e){return this.getIntegrationByName(e)}getIntegrationByName(e){return this._integrations[e]}getIntegration(e){try{return this._integrations[e.id]||null}catch(t){return DEBUG_BUILD$5&&logger.warn(`Cannot retrieve integration ${e.id} from the current Client`),null}}addIntegration(e){const t=this._integrations[e.name];setupIntegration(this,e,this._integrations),t||afterSetupIntegrations(this,[e])}sendEvent(e,t={}){this.emit("beforeSendEvent",e,t);let n=createEventEnvelope(e,this._dsn,this._options._metadata,this._options.tunnel);for(const e of t.attachments||[])n=addItemToEnvelope(n,createAttachmentEnvelopeItem(e,this._options.transportOptions&&this._options.transportOptions.textEncoder));const r=this._sendEnvelope(n);r&&r.then((t=>this.emit("afterSendEvent",e,t)),null)}sendSession(e){const t=createSessionEnvelope(e,this._dsn,this._options._metadata,this._options.tunnel);this._sendEnvelope(t)}recordDroppedEvent(e,t,n){if(this._options.sendClientReports){const n=`${e}:${t}`;DEBUG_BUILD$5&&logger.log(`Adding outcome: "${n}"`),this._outcomes[n]=this._outcomes[n]+1||1}}captureAggregateMetrics(e){DEBUG_BUILD$5&&logger.log(`Flushing aggregated metrics, number of metrics: ${e.length}`);const t=createMetricEnvelope(e,this._dsn,this._options._metadata,this._options.tunnel);this._sendEnvelope(t)}on(e,t){this._hooks[e]||(this._hooks[e]=[]),this._hooks[e].push(t)}emit(e,...t){this._hooks[e]&&this._hooks[e].forEach((e=>e(...t)))}_setupIntegrations(){const{integrations:e}=this._options;this._integrations=setupIntegrations(this,e),afterSetupIntegrations(this,e),this._integrationsInitialized=!0}_updateSessionFromEvent(e,t){let n=!1,r=!1;const o=t.exception&&t.exception.values;if(o){r=!0;for(const e of o){const t=e.mechanism;if(t&&!1===t.handled){n=!0;break}}}const a="ok"===e.status;(a&&0===e.errors||a&&n)&&(updateSession$1(e,{...n&&{status:"crashed"},errors:e.errors||Number(r||n)}),this.captureSession(e))}_isClientDoneProcessing(e){return new SyncPromise((t=>{let n=0;const r=setInterval((()=>{0==this._numProcessing?(clearInterval(r),t(!0)):(n+=1,e&&n>=e&&(clearInterval(r),t(!1)))}),1)}))}_isEnabled(){return!1!==this.getOptions().enabled&&void 0!==this._transport}_prepareEvent(e,t,n,r=getIsolationScope()){const o=this.getOptions(),a=Object.keys(this._integrations);return!t.integrations&&a.length>0&&(t.integrations=a),this.emit("preprocessEvent",e,t),prepareEvent(o,e,t,n,this,r).then((e=>{if(null===e)return e;const t={...r.getPropagationContext(),...n?n.getPropagationContext():void 0};if(!(e.contexts&&e.contexts.trace)&&t){const{traceId:r,spanId:o,parentSpanId:a,dsc:i}=t;e.contexts={trace:{trace_id:r,span_id:o,parent_span_id:a},...e.contexts};const s=i||getDynamicSamplingContextFromClient(r,this,n);e.sdkProcessingMetadata={dynamicSamplingContext:s,...e.sdkProcessingMetadata}}return e}))}_captureEvent(e,t={},n){return this._processEvent(e,t,n).then((e=>e.event_id),(e=>{if(DEBUG_BUILD$5){const t=e;"log"===t.logLevel?logger.log(t.message):logger.warn(t)}}))}_processEvent(e,t,n){const r=this.getOptions(),{sampleRate:o}=r,a=isTransactionEvent$1(e),i=isErrorEvent$1(e),s=e.type||"error",c=`before send for type \`${s}\``;if(i&&"number"==typeof o&&Math.random()>o)return this.recordDroppedEvent("sample_rate","error",e),rejectedSyncPromise(new SentryError(`Discarding event because it's not included in the random sample (sampling rate = ${o})`,"log"));const l="replay_event"===s?"replay":s,u=(e.sdkProcessingMetadata||{}).capturedSpanIsolationScope;return this._prepareEvent(e,t,n,u).then((n=>{if(null===n)throw this.recordDroppedEvent("event_processor",l,e),new SentryError("An event processor returned `null`, will not send event.","log");if(t.data&&!0===t.data.__sentry__)return n;return _validateBeforeSendResult(processBeforeSend(r,n,t),c)})).then((r=>{if(null===r)throw this.recordDroppedEvent("before_send",l,e),new SentryError(`${c} returned \`null\`, will not send event.`,"log");const o=n&&n.getSession();!a&&o&&this._updateSessionFromEvent(o,r);const i=r.transaction_info;if(a&&i&&r.transaction!==e.transaction){const e="custom";r.transaction_info={...i,source:e}}return this.sendEvent(r,t),r})).then(null,(e=>{if(e instanceof SentryError)throw e;throw this.captureException(e,{data:{__sentry__:!0},originalException:e}),new SentryError(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.\nReason: ${e}`)}))}_process(e){this._numProcessing++,e.then((e=>(this._numProcessing--,e)),(e=>(this._numProcessing--,e)))}_sendEnvelope(e){if(this.emit("beforeEnvelope",e),this._isEnabled()&&this._transport)return this._transport.send(e).then(null,(e=>{DEBUG_BUILD$5&&logger.error("Error while sending event:",e)}));DEBUG_BUILD$5&&logger.error("Transport disabled")}_clearOutcomes(){const e=this._outcomes;return this._outcomes={},Object.keys(e).map((t=>{const[n,r]=t.split(":");return{reason:n,category:r,quantity:e[t]}}))}}function _validateBeforeSendResult(e,t){const n=`${t} must return \`null\` or a valid event.`;if(isThenable(e))return e.then((e=>{if(!isPlainObject(e)&&null!==e)throw new SentryError(n);return e}),(e=>{throw new SentryError(`${t} rejected with ${e}`)}));if(!isPlainObject(e)&&null!==e)throw new SentryError(n);return e}function processBeforeSend(e,t,n){const{beforeSend:r,beforeSendTransaction:o}=e;return isErrorEvent$1(t)&&r?r(t,n):isTransactionEvent$1(t)&&o?o(t,n):t}function isErrorEvent$1(e){return void 0===e.type}function isTransactionEvent$1(e){return"transaction"===e.type}function addEventProcessor(e){const t=getClient();t&&t.addEventProcessor&&t.addEventProcessor(e)}const COUNTER_METRIC_TYPE="c",GAUGE_METRIC_TYPE="g",SET_METRIC_TYPE="s",DISTRIBUTION_METRIC_TYPE="d",DEFAULT_BROWSER_FLUSH_INTERVAL=5e3;class CounterMetric{constructor(e){this._value=e}get weight(){return 1}add(e){this._value+=e}toString(){return`${this._value}`}}class GaugeMetric{constructor(e){this._last=e,this._min=e,this._max=e,this._sum=e,this._count=1}get weight(){return 5}add(e){this._last=e,e<this._min&&(this._min=e),e>this._max&&(this._max=e),this._sum+=e,this._count++}toString(){return`${this._last}:${this._min}:${this._max}:${this._sum}:${this._count}`}}class DistributionMetric{constructor(e){this._value=[e]}get weight(){return this._value.length}add(e){this._value.push(e)}toString(){return this._value.join(":")}}class SetMetric{constructor(e){this.first=e,this._value=new Set([e])}get weight(){return this._value.size}add(e){this._value.add(e)}toString(){return Array.from(this._value).map((e=>"string"==typeof e?simpleHash(e):e)).join(":")}}const METRIC_MAP={[COUNTER_METRIC_TYPE]:CounterMetric,[GAUGE_METRIC_TYPE]:GaugeMetric,[DISTRIBUTION_METRIC_TYPE]:DistributionMetric,[SET_METRIC_TYPE]:SetMetric};function initAndBind(e,t){!0===t.debug&&(DEBUG_BUILD$5?logger.enable():consoleSandbox((()=>{console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle.")})));getCurrentScope().update(t.initialScope);const n=new e(t);setCurrentClient(n),initializeClient(n)}function setCurrentClient(e){const t=getCurrentHub().getStackTop();t.client=e,t.scope.setClient(e)}function initializeClient(e){e.init?e.init():e.setupIntegrations&&e.setupIntegrations()}const DEFAULT_TRANSPORT_BUFFER_SIZE=30;function createTransport(e,t,n=makePromiseBuffer(e.bufferSize||DEFAULT_TRANSPORT_BUFFER_SIZE)){let r={};function o(o){const a=[];if(forEachEnvelopeItem(o,((t,n)=>{const o=envelopeItemTypeToDataCategory(n);if(isRateLimited(r,o)){const r=getEventForEnvelopeItem(t,n);e.recordDroppedEvent("ratelimit_backoff",o,r)}else a.push(t)})),0===a.length)return resolvedSyncPromise();const i=createEnvelope(o[0],a),s=t=>{forEachEnvelopeItem(i,((n,r)=>{const o=getEventForEnvelopeItem(n,r);e.recordDroppedEvent(t,envelopeItemTypeToDataCategory(r),o)}))};return n.add((()=>t({body:serializeEnvelope(i,e.textEncoder)}).then((e=>(void 0!==e.statusCode&&(e.statusCode<200||e.statusCode>=300)&&DEBUG_BUILD$5&&logger.warn(`Sentry responded with status code ${e.statusCode} to sent event.`),r=updateRateLimits(r,e),e)),(e=>{throw s("network_error"),e})))).then((e=>e),(e=>{if(e instanceof SentryError)return DEBUG_BUILD$5&&logger.error("Skipped sending event because buffer is full."),s("queue_overflow"),resolvedSyncPromise();throw e}))}return o.__sentry__baseTransport__=!0,{send:o,flush:e=>n.drain(e)}}function getEventForEnvelopeItem(e,t){if("event"===t||"transaction"===t)return Array.isArray(e)?e[1]:void 0}const MIN_DELAY=100,START_DELAY=5e3,MAX_DELAY=36e5;function log(e,t){DEBUG_BUILD$5&&logger.info(`[Offline]: ${e}`,t)}function makeOfflineTransport(e){return t=>{const n=e(t),r=t.createStore?t.createStore(t):void 0;let o,a=START_DELAY;function i(e){r&&(o&&clearTimeout(o),o=setTimeout((async()=>{o=void 0;const e=await r.pop();e&&(log("Attempting to send previously queued event"),c(e).catch((e=>{log("Failed to retry sending",e)})))}),e),"number"!=typeof o&&o.unref&&o.unref())}function s(){o||(i(a),a=Math.min(2*a,MAX_DELAY))}async function c(e){try{const t=await n.send(e);let r=MIN_DELAY;if(t)if(t.headers&&t.headers["retry-after"])r=parseRetryAfterHeader(t.headers["retry-after"]);else if((t.statusCode||0)>=400)return t;return i(r),a=START_DELAY,t}catch(n){if(r&&await function(e,n,r){return!envelopeContainsItemType(e,["replay_event","replay_recording","client_report"])&&(!t.shouldStore||t.shouldStore(e,n,r))}(e,n,a))return await r.insert(e),s(),log("Error sending. Event queued",n),{};throw n}}return t.flushAtStartup&&s(),{send:c,flush:e=>n.flush(e)}}}function eventFromEnvelope(e,t){let n;return forEachEnvelopeItem(e,((e,r)=>(t.includes(r)&&(n=Array.isArray(e)?e[1]:void 0),!!n))),n}function makeOverrideReleaseTransport(e,t){return n=>{const r=e(n);return{...r,send:async e=>{const n=eventFromEnvelope(e,["event","transaction","profile","replay_event"]);return n&&(n.release=t),r.send(e)}}}}function overrideDsn(e,t){return createEnvelope(t?{...e[0],dsn:t}:e[0],e[1])}function makeMultiplexedTransport(e,t){return n=>{const r=e(n),o=new Map;function a(t,r){const a=r?`${t}:${r}`:t;let i=o.get(a);if(!i){const s=dsnFromString(t);if(!s)return;const c=getEnvelopeEndpointWithUrlEncodedAuth(s,n.tunnel);i=r?makeOverrideReleaseTransport(e,r)({...n,url:c}):e({...n,url:c}),o.set(a,i)}return[t,i]}return{send:async function(e){const n=t({envelope:e,getEvent:function(t){const n=t&&t.length?t:["event"];return eventFromEnvelope(e,n)}}).map((e=>"string"==typeof e?a(e,void 0):a(e.dsn,e.release))).filter((e=>!!e));return 0===n.length&&n.push(["",r]),(await Promise.all(n.map((([t,n])=>n.send(overrideDsn(e,t))))))[0]},flush:async function(e){const t=[await r.flush(e)];for(const[,n]of o)t.push(await n.flush(e));return t.every((e=>e))}}}}function createSpanEnvelope(e,t){const n={sent_at:(new Date).toISOString()};t&&(n.dsn=dsnToString(t));return createEnvelope(n,e.map(createSpanItem))}function createSpanItem(e){return[{type:"span"},e]}function isSentryRequestUrl(e,t){const n=t&&isHub(t)?t.getClient():t,r=n&&n.getDsn(),o=n&&n.getOptions().tunnel;return checkDsn(e,r)||checkTunnel(e,o)}function checkTunnel(e,t){return!!t&&removeTrailingSlash(e)===removeTrailingSlash(t)}function checkDsn(e,t){return!!t&&e.includes(t.host)}function removeTrailingSlash(e){return"/"===e[e.length-1]?e.slice(0,-1):e}function isHub(e){return void 0!==e.getClient}function parameterize(e,...t){const n=new String(String.raw(e,...t));return n.__sentry_template_string__=e.join("\0").replace(/%/g,"%%").replace(/\0/g,"%s"),n.__sentry_template_values__=t,n}function applySdkMetadata(e,t,n=[t],r="npm"){const o=e._metadata||{};o.sdk||(o.sdk={name:`sentry.javascript.${t}`,packages:n.map((e=>({name:`${r}:@sentry/${e}`,version:SDK_VERSION}))),version:SDK_VERSION}),e._metadata=o}const filenameMetadataMap=new Map,parsedStacks=new Set;function ensureMetadataStacksAreParsed(e){if(GLOBAL_OBJ._sentryModuleMetadata)for(const t of Object.keys(GLOBAL_OBJ._sentryModuleMetadata)){const n=GLOBAL_OBJ._sentryModuleMetadata[t];if(parsedStacks.has(t))continue;parsedStacks.add(t);const r=e(t);for(const e of r.reverse())if(e.filename){filenameMetadataMap.set(e.filename,n);break}}}function getMetadataForUrl(e,t){return ensureMetadataStacksAreParsed(e),filenameMetadataMap.get(t)}function addMetadataToStackFrames(e,t){try{t.exception.values.forEach((t=>{if(t.stacktrace)for(const n of t.stacktrace.frames||[]){if(!n.filename)continue;const t=getMetadataForUrl(e,n.filename);t&&(n.module_metadata=t)}}))}catch(e){}}function stripMetadataFromStackFrames(e){try{e.exception.values.forEach((e=>{if(e.stacktrace)for(const t of e.stacktrace.frames||[])delete t.module_metadata}))}catch(e){}}const INTEGRATION_NAME$n="ModuleMetadata",_moduleMetadataIntegration=()=>({name:INTEGRATION_NAME$n,setupOnce(){},setup(e){"function"==typeof e.on&&e.on("beforeEnvelope",(e=>{forEachEnvelopeItem(e,((e,t)=>{if("event"===t){const t=Array.isArray(e)?e[1]:void 0;t&&(stripMetadataFromStackFrames(t),e[1]=t)}}))}))},processEvent:(e,t,n)=>(addMetadataToStackFrames(n.getOptions().stackParser,e),e)}),moduleMetadataIntegration=defineIntegration(_moduleMetadataIntegration),ModuleMetadata=convertIntegrationFnToClass(INTEGRATION_NAME$n,moduleMetadataIntegration),DEFAULT_OPTIONS={include:{cookies:!0,data:!0,headers:!0,ip:!1,query_string:!0,url:!0,user:{id:!0,username:!0,email:!0}},transactionNamingScheme:"methodPath"},INTEGRATION_NAME$m="RequestData",_requestDataIntegration=(e={})=>{const t=addRequestDataToEvent,n={...DEFAULT_OPTIONS,...e,include:{method:!0,...DEFAULT_OPTIONS.include,...e.include,user:e.include&&"boolean"==typeof e.include.user?e.include.user:{...DEFAULT_OPTIONS.include.user,...(e.include||{}).user}}};return{name:INTEGRATION_NAME$m,setupOnce(){},processEvent(e,r,o){const{transactionNamingScheme:a}=n,{sdkProcessingMetadata:i={}}=e,s=i.request;if(!s)return e;const c=i.requestDataOptionsFromExpressHandler||i.requestDataOptionsFromGCPWrapper||convertReqDataIntegrationOptsToAddReqDataOpts(n),l=t(e,s,c);if("transaction"===e.type||"handler"===a)return l;const u=s._sentryTransaction;if(u){const e=spanToJSON(u).description||"",t="sentry.javascript.nextjs"===getSDKName(o)?e.startsWith("/api"):"path"!==a,[n]=extractPathForTransaction(s,{path:!0,method:t,customRoute:e});l.transaction=n}return l}}},requestDataIntegration=defineIntegration(_requestDataIntegration);function convertReqDataIntegrationOptsToAddReqDataOpts(e){const{transactionNamingScheme:t,include:{ip:n,user:r,...o}}=e,a=[];for(const[e,t]of Object.entries(o))t&&a.push(e);let i;if(void 0===r)i=!0;else if("boolean"==typeof r)i=r;else{const e=[];for(const[t,n]of Object.entries(r))n&&e.push(t);i=e}return{include:{ip:n,user:i,request:0!==a.length?a:void 0,transaction:t}}}function getSDKName(e){try{return e.getOptions()._metadata.sdk.name}catch(e){return}}convertIntegrationFnToClass(INTEGRATION_NAME$m,requestDataIntegration);const DEFAULT_IGNORE_ERRORS=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/],DEFAULT_IGNORE_TRANSACTIONS=[/^.*\/healthcheck$/,/^.*\/healthy$/,/^.*\/live$/,/^.*\/ready$/,/^.*\/heartbeat$/,/^.*\/health$/,/^.*\/healthz$/],INTEGRATION_NAME$l="InboundFilters",_inboundFiltersIntegration=(e={})=>({name:INTEGRATION_NAME$l,setupOnce(){},processEvent(t,n,r){const o=r.getOptions();return _shouldDropEvent$2(t,_mergeOptions(e,o))?null:t}}),inboundFiltersIntegration=defineIntegration(_inboundFiltersIntegration),InboundFilters=convertIntegrationFnToClass(INTEGRATION_NAME$l,inboundFiltersIntegration);function _mergeOptions(e={},t={}){return{allowUrls:[...e.allowUrls||[],...t.allowUrls||[]],denyUrls:[...e.denyUrls||[],...t.denyUrls||[]],ignoreErrors:[...e.ignoreErrors||[],...t.ignoreErrors||[],...e.disableErrorDefaults?[]:DEFAULT_IGNORE_ERRORS],ignoreTransactions:[...e.ignoreTransactions||[],...t.ignoreTransactions||[],...e.disableTransactionDefaults?[]:DEFAULT_IGNORE_TRANSACTIONS],ignoreInternal:void 0===e.ignoreInternal||e.ignoreInternal}}function _shouldDropEvent$2(e,t){return t.ignoreInternal&&_isSentryError(e)?(DEBUG_BUILD$5&&logger.warn(`Event dropped due to being internal Sentry Error.\nEvent: ${getEventDescription(e)}`),!0):_isIgnoredError(e,t.ignoreErrors)?(DEBUG_BUILD$5&&logger.warn(`Event dropped due to being matched by \`ignoreErrors\` option.\nEvent: ${getEventDescription(e)}`),!0):_isIgnoredTransaction(e,t.ignoreTransactions)?(DEBUG_BUILD$5&&logger.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.\nEvent: ${getEventDescription(e)}`),!0):_isDeniedUrl(e,t.denyUrls)?(DEBUG_BUILD$5&&logger.warn(`Event dropped due to being matched by \`denyUrls\` option.\nEvent: ${getEventDescription(e)}.\nUrl: ${_getEventFilterUrl(e)}`),!0):!_isAllowedUrl(e,t.allowUrls)&&(DEBUG_BUILD$5&&logger.warn(`Event dropped due to not being matched by \`allowUrls\` option.\nEvent: ${getEventDescription(e)}.\nUrl: ${_getEventFilterUrl(e)}`),!0)}function _isIgnoredError(e,t){return!(e.type||!t||!t.length)&&_getPossibleEventMessages(e).some((e=>stringMatchesSomePattern(e,t)))}function _isIgnoredTransaction(e,t){if("transaction"!==e.type||!t||!t.length)return!1;const n=e.transaction;return!!n&&stringMatchesSomePattern(n,t)}function _isDeniedUrl(e,t){if(!t||!t.length)return!1;const n=_getEventFilterUrl(e);return!!n&&stringMatchesSomePattern(n,t)}function _isAllowedUrl(e,t){if(!t||!t.length)return!0;const n=_getEventFilterUrl(e);return!n||stringMatchesSomePattern(n,t)}function _getPossibleEventMessages(e){const t=[];let n;e.message&&t.push(e.message);try{n=e.exception.values[e.exception.values.length-1]}catch(e){}return n&&n.value&&(t.push(n.value),n.type&&t.push(`${n.type}: ${n.value}`)),DEBUG_BUILD$5&&0===t.length&&logger.error(`Could not extract message for event ${getEventDescription(e)}`),t}function _isSentryError(e){try{return"SentryError"===e.exception.values[0].type}catch(e){}return!1}function _getLastValidUrl(e=[]){for(let t=e.length-1;t>=0;t--){const n=e[t];if(n&&"<anonymous>"!==n.filename&&"[native code]"!==n.filename)return n.filename||null}return null}function _getEventFilterUrl(e){try{let t;try{t=e.exception.values[0].stacktrace.frames}catch(e){}return t?_getLastValidUrl(t):null}catch(t){return DEBUG_BUILD$5&&logger.error(`Cannot extract url for event ${getEventDescription(e)}`),null}}let originalFunctionToString;const INTEGRATION_NAME$k="FunctionToString",SETUP_CLIENTS$1=new WeakMap,_functionToStringIntegration=()=>({name:INTEGRATION_NAME$k,setupOnce(){originalFunctionToString=Function.prototype.toString;try{Function.prototype.toString=function(...e){const t=getOriginalFunction(this),n=SETUP_CLIENTS$1.has(getClient())&&void 0!==t?t:this;return originalFunctionToString.apply(n,e)}}catch(e){}},setup(e){SETUP_CLIENTS$1.set(e,!0)}}),functionToStringIntegration=defineIntegration(_functionToStringIntegration),FunctionToString=convertIntegrationFnToClass(INTEGRATION_NAME$k,functionToStringIntegration),DEFAULT_KEY$1="cause",DEFAULT_LIMIT$1=5,INTEGRATION_NAME$j="LinkedErrors",_linkedErrorsIntegration$1=(e={})=>{const t=e.limit||DEFAULT_LIMIT$1,n=e.key||DEFAULT_KEY$1;return{name:INTEGRATION_NAME$j,setupOnce(){},preprocessEvent(e,r,o){const a=o.getOptions();applyAggregateErrorsToEvent(exceptionFromError$1,a.stackParser,a.maxValueLength,n,t,e,r)}}},linkedErrorsIntegration$1=defineIntegration(_linkedErrorsIntegration$1),LinkedErrors$1=convertIntegrationFnToClass(INTEGRATION_NAME$j,linkedErrorsIntegration$1);var index$1=Object.freeze({__proto__:null,FunctionToString:FunctionToString,InboundFilters:InboundFilters,LinkedErrors:LinkedErrors$1});class BrowserMetricsAggregator{constructor(e){this._client=e,this._buckets=new Map,this._interval=setInterval((()=>this.flush()),DEFAULT_BROWSER_FLUSH_INTERVAL)}add(e,t,n,r="none",o={},a=timestampInSeconds()){const i=Math.floor(a),s=sanitizeMetricKey(t),c=sanitizeTags(o),l=sanitizeUnit(r),u=getBucketKey(e,s,l,c);let d=this._buckets.get(u);const p=d&&e===SET_METRIC_TYPE?d.metric.weight:0;d?(d.metric.add(n),d.timestamp<i&&(d.timestamp=i)):(d={metric:new METRIC_MAP[e](n),timestamp:i,metricType:e,name:s,unit:l,tags:c},this._buckets.set(u,d));updateMetricSummaryOnActiveSpan(e,s,"string"==typeof n?d.metric.weight-p:n,l,o,u)}flush(){if(0!==this._buckets.size){if(this._client.captureAggregateMetrics){const e=Array.from(this._buckets).map((([,e])=>e));this._client.captureAggregateMetrics(e)}this._buckets.clear()}}close(){clearInterval(this._interval),this.flush()}}const INTEGRATION_NAME$i="MetricsAggregator",_metricsAggregatorIntegration=()=>({name:INTEGRATION_NAME$i,setupOnce(){},setup(e){e.metricsAggregator=new BrowserMetricsAggregator(e)}}),metricsAggregatorIntegration=defineIntegration(_metricsAggregatorIntegration),MetricsAggregator=convertIntegrationFnToClass(INTEGRATION_NAME$i,metricsAggregatorIntegration);function addToMetricsAggregator(e,t,n,r={}){const o=getClient(),a=getCurrentScope();if(o){if(!o.metricsAggregator)return void(DEBUG_BUILD$5&&logger.warn("No metrics aggregator enabled. Please add the MetricsAggregator integration to use metrics APIs"));const{unit:i,tags:s,timestamp:c}=r,{release:l,environment:u}=o.getOptions(),d=a.getTransaction(),p={};l&&(p.release=l),u&&(p.environment=u),d&&(p.transaction=spanToJSON(d).description||""),DEBUG_BUILD$5&&logger.log(`Adding value of ${n} to ${e} metric ${t}`),o.metricsAggregator.add(e,t,n,i,{...p,...s},c)}}function increment(e,t=1,n){addToMetricsAggregator(COUNTER_METRIC_TYPE,e,t,n)}function distribution(e,t,n){addToMetricsAggregator(DISTRIBUTION_METRIC_TYPE,e,t,n)}function set(e,t,n){addToMetricsAggregator(SET_METRIC_TYPE,e,t,n)}function gauge(e,t,n){addToMetricsAggregator(GAUGE_METRIC_TYPE,e,t,n)}const metrics={increment:increment,distribution:distribution,set:set,gauge:gauge,MetricsAggregator:MetricsAggregator,metricsAggregatorIntegration:metricsAggregatorIntegration},Integrations=index$1,DEBUG_BUILD$4="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__;function shouldDisableAutoInstrumentation(e){const t=_optionalChain([e,"call",e=>e(),"access",e=>e.getClient,"call",e=>e(),"optionalAccess",e=>e.getOptions,"call",e=>e()]);return"sentry"!==(_optionalChain([t,"optionalAccess",e=>e.instrumenter])||"sentry")}class Express{static __initStatic(){this.id="Express"}constructor(e={}){this.name=Express.id,this._router=e.router||e.app,this._methods=(Array.isArray(e.methods)?e.methods:[]).concat("use")}setupOnce(e,t){this._router?shouldDisableAutoInstrumentation(t)?DEBUG_BUILD$4&&logger.log("Express Integration is skipped because of instrumenter configuration."):(instrumentMiddlewares(this._router,this._methods),instrumentRouter(this._router)):DEBUG_BUILD$4&&logger.error("ExpressIntegration is missing an Express instance")}}function wrap$2(e,t){const n=e.length;switch(n){case 2:return function(n,r){const o=r.__sentry_transaction;if(o){const n=o.startChild({description:e.name,op:`middleware.express.${t}`,origin:"auto.middleware.express"});r.once("finish",(()=>{n.end()}))}return e.call(this,n,r)};case 3:return function(n,r,o){const a=_optionalChain([r.__sentry_transaction,"optionalAccess",e=>e.startChild,"call",n=>n({description:e.name,op:`middleware.express.${t}`,origin:"auto.middleware.express"})]);e.call(this,n,r,(function(...e){_optionalChain([a,"optionalAccess",e=>e.end,"call",e=>e()]),o.call(this,...e)}))};case 4:return function(n,r,o,a){const i=_optionalChain([o.__sentry_transaction,"optionalAccess",e=>e.startChild,"call",n=>n({description:e.name,op:`middleware.express.${t}`,origin:"auto.middleware.express"})]);e.call(this,n,r,o,(function(...e){_optionalChain([i,"optionalAccess",e=>e.end,"call",e=>e()]),a.call(this,...e)}))};default:throw new Error(`Express middleware takes 2-4 arguments. Got: ${n}`)}}function wrapMiddlewareArgs(e,t){return e.map((e=>"function"==typeof e?wrap$2(e,t):Array.isArray(e)?e.map((e=>"function"==typeof e?wrap$2(e,t):e)):e))}function patchMiddleware(e,t){const n=e[t];return e[t]=function(...e){return n.call(this,...wrapMiddlewareArgs(e,t))},e}function instrumentMiddlewares(e,t=[]){t.forEach((t=>patchMiddleware(e,t)))}function instrumentRouter(e){const t="settings"in e;t&&void 0===e._router&&e.lazyrouter&&e.lazyrouter();const n=t?e._router:e;if(!n)return DEBUG_BUILD$4&&logger.debug("Cannot instrument router for URL Parameterization (did not find a valid router)."),void(DEBUG_BUILD$4&&logger.debug("Routing instrumentation is currently only supported in Express 4."));const r=Object.getPrototypeOf(n),o=r.process_params;r.process_params=function(e,t,n,r,a){n._reconstructedRoute||(n._reconstructedRoute="");const{layerRoutePath:i,isRegex:s,isArray:c,numExtraSegments:l}=getLayerRoutePathInfo(e);let u;(i||s||c)&&(n._hasParameters=!0),u=i||(preventDuplicateSegments(n.originalUrl,n._reconstructedRoute,e.path)||"");const d=u.split("/").filter((e=>e.length>0&&(s||c||!e.includes("*")))).join("/");d&&d.length>0&&(n._reconstructedRoute+=`/${d}${s?"/":""}`);if(getNumberOfUrlSegments(stripUrlQueryAndFragment(n.originalUrl||""))+l===getNumberOfUrlSegments(n._reconstructedRoute)){n._hasParameters||n._reconstructedRoute!==n.originalUrl&&(n._reconstructedRoute=n.originalUrl?stripUrlQueryAndFragment(n.originalUrl):n.originalUrl);const e=r.__sentry_transaction,t=e&&spanToJSON(e).data||{};if(e&&"custom"!==t[SEMANTIC_ATTRIBUTE_SENTRY_SOURCE]){const t=n._reconstructedRoute||"/",[r,o]=extractPathForTransaction(n,{path:!0,method:!0,customRoute:t});e.updateName(r),e.setAttribute(SEMANTIC_ATTRIBUTE_SENTRY_SOURCE,o)}}return o.call(this,e,t,n,r,a)}}Express.__initStatic();const extractOriginalRoute=(e,t,n)=>{if(!(e&&t&&n&&0!==Object.keys(n).length&&_optionalChain([n,"access",e=>e[0],"optionalAccess",e=>e.offset])))return;const r=n.sort(((e,t)=>e.offset-t.offset)),o=new RegExp(t,`${t.flags}d`).exec(e);if(!o||!o.indices)return;const[,...a]=o.indices;if(a.length!==r.length)return;let i=e,s=0;return a.forEach(((e,t)=>{if(e){const[n,o]=e,a=i.substring(0,n-s),c=`:${r[t].name}`,l=i.substring(o-s);i=a+c+l,s+=o-n-c.length}})),i};function getLayerRoutePathInfo(e){let t=_optionalChain([e,"access",e=>e.route,"optionalAccess",e=>e.path]);const n=isRegExp(t),r=Array.isArray(t);if(!t){const[n]=GLOBAL_OBJ.process.versions.node.split(".").map(Number);n>=16&&(t=extractOriginalRoute(e.path,e.regexp,e.keys))}if(!t)return{isRegex:n,isArray:r,numExtraSegments:0};const o=r?Math.max(getNumberOfArrayUrlSegments(t)-getNumberOfUrlSegments(e.path||""),0):0;return{layerRoutePath:getLayerRoutePathString(r,t),isRegex:n,isArray:r,numExtraSegments:o}}function getNumberOfArrayUrlSegments(e){return e.reduce(((e,t)=>e+getNumberOfUrlSegments(t.toString())),0)}function getLayerRoutePathString(e,t){return e?t.map((e=>e.toString())).join(","):t&&t.toString()}function preventDuplicateSegments(e,t,n){const r=_optionalChain([stripUrlQueryAndFragment(e||""),"optionalAccess",e=>e.split,"call",e=>e("/"),"access",e=>e.filter,"call",e=>e((e=>!!e))]);let o=0;const a=_optionalChain([t,"optionalAccess",e=>e.split,"call",e=>e("/"),"access",e=>e.filter,"call",e=>e((e=>!!e)),"access",e=>e.length])||0;return _optionalChain([n,"optionalAccess",e=>e.split,"call",e=>e("/"),"access",e=>e.filter,"call",e=>e((e=>_optionalChain([r,"optionalAccess",e=>e[a+o]])===e&&(o+=1,!0))),"access",e=>e.join,"call",e=>e("/")])}class Postgres{static __initStatic(){this.id="Postgres"}constructor(e={}){this.name=Postgres.id,this._usePgNative=!!e.usePgNative,this._module=e.module}loadDependency(){return this._module=this._module||loadModule("pg")}setupOnce(e,t){if(shouldDisableAutoInstrumentation(t))return void(DEBUG_BUILD$4&&logger.log("Postgres Integration is skipped because of instrumenter configuration."));const n=this.loadDependency();if(!n)return void(DEBUG_BUILD$4&&logger.error("Postgres Integration was unable to require `pg` package."));const r=this._usePgNative?_optionalChain([n,"access",e=>e.native,"optionalAccess",e=>e.Client]):n.Client;r?fill(r.prototype,"query",(function(e){return function(n,r,o){const a=t().getScope().getSpan(),i={"db.system":"postgresql"};try{this.database&&(i["db.name"]=this.database),this.host&&(i["server.address"]=this.host),this.port&&(i["server.port"]=this.port),this.user&&(i["db.user"]=this.user)}catch(e){}const s=_optionalChain([a,"optionalAccess",e=>e.startChild,"call",e=>e({description:"string"==typeof n?n:n.text,op:"db",origin:"auto.db.postgres",data:i})]);if("function"==typeof o)return e.call(this,n,r,(function(e,t){_optionalChain([s,"optionalAccess",e=>e.end,"call",e=>e()]),o(e,t)}));if("function"==typeof r)return e.call(this,n,(function(e,t){_optionalChain([s,"optionalAccess",e=>e.end,"call",e=>e()]),r(e,t)}));const c=void 0!==r?e.call(this,n,r):e.call(this,n);return isThenable(c)?c.then((e=>(_optionalChain([s,"optionalAccess",e=>e.end,"call",e=>e()]),e))):(_optionalChain([s,"optionalAccess",e=>e.end,"call",e=>e()]),c)}})):DEBUG_BUILD$4&&logger.error("Postgres Integration was unable to access 'pg-native' bindings.")}}Postgres.__initStatic();class Mysql{static __initStatic(){this.id="Mysql"}constructor(){this.name=Mysql.id}loadDependency(){return this._module=this._module||loadModule("mysql/lib/Connection.js")}setupOnce(e,t){if(shouldDisableAutoInstrumentation(t))return void(DEBUG_BUILD$4&&logger.log("Mysql Integration is skipped because of instrumenter configuration."));const n=this.loadDependency();if(!n)return void(DEBUG_BUILD$4&&logger.error("Mysql Integration was unable to require `mysql` package."));let r;try{n.prototype.connect=new Proxy(n.prototype.connect,{apply:(e,t,n)=>(r||(r=t.config),e.apply(t,n))})}catch(e){DEBUG_BUILD$4&&logger.error("Mysql Integration was unable to instrument `mysql` config.")}function o(e){if(!e)return;const t=r?{"server.address":r.host,"server.port":r.port,"db.user":r.user}:{};Object.keys(t).forEach((n=>{e.setAttribute(n,t[n])})),e.end()}fill(n,"createQuery",(function(e){return function(n,r,a){const i=_optionalChain([t().getScope().getSpan(),"optionalAccess",e=>e.startChild,"call",e=>e({description:"string"==typeof n?n:n.sql,op:"db",origin:"auto.db.mysql",data:{"db.system":"mysql"}})]);if("function"==typeof a)return e.call(this,n,r,(function(e,t,n){o(i),a(e,t,n)}));if("function"==typeof r)return e.call(this,n,(function(e,t,n){o(i),r(e,t,n)}));const s=e.call(this,n,r);return s.on("end",(()=>{o(i)})),s}}))}}Mysql.__initStatic();const OPERATIONS=["aggregate","bulkWrite","countDocuments","createIndex","createIndexes","deleteMany","deleteOne","distinct","drop","dropIndex","dropIndexes","estimatedDocumentCount","find","findOne","findOneAndDelete","findOneAndReplace","findOneAndUpdate","indexes","indexExists","indexInformation","initializeOrderedBulkOp","insertMany","insertOne","isCapped","mapReduce","options","parallelCollectionScan","rename","replaceOne","stats","updateMany","updateOne"],OPERATION_SIGNATURES={bulkWrite:["operations"],countDocuments:["query"],createIndex:["fieldOrSpec"],createIndexes:["indexSpecs"],deleteMany:["filter"],deleteOne:["filter"],distinct:["key","query"],dropIndex:["indexName"],find:["query"],findOne:["query"],findOneAndDelete:["filter"],findOneAndReplace:["filter","replacement"],findOneAndUpdate:["filter","update"],indexExists:["indexes"],insertMany:["docs"],insertOne:["doc"],mapReduce:["map","reduce"],rename:["newName"],replaceOne:["filter","doc"],updateMany:["filter","update"],updateOne:["filter","update"]};function isCursor(e){return e&&"object"==typeof e&&e.once&&"function"==typeof e.once}class Mongo{static __initStatic(){this.id="Mongo"}constructor(e={}){this.name=Mongo.id,this._operations=Array.isArray(e.operations)?e.operations:OPERATIONS,this._describeOperations=!("describeOperations"in e)||e.describeOperations,this._useMongoose=!!e.useMongoose}loadDependency(){const e=this._useMongoose?"mongoose":"mongodb";return this._module=this._module||loadModule(e)}setupOnce(e,t){if(shouldDisableAutoInstrumentation(t))return void(DEBUG_BUILD$4&&logger.log("Mongo Integration is skipped because of instrumenter configuration."));const n=this.loadDependency();if(n)this._instrumentOperations(n.Collection,this._operations,t);else{const e=this._useMongoose?"mongoose":"mongodb";DEBUG_BUILD$4&&logger.error(`Mongo Integration was unable to require \`${e}\` package.`)}}_instrumentOperations(e,t,n){t.forEach((t=>this._patchOperation(e,t,n)))}_patchOperation(e,t,n){if(!(t in e.prototype))return;const r=this._getSpanContextFromOperationArguments.bind(this);fill(e.prototype,t,(function(e){return function(...o){const a=o[o.length-1],i=n(),s=i.getScope(),c=i.getClient(),l=s.getSpan(),u=_optionalChain([c,"optionalAccess",e=>e.getOptions,"call",e=>e(),"access",e=>e.sendDefaultPii]);if("function"!=typeof a||"mapReduce"===t&&2===o.length){const n=_optionalChain([l,"optionalAccess",e=>e.startChild,"call",e=>e(r(this,t,o,u))]),a=e.call(this,...o);if(isThenable(a))return a.then((e=>(_optionalChain([n,"optionalAccess",e=>e.end,"call",e=>e()]),e)));if(isCursor(a)){const e=a;try{e.once("close",(()=>{_optionalChain([n,"optionalAccess",e=>e.end,"call",e=>e()])}))}catch(e){_optionalChain([n,"optionalAccess",e=>e.end,"call",e=>e()])}return e}return _optionalChain([n,"optionalAccess",e=>e.end,"call",e=>e()]),a}const d=_optionalChain([l,"optionalAccess",e=>e.startChild,"call",e=>e(r(this,t,o.slice(0,-1)))]);return e.call(this,...o.slice(0,-1),(function(e,t){_optionalChain([d,"optionalAccess",e=>e.end,"call",e=>e()]),a(e,t)}))}}))}_getSpanContextFromOperationArguments(e,t,n,r=!1){const o={"db.system":"mongodb","db.name":e.dbName,"db.operation":t,"db.mongodb.collection":e.collectionName},a={op:"db",origin:"auto.db.mongo",description:t,data:o},i=OPERATION_SIGNATURES[t],s=Array.isArray(this._describeOperations)?this._describeOperations.includes(t):this._describeOperations;if(!i||!s||!r)return a;try{if("mapReduce"===t){const[e,t]=n;o[i[0]]="string"==typeof e?e:e.name||"<anonymous>",o[i[1]]="string"==typeof t?t:t.name||"<anonymous>"}else for(let e=0;e<i.length;e++)o[`db.mongodb.${i[e]}`]=JSON.stringify(n[e])}catch(e){}return a}}function isValidPrismaClient(e){return!!e&&!!e.$use}Mongo.__initStatic();class Prisma{static __initStatic(){this.id="Prisma"}constructor(e={}){if(this.name=Prisma.id,isValidPrismaClient(e.client)&&!e.client._sentryInstrumented){addNonEnumerableProperty(e.client,"_sentryInstrumented",!0);const t={};try{const n=e.client._engineConfig;if(n){const{activeProvider:e,clientVersion:r}=n;e&&(t["db.system"]=e),r&&(t["db.prisma.version"]=r)}}catch(e){}e.client.$use(((e,n)=>{if(shouldDisableAutoInstrumentation(getCurrentHub))return n(e);const r=e.action,o=e.model;return startSpan({name:o?`${o} ${r}`:r,onlyIfParent:!0,op:"db.prisma",attributes:{[SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN]:"auto.db.prisma"},data:{...t,"db.operation":r}},(()=>n(e)))}))}else DEBUG_BUILD$4&&logger.warn("Unsupported Prisma client provided to PrismaIntegration. Provided client:",e.client)}setupOnce(){}}Prisma.__initStatic();class GraphQL{static __initStatic(){this.id="GraphQL"}constructor(){this.name=GraphQL.id}loadDependency(){return this._module=this._module||loadModule("graphql/execution/execute.js")}setupOnce(e,t){if(shouldDisableAutoInstrumentation(t))return void(DEBUG_BUILD$4&&logger.log("GraphQL Integration is skipped because of instrumenter configuration."));const n=this.loadDependency();n?fill(n,"execute",(function(e){return function(...n){const r=t().getScope(),o=r.getSpan(),a=_optionalChain([o,"optionalAccess",e=>e.startChild,"call",e=>e({description:"execute",op:"graphql.execute",origin:"auto.graphql.graphql"})]);_optionalChain([r,"optionalAccess",e=>e.setSpan,"call",e=>e(a)]);const i=e.call(this,...n);return isThenable(i)?i.then((e=>(_optionalChain([a,"optionalAccess",e=>e.end,"call",e=>e()]),_optionalChain([r,"optionalAccess",e=>e.setSpan,"call",e=>e(o)]),e))):(_optionalChain([a,"optionalAccess",e=>e.end,"call",e=>e()]),_optionalChain([r,"optionalAccess",e=>e.setSpan,"call",e=>e(o)]),i)}})):DEBUG_BUILD$4&&logger.error("GraphQL Integration was unable to require graphql/execution package.")}}GraphQL.__initStatic();class Apollo{static __initStatic(){this.id="Apollo"}constructor(e={useNestjs:!1}){this.name=Apollo.id,this._useNest=!!e.useNestjs}loadDependency(){return this._useNest?this._module=this._module||loadModule("@nestjs/graphql"):this._module=this._module||loadModule("apollo-server-core"),this._module}setupOnce(e,t){if(shouldDisableAutoInstrumentation(t))DEBUG_BUILD$4&&logger.log("Apollo Integration is skipped because of instrumenter configuration.");else if(this._useNest){const e=this.loadDependency();if(!e)return void(DEBUG_BUILD$4&&logger.error("Apollo-NestJS Integration was unable to require @nestjs/graphql package."));fill(e.GraphQLFactory.prototype,"mergeWithSchema",(function(e){return function(...n){return fill(this.resolversExplorerService,"explore",(function(e){return function(){return instrumentResolvers(arrayify(e.call(this)),t)}})),e.call(this,...n)}}))}else{const e=this.loadDependency();if(!e)return void(DEBUG_BUILD$4&&logger.error("Apollo Integration was unable to require apollo-server-core package."));fill(e.ApolloServerBase.prototype,"constructSchema",(function(e){return function(){if(!this.config.resolvers)return DEBUG_BUILD$4&&(this.config.schema?(logger.warn("Apollo integration is not able to trace `ApolloServer` instances constructed via `schema` property.If you are using NestJS with Apollo, please use `Sentry.Integrations.Apollo({ useNestjs: true })` instead."),logger.warn()):this.config.modules&&logger.warn("Apollo integration is not able to trace `ApolloServer` instances constructed via `modules` property."),logger.error("Skipping tracing as no resolvers found on the `ApolloServer` instance.")),e.call(this);const n=arrayify(this.config.resolvers);return this.config.resolvers=instrumentResolvers(n,t),e.call(this)}}))}}}function instrumentResolvers(e,t){return e.map((e=>(Object.keys(e).forEach((n=>{Object.keys(e[n]).forEach((r=>{"function"==typeof e[n][r]&&wrapResolver(e,n,r,t)}))})),e)))}function wrapResolver(e,t,n,r){fill(e[t],n,(function(e){return function(...o){const a=_optionalChain([r().getScope().getSpan(),"optionalAccess",e=>e.startChild,"call",e=>e({description:`${t}.${n}`,op:"graphql.resolve",origin:"auto.graphql.apollo"})]),i=e.call(this,...o);return isThenable(i)?i.then((e=>(_optionalChain([a,"optionalAccess",e=>e.end,"call",e=>e()]),e))):(_optionalChain([a,"optionalAccess",e=>e.end,"call",e=>e()]),i)}}))}Apollo.__initStatic();const WINDOW$6=GLOBAL_OBJ;function registerBackgroundTabDetection(){WINDOW$6.document?WINDOW$6.document.addEventListener("visibilitychange",(()=>{const e=getActiveTransaction();if(WINDOW$6.document.hidden&&e){const t="cancelled",{op:n,status:r}=spanToJSON(e);DEBUG_BUILD$4&&logger.log(`[Tracing] Transaction: ${t} -> since tab moved to the background, op: ${n}`),r||e.setStatus(t),e.setTag("visibilitychange","document.hidden"),e.end()}})):DEBUG_BUILD$4&&logger.warn("[Tracing] Could not set up background tab detection due to lack of global document")}const bindReporter=(e,t,n)=>{let r,o;return a=>{t.value>=0&&(a||n)&&(o=t.value-(r||0),(o||void 0===r)&&(r=t.value,t.delta=o,e(t)))}},generateUniqueID=()=>`v3-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,getNavigationEntryFromPerformanceTiming=()=>{const e=WINDOW$6.performance.timing,t=WINDOW$6.performance.navigation.type,n={entryType:"navigation",startTime:0,type:2==t?"back_forward":1===t?"reload":"navigate"};for(const t in e)"navigationStart"!==t&&"toJSON"!==t&&(n[t]=Math.max(e[t]-e.navigationStart,0));return n},getNavigationEntry=()=>WINDOW$6.__WEB_VITALS_POLYFILL__?WINDOW$6.performance&&(performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]||getNavigationEntryFromPerformanceTiming()):WINDOW$6.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0],getActivationStart=()=>{const e=getNavigationEntry();return e&&e.activationStart||0},initMetric=(e,t)=>{const n=getNavigationEntry();let r="navigate";return n&&(r=WINDOW$6.document&&WINDOW$6.document.prerendering||getActivationStart()>0?"prerender":n.type.replace(/_/g,"-")),{name:e,value:void 0===t?-1:t,rating:"good",delta:0,entries:[],id:generateUniqueID(),navigationType:r}},observe=(e,t,n)=>{try{if(PerformanceObserver.supportedEntryTypes.includes(e)){const r=new PerformanceObserver((e=>{t(e.getEntries())}));return r.observe(Object.assign({type:e,buffered:!0},n||{})),r}}catch(e){}},onHidden=(e,t)=>{const n=r=>{"pagehide"!==r.type&&"hidden"!==WINDOW$6.document.visibilityState||(e(r),t&&(removeEventListener("visibilitychange",n,!0),removeEventListener("pagehide",n,!0)))};WINDOW$6.document&&(addEventListener("visibilitychange",n,!0),addEventListener("pagehide",n,!0))},onCLS=(e,t={})=>{const n=initMetric("CLS",0);let r,o=0,a=[];const i=e=>{e.forEach((e=>{if(!e.hadRecentInput){const t=a[0],i=a[a.length-1];o&&0!==a.length&&e.startTime-i.startTime<1e3&&e.startTime-t.startTime<5e3?(o+=e.value,a.push(e)):(o=e.value,a=[e]),o>n.value&&(n.value=o,n.entries=a,r&&r())}}))},s=observe("layout-shift",i);if(s){r=bindReporter(e,n,t.reportAllChanges);const o=()=>{i(s.takeRecords()),r(!0)};return onHidden(o),o}};let firstHiddenTime=-1;const initHiddenTime=()=>{WINDOW$6.document&&WINDOW$6.document.visibilityState&&(firstHiddenTime="hidden"!==WINDOW$6.document.visibilityState||WINDOW$6.document.prerendering?1/0:0)},trackChanges=()=>{onHidden((({timeStamp:e})=>{firstHiddenTime=e}),!0)},getVisibilityWatcher=()=>(firstHiddenTime<0&&(initHiddenTime(),trackChanges()),{get firstHiddenTime(){return firstHiddenTime}}),onFID=e=>{const t=getVisibilityWatcher(),n=initMetric("FID");let r;const o=e=>{e.startTime<t.firstHiddenTime&&(n.value=e.processingStart-e.startTime,n.entries.push(e),r(!0))},a=e=>{e.forEach(o)},i=observe("first-input",a);r=bindReporter(e,n),i&&onHidden((()=>{a(i.takeRecords()),i.disconnect()}),!0)};let interactionCountEstimate=0,minKnownInteractionId=1/0,maxKnownInteractionId=0;const updateEstimate=e=>{e.forEach((e=>{e.interactionId&&(minKnownInteractionId=Math.min(minKnownInteractionId,e.interactionId),maxKnownInteractionId=Math.max(maxKnownInteractionId,e.interactionId),interactionCountEstimate=maxKnownInteractionId?(maxKnownInteractionId-minKnownInteractionId)/7+1:0)}))};let po;const getInteractionCount=()=>po?interactionCountEstimate:performance.interactionCount||0,initInteractionCountPolyfill=()=>{"interactionCount"in performance||po||(po=observe("event",updateEstimate,{type:"event",buffered:!0,durationThreshold:0}))},getInteractionCountForNavigation=()=>getInteractionCount(),MAX_INTERACTIONS_TO_CONSIDER=10,longestInteractionList=[],longestInteractionMap={},processEntry=e=>{const t=longestInteractionList[longestInteractionList.length-1],n=longestInteractionMap[e.interactionId];if(n||longestInteractionList.length<MAX_INTERACTIONS_TO_CONSIDER||e.duration>t.latency){if(n)n.entries.push(e),n.latency=Math.max(n.latency,e.duration);else{const t={id:e.interactionId,latency:e.duration,entries:[e]};longestInteractionMap[t.id]=t,longestInteractionList.push(t)}longestInteractionList.sort(((e,t)=>t.latency-e.latency)),longestInteractionList.splice(MAX_INTERACTIONS_TO_CONSIDER).forEach((e=>{delete longestInteractionMap[e.id]}))}},estimateP98LongestInteraction=()=>{const e=Math.min(longestInteractionList.length-1,Math.floor(getInteractionCountForNavigation()/50));return longestInteractionList[e]},onINP=(e,t)=>{t=t||{},initInteractionCountPolyfill();const n=initMetric("INP");let r;const o=e=>{e.forEach((e=>{if(e.interactionId&&processEntry(e),"first-input"===e.entryType){!longestInteractionList.some((t=>t.entries.some((t=>e.duration===t.duration&&e.startTime===t.startTime))))&&processEntry(e)}}));const t=estimateP98LongestInteraction();t&&t.latency!==n.value&&(n.value=t.latency,n.entries=t.entries,r())},a=observe("event",o,{durationThreshold:t.durationThreshold||40});r=bindReporter(e,n,t.reportAllChanges),a&&(a.observe({type:"first-input",buffered:!0}),onHidden((()=>{o(a.takeRecords()),n.value<0&&getInteractionCountForNavigation()>0&&(n.value=0,n.entries=[]),r(!0)})))},reportedMetricIDs={},onLCP=e=>{const t=getVisibilityWatcher(),n=initMetric("LCP");let r;const o=e=>{const o=e[e.length-1];if(o){const e=Math.max(o.startTime-getActivationStart(),0);e<t.firstHiddenTime&&(n.value=e,n.entries=[o],r())}},a=observe("largest-contentful-paint",o);if(a){r=bindReporter(e,n);const t=()=>{reportedMetricIDs[n.id]||(o(a.takeRecords()),a.disconnect(),reportedMetricIDs[n.id]=!0,r(!0))};return["keydown","click"].forEach((e=>{WINDOW$6.document&&addEventListener(e,t,{once:!0,capture:!0})})),onHidden(t,!0),t}},whenReady=e=>{WINDOW$6.document&&(WINDOW$6.document.prerendering?addEventListener("prerenderingchange",(()=>whenReady(e)),!0):"complete"!==WINDOW$6.document.readyState?addEventListener("load",(()=>whenReady(e)),!0):setTimeout(e,0))},onTTFB=(e,t)=>{t=t||{};const n=initMetric("TTFB"),r=bindReporter(e,n,t.reportAllChanges);whenReady((()=>{const e=getNavigationEntry();if(e){if(n.value=Math.max(e.responseStart-getActivationStart(),0),n.value<0||n.value>performance.now())return;n.entries=[e],r(!0)}}))},handlers$1={},instrumented={};let _previousCls,_previousFid,_previousLcp,_previousTtfb,_previousInp;function addClsInstrumentationHandler(e,t=!1){return addMetricObserver("cls",e,instrumentCls,_previousCls,t)}function addLcpInstrumentationHandler(e,t=!1){return addMetricObserver("lcp",e,instrumentLcp,_previousLcp,t)}function addTtfbInstrumentationHandler(e){return addMetricObserver("ttfb",e,instrumentTtfb,_previousTtfb)}function addFidInstrumentationHandler(e){return addMetricObserver("fid",e,instrumentFid,_previousFid)}function addInpInstrumentationHandler(e){return addMetricObserver("inp",e,instrumentInp,_previousInp)}function addPerformanceInstrumentationHandler(e,t){return addHandler(e,t),instrumented[e]||(instrumentPerformanceObserver(e),instrumented[e]=!0),getCleanupCallback(e,t)}function triggerHandlers(e,t){const n=handlers$1[e];if(n&&n.length)for(const r of n)try{r(t)}catch(t){DEBUG_BUILD$4&&logger.error(`Error while triggering instrumentation handler.\nType: ${e}\nName: ${getFunctionName(r)}\nError:`,t)}}function instrumentCls(){return onCLS((e=>{triggerHandlers("cls",{metric:e}),_previousCls=e}),{reportAllChanges:!0})}function instrumentFid(){return onFID((e=>{triggerHandlers("fid",{metric:e}),_previousFid=e}))}function instrumentLcp(){return onLCP((e=>{triggerHandlers("lcp",{metric:e}),_previousLcp=e}))}function instrumentTtfb(){return onTTFB((e=>{triggerHandlers("ttfb",{metric:e}),_previousTtfb=e}))}function instrumentInp(){return onINP((e=>{triggerHandlers("inp",{metric:e}),_previousInp=e}))}function addMetricObserver(e,t,n,r,o=!1){let a;return addHandler(e,t),instrumented[e]||(a=n(),instrumented[e]=!0),r&&t({metric:r}),getCleanupCallback(e,t,o?a:void 0)}function instrumentPerformanceObserver(e){const t={};"event"===e&&(t.durationThreshold=0),observe(e,(t=>{triggerHandlers(e,{entries:t})}),t)}function addHandler(e,t){handlers$1[e]=handlers$1[e]||[],handlers$1[e].push(t)}function getCleanupCallback(e,t,n){return()=>{n&&n();const r=handlers$1[e];if(!r)return;const o=r.indexOf(t);-1!==o&&r.splice(o,1)}}function isMeasurementValue(e){return"number"==typeof e&&isFinite(e)}function _startChild(e,{startTimestamp:t,...n}){return t&&e.startTimestamp>t&&(e.startTimestamp=t),e.startChild({startTimestamp:t,...n})}const MAX_INT_AS_BYTES=2147483647;function msToSec(e){return e/1e3}function getBrowserPerformanceAPI(){return WINDOW$6&&WINDOW$6.addEventListener&&WINDOW$6.performance}let _performanceCursor=0,_measurements={},_lcpEntry,_clsEntry;function startTrackingWebVitals(){const e=getBrowserPerformanceAPI();if(e&&browserPerformanceTimeOrigin){e.mark&&WINDOW$6.performance.mark("sentry-tracing-init");const t=_trackFID(),n=_trackCLS(),r=_trackLCP(),o=_trackTtfb();return()=>{t(),n(),r(),o()}}return()=>{}}function startTrackingLongTasks(){addPerformanceInstrumentationHandler("longtask",(({entries:e})=>{for(const t of e){const e=getActiveTransaction();if(!e)return;const n=msToSec(browserPerformanceTimeOrigin+t.startTime),r=msToSec(t.duration);e.startChild({description:"Main UI thread blocked",op:"ui.long-task",origin:"auto.ui.browser.metrics",startTimestamp:n,endTimestamp:n+r})}}))}function startTrackingInteractions(){addPerformanceInstrumentationHandler("event",(({entries:e})=>{for(const t of e){const e=getActiveTransaction();if(!e)return;if("click"===t.name){const n=msToSec(browserPerformanceTimeOrigin+t.startTime),r=msToSec(t.duration),o={description:htmlTreeAsString(t.target),op:`ui.interaction.${t.name}`,origin:"auto.ui.browser.metrics",startTimestamp:n,endTimestamp:n+r},a=getComponentName(t.target);a&&(o.attributes={"ui.component_name":a}),e.startChild(o)}}}))}function startTrackingINP(e,t){if(getBrowserPerformanceAPI()&&browserPerformanceTimeOrigin){const n=_trackINP(e,t);return()=>{n()}}return()=>{}}function _trackCLS(){return addClsInstrumentationHandler((({metric:e})=>{const t=e.entries[e.entries.length-1];t&&(DEBUG_BUILD$4&&logger.log("[Measurements] Adding CLS"),_measurements.cls={value:e.value,unit:""},_clsEntry=t)}),!0)}function _trackLCP(){return addLcpInstrumentationHandler((({metric:e})=>{const t=e.entries[e.entries.length-1];t&&(DEBUG_BUILD$4&&logger.log("[Measurements] Adding LCP"),_measurements.lcp={value:e.value,unit:"millisecond"},_lcpEntry=t)}),!0)}function _trackFID(){return addFidInstrumentationHandler((({metric:e})=>{const t=e.entries[e.entries.length-1];if(!t)return;const n=msToSec(browserPerformanceTimeOrigin),r=msToSec(t.startTime);DEBUG_BUILD$4&&logger.log("[Measurements] Adding FID"),_measurements.fid={value:e.value,unit:"millisecond"},_measurements["mark.fid"]={value:n+r,unit:"second"}}))}function _trackTtfb(){return addTtfbInstrumentationHandler((({metric:e})=>{e.entries[e.entries.length-1]&&(DEBUG_BUILD$4&&logger.log("[Measurements] Adding TTFB"),_measurements.ttfb={value:e.value,unit:"millisecond"})}))}const INP_ENTRY_MAP={click:"click",pointerdown:"click",pointerup:"click",mousedown:"click",mouseup:"click",touchstart:"click",touchend:"click",mouseover:"hover",mouseout:"hover",mouseenter:"hover",mouseleave:"hover",pointerover:"hover",pointerout:"hover",pointerenter:"hover",pointerleave:"hover",dragstart:"drag",dragend:"drag",drag:"drag",dragenter:"drag",dragleave:"drag",dragover:"drag",drop:"drag",keydown:"press",keyup:"press",keypress:"press",input:"press"};function _trackINP(e,t){return addInpInstrumentationHandler((({metric:n})=>{if(void 0===n.value)return;const r=n.entries.find((e=>e.duration===n.value&&void 0!==INP_ENTRY_MAP[e.name])),o=getClient();if(!r||!o)return;const a=INP_ENTRY_MAP[r.name],i=o.getOptions(),s=msToSec(browserPerformanceTimeOrigin+r.startTime),c=msToSec(n.value),l=void 0!==r.interactionId?e[r.interactionId]:void 0;if(void 0===l)return;const{routeName:u,parentContext:d,activeTransaction:p,user:g,replayId:h}=l,f=void 0!==g?g.email||g.id||g.ip_address:void 0,m=void 0!==p?p.getProfileId():void 0,_=new Span({startTimestamp:s,endTimestamp:s+c,op:`ui.interaction.${a}`,name:htmlTreeAsString(r.target),attributes:{release:i.release,environment:i.environment,transaction:u,...void 0!==f&&""!==f?{user:f}:{},...void 0!==m?{profile_id:m}:{},...void 0!==h?{replay_id:h}:{}},exclusiveTime:n.value,measurements:{inp:{value:n.value,unit:"millisecond"}}}),E=getSampleRate(d,i,t);if(E)if(Math.random()<E){const e=_?createSpanEnvelope([_],o.getDsn()):void 0,t=o&&o.getTransport();t&&e&&t.send(e).then(null,(e=>{DEBUG_BUILD$4&&logger.error("Error while sending interaction:",e)}))}else;}))}function addPerformanceEntries(e){const t=getBrowserPerformanceAPI();if(!t||!WINDOW$6.performance.getEntries||!browserPerformanceTimeOrigin)return;DEBUG_BUILD$4&&logger.log("[Tracing] Adding & adjusting spans using Performance API");const n=msToSec(browserPerformanceTimeOrigin),r=t.getEntries(),{op:o,start_timestamp:a}=spanToJSON(e);if(r.slice(_performanceCursor).forEach((t=>{const r=msToSec(t.startTime),o=msToSec(t.duration);if(!("navigation"===e.op&&a&&n+r<a))switch(t.entryType){case"navigation":_addNavigationSpans(e,t,n);break;case"mark":case"paint":case"measure":{_addMeasureSpans(e,t,r,o,n);const a=getVisibilityWatcher(),i=t.startTime<a.firstHiddenTime;"first-paint"===t.name&&i&&(DEBUG_BUILD$4&&logger.log("[Measurements] Adding FP"),_measurements.fp={value:t.startTime,unit:"millisecond"}),"first-contentful-paint"===t.name&&i&&(DEBUG_BUILD$4&&logger.log("[Measurements] Adding FCP"),_measurements.fcp={value:t.startTime,unit:"millisecond"});break}case"resource":_addResourceSpans(e,t,t.name,r,o,n)}})),_performanceCursor=Math.max(r.length-1,0),_trackNavigator(e),"pageload"===o){_addTtfbRequestTimeToMeasurements(_measurements),["fcp","fp","lcp"].forEach((e=>{if(!_measurements[e]||!a||n>=a)return;const t=_measurements[e].value,r=n+msToSec(t),o=Math.abs(1e3*(r-a)),i=o-t;DEBUG_BUILD$4&&logger.log(`[Measurements] Normalized ${e} from ${t} to ${o} (${i})`),_measurements[e].value=o}));const t=_measurements["mark.fid"];t&&_measurements.fid&&(_startChild(e,{description:"first input delay",endTimestamp:t.value+msToSec(_measurements.fid.value),op:"ui.action",origin:"auto.ui.browser.metrics",startTimestamp:t.value}),delete _measurements["mark.fid"]),"fcp"in _measurements||delete _measurements.cls,Object.keys(_measurements).forEach((e=>{setMeasurement(e,_measurements[e].value,_measurements[e].unit)})),_tagMetricInfo(e)}_lcpEntry=void 0,_clsEntry=void 0,_measurements={}}function _addMeasureSpans(e,t,n,r,o){const a=o+n,i=a+r;return _startChild(e,{description:t.name,endTimestamp:i,op:t.entryType,origin:"auto.resource.browser.metrics",startTimestamp:a}),a}function _addNavigationSpans(e,t,n){["unloadEvent","redirect","domContentLoadedEvent","loadEvent","connect"].forEach((r=>{_addPerformanceNavigationTiming(e,t,r,n)})),_addPerformanceNavigationTiming(e,t,"secureConnection",n,"TLS/SSL","connectEnd"),_addPerformanceNavigationTiming(e,t,"fetch",n,"cache","domainLookupStart"),_addPerformanceNavigationTiming(e,t,"domainLookup",n,"DNS"),_addRequest(e,t,n)}function _addPerformanceNavigationTiming(e,t,n,r,o,a){const i=a?t[a]:t[`${n}End`],s=t[`${n}Start`];s&&i&&_startChild(e,{op:"browser",origin:"auto.browser.browser.metrics",description:o||n,startTimestamp:r+msToSec(s),endTimestamp:r+msToSec(i)})}function _addRequest(e,t,n){t.responseEnd&&(_startChild(e,{op:"browser",origin:"auto.browser.browser.metrics",description:"request",startTimestamp:n+msToSec(t.requestStart),endTimestamp:n+msToSec(t.responseEnd)}),_startChild(e,{op:"browser",origin:"auto.browser.browser.metrics",description:"response",startTimestamp:n+msToSec(t.responseStart),endTimestamp:n+msToSec(t.responseEnd)}))}function _addResourceSpans(e,t,n,r,o,a){if("xmlhttprequest"===t.initiatorType||"fetch"===t.initiatorType)return;const i=parseUrl(n),s={};setResourceEntrySizeData(s,t,"transferSize","http.response_transfer_size"),setResourceEntrySizeData(s,t,"encodedBodySize","http.response_content_length"),setResourceEntrySizeData(s,t,"decodedBodySize","http.decoded_response_content_length"),"renderBlockingStatus"in t&&(s["resource.render_blocking_status"]=t.renderBlockingStatus),i.protocol&&(s["url.scheme"]=i.protocol.split(":").pop()),i.host&&(s["server.address"]=i.host),s["url.same_origin"]=n.includes(WINDOW$6.location.origin);const c=a+r,l=c+o;_startChild(e,{description:n.replace(WINDOW$6.location.origin,""),endTimestamp:l,op:t.initiatorType?`resource.${t.initiatorType}`:"resource.other",origin:"auto.resource.browser.metrics",startTimestamp:c,data:s})}function _trackNavigator(e){const t=WINDOW$6.navigator;if(!t)return;const n=t.connection;n&&(n.effectiveType&&e.setTag("effectiveConnectionType",n.effectiveType),n.type&&e.setTag("connectionType",n.type),isMeasurementValue(n.rtt)&&(_measurements["connection.rtt"]={value:n.rtt,unit:"millisecond"})),isMeasurementValue(t.deviceMemory)&&e.setTag("deviceMemory",`${t.deviceMemory} GB`),isMeasurementValue(t.hardwareConcurrency)&&e.setTag("hardwareConcurrency",String(t.hardwareConcurrency))}function _tagMetricInfo(e){_lcpEntry&&(DEBUG_BUILD$4&&logger.log("[Measurements] Adding LCP Data"),_lcpEntry.element&&e.setTag("lcp.element",htmlTreeAsString(_lcpEntry.element)),_lcpEntry.id&&e.setTag("lcp.id",_lcpEntry.id),_lcpEntry.url&&e.setTag("lcp.url",_lcpEntry.url.trim().slice(0,200)),e.setTag("lcp.size",_lcpEntry.size)),_clsEntry&&_clsEntry.sources&&(DEBUG_BUILD$4&&logger.log("[Measurements] Adding CLS Data"),_clsEntry.sources.forEach(((t,n)=>e.setTag(`cls.source.${n+1}`,htmlTreeAsString(t.node)))))}function setResourceEntrySizeData(e,t,n,r){const o=t[n];null!=o&&o<MAX_INT_AS_BYTES&&(e[r]=o)}function _addTtfbRequestTimeToMeasurements(e){const t=getNavigationEntry();if(!t)return;const{responseStart:n,requestStart:r}=t;r<=n&&(DEBUG_BUILD$4&&logger.log("[Measurements] Adding TTFB Request Time"),e["ttfb.requestTime"]={value:n-r,unit:"millisecond"})}function getSampleRate(e,t,n){if(!hasTracingEnabled(t))return!1;let r;return r=void 0!==e&&"function"==typeof t.tracesSampler?t.tracesSampler({transactionContext:e,name:e.name,parentSampled:e.parentSampled,attributes:{...e.data,...e.attributes},location:WINDOW$6.location}):void 0!==e&&void 0!==e.sampled?e.sampled:void 0!==t.tracesSampleRate?t.tracesSampleRate:1,isValidSampleRate$1(r)?!0===r?n:!1===r?0:r*n:(DEBUG_BUILD$4&&logger.warn("[Tracing] Discarding interaction span because of invalid sample rate."),!1)}function instrumentFetchRequest(e,t,n,r,o="auto.http.browser"){if(!hasTracingEnabled()||!e.fetchData)return;const a=t(e.fetchData.url);if(e.endTimestamp&&a){const t=e.fetchData.__span;if(!t)return;const n=r[t];return void(n&&(endSpan(n,e),delete r[t]))}const i=getCurrentScope(),s=getClient(),{method:c,url:l}=e.fetchData,u=getFullURL$1(l),d=u?parseUrl(u).host:void 0,p=a?startInactiveSpan({name:`${c} ${l}`,onlyIfParent:!0,attributes:{url:l,type:"fetch","http.method":c,"http.url":u,"server.address":d,[SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN]:o},op:"http.client"}):void 0;if(p&&(e.fetchData.__span=p.spanContext().spanId,r[p.spanContext().spanId]=p),n(e.fetchData.url)&&s){const t=e.args[0];e.args[1]=e.args[1]||{};const n=e.args[1];n.headers=addTracingHeadersToFetchRequest(t,s,i,n,p)}return p}function addTracingHeadersToFetchRequest(e,t,n,r,o){const a=o||n.getSpan(),i=getIsolationScope(),{traceId:s,spanId:c,sampled:l,dsc:u}={...i.getPropagationContext(),...n.getPropagationContext()},d=a?spanToTraceHeader(a):generateSentryTraceHeader(s,c,l),p=dynamicSamplingContextToSentryBaggageHeader(u||(a?getDynamicSamplingContextFromSpan(a):getDynamicSamplingContextFromClient(s,t,n))),g=r.headers||("undefined"!=typeof Request&&isInstanceOf(e,Request)?e.headers:void 0);if(g){if("undefined"!=typeof Headers&&isInstanceOf(g,Headers)){const e=new Headers(g);return e.append("sentry-trace",d),p&&e.append(BAGGAGE_HEADER_NAME,p),e}if(Array.isArray(g)){const e=[...g,["sentry-trace",d]];return p&&e.push([BAGGAGE_HEADER_NAME,p]),e}{const e="baggage"in g?g.baggage:void 0,t=[];return Array.isArray(e)?t.push(...e):e&&t.push(e),p&&t.push(p),{...g,"sentry-trace":d,baggage:t.length>0?t.join(","):void 0}}}return{"sentry-trace":d,baggage:p}}function getFullURL$1(e){try{return new URL(e).href}catch(e){return}}function endSpan(e,t){if(t.response){setHttpStatus(e,t.response.status);const n=t.response&&t.response.headers&&t.response.headers.get("content-length");if(n){const t=parseInt(n);t>0&&e.setAttribute("http.response_content_length",t)}}else t.error&&e.setStatus("internal_error");e.end()}const DEFAULT_TRACE_PROPAGATION_TARGETS=["localhost",/^\/(?!\/)/],defaultRequestInstrumentationOptions={traceFetch:!0,traceXHR:!0,enableHTTPTimings:!0,tracingOrigins:DEFAULT_TRACE_PROPAGATION_TARGETS,tracePropagationTargets:DEFAULT_TRACE_PROPAGATION_TARGETS};function instrumentOutgoingRequests(e){const{traceFetch:t,traceXHR:n,tracePropagationTargets:r,tracingOrigins:o,shouldCreateSpanForRequest:a,enableHTTPTimings:i}={traceFetch:defaultRequestInstrumentationOptions.traceFetch,traceXHR:defaultRequestInstrumentationOptions.traceXHR,...e},s="function"==typeof a?a:e=>!0,c=e=>shouldAttachHeaders(e,r||o),l={};t&&addFetchInstrumentationHandler((e=>{const t=instrumentFetchRequest(e,s,c,l);if(t){const n=getFullURL(e.fetchData.url),r=n?parseUrl(n).host:void 0;t.setAttributes({"http.url":n,"server.address":r})}i&&t&&addHTTPTimings(t)})),n&&addXhrInstrumentationHandler((e=>{const t=xhrCallback(e,s,c,l);i&&t&&addHTTPTimings(t)}))}function isPerformanceResourceTiming(e){return"resource"===e.entryType&&"initiatorType"in e&&"string"==typeof e.nextHopProtocol&&("fetch"===e.initiatorType||"xmlhttprequest"===e.initiatorType)}function addHTTPTimings(e){const{url:t}=spanToJSON(e).data||{};if(!t||"string"!=typeof t)return;const n=addPerformanceInstrumentationHandler("resource",(({entries:r})=>{r.forEach((r=>{if(isPerformanceResourceTiming(r)&&r.name.endsWith(t)){resourceTimingEntryToSpanData(r).forEach((t=>e.setAttribute(...t))),setTimeout(n)}}))}))}function extractNetworkProtocol(e){let t="unknown",n="unknown",r="";for(const o of e){if("/"===o){[t,n]=e.split("/");break}if(!isNaN(Number(o))){t="h"===r?"http":r,n=e.split(r)[1];break}r+=o}return r===e&&(t=r),{name:t,version:n}}function getAbsoluteTime$1(e=0){return((browserPerformanceTimeOrigin||performance.timeOrigin)+e)/1e3}function resourceTimingEntryToSpanData(e){const{name:t,version:n}=extractNetworkProtocol(e.nextHopProtocol),r=[];return r.push(["network.protocol.version",n],["network.protocol.name",t]),browserPerformanceTimeOrigin?[...r,["http.request.redirect_start",getAbsoluteTime$1(e.redirectStart)],["http.request.fetch_start",getAbsoluteTime$1(e.fetchStart)],["http.request.domain_lookup_start",getAbsoluteTime$1(e.domainLookupStart)],["http.request.domain_lookup_end",getAbsoluteTime$1(e.domainLookupEnd)],["http.request.connect_start",getAbsoluteTime$1(e.connectStart)],["http.request.secure_connection_start",getAbsoluteTime$1(e.secureConnectionStart)],["http.request.connection_end",getAbsoluteTime$1(e.connectEnd)],["http.request.request_start",getAbsoluteTime$1(e.requestStart)],["http.request.response_start",getAbsoluteTime$1(e.responseStart)],["http.request.response_end",getAbsoluteTime$1(e.responseEnd)]]:r}function shouldAttachHeaders(e,t){return stringMatchesSomePattern(e,t||DEFAULT_TRACE_PROPAGATION_TARGETS)}function xhrCallback(e,t,n,r){const o=e.xhr,a=o&&o[SENTRY_XHR_DATA_KEY];if(!hasTracingEnabled()||!o||o.__sentry_own_request__||!a)return;const i=t(a.url);if(e.endTimestamp&&i){const e=o.__sentry_xhr_span_id__;if(!e)return;const t=r[e];return void(t&&void 0!==a.status_code&&(setHttpStatus(t,a.status_code),t.end(),delete r[e]))}const s=getCurrentScope(),c=getIsolationScope(),l=getFullURL(a.url),u=l?parseUrl(l).host:void 0,d=i?startInactiveSpan({name:`${a.method} ${a.url}`,onlyIfParent:!0,attributes:{type:"xhr","http.method":a.method,"http.url":l,url:a.url,"server.address":u,[SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN]:"auto.http.browser"},op:"http.client"}):void 0;d&&(o.__sentry_xhr_span_id__=d.spanContext().spanId,r[o.__sentry_xhr_span_id__]=d);const p=getClient();if(o.setRequestHeader&&n(a.url)&&p){const{traceId:e,spanId:t,sampled:n,dsc:r}={...c.getPropagationContext(),...s.getPropagationContext()};setHeaderOnXhr(o,d?spanToTraceHeader(d):generateSentryTraceHeader(e,t,n),dynamicSamplingContextToSentryBaggageHeader(r||(d?getDynamicSamplingContextFromSpan(d):getDynamicSamplingContextFromClient(e,p,s))))}return d}function setHeaderOnXhr(e,t,n){try{e.setRequestHeader("sentry-trace",t),n&&e.setRequestHeader(BAGGAGE_HEADER_NAME,n)}catch(e){}}function getFullURL(e){try{return new URL(e,WINDOW$6.location.origin).href}catch(e){return}}function instrumentRoutingWithDefaults(e,t=!0,n=!0){if(!WINDOW$6||!WINDOW$6.location)return void(DEBUG_BUILD$4&&logger.warn("Could not initialize routing instrumentation due to invalid location"));let r,o=WINDOW$6.location.href;t&&(r=e({name:WINDOW$6.location.pathname,startTimestamp:browserPerformanceTimeOrigin?browserPerformanceTimeOrigin/1e3:void 0,op:"pageload",origin:"auto.pageload.browser",metadata:{source:"url"}})),n&&addHistoryInstrumentationHandler((({to:t,from:n})=>{void 0===n&&o&&-1!==o.indexOf(t)?o=void 0:n!==t&&(o=void 0,r&&(DEBUG_BUILD$4&&logger.log(`[Tracing] Finishing current transaction with op: ${r.op}`),r.end()),r=e({name:WINDOW$6.location.pathname,op:"navigation",origin:"auto.navigation.browser",metadata:{source:"url"}}))}))}const BROWSER_TRACING_INTEGRATION_ID$1="BrowserTracing",DEFAULT_BROWSER_TRACING_OPTIONS$1={...TRACING_DEFAULTS,markBackgroundTransactions:!0,routingInstrumentation:instrumentRoutingWithDefaults,startTransactionOnLocationChange:!0,startTransactionOnPageLoad:!0,enableLongTask:!0,enableInp:!1,interactionsSampleRate:1,_experiments:{},...defaultRequestInstrumentationOptions},MAX_INTERACTIONS$1=10;class BrowserTracing{constructor(e){this.name=BROWSER_TRACING_INTEGRATION_ID$1,this._hasSetTracePropagationTargets=!1,addTracingExtensions(),DEBUG_BUILD$4&&(this._hasSetTracePropagationTargets=!(!e||!e.tracePropagationTargets&&!e.tracingOrigins)),this.options={...DEFAULT_BROWSER_TRACING_OPTIONS$1,...e},void 0!==this.options._experiments.enableLongTask&&(this.options.enableLongTask=this.options._experiments.enableLongTask),e&&!e.tracePropagationTargets&&e.tracingOrigins&&(this.options.tracePropagationTargets=e.tracingOrigins),this._collectWebVitals=startTrackingWebVitals(),this._interactionIdToRouteNameMapping={},this.options.enableInp&&startTrackingINP(this._interactionIdToRouteNameMapping,this.options.interactionsSampleRate),this.options.enableLongTask&&startTrackingLongTasks(),this.options._experiments.enableInteractions&&startTrackingInteractions(),this._latestRoute={name:void 0,context:void 0}}setupOnce(e,t){this._getCurrentHub=t;const n=t().getClient(),r=n&&n.getOptions(),{routingInstrumentation:o,startTransactionOnLocationChange:a,startTransactionOnPageLoad:i,markBackgroundTransactions:s,traceFetch:c,traceXHR:l,shouldCreateSpanForRequest:u,enableHTTPTimings:d,_experiments:p}=this.options,g=r&&r.tracePropagationTargets,h=g||this.options.tracePropagationTargets;DEBUG_BUILD$4&&this._hasSetTracePropagationTargets&&g&&logger.warn("[Tracing] The `tracePropagationTargets` option was set in the BrowserTracing integration and top level `Sentry.init`. The top level `Sentry.init` value is being used."),o((e=>{const n=this._createRouteTransaction(e);return this.options._experiments.onStartRouteTransaction&&this.options._experiments.onStartRouteTransaction(n,e,t),n}),i,a),s&&registerBackgroundTabDetection(),p.enableInteractions&&this._registerInteractionListener(),this.options.enableInp&&this._registerInpInteractionListener(),instrumentOutgoingRequests({traceFetch:c,traceXHR:l,tracePropagationTargets:h,shouldCreateSpanForRequest:u,enableHTTPTimings:d})}_createRouteTransaction(e){if(!this._getCurrentHub)return void(DEBUG_BUILD$4&&logger.warn(`[Tracing] Did not create ${e.op} transaction because _getCurrentHub is invalid.`));const t=this._getCurrentHub(),{beforeNavigate:n,idleTimeout:r,finalTimeout:o,heartbeatInterval:a}=this.options,i="pageload"===e.op;let s;if(i){const t=i?getMetaContent$1("sentry-trace"):"",n=i?getMetaContent$1("baggage"):void 0,{traceId:r,dsc:o,parentSpanId:a,sampled:c}=propagationContextFromHeaders(t,n);s={traceId:r,parentSpanId:a,parentSampled:c,...e,metadata:{...e.metadata,dynamicSamplingContext:o},trimEnd:!0}}else s={trimEnd:!0,...e};const c="function"==typeof n?n(s):s,l=void 0===c?{...s,sampled:!1}:c;l.metadata=l.name!==s.name?{...l.metadata,source:"custom"}:l.metadata,this._latestRoute.name=l.name,this._latestRoute.context=l,!1===l.sampled&&DEBUG_BUILD$4&&logger.log(`[Tracing] Will not send ${l.op} transaction because of beforeNavigate.`),DEBUG_BUILD$4&&logger.log(`[Tracing] Starting ${l.op} transaction on scope`);const{location:u}=WINDOW$6,d=startIdleTransaction(t,l,r,o,!0,{location:u},a,i);return i&&WINDOW$6.document&&(WINDOW$6.document.addEventListener("readystatechange",(()=>{["interactive","complete"].includes(WINDOW$6.document.readyState)&&d.sendAutoFinishSignal()})),["interactive","complete"].includes(WINDOW$6.document.readyState)&&d.sendAutoFinishSignal()),d.registerBeforeFinishCallback((e=>{this._collectWebVitals(),addPerformanceEntries(e)})),d}_registerInteractionListener(){let e;const t=()=>{const{idleTimeout:t,finalTimeout:n,heartbeatInterval:r}=this.options,o="ui.action.click",a=getActiveTransaction();if(a&&a.op&&["navigation","pageload"].includes(a.op))return void(DEBUG_BUILD$4&&logger.warn(`[Tracing] Did not create ${o} transaction because a pageload or navigation transaction is in progress.`));if(e&&(e.setFinishReason("interactionInterrupted"),e.end(),e=void 0),!this._getCurrentHub)return void(DEBUG_BUILD$4&&logger.warn(`[Tracing] Did not create ${o} transaction because _getCurrentHub is invalid.`));if(!this._latestRoute.name)return void(DEBUG_BUILD$4&&logger.warn(`[Tracing] Did not create ${o} transaction because _latestRouteName is missing.`));const i=this._getCurrentHub(),{location:s}=WINDOW$6,c={name:this._latestRoute.name,op:o,trimEnd:!0,data:{[SEMANTIC_ATTRIBUTE_SENTRY_SOURCE]:this._latestRoute.context?getSource$1(this._latestRoute.context):"url"}};e=startIdleTransaction(i,c,t,n,!0,{location:s},r)};["click"].forEach((e=>{WINDOW$6.document&&addEventListener(e,t,{once:!1,capture:!0})}))}_registerInpInteractionListener(){const e=({entries:e})=>{const t=getClient(),n=void 0!==t&&void 0!==t.getIntegrationByName?t.getIntegrationByName("Replay"):void 0,r=void 0!==n?n.getReplayId():void 0,o=getActiveTransaction(),a=getCurrentScope(),i=void 0!==a?a.getUser():void 0;e.forEach((e=>{if(isPerformanceEventTiming$1(e)){const t=e.interactionId;if(void 0===t)return;const n=this._interactionIdToRouteNameMapping[t],a=e.duration,s=e.startTime,c=Object.keys(this._interactionIdToRouteNameMapping),l=c.length>0?c.reduce(((e,t)=>this._interactionIdToRouteNameMapping[e].duration<this._interactionIdToRouteNameMapping[t].duration?e:t)):void 0;if("first-input"===e.entryType){if(c.map((e=>this._interactionIdToRouteNameMapping[e])).some((e=>e.duration===a&&e.startTime===s)))return}if(!t)return;if(n)n.duration=Math.max(n.duration,a);else if(c.length<MAX_INTERACTIONS$1||void 0===l||a>this._interactionIdToRouteNameMapping[l].duration){const e=this._latestRoute.name,n=this._latestRoute.context;e&&n&&(l&&Object.keys(this._interactionIdToRouteNameMapping).length>=MAX_INTERACTIONS$1&&delete this._interactionIdToRouteNameMapping[l],this._interactionIdToRouteNameMapping[t]={routeName:e,duration:a,parentContext:n,user:i,activeTransaction:o,replayId:r,startTime:s})}}}))};addPerformanceInstrumentationHandler("event",e),addPerformanceInstrumentationHandler("first-input",e)}}function getMetaContent$1(e){const t=getDomElement(`meta[name=${e}]`);return t?t.getAttribute("content"):void 0}function getSource$1(e){const t=e.attributes&&e.attributes[SEMANTIC_ATTRIBUTE_SENTRY_SOURCE],n=e.data&&e.data[SEMANTIC_ATTRIBUTE_SENTRY_SOURCE],r=e.metadata&&e.metadata.source;return t||n||r}function isPerformanceEventTiming$1(e){return"duration"in e}const BROWSER_TRACING_INTEGRATION_ID="BrowserTracing",DEFAULT_BROWSER_TRACING_OPTIONS={...TRACING_DEFAULTS,instrumentNavigation:!0,instrumentPageLoad:!0,markBackgroundSpan:!0,enableLongTask:!0,enableInp:!1,interactionsSampleRate:1,_experiments:{},...defaultRequestInstrumentationOptions},browserTracingIntegration=(e={})=>{const t=!!DEBUG_BUILD$4&&!(!e.tracePropagationTargets&&!e.tracingOrigins);addTracingExtensions(),!e.tracePropagationTargets&&e.tracingOrigins&&(e.tracePropagationTargets=e.tracingOrigins);const n={...DEFAULT_BROWSER_TRACING_OPTIONS,...e},r=startTrackingWebVitals(),o={};n.enableInp&&startTrackingINP(o,n.interactionsSampleRate),n.enableLongTask&&startTrackingLongTasks(),n._experiments.enableInteractions&&startTrackingInteractions();const a={name:void 0,context:void 0};function i(e){const t=getCurrentHub(),{beforeStartSpan:o,idleTimeout:i,finalTimeout:s,heartbeatInterval:c}=n,l="pageload"===e.op;let u;if(l){const t=l?getMetaContent("sentry-trace"):"",n=l?getMetaContent("baggage"):void 0,{traceId:r,dsc:o,parentSpanId:a,sampled:i}=propagationContextFromHeaders(t,n);u={traceId:r,parentSpanId:a,parentSampled:i,...e,metadata:{...e.metadata,dynamicSamplingContext:o},trimEnd:!0}}else u={trimEnd:!0,...e};const d=o?o(u):u;d.metadata=d.name!==u.name?{...d.metadata,source:"custom"}:d.metadata,a.name=d.name,a.context=d,!1===d.sampled&&DEBUG_BUILD$4&&logger.log(`[Tracing] Will not send ${d.op} transaction because of beforeNavigate.`),DEBUG_BUILD$4&&logger.log(`[Tracing] Starting ${d.op} transaction on scope`);const{location:p}=WINDOW$6,g=startIdleTransaction(t,d,i,s,!0,{location:p},c,l);return l&&WINDOW$6.document&&(WINDOW$6.document.addEventListener("readystatechange",(()=>{["interactive","complete"].includes(WINDOW$6.document.readyState)&&g.sendAutoFinishSignal()})),["interactive","complete"].includes(WINDOW$6.document.readyState)&&g.sendAutoFinishSignal()),g.registerBeforeFinishCallback((e=>{r(),addPerformanceEntries(e)})),g}return{name:BROWSER_TRACING_INTEGRATION_ID,setupOnce:()=>{},afterAllSetup(e){const r=e.getOptions(),{markBackgroundSpan:s,traceFetch:c,traceXHR:l,shouldCreateSpanForRequest:u,enableHTTPTimings:d,_experiments:p}=n,g=r&&r.tracePropagationTargets,h=g||n.tracePropagationTargets;let f;DEBUG_BUILD$4&&t&&g&&logger.warn("[Tracing] The `tracePropagationTargets` option was set in the BrowserTracing integration and top level `Sentry.init`. The top level `Sentry.init` value is being used.");let m=WINDOW$6.location&&WINDOW$6.location.href;if(e.on&&(e.on("startNavigationSpan",(e=>{f&&(DEBUG_BUILD$4&&logger.log(`[Tracing] Finishing current transaction with op: ${spanToJSON(f).op}`),f.end()),f=i({op:"navigation",...e})})),e.on("startPageLoadSpan",(e=>{f&&(DEBUG_BUILD$4&&logger.log(`[Tracing] Finishing current transaction with op: ${spanToJSON(f).op}`),f.end()),f=i({op:"pageload",...e})}))),n.instrumentPageLoad&&e.emit&&WINDOW$6.location){const t={name:WINDOW$6.location.pathname,startTimestamp:browserPerformanceTimeOrigin?browserPerformanceTimeOrigin/1e3:void 0,origin:"auto.pageload.browser",attributes:{[SEMANTIC_ATTRIBUTE_SENTRY_SOURCE]:"url"}};startBrowserTracingPageLoadSpan(e,t)}n.instrumentNavigation&&e.emit&&WINDOW$6.location&&addHistoryInstrumentationHandler((({to:t,from:n})=>{if(void 0===n&&m&&-1!==m.indexOf(t))m=void 0;else if(n!==t){m=void 0;const t={name:WINDOW$6.location.pathname,origin:"auto.navigation.browser",attributes:{[SEMANTIC_ATTRIBUTE_SENTRY_SOURCE]:"url"}};startBrowserTracingNavigationSpan(e,t)}})),s&&registerBackgroundTabDetection(),p.enableInteractions&&registerInteractionListener(n,a),n.enableInp&&registerInpInteractionListener(o,a),instrumentOutgoingRequests({traceFetch:c,traceXHR:l,tracePropagationTargets:h,shouldCreateSpanForRequest:u,enableHTTPTimings:d})},options:n}};function startBrowserTracingPageLoadSpan(e,t){if(!e.emit)return;e.emit("startPageLoadSpan",t);const n=getActiveSpan();return"pageload"===(n&&spanToJSON(n).op)?n:void 0}function startBrowserTracingNavigationSpan(e,t){if(!e.emit)return;e.emit("startNavigationSpan",t);const n=getActiveSpan();return"navigation"===(n&&spanToJSON(n).op)?n:void 0}function getMetaContent(e){const t=getDomElement(`meta[name=${e}]`);return t?t.getAttribute("content"):void 0}function registerInteractionListener(e,t){let n;const r=()=>{const{idleTimeout:r,finalTimeout:o,heartbeatInterval:a}=e,i="ui.action.click",s=getActiveTransaction();if(s&&s.op&&["navigation","pageload"].includes(s.op))return void(DEBUG_BUILD$4&&logger.warn(`[Tracing] Did not create ${i} transaction because a pageload or navigation transaction is in progress.`));if(n&&(n.setFinishReason("interactionInterrupted"),n.end(),n=void 0),!t.name)return void(DEBUG_BUILD$4&&logger.warn(`[Tracing] Did not create ${i} transaction because _latestRouteName is missing.`));const{location:c}=WINDOW$6,l={name:t.name,op:i,trimEnd:!0,data:{[SEMANTIC_ATTRIBUTE_SENTRY_SOURCE]:t.context?getSource(t.context):"url"}};n=startIdleTransaction(getCurrentHub(),l,r,o,!0,{location:c},a)};["click"].forEach((e=>{WINDOW$6.document&&addEventListener(e,r,{once:!1,capture:!0})}))}function isPerformanceEventTiming(e){return"duration"in e}const MAX_INTERACTIONS=10;function registerInpInteractionListener(e,t){const n=({entries:n})=>{const r=getClient(),o=void 0!==r&&void 0!==r.getIntegrationByName?r.getIntegrationByName("Replay"):void 0,a=void 0!==o?o.getReplayId():void 0,i=getActiveTransaction(),s=getCurrentScope(),c=void 0!==s?s.getUser():void 0;n.forEach((n=>{if(isPerformanceEventTiming(n)){const r=n.interactionId;if(void 0===r)return;const o=e[r],s=n.duration,l=n.startTime,u=Object.keys(e),d=u.length>0?u.reduce(((t,n)=>e[t].duration<e[n].duration?t:n)):void 0;if("first-input"===n.entryType){if(u.map((t=>e[t])).some((e=>e.duration===s&&e.startTime===l)))return}if(!r)return;if(o)o.duration=Math.max(o.duration,s);else if(u.length<MAX_INTERACTIONS||void 0===d||s>e[d].duration){const n=t.name,o=t.context;n&&o&&(d&&Object.keys(e).length>=MAX_INTERACTIONS&&delete e[d],e[r]={routeName:n,duration:s,parentContext:o,user:c,activeTransaction:i,replayId:a,startTime:l})}}}))};addPerformanceInstrumentationHandler("event",n),addPerformanceInstrumentationHandler("first-input",n)}function getSource(e){const t=e.attributes&&e.attributes[SEMANTIC_ATTRIBUTE_SENTRY_SOURCE],n=e.data&&e.data[SEMANTIC_ATTRIBUTE_SENTRY_SOURCE],r=e.metadata&&e.metadata.source;return t||n||r}const WINDOW$5=GLOBAL_OBJ;let ignoreOnError=0;function shouldIgnoreOnError(){return ignoreOnError>0}function ignoreNextOnError(){ignoreOnError++,setTimeout((()=>{ignoreOnError--}))}function wrap$1(e,t={},n){if("function"!=typeof e)return e;try{const t=e.__sentry_wrapped__;if(t)return t;if(getOriginalFunction(e))return e}catch(t){return e}const r=function(){const r=Array.prototype.slice.call(arguments);try{n&&"function"==typeof n&&n.apply(this,arguments);const o=r.map((e=>wrap$1(e,t)));return e.apply(this,o)}catch(e){throw ignoreNextOnError(),withScope((n=>{n.addEventProcessor((e=>(t.mechanism&&(addExceptionTypeValue(e,void 0,void 0),addExceptionMechanism(e,t.mechanism)),e.extra={...e.extra,arguments:r},e))),captureException(e)})),e}};try{for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t])}catch(e){}markFunctionWrapped(r,e),addNonEnumerableProperty(e,"__sentry_wrapped__",r);try{Object.getOwnPropertyDescriptor(r,"name").configurable&&Object.defineProperty(r,"name",{get:()=>e.name})}catch(e){}return r}const DEBUG_BUILD$3="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__;function exceptionFromError(e,t){const n=parseStackFrames(e,t),r={type:t&&t.name,value:extractMessage$1(t)};return n.length&&(r.stacktrace={frames:n}),void 0===r.type&&""===r.value&&(r.value="Unrecoverable error caught"),r}function eventFromPlainObject(e,t,n,r){const o=getClient(),a=o&&o.getOptions().normalizeDepth,i={exception:{values:[{type:isEvent(t)?t.constructor.name:r?"UnhandledRejection":"Error",value:getNonErrorObjectExceptionValue(t,{isUnhandledRejection:r})}]},extra:{__serialized__:normalizeToSize(t,a)}};if(n){const t=parseStackFrames(e,n);t.length&&(i.exception.values[0].stacktrace={frames:t})}return i}function eventFromError(e,t){return{exception:{values:[exceptionFromError(e,t)]}}}function parseStackFrames(e,t){const n=t.stacktrace||t.stack||"",r=getPopSize(t);try{return e(n,r)}catch(e){}return[]}const reactMinifiedRegexp=/Minified React error #\d+;/i;function getPopSize(e){if(e){if("number"==typeof e.framesToPop)return e.framesToPop;if(reactMinifiedRegexp.test(e.message))return 1}return 0}function extractMessage$1(e){const t=e&&e.message;return t?t.error&&"string"==typeof t.error.message?t.error.message:t:"No error message"}function eventFromException(e,t,n,r){const o=eventFromUnknownInput(e,t,n&&n.syntheticException||void 0,r);return addExceptionMechanism(o),o.level="error",n&&n.event_id&&(o.event_id=n.event_id),resolvedSyncPromise(o)}function eventFromMessage(e,t,n="info",r,o){const a=eventFromString(e,t,r&&r.syntheticException||void 0,o);return a.level=n,r&&r.event_id&&(a.event_id=r.event_id),resolvedSyncPromise(a)}function eventFromUnknownInput(e,t,n,r,o){let a;if(isErrorEvent$2(t)&&t.error){return eventFromError(e,t.error)}if(isDOMError(t)||isDOMException(t)){const o=t;if("stack"in t)a=eventFromError(e,t);else{const t=o.name||(isDOMError(o)?"DOMError":"DOMException"),i=o.message?`${t}: ${o.message}`:t;a=eventFromString(e,i,n,r),addExceptionTypeValue(a,i)}return"code"in o&&(a.tags={...a.tags,"DOMException.code":`${o.code}`}),a}if(isError(t))return eventFromError(e,t);if(isPlainObject(t)||isEvent(t)){return a=eventFromPlainObject(e,t,n,o),addExceptionMechanism(a,{synthetic:!0}),a}return a=eventFromString(e,t,n,r),addExceptionTypeValue(a,`${t}`,void 0),addExceptionMechanism(a,{synthetic:!0}),a}function eventFromString(e,t,n,r){const o={};if(r&&n){const r=parseStackFrames(e,n);r.length&&(o.exception={values:[{value:t,stacktrace:{frames:r}}]})}if(isParameterizedString(t)){const{__sentry_template_string__:e,__sentry_template_values__:n}=t;return o.logentry={message:e,params:n},o}return o.message=t,o}function getNonErrorObjectExceptionValue(e,{isUnhandledRejection:t}){const n=extractExceptionKeysForMessage(e),r=t?"promise rejection":"exception";if(isErrorEvent$2(e))return`Event \`ErrorEvent\` captured as ${r} with message \`${e.message}\``;if(isEvent(e)){return`Event \`${getObjectClassName(e)}\` (type=${e.type}) captured as ${r}`}return`Object captured as ${r} with keys: ${n}`}function getObjectClassName(e){try{const t=Object.getPrototypeOf(e);return t?t.constructor.name:void 0}catch(e){}}function createUserFeedbackEnvelope(e,{metadata:t,tunnel:n,dsn:r}){return createEnvelope({event_id:e.event_id,sent_at:(new Date).toISOString(),...t&&t.sdk&&{sdk:{name:t.sdk.name,version:t.sdk.version}},...!!n&&!!r&&{dsn:dsnToString(r)}},[createUserFeedbackEnvelopeItem(e)])}function createUserFeedbackEnvelopeItem(e){return[{type:"user_report"},e]}class BrowserClient extends BaseClient{constructor(e){applySdkMetadata(e,"browser",["browser"],WINDOW$5.SENTRY_SDK_SOURCE||getSDKSource()),super(e),e.sendClientReports&&WINDOW$5.document&&WINDOW$5.document.addEventListener("visibilitychange",(()=>{"hidden"===WINDOW$5.document.visibilityState&&this._flushOutcomes()}))}eventFromException(e,t){return eventFromException(this._options.stackParser,e,t,this._options.attachStacktrace)}eventFromMessage(e,t="info",n){return eventFromMessage(this._options.stackParser,e,t,n,this._options.attachStacktrace)}captureUserFeedback(e){if(!this._isEnabled())return void(DEBUG_BUILD$3&&logger.warn("SDK not enabled, will not capture user feedback."));const t=createUserFeedbackEnvelope(e,{metadata:this.getSdkMetadata(),dsn:this.getDsn(),tunnel:this.getOptions().tunnel});this._sendEnvelope(t)}_prepareEvent(e,t,n){return e.platform=e.platform||"javascript",super._prepareEvent(e,t,n)}_flushOutcomes(){const e=this._clearOutcomes();if(0===e.length)return void(DEBUG_BUILD$3&&logger.log("No outcomes to send"));if(!this._dsn)return void(DEBUG_BUILD$3&&logger.log("No dsn provided, will not send outcomes"));DEBUG_BUILD$3&&logger.log("Sending outcomes:",e);const t=createClientReportEnvelope(e,this._options.tunnel&&dsnToString(this._dsn));this._sendEnvelope(t)}}let cachedFetchImpl;function getNativeFetchImplementation(){if(cachedFetchImpl)return cachedFetchImpl;if(isNativeFetch(WINDOW$5.fetch))return cachedFetchImpl=WINDOW$5.fetch.bind(WINDOW$5);const e=WINDOW$5.document;let t=WINDOW$5.fetch;if(e&&"function"==typeof e.createElement)try{const n=e.createElement("iframe");n.hidden=!0,e.head.appendChild(n);const r=n.contentWindow;r&&r.fetch&&(t=r.fetch),e.head.removeChild(n)}catch(e){DEBUG_BUILD$3&&logger.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",e)}return cachedFetchImpl=t.bind(WINDOW$5)}function clearCachedFetchImplementation(){cachedFetchImpl=void 0}function makeFetchTransport(e,t=getNativeFetchImplementation()){let n=0,r=0;return createTransport(e,(function(o){const a=o.body.length;n+=a,r++;const i={body:o.body,method:"POST",referrerPolicy:"origin",headers:e.headers,keepalive:n<=6e4&&r<15,...e.fetchOptions};try{return t(e.url,i).then((e=>(n-=a,r--,{statusCode:e.status,headers:{"x-sentry-rate-limits":e.headers.get("X-Sentry-Rate-Limits"),"retry-after":e.headers.get("Retry-After")}})))}catch(e){return clearCachedFetchImplementation(),n-=a,r--,rejectedSyncPromise(e)}}))}const XHR_READYSTATE_DONE=4;function makeXHRTransport(e){return createTransport(e,(function(t){return new SyncPromise(((n,r)=>{const o=new XMLHttpRequest;o.onerror=r,o.onreadystatechange=()=>{o.readyState===XHR_READYSTATE_DONE&&n({statusCode:o.status,headers:{"x-sentry-rate-limits":o.getResponseHeader("X-Sentry-Rate-Limits"),"retry-after":o.getResponseHeader("Retry-After")}})},o.open("POST",e.url);for(const t in e.headers)Object.prototype.hasOwnProperty.call(e.headers,t)&&o.setRequestHeader(t,e.headers[t]);o.send(t.body)}))}))}const UNKNOWN_FUNCTION="?",OPERA10_PRIORITY=10,OPERA11_PRIORITY=20,CHROME_PRIORITY=30,WINJS_PRIORITY=40,GECKO_PRIORITY=50;function createFrame(e,t,n,r){const o={filename:e,function:t,in_app:!0};return void 0!==n&&(o.lineno=n),void 0!==r&&(o.colno=r),o}const chromeRegex=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,chromeEvalRegex=/\((\S*)(?::(\d+))(?::(\d+))\)/,chromeStackParserFn=e=>{const t=chromeRegex.exec(e);if(t){if(t[2]&&0===t[2].indexOf("eval")){const e=chromeEvalRegex.exec(t[2]);e&&(t[2]=e[1],t[3]=e[2],t[4]=e[3])}const[e,n]=extractSafariExtensionDetails(t[1]||UNKNOWN_FUNCTION,t[2]);return createFrame(n,e,t[3]?+t[3]:void 0,t[4]?+t[4]:void 0)}},chromeStackLineParser=[CHROME_PRIORITY,chromeStackParserFn],geckoREgex=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,geckoEvalRegex=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,gecko=e=>{const t=geckoREgex.exec(e);if(t){if(t[3]&&t[3].indexOf(" > eval")>-1){const e=geckoEvalRegex.exec(t[3]);e&&(t[1]=t[1]||"eval",t[3]=e[1],t[4]=e[2],t[5]="")}let e=t[3],n=t[1]||UNKNOWN_FUNCTION;return[n,e]=extractSafariExtensionDetails(n,e),createFrame(e,n,t[4]?+t[4]:void 0,t[5]?+t[5]:void 0)}},geckoStackLineParser=[GECKO_PRIORITY,gecko],winjsRegex=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:[-a-z]+):.*?):(\d+)(?::(\d+))?\)?\s*$/i,winjs=e=>{const t=winjsRegex.exec(e);return t?createFrame(t[2],t[1]||UNKNOWN_FUNCTION,+t[3],t[4]?+t[4]:void 0):void 0},winjsStackLineParser=[WINJS_PRIORITY,winjs],opera10Regex=/ line (\d+).*script (?:in )?(\S+)(?:: in function (\S+))?$/i,opera10=e=>{const t=opera10Regex.exec(e);return t?createFrame(t[2],t[3]||UNKNOWN_FUNCTION,+t[1]):void 0},opera10StackLineParser=[OPERA10_PRIORITY,opera10],opera11Regex=/ line (\d+), column (\d+)\s*(?:in (?:<anonymous function: ([^>]+)>|([^)]+))\(.*\))? in (.*):\s*$/i,opera11=e=>{const t=opera11Regex.exec(e);return t?createFrame(t[5],t[3]||t[4]||UNKNOWN_FUNCTION,+t[1],+t[2]):void 0},opera11StackLineParser=[OPERA11_PRIORITY,opera11],defaultStackLineParsers=[chromeStackLineParser,geckoStackLineParser,winjsStackLineParser],defaultStackParser=createStackParser(...defaultStackLineParsers),extractSafariExtensionDetails=(e,t)=>{const n=-1!==e.indexOf("safari-extension"),r=-1!==e.indexOf("safari-web-extension");return n||r?[-1!==e.indexOf("@")?e.split("@")[0]:UNKNOWN_FUNCTION,n?`safari-extension:${t}`:`safari-web-extension:${t}`]:[e,t]},MAX_ALLOWED_STRING_LENGTH=1024,INTEGRATION_NAME$h="Breadcrumbs",_breadcrumbsIntegration=(e={})=>{const t={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...e};return{name:INTEGRATION_NAME$h,setupOnce(){},setup(e){t.console&&addConsoleInstrumentationHandler(_getConsoleBreadcrumbHandler(e)),t.dom&&addClickKeypressInstrumentationHandler(_getDomBreadcrumbHandler(e,t.dom)),t.xhr&&addXhrInstrumentationHandler(_getXhrBreadcrumbHandler(e)),t.fetch&&addFetchInstrumentationHandler(_getFetchBreadcrumbHandler(e)),t.history&&addHistoryInstrumentationHandler(_getHistoryBreadcrumbHandler(e)),t.sentry&&e.on&&e.on("beforeSendEvent",_getSentryBreadcrumbHandler(e))}}},breadcrumbsIntegration=defineIntegration(_breadcrumbsIntegration),Breadcrumbs=convertIntegrationFnToClass(INTEGRATION_NAME$h,breadcrumbsIntegration);function _getSentryBreadcrumbHandler(e){return function(t){getClient()===e&&addBreadcrumb({category:"sentry."+("transaction"===t.type?"transaction":"event"),event_id:t.event_id,level:t.level,message:getEventDescription(t)},{event:t})}}function _getDomBreadcrumbHandler(e,t){return function(n){if(getClient()!==e)return;let r,o,a="object"==typeof t?t.serializeAttribute:void 0,i="object"==typeof t&&"number"==typeof t.maxStringLength?t.maxStringLength:void 0;i&&i>MAX_ALLOWED_STRING_LENGTH&&(DEBUG_BUILD$3&&logger.warn(`\`dom.maxStringLength\` cannot exceed ${MAX_ALLOWED_STRING_LENGTH}, but a value of ${i} was configured. Sentry will use ${MAX_ALLOWED_STRING_LENGTH} instead.`),i=MAX_ALLOWED_STRING_LENGTH),"string"==typeof a&&(a=[a]);try{const e=n.event,t=_isEvent(e)?e.target:e;r=htmlTreeAsString(t,{keyAttrs:a,maxStringLength:i}),o=getComponentName(t)}catch(e){r="<unknown>"}if(0===r.length)return;const s={category:`ui.${n.name}`,message:r};o&&(s.data={"ui.component_name":o}),addBreadcrumb(s,{event:n.event,name:n.name,global:n.global})}}function _getConsoleBreadcrumbHandler(e){return function(t){if(getClient()!==e)return;const n={category:"console",data:{arguments:t.args,logger:"console"},level:severityLevelFromString(t.level),message:safeJoin(t.args," ")};if("assert"===t.level){if(!1!==t.args[0])return;n.message=`Assertion failed: ${safeJoin(t.args.slice(1)," ")||"console.assert"}`,n.data.arguments=t.args.slice(1)}addBreadcrumb(n,{input:t.args,level:t.level})}}function _getXhrBreadcrumbHandler(e){return function(t){if(getClient()!==e)return;const{startTimestamp:n,endTimestamp:r}=t,o=t.xhr[SENTRY_XHR_DATA_KEY];if(!n||!r||!o)return;const{method:a,url:i,status_code:s,body:c}=o;addBreadcrumb({category:"xhr",data:{method:a,url:i,status_code:s},type:"http"},{xhr:t.xhr,input:c,startTimestamp:n,endTimestamp:r})}}function _getFetchBreadcrumbHandler(e){return function(t){if(getClient()!==e)return;const{startTimestamp:n,endTimestamp:r}=t;if(r&&(!t.fetchData.url.match(/sentry_key/)||"POST"!==t.fetchData.method))if(t.error){addBreadcrumb({category:"fetch",data:t.fetchData,level:"error",type:"http"},{data:t.error,input:t.args,startTimestamp:n,endTimestamp:r})}else{const e=t.response;addBreadcrumb({category:"fetch",data:{...t.fetchData,status_code:e&&e.status},type:"http"},{input:t.args,response:e,startTimestamp:n,endTimestamp:r})}}}function _getHistoryBreadcrumbHandler(e){return function(t){if(getClient()!==e)return;let n=t.from,r=t.to;const o=parseUrl(WINDOW$5.location.href);let a=n?parseUrl(n):void 0;const i=parseUrl(r);a&&a.path||(a=o),o.protocol===i.protocol&&o.host===i.host&&(r=i.relative),o.protocol===a.protocol&&o.host===a.host&&(n=a.relative),addBreadcrumb({category:"navigation",data:{from:n,to:r}})}}function _isEvent(e){return!!e&&!!e.target}const INTEGRATION_NAME$g="Dedupe",_dedupeIntegration$1=()=>{let e;return{name:INTEGRATION_NAME$g,setupOnce(){},processEvent(t){if(t.type)return t;try{if(_shouldDropEvent$1(t,e))return DEBUG_BUILD$3&&logger.warn("Event dropped due to being a duplicate of previously captured event."),null}catch(e){}return e=t}}},dedupeIntegration$1=defineIntegration(_dedupeIntegration$1),Dedupe=convertIntegrationFnToClass(INTEGRATION_NAME$g,dedupeIntegration$1);function _shouldDropEvent$1(e,t){return!!t&&(!!_isSameMessageEvent$1(e,t)||!!_isSameExceptionEvent$1(e,t))}function _isSameMessageEvent$1(e,t){const n=e.message,r=t.message;return!(!n&&!r)&&(!(n&&!r||!n&&r)&&(n===r&&(!!_isSameFingerprint$1(e,t)&&!!_isSameStacktrace$1(e,t))))}function _isSameExceptionEvent$1(e,t){const n=_getExceptionFromEvent$1(t),r=_getExceptionFromEvent$1(e);return!(!n||!r)&&(n.type===r.type&&n.value===r.value&&(!!_isSameFingerprint$1(e,t)&&!!_isSameStacktrace$1(e,t)))}function _isSameStacktrace$1(e,t){let n=_getFramesFromEvent$2(e),r=_getFramesFromEvent$2(t);if(!n&&!r)return!0;if(n&&!r||!n&&r)return!1;if(r.length!==n.length)return!1;for(let e=0;e<r.length;e++){const t=r[e],o=n[e];if(t.filename!==o.filename||t.lineno!==o.lineno||t.colno!==o.colno||t.function!==o.function)return!1}return!0}function _isSameFingerprint$1(e,t){let n=e.fingerprint,r=t.fingerprint;if(!n&&!r)return!0;if(n&&!r||!n&&r)return!1;try{return!(n.join("")!==r.join(""))}catch(e){return!1}}function _getExceptionFromEvent$1(e){return e.exception&&e.exception.values&&e.exception.values[0]}function _getFramesFromEvent$2(e){const t=e.exception;if(t)try{return t.values[0].stacktrace.frames}catch(e){return}}const INTEGRATION_NAME$f="GlobalHandlers",_globalHandlersIntegration=(e={})=>{const t={onerror:!0,onunhandledrejection:!0,...e};return{name:INTEGRATION_NAME$f,setupOnce(){Error.stackTraceLimit=50},setup(e){t.onerror&&(_installGlobalOnErrorHandler(e),globalHandlerLog("onerror")),t.onunhandledrejection&&(_installGlobalOnUnhandledRejectionHandler(e),globalHandlerLog("onunhandledrejection"))}}},globalHandlersIntegration=defineIntegration(_globalHandlersIntegration),GlobalHandlers=convertIntegrationFnToClass(INTEGRATION_NAME$f,globalHandlersIntegration);function _installGlobalOnErrorHandler(e){addGlobalErrorInstrumentationHandler((t=>{const{stackParser:n,attachStacktrace:r}=getOptions();if(getClient()!==e||shouldIgnoreOnError())return;const{msg:o,url:a,line:i,column:s,error:c}=t,l=void 0===c&&isString(o)?_eventFromIncompleteOnError(o,a,i,s):_enhanceEventWithInitialFrame(eventFromUnknownInput(n,c||o,void 0,r,!1),a,i,s);l.level="error",captureEvent(l,{originalException:c,mechanism:{handled:!1,type:"onerror"}})}))}function _installGlobalOnUnhandledRejectionHandler(e){addGlobalUnhandledRejectionInstrumentationHandler((t=>{const{stackParser:n,attachStacktrace:r}=getOptions();if(getClient()!==e||shouldIgnoreOnError())return;const o=_getUnhandledRejectionError(t),a=isPrimitive(o)?_eventFromRejectionWithPrimitive(o):eventFromUnknownInput(n,o,void 0,r,!0);a.level="error",captureEvent(a,{originalException:o,mechanism:{handled:!1,type:"onunhandledrejection"}})}))}function _getUnhandledRejectionError(e){if(isPrimitive(e))return e;const t=e;try{if("reason"in t)return t.reason;if("detail"in t&&"reason"in t.detail)return t.detail.reason}catch(e){}return e}function _eventFromRejectionWithPrimitive(e){return{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(e)}`}]}}}function _eventFromIncompleteOnError(e,t,n,r){let o=isErrorEvent$2(e)?e.message:e,a="Error";const i=o.match(/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/i);i&&(a=i[1],o=i[2]);return _enhanceEventWithInitialFrame({exception:{values:[{type:a,value:o}]}},t,n,r)}function _enhanceEventWithInitialFrame(e,t,n,r){const o=e.exception=e.exception||{},a=o.values=o.values||[],i=a[0]=a[0]||{},s=i.stacktrace=i.stacktrace||{},c=s.frames=s.frames||[],l=isNaN(parseInt(r,10))?void 0:r,u=isNaN(parseInt(n,10))?void 0:n,d=isString(t)&&t.length>0?t:getLocationHref();return 0===c.length&&c.push({colno:l,filename:d,function:"?",in_app:!0,lineno:u}),e}function globalHandlerLog(e){DEBUG_BUILD$3&&logger.log(`Global Handler attached: ${e}`)}function getOptions(){const e=getClient();return e&&e.getOptions()||{stackParser:()=>[],attachStacktrace:!1}}const INTEGRATION_NAME$e="HttpContext",_httpContextIntegration=()=>({name:INTEGRATION_NAME$e,setupOnce(){},preprocessEvent(e){if(!WINDOW$5.navigator&&!WINDOW$5.location&&!WINDOW$5.document)return;const t=e.request&&e.request.url||WINDOW$5.location&&WINDOW$5.location.href,{referrer:n}=WINDOW$5.document||{},{userAgent:r}=WINDOW$5.navigator||{},o={...e.request&&e.request.headers,...n&&{Referer:n},...r&&{"User-Agent":r}},a={...e.request,...t&&{url:t},headers:o};e.request=a}}),httpContextIntegration=defineIntegration(_httpContextIntegration),HttpContext=convertIntegrationFnToClass(INTEGRATION_NAME$e,httpContextIntegration),DEFAULT_KEY="cause",DEFAULT_LIMIT=5,INTEGRATION_NAME$d="LinkedErrors",_linkedErrorsIntegration=(e={})=>{const t=e.limit||DEFAULT_LIMIT,n=e.key||DEFAULT_KEY;return{name:INTEGRATION_NAME$d,setupOnce(){},preprocessEvent(e,r,o){const a=o.getOptions();applyAggregateErrorsToEvent(exceptionFromError,a.stackParser,a.maxValueLength,n,t,e,r)}}},linkedErrorsIntegration=defineIntegration(_linkedErrorsIntegration),LinkedErrors=convertIntegrationFnToClass(INTEGRATION_NAME$d,linkedErrorsIntegration),DEFAULT_EVENT_TARGET=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","BroadcastChannel","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","SharedWorker","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],INTEGRATION_NAME$c="TryCatch",_browserApiErrorsIntegration=(e={})=>{const t={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,...e};return{name:INTEGRATION_NAME$c,setupOnce(){t.setTimeout&&fill(WINDOW$5,"setTimeout",_wrapTimeFunction),t.setInterval&&fill(WINDOW$5,"setInterval",_wrapTimeFunction),t.requestAnimationFrame&&fill(WINDOW$5,"requestAnimationFrame",_wrapRAF),t.XMLHttpRequest&&"XMLHttpRequest"in WINDOW$5&&fill(XMLHttpRequest.prototype,"send",_wrapXHR$1);const e=t.eventTarget;if(e){(Array.isArray(e)?e:DEFAULT_EVENT_TARGET).forEach(_wrapEventTarget)}}}},browserApiErrorsIntegration=defineIntegration(_browserApiErrorsIntegration),TryCatch=convertIntegrationFnToClass(INTEGRATION_NAME$c,browserApiErrorsIntegration);function _wrapTimeFunction(e){return function(...t){const n=t[0];return t[0]=wrap$1(n,{mechanism:{data:{function:getFunctionName(e)},handled:!1,type:"instrument"}}),e.apply(this,t)}}function _wrapRAF(e){return function(t){return e.apply(this,[wrap$1(t,{mechanism:{data:{function:"requestAnimationFrame",handler:getFunctionName(e)},handled:!1,type:"instrument"}})])}}function _wrapXHR$1(e){return function(...t){const n=this;return["onload","onerror","onprogress","onreadystatechange"].forEach((e=>{e in n&&"function"==typeof n[e]&&fill(n,e,(function(t){const n={mechanism:{data:{function:e,handler:getFunctionName(t)},handled:!1,type:"instrument"}},r=getOriginalFunction(t);return r&&(n.mechanism.data.handler=getFunctionName(r)),wrap$1(t,n)}))})),e.apply(this,t)}}function _wrapEventTarget(e){const t=WINDOW$5,n=t[e]&&t[e].prototype;n&&n.hasOwnProperty&&n.hasOwnProperty("addEventListener")&&(fill(n,"addEventListener",(function(t){return function(n,r,o){try{"function"==typeof r.handleEvent&&(r.handleEvent=wrap$1(r.handleEvent,{mechanism:{data:{function:"handleEvent",handler:getFunctionName(r),target:e},handled:!1,type:"instrument"}}))}catch(e){}return t.apply(this,[n,wrap$1(r,{mechanism:{data:{function:"addEventListener",handler:getFunctionName(r),target:e},handled:!1,type:"instrument"}}),o])}})),fill(n,"removeEventListener",(function(e){return function(t,n,r){const o=n;try{const n=o&&o.__sentry_wrapped__;n&&e.call(this,t,n,r)}catch(e){}return e.call(this,t,o,r)}})))}const defaultIntegrations=[inboundFiltersIntegration(),functionToStringIntegration(),browserApiErrorsIntegration(),breadcrumbsIntegration(),globalHandlersIntegration(),linkedErrorsIntegration(),dedupeIntegration$1(),httpContextIntegration()];function getDefaultIntegrations(e){return[...defaultIntegrations]}function init(e={}){void 0===e.defaultIntegrations&&(e.defaultIntegrations=getDefaultIntegrations()),void 0===e.release&&("string"==typeof __SENTRY_RELEASE__&&(e.release=__SENTRY_RELEASE__),WINDOW$5.SENTRY_RELEASE&&WINDOW$5.SENTRY_RELEASE.id&&(e.release=WINDOW$5.SENTRY_RELEASE.id)),void 0===e.autoSessionTracking&&(e.autoSessionTracking=!0),void 0===e.sendClientReports&&(e.sendClientReports=!0);const t={...e,stackParser:stackParserFromStackParserOptions(e.stackParser||defaultStackParser),integrations:getIntegrationsToSetup(e),transport:e.transport||(supportsFetch()?makeFetchTransport:makeXHRTransport)};initAndBind(BrowserClient,t),e.autoSessionTracking&&startSessionTracking()}const showReportDialog=(e={},t=getCurrentHub())=>{if(!WINDOW$5.document)return void(DEBUG_BUILD$3&&logger.error("Global document not defined in showReportDialog call"));const{client:n,scope:r}=t.getStackTop(),o=e.dsn||n&&n.getDsn();if(!o)return void(DEBUG_BUILD$3&&logger.error("DSN not configured for showReportDialog call"));r&&(e.user={...r.getUser(),...e.user}),e.eventId||(e.eventId=t.lastEventId());const a=WINDOW$5.document.createElement("script");a.async=!0,a.crossOrigin="anonymous",a.src=getReportDialogEndpoint(o,e),e.onLoad&&(a.onload=e.onLoad);const{onClose:i}=e;if(i){const e=t=>{if("__sentry_reportdialog_closed__"===t.data)try{i()}finally{WINDOW$5.removeEventListener("message",e)}};WINDOW$5.addEventListener("message",e)}const s=WINDOW$5.document.head||WINDOW$5.document.body;s?s.appendChild(a):DEBUG_BUILD$3&&logger.error("Not injecting report dialog. No injection point found in HTML")};function forceLoad(){}function onLoad(e){e()}function wrap(e){return wrap$1(e)()}function startSessionTracking(){void 0!==WINDOW$5.document?(startSession({ignoreDuration:!0}),captureSession(),addHistoryInstrumentationHandler((({from:e,to:t})=>{void 0!==e&&e!==t&&(startSession({ignoreDuration:!0}),captureSession())}))):DEBUG_BUILD$3&&logger.warn("Session tracking in non-browser environment with @sentry/browser is not supported.")}function captureUserFeedback(e){const t=getClient();t&&t.captureUserFeedback(e)}var index=Object.freeze({__proto__:null,GlobalHandlers:GlobalHandlers,TryCatch:TryCatch,Breadcrumbs:Breadcrumbs,LinkedErrors:LinkedErrors,HttpContext:HttpContext,Dedupe:Dedupe});const WINDOW$4=GLOBAL_OBJ,REPLAY_SESSION_KEY="sentryReplaySession",REPLAY_EVENT_NAME="replay_event",UNABLE_TO_SEND_REPLAY="Unable to send Replay",SESSION_IDLE_PAUSE_DURATION=3e5,SESSION_IDLE_EXPIRE_DURATION=9e5,DEFAULT_FLUSH_MIN_DELAY=5e3,DEFAULT_FLUSH_MAX_DELAY=5500,BUFFER_CHECKOUT_TIME=6e4,RETRY_BASE_INTERVAL=5e3,RETRY_MAX_COUNT=3,NETWORK_BODY_MAX_SIZE=15e4,CONSOLE_ARG_MAX_SIZE=5e3,SLOW_CLICK_THRESHOLD=3e3,SLOW_CLICK_SCROLL_TIMEOUT=300,REPLAY_MAX_EVENT_BUFFER_SIZE=2e7,MIN_REPLAY_DURATION=4999,MIN_REPLAY_DURATION_LIMIT=15e3,MAX_REPLAY_DURATION=36e5;function _nullishCoalesce$1(e,t){return null!=e?e:t()}function _optionalChain$5(e){let t,n=e[0],r=1;for(;r<e.length;){const o=e[r],a=e[r+1];if(r+=2,("optionalAccess"===o||"optionalCall"===o)&&null==n)return;"access"===o||"optionalAccess"===o?(t=n,n=a(n)):"call"!==o&&"optionalCall"!==o||(n=a(((...e)=>n.call(t,...e))),t=void 0)}return n}var NodeType$1;function isElement$1(e){return e.nodeType===e.ELEMENT_NODE}function isShadowRoot(e){const t=_optionalChain$5([e,"optionalAccess",e=>e.host]);return Boolean(_optionalChain$5([t,"optionalAccess",e=>e.shadowRoot])===e)}function isNativeShadowDom(e){return"[object ShadowRoot]"===Object.prototype.toString.call(e)}function fixBrowserCompatibilityIssuesInCSS(e){return e.includes(" background-clip: text;")&&!e.includes(" -webkit-background-clip: text;")&&(e=e.replace(" background-clip: text;"," -webkit-background-clip: text; background-clip: text;")),e}function escapeImportStatement(e){const{cssText:t}=e;if(t.split('"').length<3)return t;const n=["@import",`url(${JSON.stringify(e.href)})`];return""===e.layerName?n.push("layer"):e.layerName&&n.push(`layer(${e.layerName})`),e.supportsText&&n.push(`supports(${e.supportsText})`),e.media.length&&n.push(e.media.mediaText),n.join(" ")+";"}function stringifyStylesheet(e){try{const t=e.rules||e.cssRules;return t?fixBrowserCompatibilityIssuesInCSS(Array.from(t,stringifyRule).join("")):null}catch(e){return null}}function stringifyRule(e){let t;if(isCSSImportRule(e))try{t=stringifyStylesheet(e.styleSheet)||escapeImportStatement(e)}catch(e){}else if(isCSSStyleRule(e)&&e.selectorText.includes(":"))return fixSafariColons(e.cssText);return t||e.cssText}function fixSafariColons(e){return e.replace(/(\[(?:[\w-]+)[^\\])(:(?:[\w-]+)\])/gm,"$1\\$2")}function isCSSImportRule(e){return"styleSheet"in e}function isCSSStyleRule(e){return"selectorText"in e}!function(e){e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment"}(NodeType$1||(NodeType$1={}));class Mirror{constructor(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}getId(e){if(!e)return-1;return _nullishCoalesce$1(_optionalChain$5([this,"access",e=>e.getMeta,"call",t=>t(e),"optionalAccess",e=>e.id]),(()=>-1))}getNode(e){return this.idNodeMap.get(e)||null}getIds(){return Array.from(this.idNodeMap.keys())}getMeta(e){return this.nodeMetaMap.get(e)||null}removeNodeFromMap(e){const t=this.getId(e);this.idNodeMap.delete(t),e.childNodes&&e.childNodes.forEach((e=>this.removeNodeFromMap(e)))}has(e){return this.idNodeMap.has(e)}hasNode(e){return this.nodeMetaMap.has(e)}add(e,t){const n=t.id;this.idNodeMap.set(n,e),this.nodeMetaMap.set(e,t)}replace(e,t){const n=this.getNode(e);if(n){const e=this.nodeMetaMap.get(n);e&&this.nodeMetaMap.set(t,e)}this.idNodeMap.set(e,t)}reset(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}}function createMirror(){return new Mirror}function shouldMaskInput({maskInputOptions:e,tagName:t,type:n}){return"OPTION"===t&&(t="SELECT"),Boolean(e[t.toLowerCase()]||n&&e[n]||"password"===n||"INPUT"===t&&!n&&e.text)}function maskInputValue({isMasked:e,element:t,value:n,maskInputFn:r}){let o=n||"";return e?(r&&(o=r(o,t)),"*".repeat(o.length)):o}function toLowerCase(e){return e.toLowerCase()}function toUpperCase(e){return e.toUpperCase()}const ORIGINAL_ATTRIBUTE_NAME="__rrweb_original__";function is2DCanvasBlank(e){const t=e.getContext("2d");if(!t)return!0;for(let n=0;n<e.width;n+=50)for(let r=0;r<e.height;r+=50){const o=t.getImageData,a=ORIGINAL_ATTRIBUTE_NAME in o?o[ORIGINAL_ATTRIBUTE_NAME]:o;if(new Uint32Array(a.call(t,n,r,Math.min(50,e.width-n),Math.min(50,e.height-r)).data.buffer).some((e=>0!==e)))return!1}return!0}function getInputType(e){const t=e.type;return e.hasAttribute("data-rr-is-password")?"password":t?toLowerCase(t):null}function getInputValue(e,t,n){return"INPUT"!==t||"radio"!==n&&"checkbox"!==n?e.value:e.getAttribute("value")||""}let _id=1;const tagNameRegex=new RegExp("[^a-z0-9-_:]"),IGNORED_NODE=-2;function genId(){return _id++}function getValidTagName(e){if(e instanceof HTMLFormElement)return"form";const t=toLowerCase(e.tagName);return tagNameRegex.test(t)?"div":t}function extractOrigin(e){let t="";return t=e.indexOf("//")>-1?e.split("/").slice(0,3).join("/"):e.split("/")[0],t=t.split("?")[0],t}let canvasService,canvasCtx;const URL_IN_CSS_REF=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,URL_PROTOCOL_MATCH=/^(?:[a-z+]+:)?\/\//i,URL_WWW_MATCH=/^www\..*/i,DATA_URI=/^(data:)([^,]*),(.*)/i;function absoluteToStylesheet(e,t){return(e||"").replace(URL_IN_CSS_REF,((e,n,r,o,a,i)=>{const s=r||a||i,c=n||o||"";if(!s)return e;if(URL_PROTOCOL_MATCH.test(s)||URL_WWW_MATCH.test(s))return`url(${c}${s}${c})`;if(DATA_URI.test(s))return`url(${c}${s}${c})`;if("/"===s[0])return`url(${c}${extractOrigin(t)+s}${c})`;const l=t.split("/"),u=s.split("/");l.pop();for(const e of u)"."!==e&&(".."===e?l.pop():l.push(e));return`url(${c}${l.join("/")}${c})`}))}const SRCSET_NOT_SPACES=/^[^ \t\n\r\u000c]+/,SRCSET_COMMAS_OR_SPACES=/^[, \t\n\r\u000c]+/;function getAbsoluteSrcsetString(e,t){if(""===t.trim())return t;let n=0;function r(e){let r;const o=e.exec(t.substring(n));return o?(r=o[0],n+=r.length,r):""}const o=[];for(;r(SRCSET_COMMAS_OR_SPACES),!(n>=t.length);){let a=r(SRCSET_NOT_SPACES);if(","===a.slice(-1))a=absoluteToDoc(e,a.substring(0,a.length-1)),o.push(a);else{let r="";a=absoluteToDoc(e,a);let i=!1;for(;;){const e=t.charAt(n);if(""===e){o.push((a+r).trim());break}if(i)")"===e&&(i=!1);else{if(","===e){n+=1,o.push((a+r).trim());break}"("===e&&(i=!0)}r+=e,n+=1}}}return o.join(", ")}function absoluteToDoc(e,t){if(!t||""===t.trim())return t;const n=e.createElement("a");return n.href=t,n.href}function isSVGElement(e){return Boolean("svg"===e.tagName||e.ownerSVGElement)}function getHref(){const e=document.createElement("a");return e.href="",e.href}function transformAttribute(e,t,n,r,o,a){return r?"src"===n||"href"===n&&("use"!==t||"#"!==r[0])||"xlink:href"===n&&"#"!==r[0]?absoluteToDoc(e,r):"background"!==n||"table"!==t&&"td"!==t&&"th"!==t?"srcset"===n?getAbsoluteSrcsetString(e,r):"style"===n?absoluteToStylesheet(r,getHref()):"object"===t&&"data"===n?absoluteToDoc(e,r):"function"==typeof a?a(n,r,o):r:absoluteToDoc(e,r):r}function ignoreAttribute(e,t,n){return("video"===e||"audio"===e)&&"autoplay"===t}function _isBlockedElement(e,t,n,r){try{if(r&&e.matches(r))return!1;if("string"==typeof t){if(e.classList.contains(t))return!0}else for(let n=e.classList.length;n--;){const r=e.classList[n];if(t.test(r))return!0}if(n)return e.matches(n)}catch(e){}return!1}function elementClassMatchesRegex$1(e,t){for(let n=e.classList.length;n--;){const r=e.classList[n];if(t.test(r))return!0}return!1}function distanceToMatch$1(e,t,n=1/0,r=0){return e?e.nodeType!==e.ELEMENT_NODE||r>n?-1:t(e)?r:distanceToMatch$1(e.parentNode,t,n,r+1):-1}function createMatchPredicate$1(e,t){return n=>{const r=n;if(null===r)return!1;try{if(e)if("string"==typeof e){if(r.matches(`.${e}`))return!0}else if(elementClassMatchesRegex$1(r,e))return!0;return!(!t||!r.matches(t))}catch(e){return!1}}}function needMaskingText(e,t,n,r,o,a){try{const i=e.nodeType===e.ELEMENT_NODE?e:e.parentElement;if(null===i)return!1;if("INPUT"===i.tagName){const e=i.getAttribute("autocomplete");if(["current-password","new-password","cc-number","cc-exp","cc-exp-month","cc-exp-year","cc-csc"].includes(e))return!0}let s=-1,c=-1;if(a){if(c=distanceToMatch$1(i,createMatchPredicate$1(r,o)),c<0)return!0;s=distanceToMatch$1(i,createMatchPredicate$1(t,n),c>=0?c:1/0)}else{if(s=distanceToMatch$1(i,createMatchPredicate$1(t,n)),s<0)return!1;c=distanceToMatch$1(i,createMatchPredicate$1(r,o),s>=0?s:1/0)}return s>=0?!(c>=0)||s<=c:!(c>=0)&&!!a}catch(e){}return!!a}function onceIframeLoaded(e,t,n){const r=e.contentWindow;if(!r)return;let o,a=!1;try{o=r.document.readyState}catch(e){return}if("complete"!==o){const r=setTimeout((()=>{a||(t(),a=!0)}),n);return void e.addEventListener("load",(()=>{clearTimeout(r),a=!0,t()}))}const i="about:blank";if(r.location.href!==i||e.src===i||""===e.src)return setTimeout(t,0),e.addEventListener("load",t);e.addEventListener("load",t)}function onceStylesheetLoaded(e,t,n){let r,o=!1;try{r=e.sheet}catch(e){return}if(r)return;const a=setTimeout((()=>{o||(t(),o=!0)}),n);e.addEventListener("load",(()=>{clearTimeout(a),o=!0,t()}))}function serializeNode(e,t){const{doc:n,mirror:r,blockClass:o,blockSelector:a,unblockSelector:i,maskAllText:s,maskAttributeFn:c,maskTextClass:l,unmaskTextClass:u,maskTextSelector:d,unmaskTextSelector:p,inlineStylesheet:g,maskInputOptions:h={},maskTextFn:f,maskInputFn:m,dataURLOptions:_={},inlineImages:E,recordCanvas:T,keepIframeSrcFn:S,newlyAddedElement:y=!1}=t,v=getRootId(n,r);switch(e.nodeType){case e.DOCUMENT_NODE:return"CSS1Compat"!==e.compatMode?{type:NodeType$1.Document,childNodes:[],compatMode:e.compatMode}:{type:NodeType$1.Document,childNodes:[]};case e.DOCUMENT_TYPE_NODE:return{type:NodeType$1.DocumentType,name:e.name,publicId:e.publicId,systemId:e.systemId,rootId:v};case e.ELEMENT_NODE:return serializeElementNode(e,{doc:n,blockClass:o,blockSelector:a,unblockSelector:i,inlineStylesheet:g,maskAttributeFn:c,maskInputOptions:h,maskInputFn:m,dataURLOptions:_,inlineImages:E,recordCanvas:T,keepIframeSrcFn:S,newlyAddedElement:y,rootId:v,maskAllText:s,maskTextClass:l,unmaskTextClass:u,maskTextSelector:d,unmaskTextSelector:p});case e.TEXT_NODE:return serializeTextNode(e,{maskAllText:s,maskTextClass:l,unmaskTextClass:u,maskTextSelector:d,unmaskTextSelector:p,maskTextFn:f,maskInputOptions:h,maskInputFn:m,rootId:v});case e.CDATA_SECTION_NODE:return{type:NodeType$1.CDATA,textContent:"",rootId:v};case e.COMMENT_NODE:return{type:NodeType$1.Comment,textContent:e.textContent||"",rootId:v};default:return!1}}function getRootId(e,t){if(!t.hasNode(e))return;const n=t.getId(e);return 1===n?void 0:n}function serializeTextNode(e,t){const{maskAllText:n,maskTextClass:r,unmaskTextClass:o,maskTextSelector:a,unmaskTextSelector:i,maskTextFn:s,maskInputOptions:c,maskInputFn:l,rootId:u}=t,d=e.parentNode&&e.parentNode.tagName;let p=e.textContent;const g="STYLE"===d||void 0,h="SCRIPT"===d||void 0,f="TEXTAREA"===d||void 0;if(g&&p){try{e.nextSibling||e.previousSibling||_optionalChain$5([e,"access",e=>e.parentNode,"access",e=>e.sheet,"optionalAccess",e=>e.cssRules])&&(p=stringifyStylesheet(e.parentNode.sheet))}catch(t){console.warn(`Cannot get CSS styles from text's parentNode. Error: ${t}`,e)}p=absoluteToStylesheet(p,getHref())}h&&(p="SCRIPT_PLACEHOLDER");const m=needMaskingText(e,r,a,o,i,n);if(g||h||f||!p||!m||(p=s?s(p,e.parentElement):p.replace(/[\S]/g,"*")),f&&p&&(c.textarea||m)&&(p=l?l(p,e.parentNode):p.replace(/[\S]/g,"*")),"OPTION"===d&&p){p=maskInputValue({isMasked:needMaskingText(e,r,a,o,i,shouldMaskInput({type:null,tagName:d,maskInputOptions:c})),element:e,value:p,maskInputFn:l})}return{type:NodeType$1.Text,textContent:p||"",isStyle:g,rootId:u}}function serializeElementNode(e,t){const{doc:n,blockClass:r,blockSelector:o,unblockSelector:a,inlineStylesheet:i,maskInputOptions:s={},maskAttributeFn:c,maskInputFn:l,dataURLOptions:u={},inlineImages:d,recordCanvas:p,keepIframeSrcFn:g,newlyAddedElement:h=!1,rootId:f,maskAllText:m,maskTextClass:_,unmaskTextClass:E,maskTextSelector:T,unmaskTextSelector:S}=t,y=_isBlockedElement(e,r,o,a),v=getValidTagName(e);let I={};const A=e.attributes.length;for(let t=0;t<A;t++){const r=e.attributes[t];r.name&&!ignoreAttribute(v,r.name,r.value)&&(I[r.name]=transformAttribute(n,v,toLowerCase(r.name),r.value,e,c))}if("link"===v&&i){const t=Array.from(n.styleSheets).find((t=>t.href===e.href));let r=null;t&&(r=stringifyStylesheet(t)),r&&(delete I.rel,delete I.href,I._cssText=absoluteToStylesheet(r,t.href))}if("style"===v&&e.sheet&&!(e.innerText||e.textContent||"").trim().length){const t=stringifyStylesheet(e.sheet);t&&(I._cssText=absoluteToStylesheet(t,getHref()))}if("input"===v||"textarea"===v||"select"===v||"option"===v){const t=e,n=getInputType(t),r=getInputValue(t,toUpperCase(v),n),o=t.checked;if("submit"!==n&&"button"!==n&&r){const e=needMaskingText(t,_,T,E,S,shouldMaskInput({type:n,tagName:toUpperCase(v),maskInputOptions:s}));I.value=maskInputValue({isMasked:e,element:t,value:r,maskInputFn:l})}o&&(I.checked=o)}if("option"===v&&(e.selected&&!s.select?I.selected=!0:delete I.selected),"canvas"===v&&p)if("2d"===e.__context)is2DCanvasBlank(e)||(I.rr_dataURL=e.toDataURL(u.type,u.quality));else if(!("__context"in e)){const t=e.toDataURL(u.type,u.quality),n=document.createElement("canvas");n.width=e.width,n.height=e.height;t!==n.toDataURL(u.type,u.quality)&&(I.rr_dataURL=t)}if("img"===v&&d){canvasService||(canvasService=n.createElement("canvas"),canvasCtx=canvasService.getContext("2d"));const t=e,r=t.crossOrigin;t.crossOrigin="anonymous";const o=()=>{t.removeEventListener("load",o);try{canvasService.width=t.naturalWidth,canvasService.height=t.naturalHeight,canvasCtx.drawImage(t,0,0),I.rr_dataURL=canvasService.toDataURL(u.type,u.quality)}catch(e){console.warn(`Cannot inline img src=${t.currentSrc}! Error: ${e}`)}r?I.crossOrigin=r:t.removeAttribute("crossorigin")};t.complete&&0!==t.naturalWidth?o():t.addEventListener("load",o)}if("audio"!==v&&"video"!==v||(I.rr_mediaState=e.paused?"paused":"played",I.rr_mediaCurrentTime=e.currentTime),h||(e.scrollLeft&&(I.rr_scrollLeft=e.scrollLeft),e.scrollTop&&(I.rr_scrollTop=e.scrollTop)),y){const{width:t,height:n}=e.getBoundingClientRect();I={class:I.class,rr_width:`${t}px`,rr_height:`${n}px`}}let b;"iframe"!==v||g(I.src)||(e.contentDocument||(I.rr_src=I.src),delete I.src);try{customElements.get(v)&&(b=!0)}catch(e){}return{type:NodeType$1.Element,tagName:v,attributes:I,childNodes:[],isSVG:isSVGElement(e)||void 0,needBlock:y,rootId:f,isCustom:b}}function lowerIfExists(e){return null==e?"":e.toLowerCase()}function slimDOMExcluded(e,t){if(t.comment&&e.type===NodeType$1.Comment)return!0;if(e.type===NodeType$1.Element){if(t.script&&("script"===e.tagName||"link"===e.tagName&&("preload"===e.attributes.rel||"modulepreload"===e.attributes.rel)&&"script"===e.attributes.as||"link"===e.tagName&&"prefetch"===e.attributes.rel&&"string"==typeof e.attributes.href&&e.attributes.href.endsWith(".js")))return!0;if(t.headFavicon&&("link"===e.tagName&&"shortcut icon"===e.attributes.rel||"meta"===e.tagName&&(lowerIfExists(e.attributes.name).match(/^msapplication-tile(image|color)$/)||"application-name"===lowerIfExists(e.attributes.name)||"icon"===lowerIfExists(e.attributes.rel)||"apple-touch-icon"===lowerIfExists(e.attributes.rel)||"shortcut icon"===lowerIfExists(e.attributes.rel))))return!0;if("meta"===e.tagName){if(t.headMetaDescKeywords&&lowerIfExists(e.attributes.name).match(/^description|keywords$/))return!0;if(t.headMetaSocial&&(lowerIfExists(e.attributes.property).match(/^(og|twitter|fb):/)||lowerIfExists(e.attributes.name).match(/^(og|twitter):/)||"pinterest"===lowerIfExists(e.attributes.name)))return!0;if(t.headMetaRobots&&("robots"===lowerIfExists(e.attributes.name)||"googlebot"===lowerIfExists(e.attributes.name)||"bingbot"===lowerIfExists(e.attributes.name)))return!0;if(t.headMetaHttpEquiv&&void 0!==e.attributes["http-equiv"])return!0;if(t.headMetaAuthorship&&("author"===lowerIfExists(e.attributes.name)||"generator"===lowerIfExists(e.attributes.name)||"framework"===lowerIfExists(e.attributes.name)||"publisher"===lowerIfExists(e.attributes.name)||"progid"===lowerIfExists(e.attributes.name)||lowerIfExists(e.attributes.property).match(/^article:/)||lowerIfExists(e.attributes.property).match(/^product:/)))return!0;if(t.headMetaVerification&&("google-site-verification"===lowerIfExists(e.attributes.name)||"yandex-verification"===lowerIfExists(e.attributes.name)||"csrf-token"===lowerIfExists(e.attributes.name)||"p:domain_verify"===lowerIfExists(e.attributes.name)||"verify-v1"===lowerIfExists(e.attributes.name)||"verification"===lowerIfExists(e.attributes.name)||"shopify-checkout-api-token"===lowerIfExists(e.attributes.name)))return!0}}return!1}function serializeNodeWithId(e,t){const{doc:n,mirror:r,blockClass:o,blockSelector:a,unblockSelector:i,maskAllText:s,maskTextClass:c,unmaskTextClass:l,maskTextSelector:u,unmaskTextSelector:d,skipChild:p=!1,inlineStylesheet:g=!0,maskInputOptions:h={},maskAttributeFn:f,maskTextFn:m,maskInputFn:_,slimDOMOptions:E,dataURLOptions:T={},inlineImages:S=!1,recordCanvas:y=!1,onSerialize:v,onIframeLoad:I,iframeLoadTimeout:A=5e3,onStylesheetLoad:b,stylesheetLoadTimeout:R=5e3,keepIframeSrcFn:O=(()=>!1),newlyAddedElement:L=!1}=t;let{preserveWhiteSpace:N=!0}=t;const C=serializeNode(e,{doc:n,mirror:r,blockClass:o,blockSelector:a,maskAllText:s,unblockSelector:i,maskTextClass:c,unmaskTextClass:l,maskTextSelector:u,unmaskTextSelector:d,inlineStylesheet:g,maskInputOptions:h,maskAttributeFn:f,maskTextFn:m,maskInputFn:_,dataURLOptions:T,inlineImages:S,recordCanvas:y,keepIframeSrcFn:O,newlyAddedElement:L});if(!C)return console.warn(e,"not serialized"),null;let w;w=r.hasNode(e)?r.getId(e):slimDOMExcluded(C,E)||!N&&C.type===NodeType$1.Text&&!C.isStyle&&!C.textContent.replace(/^\s+|\s+$/gm,"").length?IGNORED_NODE:genId();const D=Object.assign(C,{id:w});if(r.add(e,D),w===IGNORED_NODE)return null;v&&v(e);let P=!p;if(D.type===NodeType$1.Element){P=P&&!D.needBlock,delete D.needBlock;const t=e.shadowRoot;t&&isNativeShadowDom(t)&&(D.isShadowHost=!0)}if((D.type===NodeType$1.Document||D.type===NodeType$1.Element)&&P){E.headWhitespace&&D.type===NodeType$1.Element&&"head"===D.tagName&&(N=!1);const t={doc:n,mirror:r,blockClass:o,blockSelector:a,maskAllText:s,unblockSelector:i,maskTextClass:c,unmaskTextClass:l,maskTextSelector:u,unmaskTextSelector:d,skipChild:p,inlineStylesheet:g,maskInputOptions:h,maskAttributeFn:f,maskTextFn:m,maskInputFn:_,slimDOMOptions:E,dataURLOptions:T,inlineImages:S,recordCanvas:y,preserveWhiteSpace:N,onSerialize:v,onIframeLoad:I,iframeLoadTimeout:A,onStylesheetLoad:b,stylesheetLoadTimeout:R,keepIframeSrcFn:O};for(const n of Array.from(e.childNodes)){const e=serializeNodeWithId(n,t);e&&D.childNodes.push(e)}if(isElement$1(e)&&e.shadowRoot)for(const n of Array.from(e.shadowRoot.childNodes)){const r=serializeNodeWithId(n,t);r&&(isNativeShadowDom(e.shadowRoot)&&(r.isShadow=!0),D.childNodes.push(r))}}return e.parentNode&&isShadowRoot(e.parentNode)&&isNativeShadowDom(e.parentNode)&&(D.isShadow=!0),D.type===NodeType$1.Element&&"iframe"===D.tagName&&onceIframeLoaded(e,(()=>{const t=e.contentDocument;if(t&&I){const n=serializeNodeWithId(t,{doc:t,mirror:r,blockClass:o,blockSelector:a,unblockSelector:i,maskAllText:s,maskTextClass:c,unmaskTextClass:l,maskTextSelector:u,unmaskTextSelector:d,skipChild:!1,inlineStylesheet:g,maskInputOptions:h,maskAttributeFn:f,maskTextFn:m,maskInputFn:_,slimDOMOptions:E,dataURLOptions:T,inlineImages:S,recordCanvas:y,preserveWhiteSpace:N,onSerialize:v,onIframeLoad:I,iframeLoadTimeout:A,onStylesheetLoad:b,stylesheetLoadTimeout:R,keepIframeSrcFn:O});n&&I(e,n)}}),A),D.type===NodeType$1.Element&&"link"===D.tagName&&"stylesheet"===D.attributes.rel&&onceStylesheetLoaded(e,(()=>{if(b){const t=serializeNodeWithId(e,{doc:n,mirror:r,blockClass:o,blockSelector:a,unblockSelector:i,maskAllText:s,maskTextClass:c,unmaskTextClass:l,maskTextSelector:u,unmaskTextSelector:d,skipChild:!1,inlineStylesheet:g,maskInputOptions:h,maskAttributeFn:f,maskTextFn:m,maskInputFn:_,slimDOMOptions:E,dataURLOptions:T,inlineImages:S,recordCanvas:y,preserveWhiteSpace:N,onSerialize:v,onIframeLoad:I,iframeLoadTimeout:A,onStylesheetLoad:b,stylesheetLoadTimeout:R,keepIframeSrcFn:O});t&&b(e,t)}}),R),D}function snapshot(e,t){const{mirror:n=new Mirror,blockClass:r="rr-block",blockSelector:o=null,unblockSelector:a=null,maskAllText:i=!1,maskTextClass:s="rr-mask",unmaskTextClass:c=null,maskTextSelector:l=null,unmaskTextSelector:u=null,inlineStylesheet:d=!0,inlineImages:p=!1,recordCanvas:g=!1,maskAllInputs:h=!1,maskAttributeFn:f,maskTextFn:m,maskInputFn:_,slimDOM:E=!1,dataURLOptions:T,preserveWhiteSpace:S,onSerialize:y,onIframeLoad:v,iframeLoadTimeout:I,onStylesheetLoad:A,stylesheetLoadTimeout:b,keepIframeSrcFn:R=(()=>!1)}=t||{};return serializeNodeWithId(e,{doc:e,mirror:n,blockClass:r,blockSelector:o,unblockSelector:a,maskAllText:i,maskTextClass:s,unmaskTextClass:c,maskTextSelector:l,unmaskTextSelector:u,skipChild:!1,inlineStylesheet:d,maskInputOptions:!0===h?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0}:!1===h?{}:h,maskAttributeFn:f,maskTextFn:m,maskInputFn:_,slimDOMOptions:!0===E||"all"===E?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:"all"===E,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:!1===E?{}:E,dataURLOptions:T,inlineImages:p,recordCanvas:g,preserveWhiteSpace:S,onSerialize:y,onIframeLoad:v,iframeLoadTimeout:I,onStylesheetLoad:A,stylesheetLoadTimeout:b,keepIframeSrcFn:R,newlyAddedElement:!1})}function _optionalChain$4(e){let t,n=e[0],r=1;for(;r<e.length;){const o=e[r],a=e[r+1];if(r+=2,("optionalAccess"===o||"optionalCall"===o)&&null==n)return;"access"===o||"optionalAccess"===o?(t=n,n=a(n)):"call"!==o&&"optionalCall"!==o||(n=a(((...e)=>n.call(t,...e))),t=void 0)}return n}function on(e,t,n=document){const r={capture:!0,passive:!0};return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t,r)}const DEPARTED_MIRROR_ACCESS_WARNING$1="Please stop import mirror directly. Instead of that,\r\nnow you can use replayer.getMirror() to access the mirror instance of a replayer,\r\nor you can use record.mirror to access the mirror instance during recording.";let _mirror$1={map:{},getId:()=>(console.error(DEPARTED_MIRROR_ACCESS_WARNING$1),-1),getNode:()=>(console.error(DEPARTED_MIRROR_ACCESS_WARNING$1),null),removeNodeFromMap(){console.error(DEPARTED_MIRROR_ACCESS_WARNING$1)},has:()=>(console.error(DEPARTED_MIRROR_ACCESS_WARNING$1),!1),reset(){console.error(DEPARTED_MIRROR_ACCESS_WARNING$1)}};function throttle$1(e,t,n={}){let r=null,o=0;return function(...a){const i=Date.now();o||!1!==n.leading||(o=i);const s=t-(i-o),c=this;s<=0||s>t?(r&&(clearTimeout$1(r),r=null),o=i,e.apply(c,a)):r||!1===n.trailing||(r=setTimeout$1$1((()=>{o=!1===n.leading?0:Date.now(),r=null,e.apply(c,a)}),s))}}function hookSetter$1(e,t,n,r,o=window){const a=o.Object.getOwnPropertyDescriptor(e,t);return o.Object.defineProperty(e,t,r?n:{set(e){setTimeout$1$1((()=>{n.set.call(this,e)}),0),a&&a.set&&a.set.call(this,e)}}),()=>hookSetter$1(e,t,a||{},!0)}function patch$1(e,t,n){try{if(!(t in e))return()=>{};const r=e[t],o=n(r);return"function"==typeof o&&(o.prototype=o.prototype||{},Object.defineProperties(o,{__rrweb_original__:{enumerable:!1,value:r}})),e[t]=o,()=>{e[t]=r}}catch(e){return()=>{}}}"undefined"!=typeof window&&window.Proxy&&window.Reflect&&(_mirror$1=new Proxy(_mirror$1,{get:(e,t,n)=>("map"===t&&console.error(DEPARTED_MIRROR_ACCESS_WARNING$1),Reflect.get(e,t,n))}));let nowTimestamp=Date.now;function getWindowScroll(e){const t=e.document;return{left:t.scrollingElement?t.scrollingElement.scrollLeft:void 0!==e.pageXOffset?e.pageXOffset:_optionalChain$4([t,"optionalAccess",e=>e.documentElement,"access",e=>e.scrollLeft])||_optionalChain$4([t,"optionalAccess",e=>e.body,"optionalAccess",e=>e.parentElement,"optionalAccess",e=>e.scrollLeft])||_optionalChain$4([t,"optionalAccess",e=>e.body,"optionalAccess",e=>e.scrollLeft])||0,top:t.scrollingElement?t.scrollingElement.scrollTop:void 0!==e.pageYOffset?e.pageYOffset:_optionalChain$4([t,"optionalAccess",e=>e.documentElement,"access",e=>e.scrollTop])||_optionalChain$4([t,"optionalAccess",e=>e.body,"optionalAccess",e=>e.parentElement,"optionalAccess",e=>e.scrollTop])||_optionalChain$4([t,"optionalAccess",e=>e.body,"optionalAccess",e=>e.scrollTop])||0}}function getWindowHeight(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function getWindowWidth(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function closestElementOfNode$1(e){if(!e)return null;return e.nodeType===e.ELEMENT_NODE?e:e.parentElement}function isBlocked$1(e,t,n,r,o){if(!e)return!1;const a=closestElementOfNode$1(e);if(!a)return!1;const i=createMatchPredicate$1(t,n);if(!o){const e=r&&a.matches(r);return i(a)&&!e}const s=distanceToMatch$1(a,i);let c=-1;return!(s<0)&&(r&&(c=distanceToMatch$1(a,createMatchPredicate$1(null,r))),s>-1&&c<0||s<c)}function isSerialized(e,t){return-1!==t.getId(e)}function isIgnored(e,t){return t.getId(e)===IGNORED_NODE}function isAncestorRemoved(e,t){if(isShadowRoot(e))return!1;const n=t.getId(e);return!t.has(n)||(!e.parentNode||e.parentNode.nodeType!==e.DOCUMENT_NODE)&&(!e.parentNode||isAncestorRemoved(e.parentNode,t))}function legacy_isTouchEvent(e){return Boolean(e.changedTouches)}function polyfill(e=window){"NodeList"in e&&!e.NodeList.prototype.forEach&&(e.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in e&&!e.DOMTokenList.prototype.forEach&&(e.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=(...e)=>{let t=e[0];if(!(0 in e))throw new TypeError("1 argument is required");do{if(this===t)return!0}while(t=t&&t.parentNode);return!1})}function isSerializedIframe(e,t){return Boolean("IFRAME"===e.nodeName&&t.getMeta(e))}function isSerializedStylesheet(e,t){return Boolean("LINK"===e.nodeName&&e.nodeType===e.ELEMENT_NODE&&e.getAttribute&&"stylesheet"===e.getAttribute("rel")&&t.getMeta(e))}function hasShadowRoot(e){return Boolean(_optionalChain$4([e,"optionalAccess",e=>e.shadowRoot]))}/[1-9][0-9]{12}/.test(Date.now().toString())||(nowTimestamp=()=>(new Date).getTime());class StyleSheetMirror{constructor(){this.id=1,this.styleIDMap=new WeakMap,this.idStyleMap=new Map}getId(e){return _nullishCoalesce(this.styleIDMap.get(e),(()=>-1))}has(e){return this.styleIDMap.has(e)}add(e,t){if(this.has(e))return this.getId(e);let n;return n=void 0===t?this.id++:t,this.styleIDMap.set(e,n),this.idStyleMap.set(n,e),n}getStyle(e){return this.idStyleMap.get(e)||null}reset(){this.styleIDMap=new WeakMap,this.idStyleMap=new Map,this.id=1}generateId(){return this.id++}}function getShadowHost(e){let t=null;return _optionalChain$4([e,"access",e=>e.getRootNode,"optionalCall",e=>e(),"optionalAccess",e=>e.nodeType])===Node.DOCUMENT_FRAGMENT_NODE&&e.getRootNode().host&&(t=e.getRootNode().host),t}function getRootShadowHost(e){let t,n=e;for(;t=getShadowHost(n);)n=t;return n}function shadowHostInDom(e){const t=e.ownerDocument;if(!t)return!1;const n=getRootShadowHost(e);return t.contains(n)}function inDom(e){const t=e.ownerDocument;return!!t&&(t.contains(e)||shadowHostInDom(e))}const cachedImplementations$1={};function getImplementation$1(e){const t=cachedImplementations$1[e];if(t)return t;const n=window.document;let r=window[e];if(n&&"function"==typeof n.createElement)try{const t=n.createElement("iframe");t.hidden=!0,n.head.appendChild(t);const o=t.contentWindow;o&&o[e]&&(r=o[e]),n.head.removeChild(t)}catch(e){}return cachedImplementations$1[e]=r.bind(window)}function onRequestAnimationFrame$1(...e){return getImplementation$1("requestAnimationFrame")(...e)}function setTimeout$1$1(...e){return getImplementation$1("setTimeout")(...e)}function clearTimeout$1(...e){return getImplementation$1("clearTimeout")(...e)}var EventType=(e=>(e[e.DomContentLoaded=0]="DomContentLoaded",e[e.Load=1]="Load",e[e.FullSnapshot=2]="FullSnapshot",e[e.IncrementalSnapshot=3]="IncrementalSnapshot",e[e.Meta=4]="Meta",e[e.Custom=5]="Custom",e[e.Plugin=6]="Plugin",e))(EventType||{}),IncrementalSource=(e=>(e[e.Mutation=0]="Mutation",e[e.MouseMove=1]="MouseMove",e[e.MouseInteraction=2]="MouseInteraction",e[e.Scroll=3]="Scroll",e[e.ViewportResize=4]="ViewportResize",e[e.Input=5]="Input",e[e.TouchMove=6]="TouchMove",e[e.MediaInteraction=7]="MediaInteraction",e[e.StyleSheetRule=8]="StyleSheetRule",e[e.CanvasMutation=9]="CanvasMutation",e[e.Font=10]="Font",e[e.Log=11]="Log",e[e.Drag=12]="Drag",e[e.StyleDeclaration=13]="StyleDeclaration",e[e.Selection=14]="Selection",e[e.AdoptedStyleSheet=15]="AdoptedStyleSheet",e[e.CustomElement=16]="CustomElement",e))(IncrementalSource||{}),MouseInteractions=(e=>(e[e.MouseUp=0]="MouseUp",e[e.MouseDown=1]="MouseDown",e[e.Click=2]="Click",e[e.ContextMenu=3]="ContextMenu",e[e.DblClick=4]="DblClick",e[e.Focus=5]="Focus",e[e.Blur=6]="Blur",e[e.TouchStart=7]="TouchStart",e[e.TouchMove_Departed=8]="TouchMove_Departed",e[e.TouchEnd=9]="TouchEnd",e[e.TouchCancel=10]="TouchCancel",e))(MouseInteractions||{}),PointerTypes=(e=>(e[e.Mouse=0]="Mouse",e[e.Pen=1]="Pen",e[e.Touch=2]="Touch",e))(PointerTypes||{});function _optionalChain$3(e){let t,n=e[0],r=1;for(;r<e.length;){const o=e[r],a=e[r+1];if(r+=2,("optionalAccess"===o||"optionalCall"===o)&&null==n)return;"access"===o||"optionalAccess"===o?(t=n,n=a(n)):"call"!==o&&"optionalCall"!==o||(n=a(((...e)=>n.call(t,...e))),t=void 0)}return n}function isNodeInLinkedList(e){return"__ln"in e}class DoubleLinkedList{constructor(){this.length=0,this.head=null,this.tail=null}get(e){if(e>=this.length)throw new Error("Position outside of list range");let t=this.head;for(let n=0;n<e;n++)t=_optionalChain$3([t,"optionalAccess",e=>e.next])||null;return t}addNode(e){const t={value:e,previous:null,next:null};if(e.__ln=t,e.previousSibling&&isNodeInLinkedList(e.previousSibling)){const n=e.previousSibling.__ln.next;t.next=n,t.previous=e.previousSibling.__ln,e.previousSibling.__ln.next=t,n&&(n.previous=t)}else if(e.nextSibling&&isNodeInLinkedList(e.nextSibling)&&e.nextSibling.__ln.previous){const n=e.nextSibling.__ln.previous;t.previous=n,t.next=e.nextSibling.__ln,e.nextSibling.__ln.previous=t,n&&(n.next=t)}else this.head&&(this.head.previous=t),t.next=this.head,this.head=t;null===t.next&&(this.tail=t),this.length++}removeNode(e){const t=e.__ln;this.head&&(t.previous?(t.previous.next=t.next,t.next?t.next.previous=t.previous:this.tail=t.previous):(this.head=t.next,this.head?this.head.previous=null:this.tail=null),e.__ln&&delete e.__ln,this.length--)}}const moveKey=(e,t)=>`${e}@${t}`;class MutationBuffer{constructor(){this.frozen=!1,this.locked=!1,this.texts=[],this.attributes=[],this.attributeMap=new WeakMap,this.removes=[],this.mapRemoves=[],this.movedMap={},this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.processMutations=e=>{e.forEach(this.processMutation),this.emit()},this.emit=()=>{if(this.frozen||this.locked)return;const e=[],t=new Set,n=new DoubleLinkedList,r=e=>{let t=e,n=IGNORED_NODE;for(;n===IGNORED_NODE;)t=t&&t.nextSibling,n=t&&this.mirror.getId(t);return n},o=o=>{if(!o.parentNode||!inDom(o))return;const a=isShadowRoot(o.parentNode)?this.mirror.getId(getShadowHost(o)):this.mirror.getId(o.parentNode),i=r(o);if(-1===a||-1===i)return n.addNode(o);const s=serializeNodeWithId(o,{doc:this.doc,mirror:this.mirror,blockClass:this.blockClass,blockSelector:this.blockSelector,maskAllText:this.maskAllText,unblockSelector:this.unblockSelector,maskTextClass:this.maskTextClass,unmaskTextClass:this.unmaskTextClass,maskTextSelector:this.maskTextSelector,unmaskTextSelector:this.unmaskTextSelector,skipChild:!0,newlyAddedElement:!0,inlineStylesheet:this.inlineStylesheet,maskInputOptions:this.maskInputOptions,maskAttributeFn:this.maskAttributeFn,maskTextFn:this.maskTextFn,maskInputFn:this.maskInputFn,slimDOMOptions:this.slimDOMOptions,dataURLOptions:this.dataURLOptions,recordCanvas:this.recordCanvas,inlineImages:this.inlineImages,onSerialize:e=>{isSerializedIframe(e,this.mirror)&&this.iframeManager.addIframe(e),isSerializedStylesheet(e,this.mirror)&&this.stylesheetManager.trackLinkElement(e),hasShadowRoot(o)&&this.shadowDomManager.addShadowRoot(o.shadowRoot,this.doc)},onIframeLoad:(e,t)=>{this.iframeManager.attachIframe(e,t),this.shadowDomManager.observeAttachShadow(e)},onStylesheetLoad:(e,t)=>{this.stylesheetManager.attachLinkElement(e,t)}});s&&(e.push({parentId:a,nextId:i,node:s}),t.add(s.id))};for(;this.mapRemoves.length;)this.mirror.removeNodeFromMap(this.mapRemoves.shift());for(const e of this.movedSet)isParentRemoved(this.removes,e,this.mirror)&&!this.movedSet.has(e.parentNode)||o(e);for(const e of this.addedSet)isAncestorInSet(this.droppedSet,e)||isParentRemoved(this.removes,e,this.mirror)?isAncestorInSet(this.movedSet,e)?o(e):this.droppedSet.add(e):o(e);let a=null;for(;n.length;){let e=null;if(a){const t=this.mirror.getId(a.value.parentNode),n=r(a.value);-1!==t&&-1!==n&&(e=a)}if(!e){let t=n.tail;for(;t;){const n=t;if(t=t.previous,n){const t=this.mirror.getId(n.value.parentNode);if(-1===r(n.value))continue;if(-1!==t){e=n;break}{const t=n.value;if(t.parentNode&&t.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE){const r=t.parentNode.host;if(-1!==this.mirror.getId(r)){e=n;break}}}}}}if(!e){for(;n.head;)n.removeNode(n.head.value);break}a=e.previous,n.removeNode(e.value),o(e.value)}const i={texts:this.texts.map((e=>({id:this.mirror.getId(e.node),value:e.value}))).filter((e=>!t.has(e.id))).filter((e=>this.mirror.has(e.id))),attributes:this.attributes.map((e=>{const{attributes:t}=e;if("string"==typeof t.style){const n=JSON.stringify(e.styleDiff),r=JSON.stringify(e._unchangedStyles);n.length<t.style.length&&(n+r).split("var(").length===t.style.split("var(").length&&(t.style=e.styleDiff)}return{id:this.mirror.getId(e.node),attributes:t}})).filter((e=>!t.has(e.id))).filter((e=>this.mirror.has(e.id))),removes:this.removes,adds:e};(i.texts.length||i.attributes.length||i.removes.length||i.adds.length)&&(this.texts=[],this.attributes=[],this.attributeMap=new WeakMap,this.removes=[],this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.movedMap={},this.mutationCb(i))},this.processMutation=e=>{if(!isIgnored(e.target,this.mirror))switch(e.type){case"characterData":{const t=e.target.textContent;isBlocked$1(e.target,this.blockClass,this.blockSelector,this.unblockSelector,!1)||t===e.oldValue||this.texts.push({value:needMaskingText(e.target,this.maskTextClass,this.maskTextSelector,this.unmaskTextClass,this.unmaskTextSelector,this.maskAllText)&&t?this.maskTextFn?this.maskTextFn(t,closestElementOfNode$1(e.target)):t.replace(/[\S]/g,"*"):t,node:e.target});break}case"attributes":{const t=e.target;let n=e.attributeName,r=e.target.getAttribute(n);if("value"===n){const n=getInputType(t),o=t.tagName;r=getInputValue(t,o,n);const a=shouldMaskInput({maskInputOptions:this.maskInputOptions,tagName:o,type:n});r=maskInputValue({isMasked:needMaskingText(e.target,this.maskTextClass,this.maskTextSelector,this.unmaskTextClass,this.unmaskTextSelector,a),element:t,value:r,maskInputFn:this.maskInputFn})}if(isBlocked$1(e.target,this.blockClass,this.blockSelector,this.unblockSelector,!1)||r===e.oldValue)return;let o=this.attributeMap.get(e.target);if("IFRAME"===t.tagName&&"src"===n&&!this.keepIframeSrcFn(r)){if(t.contentDocument)return;n="rr_src"}if(o||(o={node:e.target,attributes:{},styleDiff:{},_unchangedStyles:{}},this.attributes.push(o),this.attributeMap.set(e.target,o)),"type"===n&&"INPUT"===t.tagName&&"password"===(e.oldValue||"").toLowerCase()&&t.setAttribute("data-rr-is-password","true"),!ignoreAttribute(t.tagName,n)&&(o.attributes[n]=transformAttribute(this.doc,toLowerCase(t.tagName),toLowerCase(n),r,t,this.maskAttributeFn),"style"===n)){if(!this.unattachedDoc)try{this.unattachedDoc=document.implementation.createHTMLDocument()}catch(e){this.unattachedDoc=this.doc}const n=this.unattachedDoc.createElement("span");e.oldValue&&n.setAttribute("style",e.oldValue);for(const e of Array.from(t.style)){const r=t.style.getPropertyValue(e),a=t.style.getPropertyPriority(e);r!==n.style.getPropertyValue(e)||a!==n.style.getPropertyPriority(e)?o.styleDiff[e]=""===a?r:[r,a]:o._unchangedStyles[e]=[r,a]}for(const e of Array.from(n.style))""===t.style.getPropertyValue(e)&&(o.styleDiff[e]=!1)}break}case"childList":if(isBlocked$1(e.target,this.blockClass,this.blockSelector,this.unblockSelector,!0))return;e.addedNodes.forEach((t=>this.genAdds(t,e.target))),e.removedNodes.forEach((t=>{const n=this.mirror.getId(t),r=isShadowRoot(e.target)?this.mirror.getId(e.target.host):this.mirror.getId(e.target);isBlocked$1(e.target,this.blockClass,this.blockSelector,this.unblockSelector,!1)||isIgnored(t,this.mirror)||!isSerialized(t,this.mirror)||(this.addedSet.has(t)?(deepDelete(this.addedSet,t),this.droppedSet.add(t)):this.addedSet.has(e.target)&&-1===n||isAncestorRemoved(e.target,this.mirror)||(this.movedSet.has(t)&&this.movedMap[moveKey(n,r)]?deepDelete(this.movedSet,t):this.removes.push({parentId:r,id:n,isShadow:!(!isShadowRoot(e.target)||!isNativeShadowDom(e.target))||void 0})),this.mapRemoves.push(t))}))}},this.genAdds=(e,t)=>{if(!this.processedNodeManager.inOtherBuffer(e,this)&&!this.addedSet.has(e)&&!this.movedSet.has(e)){if(this.mirror.hasNode(e)){if(isIgnored(e,this.mirror))return;this.movedSet.add(e);let n=null;t&&this.mirror.hasNode(t)&&(n=this.mirror.getId(t)),n&&-1!==n&&(this.movedMap[moveKey(this.mirror.getId(e),n)]=!0)}else this.addedSet.add(e),this.droppedSet.delete(e);isBlocked$1(e,this.blockClass,this.blockSelector,this.unblockSelector,!1)||(e.childNodes.forEach((e=>this.genAdds(e))),hasShadowRoot(e)&&e.shadowRoot.childNodes.forEach((t=>{this.processedNodeManager.add(t,this),this.genAdds(t,e)})))}}}init(e){["mutationCb","blockClass","blockSelector","unblockSelector","maskAllText","maskTextClass","unmaskTextClass","maskTextSelector","unmaskTextSelector","inlineStylesheet","maskInputOptions","maskAttributeFn","maskTextFn","maskInputFn","keepIframeSrcFn","recordCanvas","inlineImages","slimDOMOptions","dataURLOptions","doc","mirror","iframeManager","stylesheetManager","shadowDomManager","canvasManager","processedNodeManager"].forEach((t=>{this[t]=e[t]}))}freeze(){this.frozen=!0,this.canvasManager.freeze()}unfreeze(){this.frozen=!1,this.canvasManager.unfreeze(),this.emit()}isFrozen(){return this.frozen}lock(){this.locked=!0,this.canvasManager.lock()}unlock(){this.locked=!1,this.canvasManager.unlock(),this.emit()}reset(){this.shadowDomManager.reset(),this.canvasManager.reset()}}function deepDelete(e,t){e.delete(t),t.childNodes.forEach((t=>deepDelete(e,t)))}function isParentRemoved(e,t,n){return 0!==e.length&&_isParentRemoved(e,t,n)}function _isParentRemoved(e,t,n){const{parentNode:r}=t;if(!r)return!1;const o=n.getId(r);return!!e.some((e=>e.id===o))||_isParentRemoved(e,r,n)}function isAncestorInSet(e,t){return 0!==e.size&&_isAncestorInSet(e,t)}function _isAncestorInSet(e,t){const{parentNode:n}=t;return!!n&&(!!e.has(n)||_isAncestorInSet(e,n))}let errorHandler$1;function registerErrorHandler$1(e){errorHandler$1=e}function unregisterErrorHandler(){errorHandler$1=void 0}const callbackWrapper$1=e=>{if(!errorHandler$1)return e;return(...t)=>{try{return e(...t)}catch(e){if(errorHandler$1&&!0===errorHandler$1(e))return()=>{};throw e}}};function _optionalChain$2(e){let t,n=e[0],r=1;for(;r<e.length;){const o=e[r],a=e[r+1];if(r+=2,("optionalAccess"===o||"optionalCall"===o)&&null==n)return;"access"===o||"optionalAccess"===o?(t=n,n=a(n)):"call"!==o&&"optionalCall"!==o||(n=a(((...e)=>n.call(t,...e))),t=void 0)}return n}const mutationBuffers=[];function getEventTarget(e){try{if("composedPath"in e){const t=e.composedPath();if(t.length)return t[0]}else if("path"in e&&e.path.length)return e.path[0]}catch(e){}return e&&e.target}function initMutationObserver(e,t){const n=new MutationBuffer;mutationBuffers.push(n),n.init(e);let r=window.MutationObserver||window.__rrMutationObserver;const o=_optionalChain$2([window,"optionalAccess",e=>e.Zone,"optionalAccess",e=>e.__symbol__,"optionalCall",e=>e("MutationObserver")]);o&&window[o]&&(r=window[o]);const a=new r(callbackWrapper$1((t=>{e.onMutation&&!1===e.onMutation(t)||n.processMutations.bind(n)(t)})));return a.observe(t,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),a}function initMoveObserver({mousemoveCb:e,sampling:t,doc:n,mirror:r}){if(!1===t.mousemove)return()=>{};const o="number"==typeof t.mousemove?t.mousemove:50,a="number"==typeof t.mousemoveCallback?t.mousemoveCallback:500;let i,s=[];const c=throttle$1(callbackWrapper$1((t=>{const n=Date.now()-i;e(s.map((e=>(e.timeOffset-=n,e))),t),s=[],i=null})),a),l=callbackWrapper$1(throttle$1(callbackWrapper$1((e=>{const t=getEventTarget(e),{clientX:n,clientY:o}=legacy_isTouchEvent(e)?e.changedTouches[0]:e;i||(i=nowTimestamp()),s.push({x:n,y:o,id:r.getId(t),timeOffset:nowTimestamp()-i}),c("undefined"!=typeof DragEvent&&e instanceof DragEvent?IncrementalSource.Drag:e instanceof MouseEvent?IncrementalSource.MouseMove:IncrementalSource.TouchMove)})),o,{trailing:!1})),u=[on("mousemove",l,n),on("touchmove",l,n),on("drag",l,n)];return callbackWrapper$1((()=>{u.forEach((e=>e()))}))}function initMouseInteractionObserver({mouseInteractionCb:e,doc:t,mirror:n,blockClass:r,blockSelector:o,unblockSelector:a,sampling:i}){if(!1===i.mouseInteraction)return()=>{};const s=!0===i.mouseInteraction||void 0===i.mouseInteraction?{}:i.mouseInteraction,c=[];let l=null;return Object.keys(MouseInteractions).filter((e=>Number.isNaN(Number(e))&&!e.endsWith("_Departed")&&!1!==s[e])).forEach((i=>{let s=toLowerCase(i);const u=(t=>i=>{const s=getEventTarget(i);if(isBlocked$1(s,r,o,a,!0))return;let c=null,u=t;if("pointerType"in i){switch(i.pointerType){case"mouse":c=PointerTypes.Mouse;break;case"touch":c=PointerTypes.Touch;break;case"pen":c=PointerTypes.Pen}c===PointerTypes.Touch?MouseInteractions[t]===MouseInteractions.MouseDown?u="TouchStart":MouseInteractions[t]===MouseInteractions.MouseUp&&(u="TouchEnd"):PointerTypes.Pen}else legacy_isTouchEvent(i)&&(c=PointerTypes.Touch);null!==c?(l=c,(u.startsWith("Touch")&&c===PointerTypes.Touch||u.startsWith("Mouse")&&c===PointerTypes.Mouse)&&(c=null)):MouseInteractions[t]===MouseInteractions.Click&&(c=l,l=null);const d=legacy_isTouchEvent(i)?i.changedTouches[0]:i;if(!d)return;const p=n.getId(s),{clientX:g,clientY:h}=d;callbackWrapper$1(e)({type:MouseInteractions[u],id:p,x:g,y:h,...null!==c&&{pointerType:c}})})(i);if(window.PointerEvent)switch(MouseInteractions[i]){case MouseInteractions.MouseDown:case MouseInteractions.MouseUp:s=s.replace("mouse","pointer");break;case MouseInteractions.TouchStart:case MouseInteractions.TouchEnd:return}c.push(on(s,u,t))})),callbackWrapper$1((()=>{c.forEach((e=>e()))}))}function initScrollObserver({scrollCb:e,doc:t,mirror:n,blockClass:r,blockSelector:o,unblockSelector:a,sampling:i}){return on("scroll",callbackWrapper$1(throttle$1(callbackWrapper$1((i=>{const s=getEventTarget(i);if(!s||isBlocked$1(s,r,o,a,!0))return;const c=n.getId(s);if(s===t&&t.defaultView){const n=getWindowScroll(t.defaultView);e({id:c,x:n.left,y:n.top})}else e({id:c,x:s.scrollLeft,y:s.scrollTop})})),i.scroll||100)),t)}function initViewportResizeObserver({viewportResizeCb:e},{win:t}){let n=-1,r=-1;return on("resize",callbackWrapper$1(throttle$1(callbackWrapper$1((()=>{const t=getWindowHeight(),o=getWindowWidth();n===t&&r===o||(e({width:Number(o),height:Number(t)}),n=t,r=o)})),200)),t)}const INPUT_TAGS=["INPUT","TEXTAREA","SELECT"],lastInputValueMap=new WeakMap;function initInputObserver({inputCb:e,doc:t,mirror:n,blockClass:r,blockSelector:o,unblockSelector:a,ignoreClass:i,ignoreSelector:s,maskInputOptions:c,maskInputFn:l,sampling:u,userTriggeredOnInput:d,maskTextClass:p,unmaskTextClass:g,maskTextSelector:h,unmaskTextSelector:f}){function m(e){let n=getEventTarget(e);const u=e.isTrusted,m=n&&toUpperCase(n.tagName);if("OPTION"===m&&(n=n.parentElement),!n||!m||INPUT_TAGS.indexOf(m)<0||isBlocked$1(n,r,o,a,!0))return;const E=n;if(E.classList.contains(i)||s&&E.matches(s))return;const T=getInputType(n);let S=getInputValue(E,m,T),y=!1;const v=shouldMaskInput({maskInputOptions:c,tagName:m,type:T}),I=needMaskingText(n,p,h,g,f,v);"radio"!==T&&"checkbox"!==T||(y=n.checked),S=maskInputValue({isMasked:I,element:n,value:S,maskInputFn:l}),_(n,d?{text:S,isChecked:y,userTriggered:u}:{text:S,isChecked:y});const A=n.name;"radio"===T&&A&&y&&t.querySelectorAll(`input[type="radio"][name="${A}"]`).forEach((e=>{if(e!==n){const t=maskInputValue({isMasked:I,element:e,value:getInputValue(e,m,T),maskInputFn:l});_(e,d?{text:t,isChecked:!y,userTriggered:!1}:{text:t,isChecked:!y})}}))}function _(t,r){const o=lastInputValueMap.get(t);if(!o||o.text!==r.text||o.isChecked!==r.isChecked){lastInputValueMap.set(t,r);const o=n.getId(t);callbackWrapper$1(e)({...r,id:o})}}const E=("last"===u.input?["change"]:["input","change"]).map((e=>on(e,callbackWrapper$1(m),t))),T=t.defaultView;if(!T)return()=>{E.forEach((e=>e()))};const S=T.Object.getOwnPropertyDescriptor(T.HTMLInputElement.prototype,"value"),y=[[T.HTMLInputElement.prototype,"value"],[T.HTMLInputElement.prototype,"checked"],[T.HTMLSelectElement.prototype,"value"],[T.HTMLTextAreaElement.prototype,"value"],[T.HTMLSelectElement.prototype,"selectedIndex"],[T.HTMLOptionElement.prototype,"selected"]];return S&&S.set&&E.push(...y.map((e=>hookSetter$1(e[0],e[1],{set(){callbackWrapper$1(m)({target:this,isTrusted:!1})}},!1,T)))),callbackWrapper$1((()=>{E.forEach((e=>e()))}))}function getNestedCSSRulePositions(e){return function(e,t){if(hasNestedCSSRule("CSSGroupingRule")&&e.parentRule instanceof CSSGroupingRule||hasNestedCSSRule("CSSMediaRule")&&e.parentRule instanceof CSSMediaRule||hasNestedCSSRule("CSSSupportsRule")&&e.parentRule instanceof CSSSupportsRule||hasNestedCSSRule("CSSConditionRule")&&e.parentRule instanceof CSSConditionRule){const n=Array.from(e.parentRule.cssRules).indexOf(e);t.unshift(n)}else if(e.parentStyleSheet){const n=Array.from(e.parentStyleSheet.cssRules).indexOf(e);t.unshift(n)}return t}(e,[])}function getIdAndStyleId(e,t,n){let r,o;return e?(e.ownerNode?r=t.getId(e.ownerNode):o=n.getId(e),{styleId:o,id:r}):{}}function initStyleSheetObserver({styleSheetRuleCb:e,mirror:t,stylesheetManager:n},{win:r}){if(!r.CSSStyleSheet||!r.CSSStyleSheet.prototype)return()=>{};const o=r.CSSStyleSheet.prototype.insertRule;r.CSSStyleSheet.prototype.insertRule=new Proxy(o,{apply:callbackWrapper$1(((r,o,a)=>{const[i,s]=a,{id:c,styleId:l}=getIdAndStyleId(o,t,n.styleMirror);return(c&&-1!==c||l&&-1!==l)&&e({id:c,styleId:l,adds:[{rule:i,index:s}]}),r.apply(o,a)}))});const a=r.CSSStyleSheet.prototype.deleteRule;let i,s;r.CSSStyleSheet.prototype.deleteRule=new Proxy(a,{apply:callbackWrapper$1(((r,o,a)=>{const[i]=a,{id:s,styleId:c}=getIdAndStyleId(o,t,n.styleMirror);return(s&&-1!==s||c&&-1!==c)&&e({id:s,styleId:c,removes:[{index:i}]}),r.apply(o,a)}))}),r.CSSStyleSheet.prototype.replace&&(i=r.CSSStyleSheet.prototype.replace,r.CSSStyleSheet.prototype.replace=new Proxy(i,{apply:callbackWrapper$1(((r,o,a)=>{const[i]=a,{id:s,styleId:c}=getIdAndStyleId(o,t,n.styleMirror);return(s&&-1!==s||c&&-1!==c)&&e({id:s,styleId:c,replace:i}),r.apply(o,a)}))})),r.CSSStyleSheet.prototype.replaceSync&&(s=r.CSSStyleSheet.prototype.replaceSync,r.CSSStyleSheet.prototype.replaceSync=new Proxy(s,{apply:callbackWrapper$1(((r,o,a)=>{const[i]=a,{id:s,styleId:c}=getIdAndStyleId(o,t,n.styleMirror);return(s&&-1!==s||c&&-1!==c)&&e({id:s,styleId:c,replaceSync:i}),r.apply(o,a)}))}));const c={};canMonkeyPatchNestedCSSRule("CSSGroupingRule")?c.CSSGroupingRule=r.CSSGroupingRule:(canMonkeyPatchNestedCSSRule("CSSMediaRule")&&(c.CSSMediaRule=r.CSSMediaRule),canMonkeyPatchNestedCSSRule("CSSConditionRule")&&(c.CSSConditionRule=r.CSSConditionRule),canMonkeyPatchNestedCSSRule("CSSSupportsRule")&&(c.CSSSupportsRule=r.CSSSupportsRule));const l={};return Object.entries(c).forEach((([r,o])=>{l[r]={insertRule:o.prototype.insertRule,deleteRule:o.prototype.deleteRule},o.prototype.insertRule=new Proxy(l[r].insertRule,{apply:callbackWrapper$1(((r,o,a)=>{const[i,s]=a,{id:c,styleId:l}=getIdAndStyleId(o.parentStyleSheet,t,n.styleMirror);return(c&&-1!==c||l&&-1!==l)&&e({id:c,styleId:l,adds:[{rule:i,index:[...getNestedCSSRulePositions(o),s||0]}]}),r.apply(o,a)}))}),o.prototype.deleteRule=new Proxy(l[r].deleteRule,{apply:callbackWrapper$1(((r,o,a)=>{const[i]=a,{id:s,styleId:c}=getIdAndStyleId(o.parentStyleSheet,t,n.styleMirror);return(s&&-1!==s||c&&-1!==c)&&e({id:s,styleId:c,removes:[{index:[...getNestedCSSRulePositions(o),i]}]}),r.apply(o,a)}))})})),callbackWrapper$1((()=>{r.CSSStyleSheet.prototype.insertRule=o,r.CSSStyleSheet.prototype.deleteRule=a,i&&(r.CSSStyleSheet.prototype.replace=i),s&&(r.CSSStyleSheet.prototype.replaceSync=s),Object.entries(c).forEach((([e,t])=>{t.prototype.insertRule=l[e].insertRule,t.prototype.deleteRule=l[e].deleteRule}))}))}function initAdoptedStyleSheetObserver({mirror:e,stylesheetManager:t},n){let r=null;r="#document"===n.nodeName?e.getId(n):e.getId(n.host);const o="#document"===n.nodeName?_optionalChain$2([n,"access",e=>e.defaultView,"optionalAccess",e=>e.Document]):_optionalChain$2([n,"access",e=>e.ownerDocument,"optionalAccess",e=>e.defaultView,"optionalAccess",e=>e.ShadowRoot]),a=_optionalChain$2([o,"optionalAccess",e=>e.prototype])?Object.getOwnPropertyDescriptor(_optionalChain$2([o,"optionalAccess",e=>e.prototype]),"adoptedStyleSheets"):void 0;return null!==r&&-1!==r&&o&&a?(Object.defineProperty(n,"adoptedStyleSheets",{configurable:a.configurable,enumerable:a.enumerable,get(){return _optionalChain$2([a,"access",e=>e.get,"optionalAccess",e=>e.call,"call",e=>e(this)])},set(e){const n=_optionalChain$2([a,"access",e=>e.set,"optionalAccess",e=>e.call,"call",t=>t(this,e)]);if(null!==r&&-1!==r)try{t.adoptStyleSheets(e,r)}catch(e){}return n}}),callbackWrapper$1((()=>{Object.defineProperty(n,"adoptedStyleSheets",{configurable:a.configurable,enumerable:a.enumerable,get:a.get,set:a.set})}))):()=>{}}function initStyleDeclarationObserver({styleDeclarationCb:e,mirror:t,ignoreCSSAttributes:n,stylesheetManager:r},{win:o}){const a=o.CSSStyleDeclaration.prototype.setProperty;o.CSSStyleDeclaration.prototype.setProperty=new Proxy(a,{apply:callbackWrapper$1(((o,i,s)=>{const[c,l,u]=s;if(n.has(c))return a.apply(i,[c,l,u]);const{id:d,styleId:p}=getIdAndStyleId(_optionalChain$2([i,"access",e=>e.parentRule,"optionalAccess",e=>e.parentStyleSheet]),t,r.styleMirror);return(d&&-1!==d||p&&-1!==p)&&e({id:d,styleId:p,set:{property:c,value:l,priority:u},index:getNestedCSSRulePositions(i.parentRule)}),o.apply(i,s)}))});const i=o.CSSStyleDeclaration.prototype.removeProperty;return o.CSSStyleDeclaration.prototype.removeProperty=new Proxy(i,{apply:callbackWrapper$1(((o,a,s)=>{const[c]=s;if(n.has(c))return i.apply(a,[c]);const{id:l,styleId:u}=getIdAndStyleId(_optionalChain$2([a,"access",e=>e.parentRule,"optionalAccess",e=>e.parentStyleSheet]),t,r.styleMirror);return(l&&-1!==l||u&&-1!==u)&&e({id:l,styleId:u,remove:{property:c},index:getNestedCSSRulePositions(a.parentRule)}),o.apply(a,s)}))}),callbackWrapper$1((()=>{o.CSSStyleDeclaration.prototype.setProperty=a,o.CSSStyleDeclaration.prototype.removeProperty=i}))}function initMediaInteractionObserver({mediaInteractionCb:e,blockClass:t,blockSelector:n,unblockSelector:r,mirror:o,sampling:a,doc:i}){const s=callbackWrapper$1((i=>throttle$1(callbackWrapper$1((a=>{const s=getEventTarget(a);if(!s||isBlocked$1(s,t,n,r,!0))return;const{currentTime:c,volume:l,muted:u,playbackRate:d}=s;e({type:i,id:o.getId(s),currentTime:c,volume:l,muted:u,playbackRate:d})})),a.media||500))),c=[on("play",s(0),i),on("pause",s(1),i),on("seeked",s(2),i),on("volumechange",s(3),i),on("ratechange",s(4),i)];return callbackWrapper$1((()=>{c.forEach((e=>e()))}))}function initFontObserver({fontCb:e,doc:t}){const n=t.defaultView;if(!n)return()=>{};const r=[],o=new WeakMap,a=n.FontFace;n.FontFace=function(e,t,n){const r=new a(e,t,n);return o.set(r,{family:e,buffer:"string"!=typeof t,descriptors:n,fontSource:"string"==typeof t?t:JSON.stringify(Array.from(new Uint8Array(t)))}),r};const i=patch$1(t.fonts,"add",(function(t){return function(n){return setTimeout$1$1(callbackWrapper$1((()=>{const t=o.get(n);t&&(e(t),o.delete(n))})),0),t.apply(this,[n])}}));return r.push((()=>{n.FontFace=a})),r.push(i),callbackWrapper$1((()=>{r.forEach((e=>e()))}))}function initSelectionObserver(e){const{doc:t,mirror:n,blockClass:r,blockSelector:o,unblockSelector:a,selectionCb:i}=e;let s=!0;const c=callbackWrapper$1((()=>{const e=t.getSelection();if(!e||s&&_optionalChain$2([e,"optionalAccess",e=>e.isCollapsed]))return;s=e.isCollapsed||!1;const c=[],l=e.rangeCount||0;for(let t=0;t<l;t++){const i=e.getRangeAt(t),{startContainer:s,startOffset:l,endContainer:u,endOffset:d}=i;isBlocked$1(s,r,o,a,!0)||isBlocked$1(u,r,o,a,!0)||c.push({start:n.getId(s),startOffset:l,end:n.getId(u),endOffset:d})}i({ranges:c})}));return c(),on("selectionchange",c)}function initCustomElementObserver({doc:e,customElementCb:t}){const n=e.defaultView;if(!n||!n.customElements)return()=>{};return patch$1(n.customElements,"define",(function(e){return function(n,r,o){try{t({define:{name:n}})}catch(e){}return e.apply(this,[n,r,o])}}))}function initObservers(e,t={}){const n=e.doc.defaultView;if(!n)return()=>{};const r=initMutationObserver(e,e.doc),o=initMoveObserver(e),a=initMouseInteractionObserver(e),i=initScrollObserver(e),s=initViewportResizeObserver(e,{win:n}),c=initInputObserver(e),l=initMediaInteractionObserver(e),u=initStyleSheetObserver(e,{win:n}),d=initAdoptedStyleSheetObserver(e,e.doc),p=initStyleDeclarationObserver(e,{win:n}),g=e.collectFonts?initFontObserver(e):()=>{},h=initSelectionObserver(e),f=initCustomElementObserver(e),m=[];for(const t of e.plugins)m.push(t.observer(t.callback,n,t.options));return callbackWrapper$1((()=>{mutationBuffers.forEach((e=>e.reset())),r.disconnect(),o(),a(),i(),s(),c(),l(),u(),d(),p(),g(),h(),f(),m.forEach((e=>e()))}))}function hasNestedCSSRule(e){return void 0!==window[e]}function canMonkeyPatchNestedCSSRule(e){return Boolean(void 0!==window[e]&&window[e].prototype&&"insertRule"in window[e].prototype&&"deleteRule"in window[e].prototype)}class CrossOriginIframeMirror{constructor(e){this.generateIdFn=e,this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap}getId(e,t,n,r){const o=n||this.getIdToRemoteIdMap(e),a=r||this.getRemoteIdToIdMap(e);let i=o.get(t);return i||(i=this.generateIdFn(),o.set(t,i),a.set(i,t)),i}getIds(e,t){const n=this.getIdToRemoteIdMap(e),r=this.getRemoteIdToIdMap(e);return t.map((t=>this.getId(e,t,n,r)))}getRemoteId(e,t,n){const r=n||this.getRemoteIdToIdMap(e);if("number"!=typeof t)return t;const o=r.get(t);return o||-1}getRemoteIds(e,t){const n=this.getRemoteIdToIdMap(e);return t.map((t=>this.getRemoteId(e,t,n)))}reset(e){if(!e)return this.iframeIdToRemoteIdMap=new WeakMap,void(this.iframeRemoteIdToIdMap=new WeakMap);this.iframeIdToRemoteIdMap.delete(e),this.iframeRemoteIdToIdMap.delete(e)}getIdToRemoteIdMap(e){let t=this.iframeIdToRemoteIdMap.get(e);return t||(t=new Map,this.iframeIdToRemoteIdMap.set(e,t)),t}getRemoteIdToIdMap(e){let t=this.iframeRemoteIdToIdMap.get(e);return t||(t=new Map,this.iframeRemoteIdToIdMap.set(e,t)),t}}function _optionalChain$1(e){let t,n=e[0],r=1;for(;r<e.length;){const o=e[r],a=e[r+1];if(r+=2,("optionalAccess"===o||"optionalCall"===o)&&null==n)return;"access"===o||"optionalAccess"===o?(t=n,n=a(n)):"call"!==o&&"optionalCall"!==o||(n=a(((...e)=>n.call(t,...e))),t=void 0)}return n}class IframeManagerNoop{constructor(){this.crossOriginIframeMirror=new CrossOriginIframeMirror(genId),this.crossOriginIframeRootIdMap=new WeakMap}addIframe(){}addLoadListener(){}attachIframe(){}}class IframeManager{constructor(e){this.iframes=new WeakMap,this.crossOriginIframeMap=new WeakMap,this.crossOriginIframeMirror=new CrossOriginIframeMirror(genId),this.crossOriginIframeRootIdMap=new WeakMap,this.mutationCb=e.mutationCb,this.wrappedEmit=e.wrappedEmit,this.stylesheetManager=e.stylesheetManager,this.recordCrossOriginIframes=e.recordCrossOriginIframes,this.crossOriginIframeStyleMirror=new CrossOriginIframeMirror(this.stylesheetManager.styleMirror.generateId.bind(this.stylesheetManager.styleMirror)),this.mirror=e.mirror,this.recordCrossOriginIframes&&window.addEventListener("message",this.handleMessage.bind(this))}addIframe(e){this.iframes.set(e,!0),e.contentWindow&&this.crossOriginIframeMap.set(e.contentWindow,e)}addLoadListener(e){this.loadListener=e}attachIframe(e,t){this.mutationCb({adds:[{parentId:this.mirror.getId(e),nextId:null,node:t}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),_optionalChain$1([this,"access",e=>e.loadListener,"optionalCall",t=>t(e)]),e.contentDocument&&e.contentDocument.adoptedStyleSheets&&e.contentDocument.adoptedStyleSheets.length>0&&this.stylesheetManager.adoptStyleSheets(e.contentDocument.adoptedStyleSheets,this.mirror.getId(e.contentDocument))}handleMessage(e){const t=e;if("rrweb"!==t.data.type||t.origin!==t.data.origin)return;if(!e.source)return;const n=this.crossOriginIframeMap.get(e.source);if(!n)return;const r=this.transformCrossOriginEvent(n,t.data.event);r&&this.wrappedEmit(r,t.data.isCheckout)}transformCrossOriginEvent(e,t){switch(t.type){case EventType.FullSnapshot:{this.crossOriginIframeMirror.reset(e),this.crossOriginIframeStyleMirror.reset(e),this.replaceIdOnNode(t.data.node,e);const n=t.data.node.id;return this.crossOriginIframeRootIdMap.set(e,n),this.patchRootIdOnNode(t.data.node,n),{timestamp:t.timestamp,type:EventType.IncrementalSnapshot,data:{source:IncrementalSource.Mutation,adds:[{parentId:this.mirror.getId(e),nextId:null,node:t.data.node}],removes:[],texts:[],attributes:[],isAttachIframe:!0}}}case EventType.Meta:case EventType.Load:case EventType.DomContentLoaded:return!1;case EventType.Plugin:return t;case EventType.Custom:return this.replaceIds(t.data.payload,e,["id","parentId","previousId","nextId"]),t;case EventType.IncrementalSnapshot:switch(t.data.source){case IncrementalSource.Mutation:return t.data.adds.forEach((t=>{this.replaceIds(t,e,["parentId","nextId","previousId"]),this.replaceIdOnNode(t.node,e);const n=this.crossOriginIframeRootIdMap.get(e);n&&this.patchRootIdOnNode(t.node,n)})),t.data.removes.forEach((t=>{this.replaceIds(t,e,["parentId","id"])})),t.data.attributes.forEach((t=>{this.replaceIds(t,e,["id"])})),t.data.texts.forEach((t=>{this.replaceIds(t,e,["id"])})),t;case IncrementalSource.Drag:case IncrementalSource.TouchMove:case IncrementalSource.MouseMove:return t.data.positions.forEach((t=>{this.replaceIds(t,e,["id"])})),t;case IncrementalSource.ViewportResize:return!1;case IncrementalSource.MediaInteraction:case IncrementalSource.MouseInteraction:case IncrementalSource.Scroll:case IncrementalSource.CanvasMutation:case IncrementalSource.Input:return this.replaceIds(t.data,e,["id"]),t;case IncrementalSource.StyleSheetRule:case IncrementalSource.StyleDeclaration:return this.replaceIds(t.data,e,["id"]),this.replaceStyleIds(t.data,e,["styleId"]),t;case IncrementalSource.Font:return t;case IncrementalSource.Selection:return t.data.ranges.forEach((t=>{this.replaceIds(t,e,["start","end"])})),t;case IncrementalSource.AdoptedStyleSheet:return this.replaceIds(t.data,e,["id"]),this.replaceStyleIds(t.data,e,["styleIds"]),_optionalChain$1([t,"access",e=>e.data,"access",e=>e.styles,"optionalAccess",e=>e.forEach,"call",t=>t((t=>{this.replaceStyleIds(t,e,["styleId"])}))]),t}}return!1}replace(e,t,n,r){for(const o of r)(Array.isArray(t[o])||"number"==typeof t[o])&&(Array.isArray(t[o])?t[o]=e.getIds(n,t[o]):t[o]=e.getId(n,t[o]));return t}replaceIds(e,t,n){return this.replace(this.crossOriginIframeMirror,e,t,n)}replaceStyleIds(e,t,n){return this.replace(this.crossOriginIframeStyleMirror,e,t,n)}replaceIdOnNode(e,t){this.replaceIds(e,t,["id","rootId"]),"childNodes"in e&&e.childNodes.forEach((e=>{this.replaceIdOnNode(e,t)}))}patchRootIdOnNode(e,t){e.type===NodeType$1.Document||e.rootId||(e.rootId=t),"childNodes"in e&&e.childNodes.forEach((e=>{this.patchRootIdOnNode(e,t)}))}}class ShadowDomManagerNoop{init(){}addShadowRoot(){}observeAttachShadow(){}reset(){}}class ShadowDomManager{constructor(e){this.shadowDoms=new WeakSet,this.restoreHandlers=[],this.mutationCb=e.mutationCb,this.scrollCb=e.scrollCb,this.bypassOptions=e.bypassOptions,this.mirror=e.mirror,this.init()}init(){this.reset(),this.patchAttachShadow(Element,document)}addShadowRoot(e,t){if(!isNativeShadowDom(e))return;if(this.shadowDoms.has(e))return;this.shadowDoms.add(e);const n=initMutationObserver({...this.bypassOptions,doc:t,mutationCb:this.mutationCb,mirror:this.mirror,shadowDomManager:this},e);this.restoreHandlers.push((()=>n.disconnect())),this.restoreHandlers.push(initScrollObserver({...this.bypassOptions,scrollCb:this.scrollCb,doc:e,mirror:this.mirror})),setTimeout$1$1((()=>{e.adoptedStyleSheets&&e.adoptedStyleSheets.length>0&&this.bypassOptions.stylesheetManager.adoptStyleSheets(e.adoptedStyleSheets,this.mirror.getId(e.host)),this.restoreHandlers.push(initAdoptedStyleSheetObserver({mirror:this.mirror,stylesheetManager:this.bypassOptions.stylesheetManager},e))}),0)}observeAttachShadow(e){e.contentWindow&&e.contentDocument&&this.patchAttachShadow(e.contentWindow.Element,e.contentDocument)}patchAttachShadow(e,t){const n=this;this.restoreHandlers.push(patch$1(e.prototype,"attachShadow",(function(e){return function(r){const o=e.call(this,r);return this.shadowRoot&&inDom(this)&&n.addShadowRoot(this.shadowRoot,t),o}})))}reset(){this.restoreHandlers.forEach((e=>{try{e()}catch(e){}})),this.restoreHandlers=[],this.shadowDoms=new WeakSet}}class CanvasManagerNoop{reset(){}freeze(){}unfreeze(){}lock(){}unlock(){}snapshot(){}}class StylesheetManager{constructor(e){this.trackedLinkElements=new WeakSet,this.styleMirror=new StyleSheetMirror,this.mutationCb=e.mutationCb,this.adoptedStyleSheetCb=e.adoptedStyleSheetCb}attachLinkElement(e,t){"_cssText"in t.attributes&&this.mutationCb({adds:[],removes:[],texts:[],attributes:[{id:t.id,attributes:t.attributes}]}),this.trackLinkElement(e)}trackLinkElement(e){this.trackedLinkElements.has(e)||(this.trackedLinkElements.add(e),this.trackStylesheetInLinkElement(e))}adoptStyleSheets(e,t){if(0===e.length)return;const n={id:t,styleIds:[]},r=[];for(const t of e){let e;this.styleMirror.has(t)?e=this.styleMirror.getId(t):(e=this.styleMirror.add(t),r.push({styleId:e,rules:Array.from(t.rules||CSSRule,((e,t)=>({rule:stringifyRule(e),index:t})))})),n.styleIds.push(e)}r.length>0&&(n.styles=r),this.adoptedStyleSheetCb(n)}reset(){this.styleMirror.reset(),this.trackedLinkElements=new WeakSet}trackStylesheetInLinkElement(e){}}class ProcessedNodeManager{constructor(){this.nodeMap=new WeakMap,this.loop=!0,this.periodicallyClear()}periodicallyClear(){onRequestAnimationFrame$1((()=>{this.clear(),this.loop&&this.periodicallyClear()}))}inOtherBuffer(e,t){const n=this.nodeMap.get(e);return n&&Array.from(n).some((e=>e!==t))}add(e,t){this.nodeMap.set(e,(this.nodeMap.get(e)||new Set).add(t))}clear(){this.nodeMap=new WeakMap}destroy(){this.loop=!1}}let wrappedEmit,_takeFullSnapshot;const mirror=createMirror();function record(e={}){const{emit:t,checkoutEveryNms:n,checkoutEveryNth:r,blockClass:o="rr-block",blockSelector:a=null,unblockSelector:i=null,ignoreClass:s="rr-ignore",ignoreSelector:c=null,maskAllText:l=!1,maskTextClass:u="rr-mask",unmaskTextClass:d=null,maskTextSelector:p=null,unmaskTextSelector:g=null,inlineStylesheet:h=!0,maskAllInputs:f,maskInputOptions:m,slimDOMOptions:_,maskAttributeFn:E,maskInputFn:T,maskTextFn:S,maxCanvasSize:y=null,packFn:v,sampling:I={},dataURLOptions:A={},mousemoveWait:b,recordCanvas:R=!1,recordCrossOriginIframes:O=!1,recordAfter:L=("DOMContentLoaded"===e.recordAfter?e.recordAfter:"load"),userTriggeredOnInput:N=!1,collectFonts:C=!1,inlineImages:w=!1,plugins:D,keepIframeSrcFn:P=(()=>!1),ignoreCSSAttributes:x=new Set([]),errorHandler:k,onMutation:M,getCanvasManager:U}=e;registerErrorHandler$1(k);const F=!O||window.parent===window;let $=!1;if(!F)try{window.parent.document&&($=!1)}catch(e){$=!0}if(F&&!t)throw new Error("emit function is required");void 0!==b&&void 0===I.mousemove&&(I.mousemove=b),mirror.reset();const B=!0===f?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,radio:!0,checkbox:!0}:void 0!==m?m:{},G=!0===_||"all"===_?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:"all"===_,headMetaDescKeywords:"all"===_}:_||{};let W;polyfill();let H=0;const V=e=>{for(const t of D||[])t.eventProcessor&&(e=t.eventProcessor(e));return v&&!$&&(e=v(e)),e};wrappedEmit=(e,o)=>{const a=e;if(a.timestamp=nowTimestamp(),!_optionalChain([mutationBuffers,"access",e=>e[0],"optionalAccess",e=>e.isFrozen,"call",e=>e()])||a.type===EventType.FullSnapshot||a.type===EventType.IncrementalSnapshot&&a.data.source===IncrementalSource.Mutation||mutationBuffers.forEach((e=>e.unfreeze())),F)_optionalChain([t,"optionalCall",e=>e(V(a),o)]);else if($){const e={type:"rrweb",event:V(a),origin:window.location.origin,isCheckout:o};window.parent.postMessage(e,"*")}if(a.type===EventType.FullSnapshot)W=a,H=0;else if(a.type===EventType.IncrementalSnapshot){if(a.data.source===IncrementalSource.Mutation&&a.data.isAttachIframe)return;H++;const e=r&&H>=r,t=n&&W&&a.timestamp-W.timestamp>n;(e||t)&&Q(!0)}};const q=e=>{wrappedEmit({type:EventType.IncrementalSnapshot,data:{source:IncrementalSource.Mutation,...e}})},j=e=>wrappedEmit({type:EventType.IncrementalSnapshot,data:{source:IncrementalSource.Scroll,...e}}),z=e=>wrappedEmit({type:EventType.IncrementalSnapshot,data:{source:IncrementalSource.CanvasMutation,...e}}),J=new StylesheetManager({mutationCb:q,adoptedStyleSheetCb:e=>wrappedEmit({type:EventType.IncrementalSnapshot,data:{source:IncrementalSource.AdoptedStyleSheet,...e}})}),Y="boolean"==typeof __RRWEB_EXCLUDE_IFRAME__&&__RRWEB_EXCLUDE_IFRAME__?new IframeManagerNoop:new IframeManager({mirror:mirror,mutationCb:q,stylesheetManager:J,recordCrossOriginIframes:O,wrappedEmit:wrappedEmit});for(const e of D||[])e.getMirror&&e.getMirror({nodeMirror:mirror,crossOriginIframeMirror:Y.crossOriginIframeMirror,crossOriginIframeStyleMirror:Y.crossOriginIframeStyleMirror});const X=new ProcessedNodeManager,K=_getCanvasManager(U,{mirror:mirror,win:window,mutationCb:e=>wrappedEmit({type:EventType.IncrementalSnapshot,data:{source:IncrementalSource.CanvasMutation,...e}}),recordCanvas:R,blockClass:o,blockSelector:a,unblockSelector:i,maxCanvasSize:y,sampling:I.canvas,dataURLOptions:A,errorHandler:k}),Z="boolean"==typeof __RRWEB_EXCLUDE_SHADOW_DOM__&&__RRWEB_EXCLUDE_SHADOW_DOM__?new ShadowDomManagerNoop:new ShadowDomManager({mutationCb:q,scrollCb:j,bypassOptions:{onMutation:M,blockClass:o,blockSelector:a,unblockSelector:i,maskAllText:l,maskTextClass:u,unmaskTextClass:d,maskTextSelector:p,unmaskTextSelector:g,inlineStylesheet:h,maskInputOptions:B,dataURLOptions:A,maskAttributeFn:E,maskTextFn:S,maskInputFn:T,recordCanvas:R,inlineImages:w,sampling:I,slimDOMOptions:G,iframeManager:Y,stylesheetManager:J,canvasManager:K,keepIframeSrcFn:P,processedNodeManager:X},mirror:mirror}),Q=(e=!1)=>{wrappedEmit({type:EventType.Meta,data:{href:window.location.href,width:getWindowWidth(),height:getWindowHeight()}},e),J.reset(),Z.init(),mutationBuffers.forEach((e=>e.lock()));const t=snapshot(document,{mirror:mirror,blockClass:o,blockSelector:a,unblockSelector:i,maskAllText:l,maskTextClass:u,unmaskTextClass:d,maskTextSelector:p,unmaskTextSelector:g,inlineStylesheet:h,maskAllInputs:B,maskAttributeFn:E,maskInputFn:T,maskTextFn:S,slimDOM:G,dataURLOptions:A,recordCanvas:R,inlineImages:w,onSerialize:e=>{isSerializedIframe(e,mirror)&&Y.addIframe(e),isSerializedStylesheet(e,mirror)&&J.trackLinkElement(e),hasShadowRoot(e)&&Z.addShadowRoot(e.shadowRoot,document)},onIframeLoad:(e,t)=>{Y.attachIframe(e,t),Z.observeAttachShadow(e)},onStylesheetLoad:(e,t)=>{J.attachLinkElement(e,t)},keepIframeSrcFn:P});if(!t)return console.warn("Failed to snapshot the document");wrappedEmit({type:EventType.FullSnapshot,data:{node:t,initialOffset:getWindowScroll(window)}}),mutationBuffers.forEach((e=>e.unlock())),document.adoptedStyleSheets&&document.adoptedStyleSheets.length>0&&J.adoptStyleSheets(document.adoptedStyleSheets,mirror.getId(document))};_takeFullSnapshot=Q;try{const e=[],t=e=>callbackWrapper$1(initObservers)({onMutation:M,mutationCb:q,mousemoveCb:(e,t)=>wrappedEmit({type:EventType.IncrementalSnapshot,data:{source:t,positions:e}}),mouseInteractionCb:e=>wrappedEmit({type:EventType.IncrementalSnapshot,data:{source:IncrementalSource.MouseInteraction,...e}}),scrollCb:j,viewportResizeCb:e=>wrappedEmit({type:EventType.IncrementalSnapshot,data:{source:IncrementalSource.ViewportResize,...e}}),inputCb:e=>wrappedEmit({type:EventType.IncrementalSnapshot,data:{source:IncrementalSource.Input,...e}}),mediaInteractionCb:e=>wrappedEmit({type:EventType.IncrementalSnapshot,data:{source:IncrementalSource.MediaInteraction,...e}}),styleSheetRuleCb:e=>wrappedEmit({type:EventType.IncrementalSnapshot,data:{source:IncrementalSource.StyleSheetRule,...e}}),styleDeclarationCb:e=>wrappedEmit({type:EventType.IncrementalSnapshot,data:{source:IncrementalSource.StyleDeclaration,...e}}),canvasMutationCb:z,fontCb:e=>wrappedEmit({type:EventType.IncrementalSnapshot,data:{source:IncrementalSource.Font,...e}}),selectionCb:e=>{wrappedEmit({type:EventType.IncrementalSnapshot,data:{source:IncrementalSource.Selection,...e}})},customElementCb:e=>{wrappedEmit({type:EventType.IncrementalSnapshot,data:{source:IncrementalSource.CustomElement,...e}})},blockClass:o,ignoreClass:s,ignoreSelector:c,maskAllText:l,maskTextClass:u,unmaskTextClass:d,maskTextSelector:p,unmaskTextSelector:g,maskInputOptions:B,inlineStylesheet:h,sampling:I,recordCanvas:R,inlineImages:w,userTriggeredOnInput:N,collectFonts:C,doc:e,maskAttributeFn:E,maskInputFn:T,maskTextFn:S,keepIframeSrcFn:P,blockSelector:a,unblockSelector:i,slimDOMOptions:G,dataURLOptions:A,mirror:mirror,iframeManager:Y,stylesheetManager:J,shadowDomManager:Z,processedNodeManager:X,canvasManager:K,ignoreCSSAttributes:x,plugins:_optionalChain([D,"optionalAccess",e=>e.filter,"call",e=>e((e=>e.observer)),"optionalAccess",e=>e.map,"call",e=>e((e=>({observer:e.observer,options:e.options,callback:t=>wrappedEmit({type:EventType.Plugin,data:{plugin:e.name,payload:t}})})))])||[]},{});Y.addLoadListener((n=>{try{e.push(t(n.contentDocument))}catch(e){console.warn(e)}}));const n=()=>{Q(),e.push(t(document))};return"interactive"===document.readyState||"complete"===document.readyState?n():(e.push(on("DOMContentLoaded",(()=>{wrappedEmit({type:EventType.DomContentLoaded,data:{}}),"DOMContentLoaded"===L&&n()}))),e.push(on("load",(()=>{wrappedEmit({type:EventType.Load,data:{}}),"load"===L&&n()}),window))),()=>{e.forEach((e=>e())),X.destroy(),_takeFullSnapshot=void 0,unregisterErrorHandler()}}catch(e){console.warn(e)}}function takeFullSnapshot(e){if(!_takeFullSnapshot)throw new Error("please take full snapshot after start recording");_takeFullSnapshot(e)}function _getCanvasManager(e,t){try{return e?e(t):new CanvasManagerNoop}catch(e){return console.warn("Unable to initialize CanvasManager"),new CanvasManagerNoop}}record.mirror=mirror,record.takeFullSnapshot=takeFullSnapshot;const ReplayEventTypeIncrementalSnapshot=3,ReplayEventTypeCustom=5;function timestampToMs(e){return e>9999999999?e:1e3*e}function timestampToS(e){return e>9999999999?e/1e3:e}function addBreadcrumbEvent(e,t){"sentry.transaction"!==t.category&&(["ui.click","ui.input"].includes(t.category)?e.triggerUserActivity():e.checkAndHandleExpiredSession(),e.addUpdate((()=>(e.throttledAddEvent({type:EventType.Custom,timestamp:1e3*(t.timestamp||0),data:{tag:"breadcrumb",payload:normalize(t,10,1e3)}}),"console"===t.category))))}const INTERACTIVE_SELECTOR="button,a";function getClosestInteractive(e){return e.closest(INTERACTIVE_SELECTOR)||e}function getClickTargetNode(e){const t=getTargetNode(e);return t&&t instanceof Element?getClosestInteractive(t):t}function getTargetNode(e){return isEventWithTarget(e)?e.target:e}function isEventWithTarget(e){return"object"==typeof e&&!!e&&"target"in e}let handlers;function onWindowOpen(e){return handlers||(handlers=[],monkeyPatchWindowOpen()),handlers.push(e),()=>{const t=handlers?handlers.indexOf(e):-1;t>-1&&handlers.splice(t,1)}}function monkeyPatchWindowOpen(){fill(WINDOW$4,"open",(function(e){return function(...t){if(handlers)try{handlers.forEach((e=>e()))}catch(e){}return e.apply(WINDOW$4,t)}}))}function handleClick(e,t,n){e.handleClick(t,n)}class ClickDetector{constructor(e,t,n=addBreadcrumbEvent){this._lastMutation=0,this._lastScroll=0,this._clicks=[],this._timeout=t.timeout/1e3,this._threshold=t.threshold/1e3,this._scollTimeout=t.scrollTimeout/1e3,this._replay=e,this._ignoreSelector=t.ignoreSelector,this._addBreadcrumbEvent=n}addListeners(){const e=onWindowOpen((()=>{this._lastMutation=nowInSeconds()}));this._teardown=()=>{e(),this._clicks=[],this._lastMutation=0,this._lastScroll=0}}removeListeners(){this._teardown&&this._teardown(),this._checkClickTimeout&&clearTimeout(this._checkClickTimeout)}handleClick(e,t){if(ignoreElement(t,this._ignoreSelector)||!isClickBreadcrumb(e))return;const n={timestamp:timestampToS(e.timestamp),clickBreadcrumb:e,clickCount:0,node:t};this._clicks.some((e=>e.node===n.node&&Math.abs(e.timestamp-n.timestamp)<1))||(this._clicks.push(n),1===this._clicks.length&&this._scheduleCheckClicks())}registerMutation(e=Date.now()){this._lastMutation=timestampToS(e)}registerScroll(e=Date.now()){this._lastScroll=timestampToS(e)}registerClick(e){const t=getClosestInteractive(e);this._handleMultiClick(t)}_handleMultiClick(e){this._getClicks(e).forEach((e=>{e.clickCount++}))}_getClicks(e){return this._clicks.filter((t=>t.node===e))}_checkClicks(){const e=[],t=nowInSeconds();this._clicks.forEach((n=>{!n.mutationAfter&&this._lastMutation&&(n.mutationAfter=n.timestamp<=this._lastMutation?this._lastMutation-n.timestamp:void 0),!n.scrollAfter&&this._lastScroll&&(n.scrollAfter=n.timestamp<=this._lastScroll?this._lastScroll-n.timestamp:void 0),n.timestamp+this._timeout<=t&&e.push(n)}));for(const t of e){const e=this._clicks.indexOf(t);e>-1&&(this._generateBreadcrumbs(t),this._clicks.splice(e,1))}this._clicks.length&&this._scheduleCheckClicks()}_generateBreadcrumbs(e){const t=this._replay,n=e.scrollAfter&&e.scrollAfter<=this._scollTimeout,r=e.mutationAfter&&e.mutationAfter<=this._threshold,o=!n&&!r,{clickCount:a,clickBreadcrumb:i}=e;if(o){const n=1e3*Math.min(e.mutationAfter||this._timeout,this._timeout),r=n<1e3*this._timeout?"mutation":"timeout",o={type:"default",message:i.message,timestamp:i.timestamp,category:"ui.slowClickDetected",data:{...i.data,url:WINDOW$4.location.href,route:t.getCurrentRoute(),timeAfterClickMs:n,endReason:r,clickCount:a||1}};this._addBreadcrumbEvent(t,o)}else if(a>1){const e={type:"default",message:i.message,timestamp:i.timestamp,category:"ui.multiClick",data:{...i.data,url:WINDOW$4.location.href,route:t.getCurrentRoute(),clickCount:a,metric:!0}};this._addBreadcrumbEvent(t,e)}}_scheduleCheckClicks(){this._checkClickTimeout&&clearTimeout(this._checkClickTimeout),this._checkClickTimeout=setTimeout((()=>this._checkClicks()),1e3)}}const SLOW_CLICK_TAGS=["A","BUTTON","INPUT"];function ignoreElement(e,t){return!SLOW_CLICK_TAGS.includes(e.tagName)||("INPUT"===e.tagName&&!["submit","button"].includes(e.getAttribute("type")||"")||(!("A"!==e.tagName||!(e.hasAttribute("download")||e.hasAttribute("target")&&"_self"!==e.getAttribute("target")))||!(!t||!e.matches(t))))}function isClickBreadcrumb(e){return!(!e.data||"number"!=typeof e.data.nodeId||!e.timestamp)}function nowInSeconds(){return Date.now()/1e3}function updateClickDetectorForRecordingEvent(e,t){try{if(!isIncrementalEvent(t))return;const{source:n}=t.data;if(n===IncrementalSource.Mutation&&e.registerMutation(t.timestamp),n===IncrementalSource.Scroll&&e.registerScroll(t.timestamp),isIncrementalMouseInteraction(t)){const{type:n,id:r}=t.data,o=record.mirror.getNode(r);o instanceof HTMLElement&&n===MouseInteractions.Click&&e.registerClick(o)}}catch(e){}}function isIncrementalEvent(e){return e.type===ReplayEventTypeIncrementalSnapshot}function isIncrementalMouseInteraction(e){return e.data.source===IncrementalSource.MouseInteraction}function createBreadcrumb(e){return{timestamp:Date.now()/1e3,type:"default",...e}}var NodeType$2;!function(e){e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment"}(NodeType$2||(NodeType$2={}));const ATTRIBUTES_TO_RECORD=new Set(["id","class","aria-label","role","name","alt","title","data-test-id","data-testid","disabled","aria-disabled","data-sentry-component"]);function getAttributesToRecord(e){const t={};for(const n in e)if(ATTRIBUTES_TO_RECORD.has(n)){let r=n;"data-testid"!==n&&"data-test-id"!==n||(r="testId"),t[r]=e[n]}return t}const handleDomListener=e=>t=>{if(!e.isEnabled())return;const n=handleDom(t);if(!n)return;const r="click"===t.name,o=r?t.event:void 0;!(r&&e.clickDetector&&o&&o.target)||o.altKey||o.metaKey||o.ctrlKey||o.shiftKey||handleClick(e.clickDetector,n,getClickTargetNode(t.event)),addBreadcrumbEvent(e,n)};function getBaseDomBreadcrumb(e,t){const n=record.mirror.getId(e),r=n&&record.mirror.getNode(n),o=r&&record.mirror.getMeta(r),a=o&&isElement(o)?o:null;return{message:t,data:a?{nodeId:n,node:{id:n,tagName:a.tagName,textContent:Array.from(a.childNodes).map((e=>e.type===NodeType$2.Text&&e.textContent)).filter(Boolean).map((e=>e.trim())).join(""),attributes:getAttributesToRecord(a.attributes)}}:{}}}function handleDom(e){const{target:t,message:n}=getDomTarget(e);return createBreadcrumb({category:`ui.${e.name}`,...getBaseDomBreadcrumb(t,n)})}function getDomTarget(e){const t="click"===e.name;let n,r=null;try{r=t?getClickTargetNode(e.event):getTargetNode(e.event),n=htmlTreeAsString(r,{maxStringLength:200})||"<unknown>"}catch(e){n="<unknown>"}return{target:r,message:n}}function isElement(e){return e.type===NodeType$2.Element}function handleKeyboardEvent(e,t){if(!e.isEnabled())return;e.updateUserActivity();const n=getKeyboardBreadcrumb(t);n&&addBreadcrumbEvent(e,n)}function getKeyboardBreadcrumb(e){const{metaKey:t,shiftKey:n,ctrlKey:r,altKey:o,key:a,target:i}=e;if(!i||isInputElement(i)||!a)return null;const s=t||r||o,c=1===a.length;if(!s&&c)return null;const l=htmlTreeAsString(i,{maxStringLength:200})||"<unknown>";return createBreadcrumb({category:"ui.keyDown",message:l,data:{...getBaseDomBreadcrumb(i,l).data,metaKey:t,shiftKey:n,ctrlKey:r,altKey:o,key:a}})}function isInputElement(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName||e.isContentEditable}const ENTRY_TYPES={resource:createResourceEntry,paint:createPaintEntry,navigation:createNavigationEntry};function createPerformanceEntries(e){return e.map(createPerformanceEntry).filter(Boolean)}function createPerformanceEntry(e){return ENTRY_TYPES[e.entryType]?ENTRY_TYPES[e.entryType](e):null}function getAbsoluteTime(e){return((browserPerformanceTimeOrigin||WINDOW$4.performance.timeOrigin)+e)/1e3}function createPaintEntry(e){const{duration:t,entryType:n,name:r,startTime:o}=e,a=getAbsoluteTime(o);return{type:n,name:r,start:a,end:a+t,data:void 0}}function createNavigationEntry(e){const{entryType:t,name:n,decodedBodySize:r,duration:o,domComplete:a,encodedBodySize:i,domContentLoadedEventStart:s,domContentLoadedEventEnd:c,domInteractive:l,loadEventStart:u,loadEventEnd:d,redirectCount:p,startTime:g,transferSize:h,type:f}=e;return 0===o?null:{type:`${t}.${f}`,start:getAbsoluteTime(g),end:getAbsoluteTime(a),name:n,data:{size:h,decodedBodySize:r,encodedBodySize:i,duration:o,domInteractive:l,domContentLoadedEventStart:s,domContentLoadedEventEnd:c,loadEventStart:u,loadEventEnd:d,domComplete:a,redirectCount:p}}}function createResourceEntry(e){const{entryType:t,initiatorType:n,name:r,responseEnd:o,startTime:a,decodedBodySize:i,encodedBodySize:s,responseStatus:c,transferSize:l}=e;return["fetch","xmlhttprequest"].includes(n)?null:{type:`${t}.${n}`,start:getAbsoluteTime(a),end:getAbsoluteTime(o),name:r,data:{size:l,statusCode:c,decodedBodySize:i,encodedBodySize:s}}}function getLargestContentfulPaint(e){const t=e.entries,n=t[t.length-1],r=n?n.element:void 0,o=e.value,a=getAbsoluteTime(o);return{type:"largest-contentful-paint",name:"largest-contentful-paint",start:a,end:a,data:{value:o,size:o,nodeId:r?record.mirror.getId(r):void 0}}}function setupPerformanceObserver(e){function t(t){e.performanceEntries.includes(t)||e.performanceEntries.push(t)}function n({entries:e}){e.forEach(t)}const r=[];return["navigation","paint","resource"].forEach((e=>{r.push(addPerformanceInstrumentationHandler(e,n))})),r.push(addLcpInstrumentationHandler((({metric:t})=>{e.replayPerformanceEntries.push(getLargestContentfulPaint(t))}))),()=>{r.forEach((e=>e()))}}const DEBUG_BUILD$2="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__,r$1='var t=Uint8Array,n=Uint16Array,r=Int32Array,e=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),i=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),s=function(t,e){for(var i=new n(31),a=0;a<31;++a)i[a]=e+=1<<t[a-1];var s=new r(i[30]);for(a=1;a<30;++a)for(var o=i[a];o<i[a+1];++o)s[o]=o-i[a]<<5|a;return{b:i,r:s}},o=s(e,2),f=o.b,h=o.r;f[28]=258,h[258]=28;for(var l=s(i,0).r,u=new n(32768),c=0;c<32768;++c){var v=(43690&c)>>1|(21845&c)<<1;v=(61680&(v=(52428&v)>>2|(13107&v)<<2))>>4|(3855&v)<<4,u[c]=((65280&v)>>8|(255&v)<<8)>>1}var d=function(t,r,e){for(var i=t.length,a=0,s=new n(r);a<i;++a)t[a]&&++s[t[a]-1];var o,f=new n(r);for(a=1;a<r;++a)f[a]=f[a-1]+s[a-1]<<1;if(e){o=new n(1<<r);var h=15-r;for(a=0;a<i;++a)if(t[a])for(var l=a<<4|t[a],c=r-t[a],v=f[t[a]-1]++<<c,d=v|(1<<c)-1;v<=d;++v)o[u[v]>>h]=l}else for(o=new n(i),a=0;a<i;++a)t[a]&&(o[a]=u[f[t[a]-1]++]>>15-t[a]);return o},g=new t(288);for(c=0;c<144;++c)g[c]=8;for(c=144;c<256;++c)g[c]=9;for(c=256;c<280;++c)g[c]=7;for(c=280;c<288;++c)g[c]=8;var w=new t(32);for(c=0;c<32;++c)w[c]=5;var p=d(g,9,0),y=d(w,5,0),m=function(t){return(t+7)/8|0},b=function(n,r,e){return(null==r||r<0)&&(r=0),(null==e||e>n.length)&&(e=n.length),new t(n.subarray(r,e))},M=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],E=function(t,n,r){var e=new Error(n||M[t]);if(e.code=t,Error.captureStackTrace&&Error.captureStackTrace(e,E),!r)throw e;return e},z=function(t,n,r){r<<=7&n;var e=n/8|0;t[e]|=r,t[e+1]|=r>>8},A=function(t,n,r){r<<=7&n;var e=n/8|0;t[e]|=r,t[e+1]|=r>>8,t[e+2]|=r>>16},_=function(r,e){for(var i=[],a=0;a<r.length;++a)r[a]&&i.push({s:a,f:r[a]});var s=i.length,o=i.slice();if(!s)return{t:F,l:0};if(1==s){var f=new t(i[0].s+1);return f[i[0].s]=1,{t:f,l:1}}i.sort((function(t,n){return t.f-n.f})),i.push({s:-1,f:25001});var h=i[0],l=i[1],u=0,c=1,v=2;for(i[0]={s:-1,f:h.f+l.f,l:h,r:l};c!=s-1;)h=i[i[u].f<i[v].f?u++:v++],l=i[u!=c&&i[u].f<i[v].f?u++:v++],i[c++]={s:-1,f:h.f+l.f,l:h,r:l};var d=o[0].s;for(a=1;a<s;++a)o[a].s>d&&(d=o[a].s);var g=new n(d+1),w=x(i[c-1],g,0);if(w>e){a=0;var p=0,y=w-e,m=1<<y;for(o.sort((function(t,n){return g[n.s]-g[t.s]||t.f-n.f}));a<s;++a){var b=o[a].s;if(!(g[b]>e))break;p+=m-(1<<w-g[b]),g[b]=e}for(p>>=y;p>0;){var M=o[a].s;g[M]<e?p-=1<<e-g[M]++-1:++a}for(;a>=0&&p;--a){var E=o[a].s;g[E]==e&&(--g[E],++p)}w=e}return{t:new t(g),l:w}},x=function(t,n,r){return-1==t.s?Math.max(x(t.l,n,r+1),x(t.r,n,r+1)):n[t.s]=r},D=function(t){for(var r=t.length;r&&!t[--r];);for(var e=new n(++r),i=0,a=t[0],s=1,o=function(t){e[i++]=t},f=1;f<=r;++f)if(t[f]==a&&f!=r)++s;else{if(!a&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(a),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}for(;s--;)o(a);s=1,a=t[f]}return{c:e.subarray(0,i),n:r}},T=function(t,n){for(var r=0,e=0;e<n.length;++e)r+=t[e]*n[e];return r},k=function(t,n,r){var e=r.length,i=m(n+2);t[i]=255&e,t[i+1]=e>>8,t[i+2]=255^t[i],t[i+3]=255^t[i+1];for(var a=0;a<e;++a)t[i+a+4]=r[a];return 8*(i+4+e)},C=function(t,r,s,o,f,h,l,u,c,v,m){z(r,m++,s),++f[256];for(var b=_(f,15),M=b.t,E=b.l,x=_(h,15),C=x.t,U=x.l,F=D(M),I=F.c,S=F.n,L=D(C),O=L.c,j=L.n,q=new n(19),B=0;B<I.length;++B)++q[31&I[B]];for(B=0;B<O.length;++B)++q[31&O[B]];for(var G=_(q,7),H=G.t,J=G.l,K=19;K>4&&!H[a[K-1]];--K);var N,P,Q,R,V=v+5<<3,W=T(f,g)+T(h,w)+l,X=T(f,M)+T(h,C)+l+14+3*K+T(q,H)+2*q[16]+3*q[17]+7*q[18];if(c>=0&&V<=W&&V<=X)return k(r,m,t.subarray(c,c+v));if(z(r,m,1+(X<W)),m+=2,X<W){N=d(M,E,0),P=M,Q=d(C,U,0),R=C;var Y=d(H,J,0);z(r,m,S-257),z(r,m+5,j-1),z(r,m+10,K-4),m+=14;for(B=0;B<K;++B)z(r,m+3*B,H[a[B]]);m+=3*K;for(var Z=[I,O],$=0;$<2;++$){var tt=Z[$];for(B=0;B<tt.length;++B){var nt=31&tt[B];z(r,m,Y[nt]),m+=H[nt],nt>15&&(z(r,m,tt[B]>>5&127),m+=tt[B]>>12)}}}else N=p,P=g,Q=y,R=w;for(B=0;B<u;++B){var rt=o[B];if(rt>255){A(r,m,N[(nt=rt>>18&31)+257]),m+=P[nt+257],nt>7&&(z(r,m,rt>>23&31),m+=e[nt]);var et=31&rt;A(r,m,Q[et]),m+=R[et],et>3&&(A(r,m,rt>>5&8191),m+=i[et])}else A(r,m,N[rt]),m+=P[rt]}return A(r,m,N[256]),m+P[256]},U=new r([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),F=new t(0),I=function(){for(var t=new Int32Array(256),n=0;n<256;++n){for(var r=n,e=9;--e;)r=(1&r&&-306674912)^r>>>1;t[n]=r}return t}(),S=function(){var t=1,n=0;return{p:function(r){for(var e=t,i=n,a=0|r.length,s=0;s!=a;){for(var o=Math.min(s+2655,a);s<o;++s)i+=e+=r[s];e=(65535&e)+15*(e>>16),i=(65535&i)+15*(i>>16)}t=e,n=i},d:function(){return(255&(t%=65521))<<24|(65280&t)<<8|(255&(n%=65521))<<8|n>>8}}},L=function(a,s,o,f,u){if(!u&&(u={l:1},s.dictionary)){var c=s.dictionary.subarray(-32768),v=new t(c.length+a.length);v.set(c),v.set(a,c.length),a=v,u.w=c.length}return function(a,s,o,f,u,c){var v=c.z||a.length,d=new t(f+v+5*(1+Math.ceil(v/7e3))+u),g=d.subarray(f,d.length-u),w=c.l,p=7&(c.r||0);if(s){p&&(g[0]=c.r>>3);for(var y=U[s-1],M=y>>13,E=8191&y,z=(1<<o)-1,A=c.p||new n(32768),_=c.h||new n(z+1),x=Math.ceil(o/3),D=2*x,T=function(t){return(a[t]^a[t+1]<<x^a[t+2]<<D)&z},F=new r(25e3),I=new n(288),S=new n(32),L=0,O=0,j=c.i||0,q=0,B=c.w||0,G=0;j+2<v;++j){var H=T(j),J=32767&j,K=_[H];if(A[J]=K,_[H]=J,B<=j){var N=v-j;if((L>7e3||q>24576)&&(N>423||!w)){p=C(a,g,0,F,I,S,O,q,G,j-G,p),q=L=O=0,G=j;for(var P=0;P<286;++P)I[P]=0;for(P=0;P<30;++P)S[P]=0}var Q=2,R=0,V=E,W=J-K&32767;if(N>2&&H==T(j-W))for(var X=Math.min(M,N)-1,Y=Math.min(32767,j),Z=Math.min(258,N);W<=Y&&--V&&J!=K;){if(a[j+Q]==a[j+Q-W]){for(var $=0;$<Z&&a[j+$]==a[j+$-W];++$);if($>Q){if(Q=$,R=W,$>X)break;var tt=Math.min(W,$-2),nt=0;for(P=0;P<tt;++P){var rt=j-W+P&32767,et=rt-A[rt]&32767;et>nt&&(nt=et,K=rt)}}}W+=(J=K)-(K=A[J])&32767}if(R){F[q++]=268435456|h[Q]<<18|l[R];var it=31&h[Q],at=31&l[R];O+=e[it]+i[at],++I[257+it],++S[at],B=j+Q,++L}else F[q++]=a[j],++I[a[j]]}}for(j=Math.max(j,B);j<v;++j)F[q++]=a[j],++I[a[j]];p=C(a,g,w,F,I,S,O,q,G,j-G,p),w||(c.r=7&p|g[p/8|0]<<3,p-=7,c.h=_,c.p=A,c.i=j,c.w=B)}else{for(j=c.w||0;j<v+w;j+=65535){var st=j+65535;st>=v&&(g[p/8|0]=w,st=v),p=k(g,p+1,a.subarray(j,st))}c.i=v}return b(d,0,f+m(p)+u)}(a,null==s.level?6:s.level,null==s.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(a.length)))):12+s.mem,o,f,u)},O=function(t,n,r){for(;r;++n)t[n]=r,r>>>=8},j=function(){function n(n,r){if("function"==typeof n&&(r=n,n={}),this.ondata=r,this.o=n||{},this.s={l:0,i:32768,w:32768,z:32768},this.b=new t(98304),this.o.dictionary){var e=this.o.dictionary.subarray(-32768);this.b.set(e,32768-e.length),this.s.i=32768-e.length}}return n.prototype.p=function(t,n){this.ondata(L(t,this.o,0,0,this.s),n)},n.prototype.push=function(n,r){this.ondata||E(5),this.s.l&&E(4);var e=n.length+this.s.z;if(e>this.b.length){if(e>2*this.b.length-32768){var i=new t(-32768&e);i.set(this.b.subarray(0,this.s.z)),this.b=i}var a=this.b.length-this.s.z;a&&(this.b.set(n.subarray(0,a),this.s.z),this.s.z=this.b.length,this.p(this.b,!1)),this.b.set(this.b.subarray(-32768)),this.b.set(n.subarray(a),32768),this.s.z=n.length-a+32768,this.s.i=32766,this.s.w=32768}else this.b.set(n,this.s.z),this.s.z+=n.length;this.s.l=1&r,(this.s.z>this.s.w+8191||r)&&(this.p(this.b,r||!1),this.s.w=this.s.i,this.s.i-=2)},n}();function q(t,n){n||(n={});var r=function(){var t=-1;return{p:function(n){for(var r=t,e=0;e<n.length;++e)r=I[255&r^n[e]]^r>>>8;t=r},d:function(){return~t}}}(),e=t.length;r.p(t);var i,a=L(t,n,10+((i=n).filename?i.filename.length+1:0),8),s=a.length;return function(t,n){var r=n.filename;if(t[0]=31,t[1]=139,t[2]=8,t[8]=n.level<2?4:9==n.level?2:0,t[9]=3,0!=n.mtime&&O(t,4,Math.floor(new Date(n.mtime||Date.now())/1e3)),r){t[3]=8;for(var e=0;e<=r.length;++e)t[e+10]=r.charCodeAt(e)}}(a,n),O(a,s-8,r.d()),O(a,s-4,e),a}var B=function(){function t(t,n){this.c=S(),this.v=1,j.call(this,t,n)}return t.prototype.push=function(t,n){this.c.p(t),j.prototype.push.call(this,t,n)},t.prototype.p=function(t,n){var r=L(t,this.o,this.v&&(this.o.dictionary?6:2),n&&4,this.s);this.v&&(function(t,n){var r=n.level,e=0==r?0:r<6?1:9==r?3:2;if(t[0]=120,t[1]=e<<6|(n.dictionary&&32),t[1]|=31-(t[0]<<8|t[1])%31,n.dictionary){var i=S();i.p(n.dictionary),O(t,2,i.d())}}(r,this.o),this.v=0),n&&O(r,r.length-4,this.c.d()),this.ondata(r,n)},t}(),G="undefined"!=typeof TextEncoder&&new TextEncoder,H="undefined"!=typeof TextDecoder&&new TextDecoder;try{H.decode(F,{stream:!0})}catch(t){}var J=function(){function t(t){this.ondata=t}return t.prototype.push=function(t,n){this.ondata||E(5),this.d&&E(4),this.ondata(K(t),this.d=n||!1)},t}();function K(n,r){if(r){for(var e=new t(n.length),i=0;i<n.length;++i)e[i]=n.charCodeAt(i);return e}if(G)return G.encode(n);var a=n.length,s=new t(n.length+(n.length>>1)),o=0,f=function(t){s[o++]=t};for(i=0;i<a;++i){if(o+5>s.length){var h=new t(o+8+(a-i<<1));h.set(s),s=h}var l=n.charCodeAt(i);l<128||r?f(l):l<2048?(f(192|l>>6),f(128|63&l)):l>55295&&l<57344?(f(240|(l=65536+(1047552&l)|1023&n.charCodeAt(++i))>>18),f(128|l>>12&63),f(128|l>>6&63),f(128|63&l)):(f(224|l>>12),f(128|l>>6&63),f(128|63&l))}return b(s,0,o)}const N=new class{constructor(){this._init()}clear(){this._init()}addEvent(t){if(!t)throw new Error("Adding invalid event");const n=this._hasEvents?",":"";this.stream.push(n+t),this._hasEvents=!0}finish(){this.stream.push("]",!0);const t=function(t){let n=0;for(let r=0,e=t.length;r<e;r++)n+=t[r].length;const r=new Uint8Array(n);for(let n=0,e=0,i=t.length;n<i;n++){const i=t[n];r.set(i,e),e+=i.length}return r}(this._deflatedData);return this._init(),t}_init(){this._hasEvents=!1,this._deflatedData=[],this.deflate=new B,this.deflate.ondata=(t,n)=>{this._deflatedData.push(t)},this.stream=new J(((t,n)=>{this.deflate.push(t,n)})),this.stream.push("[")}},P={clear:()=>{N.clear()},addEvent:t=>N.addEvent(t),finish:()=>N.finish(),compress:t=>function(t){return q(K(t))}(t)};addEventListener("message",(function(t){const n=t.data.method,r=t.data.id,e=t.data.arg;if(n in P&&"function"==typeof P[n])try{const t=P[n](e);postMessage({id:r,method:n,success:!0,response:t})}catch(t){postMessage({id:r,method:n,success:!1,response:t.message}),console.error(t)}})),postMessage({id:void 0,method:"init",success:!0,response:void 0});';function e(){const e=new Blob([r$1]);return URL.createObjectURL(e)}function logInfo(e,t){DEBUG_BUILD$2&&(logger.info(e),t&&addLogBreadcrumb(e))}function logInfoNextTick(e,t){DEBUG_BUILD$2&&(logger.info(e),t&&setTimeout((()=>{addLogBreadcrumb(e)}),0))}function addLogBreadcrumb(e){addBreadcrumb({category:"console",data:{logger:"replay"},level:"info",message:e},{level:"info"})}class EventBufferSizeExceededError extends Error{constructor(){super(`Event buffer exceeded maximum size of ${REPLAY_MAX_EVENT_BUFFER_SIZE}.`)}}class EventBufferArray{constructor(){this.events=[],this._totalSize=0,this.hasCheckout=!1}get hasEvents(){return this.events.length>0}get type(){return"sync"}destroy(){this.events=[]}async addEvent(e){const t=JSON.stringify(e).length;if(this._totalSize+=t,this._totalSize>REPLAY_MAX_EVENT_BUFFER_SIZE)throw new EventBufferSizeExceededError;this.events.push(e)}finish(){return new Promise((e=>{const t=this.events;this.clear(),e(JSON.stringify(t))}))}clear(){this.events=[],this._totalSize=0,this.hasCheckout=!1}getEarliestTimestamp(){const e=this.events.map((e=>e.timestamp)).sort()[0];return e?timestampToMs(e):null}}class WorkerHandler{constructor(e){this._worker=e,this._id=0}ensureReady(){return this._ensureReadyPromise||(this._ensureReadyPromise=new Promise(((e,t)=>{this._worker.addEventListener("message",(({data:n})=>{n.success?e():t()}),{once:!0}),this._worker.addEventListener("error",(e=>{t(e)}),{once:!0})}))),this._ensureReadyPromise}destroy(){logInfo("[Replay] Destroying compression worker"),this._worker.terminate()}postMessage(e,t){const n=this._getAndIncrementId();return new Promise(((r,o)=>{const a=({data:t})=>{const i=t;if(i.method===e&&i.id===n){if(this._worker.removeEventListener("message",a),!i.success)return DEBUG_BUILD$2&&logger.error("[Replay]",i.response),void o(new Error("Error in compression worker"));r(i.response)}};this._worker.addEventListener("message",a),this._worker.postMessage({id:n,method:e,arg:t})}))}_getAndIncrementId(){return this._id++}}class EventBufferCompressionWorker{constructor(e){this._worker=new WorkerHandler(e),this._earliestTimestamp=null,this._totalSize=0,this.hasCheckout=!1}get hasEvents(){return!!this._earliestTimestamp}get type(){return"worker"}ensureReady(){return this._worker.ensureReady()}destroy(){this._worker.destroy()}addEvent(e){const t=timestampToMs(e.timestamp);(!this._earliestTimestamp||t<this._earliestTimestamp)&&(this._earliestTimestamp=t);const n=JSON.stringify(e);return this._totalSize+=n.length,this._totalSize>REPLAY_MAX_EVENT_BUFFER_SIZE?Promise.reject(new EventBufferSizeExceededError):this._sendEventToWorker(n)}finish(){return this._finishRequest()}clear(){this._earliestTimestamp=null,this._totalSize=0,this.hasCheckout=!1,this._worker.postMessage("clear").then(null,(e=>{DEBUG_BUILD$2&&logger.warn('[Replay] Sending "clear" message to worker failed',e)}))}getEarliestTimestamp(){return this._earliestTimestamp}_sendEventToWorker(e){return this._worker.postMessage("addEvent",e)}async _finishRequest(){const e=await this._worker.postMessage("finish");return this._earliestTimestamp=null,this._totalSize=0,e}}class EventBufferProxy{constructor(e){this._fallback=new EventBufferArray,this._compression=new EventBufferCompressionWorker(e),this._used=this._fallback,this._ensureWorkerIsLoadedPromise=this._ensureWorkerIsLoaded()}get type(){return this._used.type}get hasEvents(){return this._used.hasEvents}get hasCheckout(){return this._used.hasCheckout}set hasCheckout(e){this._used.hasCheckout=e}destroy(){this._fallback.destroy(),this._compression.destroy()}clear(){return this._used.clear()}getEarliestTimestamp(){return this._used.getEarliestTimestamp()}addEvent(e){return this._used.addEvent(e)}async finish(){return await this.ensureWorkerIsLoaded(),this._used.finish()}ensureWorkerIsLoaded(){return this._ensureWorkerIsLoadedPromise}async _ensureWorkerIsLoaded(){try{await this._compression.ensureReady()}catch(e){return void logInfo("[Replay] Failed to load the compression worker, falling back to simple buffer")}await this._switchToCompressionWorker()}async _switchToCompressionWorker(){const{events:e,hasCheckout:t}=this._fallback,n=[];for(const t of e)n.push(this._compression.addEvent(t));this._compression.hasCheckout=t,this._used=this._compression;try{await Promise.all(n)}catch(e){DEBUG_BUILD$2&&logger.warn("[Replay] Failed to add events when switching buffers.",e)}}}function createEventBuffer({useCompression:e,workerUrl:t}){if(e&&window.Worker){const e=_loadWorker(t);if(e)return e}return logInfo("[Replay] Using simple buffer"),new EventBufferArray}function _loadWorker(e){try{const t=e||_getWorkerUrl();if(!t)return;logInfo("[Replay] Using compression worker"+(e?` from ${e}`:""));const n=new Worker(t);return new EventBufferProxy(n)}catch(e){logInfo("[Replay] Failed to create compression worker")}}function _getWorkerUrl(){return"undefined"!=typeof __SENTRY_EXCLUDE_REPLAY_WORKER__&&__SENTRY_EXCLUDE_REPLAY_WORKER__?"":e()}function hasSessionStorage(){try{return"sessionStorage"in WINDOW$4&&!!WINDOW$4.sessionStorage}catch(e){return!1}}function clearSession(e){deleteSession(),e.session=void 0}function deleteSession(){if(hasSessionStorage())try{WINDOW$4.sessionStorage.removeItem(REPLAY_SESSION_KEY)}catch(e){}}function isSampled(e){return void 0!==e&&Math.random()<e}function makeSession(e){const t=Date.now();return{id:e.id||uuid4(),started:e.started||t,lastActivity:e.lastActivity||t,segmentId:e.segmentId||0,sampled:e.sampled,previousSessionId:e.previousSessionId}}function saveSession(e){if(hasSessionStorage())try{WINDOW$4.sessionStorage.setItem(REPLAY_SESSION_KEY,JSON.stringify(e))}catch(e){}}function getSessionSampleType(e,t){return isSampled(e)?"session":!!t&&"buffer"}function createSession({sessionSampleRate:e,allowBuffering:t,stickySession:n=!1},{previousSessionId:r}={}){const o=makeSession({sampled:getSessionSampleType(e,t),previousSessionId:r});return n&&saveSession(o),o}function fetchSession(e){if(!hasSessionStorage())return null;try{const t=WINDOW$4.sessionStorage.getItem(REPLAY_SESSION_KEY);if(!t)return null;const n=JSON.parse(t);return logInfoNextTick("[Replay] Loading existing session",e),makeSession(n)}catch(e){return null}}function isExpired(e,t,n=+new Date){return null===e||void 0===t||t<0||0!==t&&e+t<=n}function isSessionExpired(e,{maxReplayDuration:t,sessionIdleExpire:n,targetTime:r=Date.now()}){return isExpired(e.started,t,r)||isExpired(e.lastActivity,n,r)}function shouldRefreshSession(e,{sessionIdleExpire:t,maxReplayDuration:n}){return!!isSessionExpired(e,{sessionIdleExpire:t,maxReplayDuration:n})&&("buffer"!==e.sampled||0!==e.segmentId)}function loadOrCreateSession({traceInternals:e,sessionIdleExpire:t,maxReplayDuration:n,previousSessionId:r},o){const a=o.stickySession&&fetchSession(e);return a?shouldRefreshSession(a,{sessionIdleExpire:t,maxReplayDuration:n})?(logInfoNextTick("[Replay] Session in sessionStorage is expired, creating new one..."),createSession(o,{previousSessionId:a.id})):a:(logInfoNextTick("[Replay] Creating new session",e),createSession(o,{previousSessionId:r}))}function isCustomEvent(e){return e.type===EventType.Custom}function addEventSync(e,t,n){return!!shouldAddEvent(e,t)&&(_addEvent(e,t,n),!0)}function addEvent(e,t,n){return shouldAddEvent(e,t)?_addEvent(e,t,n):Promise.resolve(null)}async function _addEvent(e,t,n){if(!e.eventBuffer)return null;try{n&&"buffer"===e.recordingMode&&e.eventBuffer.clear(),n&&(e.eventBuffer.hasCheckout=!0);const r=maybeApplyCallback(t,e.getOptions().beforeAddRecordingEvent);if(!r)return;return await e.eventBuffer.addEvent(r)}catch(t){const n=t&&t instanceof EventBufferSizeExceededError?"addEventSizeExceeded":"addEvent";DEBUG_BUILD$2&&logger.error(t),await e.stop({reason:n});const r=getClient();r&&r.recordDroppedEvent("internal_sdk_error","replay")}}function shouldAddEvent(e,t){if(!e.eventBuffer||e.isPaused()||!e.isEnabled())return!1;const n=timestampToMs(t.timestamp);return!(n+e.timeouts.sessionIdlePause<Date.now())&&(!(n>e.getContext().initialTimestamp+e.getOptions().maxReplayDuration)||(logInfo(`[Replay] Skipping event with timestamp ${n} because it is after maxReplayDuration`,e.getOptions()._experiments.traceInternals),!1))}function maybeApplyCallback(e,t){try{if("function"==typeof t&&isCustomEvent(e))return t(e)}catch(e){return DEBUG_BUILD$2&&logger.error("[Replay] An error occured in the `beforeAddRecordingEvent` callback, skipping the event...",e),null}return e}function isErrorEvent(e){return!e.type}function isTransactionEvent(e){return"transaction"===e.type}function isReplayEvent(e){return"replay_event"===e.type}function isFeedbackEvent(e){return"feedback"===e.type}function handleAfterSendEvent(e){const t=isBaseTransportSend();return(n,r)=>{if(!e.isEnabled()||!isErrorEvent(n)&&!isTransactionEvent(n))return;const o=r&&r.statusCode;t&&(!o||o<200||o>=300)||(isTransactionEvent(n)?handleTransactionEvent(e,n):handleErrorEvent(e,n))}}function handleTransactionEvent(e,t){const n=e.getContext();t.contexts&&t.contexts.trace&&t.contexts.trace.trace_id&&n.traceIds.size<100&&n.traceIds.add(t.contexts.trace.trace_id)}function handleErrorEvent(e,t){const n=e.getContext();if(t.event_id&&n.errorIds.size<100&&n.errorIds.add(t.event_id),"buffer"!==e.recordingMode||!t.tags||!t.tags.replayId)return;const{beforeErrorSampling:r}=e.getOptions();("function"!=typeof r||r(t))&&setTimeout((()=>{e.sendBufferedReplayOrFlush()}))}function isBaseTransportSend(){const e=getClient();if(!e)return!1;const t=e.getTransport();return t&&t.send.__sentry__baseTransport__||!1}function handleBeforeSendEvent(e){return t=>{e.isEnabled()&&isErrorEvent(t)&&handleHydrationError(e,t)}}function handleHydrationError(e,t){const n=t.exception&&t.exception.values&&t.exception.values[0].value;if("string"==typeof n&&(n.match(/reactjs\.org\/docs\/error-decoder\.html\?invariant=(418|419|422|423|425)/)||n.match(/(does not match server-rendered HTML|Hydration failed because)/i))){addBreadcrumbEvent(e,createBreadcrumb({category:"replay.hydrate-error"}))}}function isRrwebError(e,t){return!(e.type||!e.exception||!e.exception.values||!e.exception.values.length)&&!(!t.originalException||!t.originalException.__rrweb__)}function addFeedbackBreadcrumb(e,t){e.triggerUserActivity(),e.addUpdate((()=>!t.timestamp||(e.throttledAddEvent({type:EventType.Custom,timestamp:1e3*t.timestamp,data:{tag:"breadcrumb",payload:{timestamp:t.timestamp,type:"default",category:"sentry.feedback",data:{feedbackId:t.event_id}}}}),!1)))}function shouldSampleForBufferEvent(e,t){return"buffer"===e.recordingMode&&(t.message!==UNABLE_TO_SEND_REPLAY&&(!(!t.exception||t.type)&&isSampled(e.getOptions().errorSampleRate)))}function handleGlobalEventListener(e,t=!1){const n=t?handleAfterSendEvent(e):void 0;return Object.assign(((t,r)=>{if(!e.isEnabled())return t;if(isReplayEvent(t))return delete t.breadcrumbs,t;if(!isErrorEvent(t)&&!isTransactionEvent(t)&&!isFeedbackEvent(t))return t;if(!e.checkAndHandleExpiredSession())return t;if(isFeedbackEvent(t))return e.flush(),t.contexts.feedback.replay_id=e.getSessionId(),addFeedbackBreadcrumb(e,t),t;if(isRrwebError(t,r)&&!e.getOptions()._experiments.captureExceptions)return DEBUG_BUILD$2&&logger.log("[Replay] Ignoring error from rrweb internals",t),null;return(shouldSampleForBufferEvent(e,t)||"session"===e.recordingMode)&&(t.tags={...t.tags,replayId:e.getSessionId()}),n&&n(t,{statusCode:200}),t}),{id:"Replay"})}function createPerformanceSpans(e,t){return t.map((({type:t,start:n,end:r,name:o,data:a})=>{const i=e.throttledAddEvent({type:EventType.Custom,timestamp:n,data:{tag:"performanceSpan",payload:{op:t,description:o,startTimestamp:n,endTimestamp:r,data:a}}});return"string"==typeof i?Promise.resolve(null):i}))}function handleHistory(e){const{from:t,to:n}=e,r=Date.now()/1e3;return{type:"navigation.push",start:r,end:r,name:n,data:{previous:t}}}function handleHistorySpanListener(e){return t=>{if(!e.isEnabled())return;const n=handleHistory(t);null!==n&&(e.getContext().urls.push(n.name),e.triggerUserActivity(),e.addUpdate((()=>(createPerformanceSpans(e,[n]),!1))))}}function shouldFilterRequest(e,t){return(!DEBUG_BUILD$2||!e.getOptions()._experiments.traceInternals)&&isSentryRequestUrl(t,getClient())}function addNetworkBreadcrumb(e,t){e.isEnabled()&&null!==t&&(shouldFilterRequest(e,t.name)||e.addUpdate((()=>(createPerformanceSpans(e,[t]),!0))))}function handleFetch(e){const{startTimestamp:t,endTimestamp:n,fetchData:r,response:o}=e;if(!n)return null;const{method:a,url:i}=r;return{type:"resource.fetch",start:t/1e3,end:n/1e3,name:i,data:{method:a,statusCode:o?o.status:void 0}}}function handleFetchSpanListener(e){return t=>{if(!e.isEnabled())return;const n=handleFetch(t);addNetworkBreadcrumb(e,n)}}function handleXhr(e){const{startTimestamp:t,endTimestamp:n,xhr:r}=e,o=r[SENTRY_XHR_DATA_KEY];if(!t||!n||!o)return null;const{method:a,url:i,status_code:s}=o;return void 0===i?null:{type:"resource.xhr",name:i,start:t/1e3,end:n/1e3,data:{method:a,statusCode:s}}}function handleXhrSpanListener(e){return t=>{if(!e.isEnabled())return;const n=handleXhr(t);addNetworkBreadcrumb(e,n)}}function getBodySize(e,t){if(e)try{if("string"==typeof e)return t.encode(e).length;if(e instanceof URLSearchParams)return t.encode(e.toString()).length;if(e instanceof FormData){const n=_serializeFormData(e);return t.encode(n).length}if(e instanceof Blob)return e.size;if(e instanceof ArrayBuffer)return e.byteLength}catch(e){}}function parseContentLengthHeader(e){if(!e)return;const t=parseInt(e,10);return isNaN(t)?void 0:t}function getBodyString(e){try{if("string"==typeof e)return[e];if(e instanceof URLSearchParams)return[e.toString()];if(e instanceof FormData)return[_serializeFormData(e)];if(!e)return[void 0]}catch(t){return DEBUG_BUILD$2&&logger.warn("[Replay] Failed to serialize body",e),[void 0,"BODY_PARSE_ERROR"]}return DEBUG_BUILD$2&&logger.info("[Replay] Skipping network body because of body type",e),[void 0,"UNPARSEABLE_BODY_TYPE"]}function mergeWarning(e,t){if(!e)return{headers:{},size:void 0,_meta:{warnings:[t]}};const n={...e._meta},r=n.warnings||[];return n.warnings=[...r,t],e._meta=n,e}function makeNetworkReplayBreadcrumb(e,t){if(!t)return null;const{startTimestamp:n,endTimestamp:r,url:o,method:a,statusCode:i,request:s,response:c}=t;return{type:e,start:n/1e3,end:r/1e3,name:o,data:dropUndefinedKeys({method:a,statusCode:i,request:s,response:c})}}function buildSkippedNetworkRequestOrResponse(e){return{headers:{},size:e,_meta:{warnings:["URL_SKIPPED"]}}}function buildNetworkRequestOrResponse(e,t,n){if(!t&&0===Object.keys(e).length)return;if(!t)return{headers:e};if(!n)return{headers:e,size:t};const r={headers:e,size:t},{body:o,warnings:a}=normalizeNetworkBody(n);return r.body=o,a&&a.length>0&&(r._meta={warnings:a}),r}function getAllowedHeaders(e,t){return Object.keys(e).reduce(((n,r)=>{const o=r.toLowerCase();return t.includes(o)&&e[r]&&(n[o]=e[r]),n}),{})}function _serializeFormData(e){return new URLSearchParams(e).toString()}function normalizeNetworkBody(e){if(!e||"string"!=typeof e)return{body:e};const t=e.length>NETWORK_BODY_MAX_SIZE,n=_strIsProbablyJson(e);if(t){const t=e.slice(0,NETWORK_BODY_MAX_SIZE);return n?{body:t,warnings:["MAYBE_JSON_TRUNCATED"]}:{body:`${t}â¦`,warnings:["TEXT_TRUNCATED"]}}if(n)try{return{body:JSON.parse(e)}}catch(e){}return{body:e}}function _strIsProbablyJson(e){const t=e[0],n=e[e.length-1];return"["===t&&"]"===n||"{"===t&&"}"===n}function urlMatches(e,t){return stringMatchesSomePattern(getFullUrl(e),t)}function getFullUrl(e,t=WINDOW$4.document.baseURI){if(e.startsWith("http://")||e.startsWith("https://")||e.startsWith(WINDOW$4.location.origin))return e;const n=new URL(e,t);if(n.origin!==new URL(t).origin)return e;const r=n.href;return!e.endsWith("/")&&r.endsWith("/")?r.slice(0,-1):r}async function captureFetchBreadcrumbToReplay(e,t,n){try{const r=makeNetworkReplayBreadcrumb("resource.fetch",await _prepareFetchData(e,t,n));addNetworkBreadcrumb(n.replay,r)}catch(e){DEBUG_BUILD$2&&logger.error("[Replay] Failed to capture fetch breadcrumb",e)}}function enrichFetchBreadcrumb(e,t,n){const{input:r,response:o}=t,a=getBodySize(r?_getFetchRequestArgBody(r):void 0,n.textEncoder),i=o?parseContentLengthHeader(o.headers.get("content-length")):void 0;void 0!==a&&(e.data.request_body_size=a),void 0!==i&&(e.data.response_body_size=i)}async function _prepareFetchData(e,t,n){const r=Date.now(),{startTimestamp:o=r,endTimestamp:a=r}=t,{url:i,method:s,status_code:c=0,request_body_size:l,response_body_size:u}=e.data,d=urlMatches(i,n.networkDetailAllowUrls)&&!urlMatches(i,n.networkDetailDenyUrls);return{startTimestamp:o,endTimestamp:a,url:i,method:s,statusCode:c,request:d?_getRequestInfo(n,t.input,l):buildSkippedNetworkRequestOrResponse(l),response:await _getResponseInfo(d,n,t.response,u)}}function _getRequestInfo({networkCaptureBodies:e,networkRequestHeaders:t},n,r){const o=n?getRequestHeaders(n,t):{};if(!e)return buildNetworkRequestOrResponse(o,r,void 0);const a=_getFetchRequestArgBody(n),[i,s]=getBodyString(a),c=buildNetworkRequestOrResponse(o,r,i);return s?mergeWarning(c,s):c}async function _getResponseInfo(e,{networkCaptureBodies:t,textEncoder:n,networkResponseHeaders:r},o,a){if(!e&&void 0!==a)return buildSkippedNetworkRequestOrResponse(a);const i=o?getAllHeaders(o.headers,r):{};if(!o||!t&&void 0!==a)return buildNetworkRequestOrResponse(i,a,void 0);const[s,c]=await _parseFetchResponseBody(o),l=getResponseData(s,{networkCaptureBodies:t,textEncoder:n,responseBodySize:a,captureDetails:e,headers:i});return c?mergeWarning(l,c):l}function getResponseData(e,{networkCaptureBodies:t,textEncoder:n,responseBodySize:r,captureDetails:o,headers:a}){try{const i=e&&e.length&&void 0===r?getBodySize(e,n):r;return o?buildNetworkRequestOrResponse(a,i,t?e:void 0):buildSkippedNetworkRequestOrResponse(i)}catch(e){return DEBUG_BUILD$2&&logger.warn("[Replay] Failed to serialize response body",e),buildNetworkRequestOrResponse(a,r,void 0)}}async function _parseFetchResponseBody(e){const t=_tryCloneResponse(e);if(!t)return[void 0,"BODY_PARSE_ERROR"];try{return[await _tryGetResponseText(t)]}catch(e){return DEBUG_BUILD$2&&logger.warn("[Replay] Failed to get text body from response",e),[void 0,"BODY_PARSE_ERROR"]}}function _getFetchRequestArgBody(e=[]){if(2===e.length&&"object"==typeof e[1])return e[1].body}function getAllHeaders(e,t){const n={};return t.forEach((t=>{e.get(t)&&(n[t]=e.get(t))})),n}function getRequestHeaders(e,t){return 1===e.length&&"string"!=typeof e[0]?getHeadersFromOptions(e[0],t):2===e.length?getHeadersFromOptions(e[1],t):{}}function getHeadersFromOptions(e,t){if(!e)return{};const n=e.headers;return n?n instanceof Headers?getAllHeaders(n,t):Array.isArray(n)?{}:getAllowedHeaders(n,t):{}}function _tryCloneResponse(e){try{return e.clone()}catch(e){DEBUG_BUILD$2&&logger.warn("[Replay] Failed to clone response body",e)}}function _tryGetResponseText(e){return new Promise(((t,n)=>{const r=setTimeout((()=>n(new Error("Timeout while trying to read response body"))),500);_getResponseText(e).then((e=>t(e)),(e=>n(e))).finally((()=>clearTimeout(r)))}))}async function _getResponseText(e){return await e.text()}async function captureXhrBreadcrumbToReplay(e,t,n){try{const r=makeNetworkReplayBreadcrumb("resource.xhr",_prepareXhrData(e,t,n));addNetworkBreadcrumb(n.replay,r)}catch(e){DEBUG_BUILD$2&&logger.error("[Replay] Failed to capture xhr breadcrumb",e)}}function enrichXhrBreadcrumb(e,t,n){const{xhr:r,input:o}=t;if(!r)return;const a=getBodySize(o,n.textEncoder),i=r.getResponseHeader("content-length")?parseContentLengthHeader(r.getResponseHeader("content-length")):_getBodySize(r.response,r.responseType,n.textEncoder);void 0!==a&&(e.data.request_body_size=a),void 0!==i&&(e.data.response_body_size=i)}function _prepareXhrData(e,t,n){const r=Date.now(),{startTimestamp:o=r,endTimestamp:a=r,input:i,xhr:s}=t,{url:c,method:l,status_code:u=0,request_body_size:d,response_body_size:p}=e.data;if(!c)return null;if(!s||!urlMatches(c,n.networkDetailAllowUrls)||urlMatches(c,n.networkDetailDenyUrls)){return{startTimestamp:o,endTimestamp:a,url:c,method:l,statusCode:u,request:buildSkippedNetworkRequestOrResponse(d),response:buildSkippedNetworkRequestOrResponse(p)}}const g=s[SENTRY_XHR_DATA_KEY],h=g?getAllowedHeaders(g.request_headers,n.networkRequestHeaders):{},f=getAllowedHeaders(getResponseHeaders(s),n.networkResponseHeaders),[m,_]=n.networkCaptureBodies?getBodyString(i):[void 0],[E,T]=n.networkCaptureBodies?_getXhrResponseBody(s):[void 0],S=buildNetworkRequestOrResponse(h,d,m),y=buildNetworkRequestOrResponse(f,p,E);return{startTimestamp:o,endTimestamp:a,url:c,method:l,statusCode:u,request:_?mergeWarning(S,_):S,response:T?mergeWarning(y,T):y}}function getResponseHeaders(e){const t=e.getAllResponseHeaders();return t?t.split("\r\n").reduce(((e,t)=>{const[n,r]=t.split(": ");return e[n.toLowerCase()]=r,e}),{}):{}}function _getXhrResponseBody(e){const t=[];try{return[e.responseText]}catch(e){t.push(e)}try{return _parseXhrResponse(e.response,e.responseType)}catch(e){t.push(e)}return DEBUG_BUILD$2&&logger.warn("[Replay] Failed to get xhr response body",...t),[void 0]}function _parseXhrResponse(e,t){try{if("string"==typeof e)return[e];if(e instanceof Document)return[e.body.outerHTML];if("json"===t&&e&&"object"==typeof e)return[JSON.stringify(e)];if(!e)return[void 0]}catch(t){return DEBUG_BUILD$2&&logger.warn("[Replay] Failed to serialize body",e),[void 0,"BODY_PARSE_ERROR"]}return DEBUG_BUILD$2&&logger.info("[Replay] Skipping network body because of body type",e),[void 0,"UNPARSEABLE_BODY_TYPE"]}function _getBodySize(e,t,n){try{return getBodySize("json"===t&&e&&"object"==typeof e?JSON.stringify(e):e,n)}catch(e){return}}function handleNetworkBreadcrumbs(e){const t=getClient();try{const n=new TextEncoder,{networkDetailAllowUrls:r,networkDetailDenyUrls:o,networkCaptureBodies:a,networkRequestHeaders:i,networkResponseHeaders:s}=e.getOptions(),c={replay:e,textEncoder:n,networkDetailAllowUrls:r,networkDetailDenyUrls:o,networkCaptureBodies:a,networkRequestHeaders:i,networkResponseHeaders:s};t&&t.on?t.on("beforeAddBreadcrumb",((e,t)=>beforeAddNetworkBreadcrumb(c,e,t))):(addFetchInstrumentationHandler(handleFetchSpanListener(e)),addXhrInstrumentationHandler(handleXhrSpanListener(e)))}catch(e){}}function beforeAddNetworkBreadcrumb(e,t,n){if(t.data)try{_isXhrBreadcrumb(t)&&_isXhrHint(n)&&(enrichXhrBreadcrumb(t,n,e),captureXhrBreadcrumbToReplay(t,n,e)),_isFetchBreadcrumb(t)&&_isFetchHint(n)&&(enrichFetchBreadcrumb(t,n,e),captureFetchBreadcrumbToReplay(t,n,e))}catch(e){DEBUG_BUILD$2&&logger.warn("Error when enriching network breadcrumb")}}function _isXhrBreadcrumb(e){return"xhr"===e.category}function _isFetchBreadcrumb(e){return"fetch"===e.category}function _isXhrHint(e){return e&&e.xhr}function _isFetchHint(e){return e&&e.response}let _LAST_BREADCRUMB=null;function isBreadcrumbWithCategory(e){return!!e.category}const handleScopeListener=e=>t=>{if(!e.isEnabled())return;const n=handleScope(t);n&&addBreadcrumbEvent(e,n)};function handleScope(e){const t=e.getLastBreadcrumb&&e.getLastBreadcrumb();return _LAST_BREADCRUMB!==t&&t?(_LAST_BREADCRUMB=t,!isBreadcrumbWithCategory(t)||["fetch","xhr","sentry.event","sentry.transaction"].includes(t.category)||t.category.startsWith("ui.")?null:"console"===t.category?normalizeConsoleBreadcrumb(t):createBreadcrumb(t)):null}function normalizeConsoleBreadcrumb(e){const t=e.data&&e.data.arguments;if(!Array.isArray(t)||0===t.length)return createBreadcrumb(e);let n=!1;const r=t.map((e=>{if(!e)return e;if("string"==typeof e)return e.length>CONSOLE_ARG_MAX_SIZE?(n=!0,`${e.slice(0,CONSOLE_ARG_MAX_SIZE)}â¦`):e;if("object"==typeof e)try{const t=normalize(e,7);return JSON.stringify(t).length>CONSOLE_ARG_MAX_SIZE?(n=!0,`${JSON.stringify(t,null,2).slice(0,CONSOLE_ARG_MAX_SIZE)}â¦`):t}catch(e){}return e}));return createBreadcrumb({...e,data:{...e.data,arguments:r,...n?{_meta:{warnings:["CONSOLE_ARG_TRUNCATED"]}}:{}}})}function addGlobalListeners(e){const t=getCurrentScope(),n=getClient();t.addScopeListener(handleScopeListener(e)),addClickKeypressInstrumentationHandler(handleDomListener(e)),addHistoryInstrumentationHandler(handleHistorySpanListener(e)),handleNetworkBreadcrumbs(e);const r=handleGlobalEventListener(e,!hasHooks(n));n&&n.addEventProcessor?n.addEventProcessor(r):addEventProcessor(r),hasHooks(n)&&(n.on("beforeSendEvent",handleBeforeSendEvent(e)),n.on("afterSendEvent",handleAfterSendEvent(e)),n.on("createDsc",(t=>{const n=e.getSessionId();if(n&&e.isEnabled()&&"session"===e.recordingMode){e.checkAndHandleExpiredSession()&&(t.replay_id=n)}})),n.on("startTransaction",(t=>{e.lastTransaction=t})),n.on("finishTransaction",(t=>{e.lastTransaction=t})),n.on("beforeSendFeedback",((t,n)=>{const r=e.getSessionId();n&&n.includeReplay&&e.isEnabled()&&r&&t.contexts&&t.contexts.feedback&&(t.contexts.feedback.replay_id=r)})))}function hasHooks(e){return!(!e||!e.on)}async function addMemoryEntry(e){try{return Promise.all(createPerformanceSpans(e,[createMemoryEntry(WINDOW$4.performance.memory)]))}catch(e){return[]}}function createMemoryEntry(e){const{jsHeapSizeLimit:t,totalJSHeapSize:n,usedJSHeapSize:r}=e,o=Date.now()/1e3;return{type:"memory",name:"memory",start:o,end:o,data:{memory:{jsHeapSizeLimit:t,totalJSHeapSize:n,usedJSHeapSize:r}}}}function debounce(e,t,n){let r,o,a;const i=n&&n.maxWait?Math.max(n.maxWait,t):0;function s(){return c(),r=e(),r}function c(){void 0!==o&&clearTimeout(o),void 0!==a&&clearTimeout(a),o=a=void 0}function l(){return o&&clearTimeout(o),o=setTimeout(s,t),i&&void 0===a&&(a=setTimeout(s,i)),r}return l.cancel=c,l.flush=function(){return void 0!==o||void 0!==a?s():r},l}function getHandleRecordingEmit(e){let t=!1;return(n,r)=>{if(!e.checkAndHandleExpiredSession())return void(DEBUG_BUILD$2&&logger.warn("[Replay] Received replay event after session expired."));const o=r||!t;t=!0,e.clickDetector&&updateClickDetectorForRecordingEvent(e.clickDetector,n),e.addUpdate((()=>{if("buffer"===e.recordingMode&&o&&e.setInitialState(),!addEventSync(e,n,o))return!0;if(!o)return!1;if(addSettingsEvent(e,o),e.session&&e.session.previousSessionId)return!0;if("buffer"===e.recordingMode&&e.session&&e.eventBuffer){const t=e.eventBuffer.getEarliestTimestamp();t&&(logInfo(`[Replay] Updating session start time to earliest event in buffer to ${new Date(t)}`,e.getOptions()._experiments.traceInternals),e.session.started=t,e.getOptions().stickySession&&saveSession(e.session))}return"session"===e.recordingMode&&e.flush(),!0}))}}function createOptionsEvent(e){const t=e.getOptions();return{type:EventType.Custom,timestamp:Date.now(),data:{tag:"options",payload:{shouldRecordCanvas:e.isRecordingCanvas(),sessionSampleRate:t.sessionSampleRate,errorSampleRate:t.errorSampleRate,useCompressionOption:t.useCompression,blockAllMedia:t.blockAllMedia,maskAllText:t.maskAllText,maskAllInputs:t.maskAllInputs,useCompression:!!e.eventBuffer&&"worker"===e.eventBuffer.type,networkDetailHasUrls:t.networkDetailAllowUrls.length>0,networkCaptureBodies:t.networkCaptureBodies,networkRequestHasHeaders:t.networkRequestHeaders.length>0,networkResponseHasHeaders:t.networkResponseHeaders.length>0}}}}function addSettingsEvent(e,t){t&&e.session&&0===e.session.segmentId&&addEventSync(e,createOptionsEvent(e),!1)}function createReplayEnvelope(e,t,n,r){return createEnvelope(createEventEnvelopeHeaders(e,getSdkMetadataForEnvelopeHeader(e),r,n),[[{type:"replay_event"},e],[{type:"replay_recording",length:"string"==typeof t?(new TextEncoder).encode(t).length:t.length},t]])}function prepareRecordingData({recordingData:e,headers:t}){let n;const r=`${JSON.stringify(t)}\n`;if("string"==typeof e)n=`${r}${e}`;else{const t=(new TextEncoder).encode(r);n=new Uint8Array(t.length+e.length),n.set(t),n.set(e,t.length)}return n}async function prepareReplayEvent({client:e,scope:t,replayId:n,event:r}){const o={event_id:n,integrations:"object"!=typeof e._integrations||null===e._integrations||Array.isArray(e._integrations)?void 0:Object.keys(e._integrations)};e.emit&&e.emit("preprocessEvent",r,o);const a=await prepareEvent(e.getOptions(),r,o,t,e,getIsolationScope());if(!a)return null;a.platform=a.platform||"javascript";const i=e.getSdkMetadata&&e.getSdkMetadata(),{name:s,version:c}=i&&i.sdk||{};return a.sdk={...a.sdk,name:s||"sentry.javascript.unknown",version:c||"0.0.0"},a}async function sendReplayRequest({recordingData:e,replayId:t,segmentId:n,eventContext:r,timestamp:o,session:a}){const i=prepareRecordingData({recordingData:e,headers:{segment_id:n}}),{urls:s,errorIds:c,traceIds:l,initialTimestamp:u}=r,d=getClient(),p=getCurrentScope(),g=d&&d.getTransport(),h=d&&d.getDsn();if(!(d&&g&&h&&a.sampled))return;const f={type:REPLAY_EVENT_NAME,replay_start_timestamp:u/1e3,timestamp:o/1e3,error_ids:c,trace_ids:l,urls:s,replay_id:t,segment_id:n,replay_type:a.sampled},m=await prepareReplayEvent({scope:p,client:d,replayId:t,event:f});if(!m)return d.recordDroppedEvent("event_processor","replay",f),void logInfo("An event processor returned `null`, will not send event.");delete m.sdkProcessingMetadata;const _=createReplayEnvelope(m,i,h,d.getOptions().tunnel);let E;try{E=await g.send(_)}catch(e){const t=new Error(UNABLE_TO_SEND_REPLAY);try{t.cause=e}catch(e){}throw t}if(!E)return E;if("number"==typeof E.statusCode&&(E.statusCode<200||E.statusCode>=300))throw new TransportStatusCodeError(E.statusCode);const T=updateRateLimits({},E);if(isRateLimited(T,"replay"))throw new RateLimitError(T);return E}class TransportStatusCodeError extends Error{constructor(e){super(`Transport returned status code ${e}`)}}class RateLimitError extends Error{constructor(e){super("Rate limit hit"),this.rateLimits=e}}async function sendReplay(e,t={count:0,interval:RETRY_BASE_INTERVAL}){const{recordingData:n,options:r}=e;if(n.length)try{return await sendReplayRequest(e),!0}catch(n){if(n instanceof TransportStatusCodeError||n instanceof RateLimitError)throw n;if(setContext("Replays",{_retryCount:t.count}),DEBUG_BUILD$2&&r._experiments&&r._experiments.captureExceptions&&captureException(n),t.count>=RETRY_MAX_COUNT){const e=new Error(`${UNABLE_TO_SEND_REPLAY} - max retries exceeded`);try{e.cause=n}catch(e){}throw e}return t.interval*=++t.count,new Promise(((n,r)=>{setTimeout((async()=>{try{await sendReplay(e,t),n(!0)}catch(e){r(e)}}),t.interval)}))}}const THROTTLED="__THROTTLED",SKIPPED="__SKIPPED";function throttle(e,t,n){const r=new Map;let o=!1;return(...a)=>{const i=Math.floor(Date.now()/1e3);if((e=>{const t=e-n;r.forEach(((e,n)=>{n<t&&r.delete(n)}))})(i),[...r.values()].reduce(((e,t)=>e+t),0)>=t){const e=o;return o=!0,e?SKIPPED:THROTTLED}o=!1;const s=r.get(i)||0;return r.set(i,s+1),e(...a)}}class ReplayContainer{constructor({options:e,recordingOptions:t}){ReplayContainer.prototype.__init.call(this),ReplayContainer.prototype.__init2.call(this),ReplayContainer.prototype.__init3.call(this),ReplayContainer.prototype.__init4.call(this),ReplayContainer.prototype.__init5.call(this),ReplayContainer.prototype.__init6.call(this),this.eventBuffer=null,this.performanceEntries=[],this.replayPerformanceEntries=[],this.recordingMode="session",this.timeouts={sessionIdlePause:SESSION_IDLE_PAUSE_DURATION,sessionIdleExpire:SESSION_IDLE_EXPIRE_DURATION},this._lastActivity=Date.now(),this._isEnabled=!1,this._isPaused=!1,this._hasInitializedCoreListeners=!1,this._context={errorIds:new Set,traceIds:new Set,urls:[],initialTimestamp:Date.now(),initialUrl:""},this._recordingOptions=t,this._options=e,this._debouncedFlush=debounce((()=>this._flush()),this._options.flushMinDelay,{maxWait:this._options.flushMaxDelay}),this._throttledAddEvent=throttle(((e,t)=>addEvent(this,e,t)),300,5);const{slowClickTimeout:n,slowClickIgnoreSelectors:r}=this.getOptions(),o=n?{threshold:Math.min(SLOW_CLICK_THRESHOLD,n),timeout:n,scrollTimeout:SLOW_CLICK_SCROLL_TIMEOUT,ignoreSelector:r?r.join(","):""}:void 0;o&&(this.clickDetector=new ClickDetector(this,o))}getContext(){return this._context}isEnabled(){return this._isEnabled}isPaused(){return this._isPaused}isRecordingCanvas(){return Boolean(this._canvas)}getOptions(){return this._options}initializeSampling(e){const{errorSampleRate:t,sessionSampleRate:n}=this._options;t<=0&&n<=0||(this._initializeSessionForSampling(e),this.session?!1!==this.session.sampled&&(this.recordingMode="buffer"===this.session.sampled&&0===this.session.segmentId?"buffer":"session",logInfoNextTick(`[Replay] Starting replay in ${this.recordingMode} mode`,this._options._experiments.traceInternals),this._initializeRecording()):this._handleException(new Error("Unable to initialize and create session")))}start(){if(this._isEnabled&&"session"===this.recordingMode)throw new Error("Replay recording is already in progress");if(this._isEnabled&&"buffer"===this.recordingMode)throw new Error("Replay buffering is in progress, call `flush()` to save the replay");logInfoNextTick("[Replay] Starting replay in session mode",this._options._experiments.traceInternals),this._updateUserActivity();const e=loadOrCreateSession({maxReplayDuration:this._options.maxReplayDuration,sessionIdleExpire:this.timeouts.sessionIdleExpire,traceInternals:this._options._experiments.traceInternals},{stickySession:this._options.stickySession,sessionSampleRate:1,allowBuffering:!1});this.session=e,this._initializeRecording()}startBuffering(){if(this._isEnabled)throw new Error("Replay recording is already in progress");logInfoNextTick("[Replay] Starting replay in buffer mode",this._options._experiments.traceInternals);const e=loadOrCreateSession({sessionIdleExpire:this.timeouts.sessionIdleExpire,maxReplayDuration:this._options.maxReplayDuration,traceInternals:this._options._experiments.traceInternals},{stickySession:this._options.stickySession,sessionSampleRate:0,allowBuffering:!0});this.session=e,this.recordingMode="buffer",this._initializeRecording()}startRecording(){try{const e=this._canvas;this._stopRecording=record({...this._recordingOptions,..."buffer"===this.recordingMode&&{checkoutEveryNms:BUFFER_CHECKOUT_TIME},emit:getHandleRecordingEmit(this),onMutation:this._onMutationHandler,...e?{recordCanvas:e.recordCanvas,getCanvasManager:e.getCanvasManager,sampling:e.sampling,dataURLOptions:e.dataURLOptions}:{}})}catch(e){this._handleException(e)}}stopRecording(){try{return this._stopRecording&&(this._stopRecording(),this._stopRecording=void 0),!0}catch(e){return this._handleException(e),!1}}async stop({forceFlush:e=!1,reason:t}={}){if(this._isEnabled){this._isEnabled=!1;try{logInfo("[Replay] Stopping Replay"+(t?` triggered by ${t}`:""),this._options._experiments.traceInternals),this._removeListeners(),this.stopRecording(),this._debouncedFlush.cancel(),e&&await this._flush({force:!0}),this.eventBuffer&&this.eventBuffer.destroy(),this.eventBuffer=null,clearSession(this)}catch(e){this._handleException(e)}}}pause(){this._isPaused||(this._isPaused=!0,this.stopRecording(),logInfo("[Replay] Pausing replay",this._options._experiments.traceInternals))}resume(){this._isPaused&&this._checkSession()&&(this._isPaused=!1,this.startRecording(),logInfo("[Replay] Resuming replay",this._options._experiments.traceInternals))}async sendBufferedReplayOrFlush({continueRecording:e=!0}={}){if("session"===this.recordingMode)return this.flushImmediate();const t=Date.now();logInfo("[Replay] Converting buffer to session",this._options._experiments.traceInternals),await this.flushImmediate();const n=this.stopRecording();e&&n&&"session"!==this.recordingMode&&(this.recordingMode="session",this.session&&(this._updateUserActivity(t),this._updateSessionActivity(t),this._maybeSaveSession()),this.startRecording())}addUpdate(e){const t=e();"buffer"!==this.recordingMode&&!0!==t&&this._debouncedFlush()}triggerUserActivity(){if(this._updateUserActivity(),this._stopRecording)this.checkAndHandleExpiredSession(),this._updateSessionActivity();else{if(!this._checkSession())return;this.resume()}}updateUserActivity(){this._updateUserActivity(),this._updateSessionActivity()}conditionalFlush(){return"buffer"===this.recordingMode?Promise.resolve():this.flushImmediate()}flush(){return this._debouncedFlush()}flushImmediate(){return this._debouncedFlush(),this._debouncedFlush.flush()}cancelFlush(){this._debouncedFlush.cancel()}getSessionId(){return this.session&&this.session.id}checkAndHandleExpiredSession(){if(!(this._lastActivity&&isExpired(this._lastActivity,this.timeouts.sessionIdlePause)&&this.session&&"session"===this.session.sampled))return!!this._checkSession();this.pause()}setInitialState(){const e=`${WINDOW$4.location.pathname}${WINDOW$4.location.hash}${WINDOW$4.location.search}`,t=`${WINDOW$4.location.origin}${e}`;this.performanceEntries=[],this.replayPerformanceEntries=[],this._clearContext(),this._context.initialUrl=t,this._context.initialTimestamp=Date.now(),this._context.urls.push(t)}throttledAddEvent(e,t){const n=this._throttledAddEvent(e,t);if(n===THROTTLED){const e=createBreadcrumb({category:"replay.throttled"});this.addUpdate((()=>!addEventSync(this,{type:ReplayEventTypeCustom,timestamp:e.timestamp||0,data:{tag:"breadcrumb",payload:e,metric:!0}})))}return n}getCurrentRoute(){const e=this.lastTransaction||getCurrentScope().getTransaction(),t=(e&&spanToJSON(e).data||{})[SEMANTIC_ATTRIBUTE_SENTRY_SOURCE];if(e&&t&&["route","custom"].includes(t))return spanToJSON(e).description}_initializeRecording(){this.setInitialState(),this._updateSessionActivity(),this.eventBuffer=createEventBuffer({useCompression:this._options.useCompression,workerUrl:this._options.workerUrl}),this._removeListeners(),this._addListeners(),this._isEnabled=!0,this._isPaused=!1,this.startRecording()}_handleException(e){DEBUG_BUILD$2&&logger.error("[Replay]",e),DEBUG_BUILD$2&&this._options._experiments&&this._options._experiments.captureExceptions&&captureException(e)}_initializeSessionForSampling(e){const t=this._options.errorSampleRate>0,n=loadOrCreateSession({sessionIdleExpire:this.timeouts.sessionIdleExpire,maxReplayDuration:this._options.maxReplayDuration,traceInternals:this._options._experiments.traceInternals,previousSessionId:e},{stickySession:this._options.stickySession,sessionSampleRate:this._options.sessionSampleRate,allowBuffering:t});this.session=n}_checkSession(){if(!this.session)return!1;const e=this.session;return!shouldRefreshSession(e,{sessionIdleExpire:this.timeouts.sessionIdleExpire,maxReplayDuration:this._options.maxReplayDuration})||(this._refreshSession(e),!1)}async _refreshSession(e){this._isEnabled&&(await this.stop({reason:"refresh session"}),this.initializeSampling(e.id))}_addListeners(){try{WINDOW$4.document.addEventListener("visibilitychange",this._handleVisibilityChange),WINDOW$4.addEventListener("blur",this._handleWindowBlur),WINDOW$4.addEventListener("focus",this._handleWindowFocus),WINDOW$4.addEventListener("keydown",this._handleKeyboardEvent),this.clickDetector&&this.clickDetector.addListeners(),this._hasInitializedCoreListeners||(addGlobalListeners(this),this._hasInitializedCoreListeners=!0)}catch(e){this._handleException(e)}this._performanceCleanupCallback=setupPerformanceObserver(this)}_removeListeners(){try{WINDOW$4.document.removeEventListener("visibilitychange",this._handleVisibilityChange),WINDOW$4.removeEventListener("blur",this._handleWindowBlur),WINDOW$4.removeEventListener("focus",this._handleWindowFocus),WINDOW$4.removeEventListener("keydown",this._handleKeyboardEvent),this.clickDetector&&this.clickDetector.removeListeners(),this._performanceCleanupCallback&&this._performanceCleanupCallback()}catch(e){this._handleException(e)}}__init(){this._handleVisibilityChange=()=>{"visible"===WINDOW$4.document.visibilityState?this._doChangeToForegroundTasks():this._doChangeToBackgroundTasks()}}__init2(){this._handleWindowBlur=()=>{const e=createBreadcrumb({category:"ui.blur"});this._doChangeToBackgroundTasks(e)}}__init3(){this._handleWindowFocus=()=>{const e=createBreadcrumb({category:"ui.focus"});this._doChangeToForegroundTasks(e)}}__init4(){this._handleKeyboardEvent=e=>{handleKeyboardEvent(this,e)}}_doChangeToBackgroundTasks(e){if(!this.session)return;isSessionExpired(this.session,{maxReplayDuration:this._options.maxReplayDuration,sessionIdleExpire:this.timeouts.sessionIdleExpire})||(e&&this._createCustomBreadcrumb(e),this.conditionalFlush())}_doChangeToForegroundTasks(e){if(!this.session)return;this.checkAndHandleExpiredSession()?e&&this._createCustomBreadcrumb(e):logInfo("[Replay] Document has become active, but session has expired")}_updateUserActivity(e=Date.now()){this._lastActivity=e}_updateSessionActivity(e=Date.now()){this.session&&(this.session.lastActivity=e,this._maybeSaveSession())}_createCustomBreadcrumb(e){this.addUpdate((()=>{this.throttledAddEvent({type:EventType.Custom,timestamp:e.timestamp||0,data:{tag:"breadcrumb",payload:e}})}))}_addPerformanceEntries(){const e=createPerformanceEntries(this.performanceEntries).concat(this.replayPerformanceEntries);return this.performanceEntries=[],this.replayPerformanceEntries=[],Promise.all(createPerformanceSpans(this,e))}_clearContext(){this._context.errorIds.clear(),this._context.traceIds.clear(),this._context.urls=[]}_updateInitialTimestampFromEventBuffer(){const{session:e,eventBuffer:t}=this;if(!e||!t)return;if(e.segmentId)return;const n=t.getEarliestTimestamp();n&&n<this._context.initialTimestamp&&(this._context.initialTimestamp=n)}_popEventContext(){const e={initialTimestamp:this._context.initialTimestamp,initialUrl:this._context.initialUrl,errorIds:Array.from(this._context.errorIds),traceIds:Array.from(this._context.traceIds),urls:this._context.urls};return this._clearContext(),e}async _runFlush(){const e=this.getSessionId();if(this.session&&this.eventBuffer&&e){if(await this._addPerformanceEntries(),this.eventBuffer&&this.eventBuffer.hasEvents&&(await addMemoryEntry(this),this.eventBuffer&&e===this.getSessionId()))try{this._updateInitialTimestampFromEventBuffer();const t=Date.now();if(t-this._context.initialTimestamp>this._options.maxReplayDuration+3e4)throw new Error("Session is too long, not sending replay");const n=this._popEventContext(),r=this.session.segmentId++;this._maybeSaveSession();const o=await this.eventBuffer.finish();await sendReplay({replayId:e,recordingData:o,segmentId:r,eventContext:n,session:this.session,options:this.getOptions(),timestamp:t})}catch(e){this._handleException(e),this.stop({reason:"sendReplay"});const t=getClient();t&&t.recordDroppedEvent("send_error","replay")}}else DEBUG_BUILD$2&&logger.error("[Replay] No session or eventBuffer found to flush.")}__init5(){this._flush=async({force:e=!1}={})=>{if(!this._isEnabled&&!e)return;if(!this.checkAndHandleExpiredSession())return void(DEBUG_BUILD$2&&logger.error("[Replay] Attempting to finish replay event after session expired."));if(!this.session)return;const t=this.session.started,n=Date.now()-t;this._debouncedFlush.cancel();const r=n<this._options.minReplayDuration,o=n>this._options.maxReplayDuration+5e3;if(r||o)return logInfo(`[Replay] Session duration (${Math.floor(n/1e3)}s) is too ${r?"short":"long"}, not sending replay.`,this._options._experiments.traceInternals),void(r&&this._debouncedFlush());const a=this.eventBuffer;if(a&&0===this.session.segmentId&&!a.hasCheckout&&logInfo("[Replay] Flushing initial segment without checkout.",this._options._experiments.traceInternals),!this._flushLock)return this._flushLock=this._runFlush(),await this._flushLock,void(this._flushLock=void 0);try{await this._flushLock}catch(e){DEBUG_BUILD$2&&logger.error(e)}finally{this._debouncedFlush()}}}_maybeSaveSession(){this.session&&this._options.stickySession&&saveSession(this.session)}__init6(){this._onMutationHandler=e=>{const t=e.length,n=this._options.mutationLimit,r=n&&t>n;if(t>this._options.mutationBreadcrumbLimit||r){const e=createBreadcrumb({category:"replay.mutations",data:{count:t,limit:r}});this._createCustomBreadcrumb(e)}return!r||(this.stop({reason:"mutationLimit",forceFlush:"session"===this.recordingMode}),!1)}}}function getOption(e,t,n,r){const o=[...e,..."string"==typeof r?r.split(","):[],...t];return void 0!==n&&("string"==typeof n&&o.push(`.${n}`),consoleSandbox((()=>{console.warn("[Replay] You are using a deprecated configuration item for privacy. Read the documentation on how to use the new privacy configuration.")}))),o.join(",")}function getPrivacyOptions({mask:e,unmask:t,block:n,unblock:r,ignore:o,blockClass:a,blockSelector:i,maskTextClass:s,maskTextSelector:c,ignoreClass:l}){const u={maskTextSelector:getOption(e,[".sentry-mask","[data-sentry-mask]"],s,c),unmaskTextSelector:getOption(t,[".sentry-unmask","[data-sentry-unmask]"]),blockSelector:getOption(n,[".sentry-block","[data-sentry-block]",'base[href="/"]'],a,i),unblockSelector:getOption(r,[".sentry-unblock","[data-sentry-unblock]"]),ignoreSelector:getOption(o,[".sentry-ignore","[data-sentry-ignore]",'input[type="file"]'],l)};return a instanceof RegExp&&(u.blockClass=a),s instanceof RegExp&&(u.maskTextClass=s),u}function maskAttribute({el:e,key:t,maskAttributes:n,maskAllText:r,privacyOptions:o,value:a}){return r?o.unmaskTextSelector&&e.matches(o.unmaskTextSelector)?a:n.includes(t)||"value"===t&&"INPUT"===e.tagName&&["submit","button"].includes(e.getAttribute("type")||"")?a.replace(/[\S]/g,"*"):a:a}const MEDIA_SELECTORS='img,image,svg,video,object,picture,embed,map,audio,link[rel="icon"],link[rel="apple-touch-icon"]',DEFAULT_NETWORK_HEADERS=["content-length","content-type","accept"];let _initialized=!1;const replayIntegration$1=e=>new Replay$1(e);class Replay$1{static __initStatic(){this.id="Replay"}constructor({flushMinDelay:e=DEFAULT_FLUSH_MIN_DELAY,flushMaxDelay:t=DEFAULT_FLUSH_MAX_DELAY,minReplayDuration:n=MIN_REPLAY_DURATION,maxReplayDuration:r=MAX_REPLAY_DURATION,stickySession:o=!0,useCompression:a=!0,workerUrl:i,_experiments:s={},sessionSampleRate:c,errorSampleRate:l,maskAllText:u=!0,maskAllInputs:d=!0,blockAllMedia:p=!0,mutationBreadcrumbLimit:g=750,mutationLimit:h=1e4,slowClickTimeout:f=7e3,slowClickIgnoreSelectors:m=[],networkDetailAllowUrls:_=[],networkDetailDenyUrls:E=[],networkCaptureBodies:T=!0,networkRequestHeaders:S=[],networkResponseHeaders:y=[],mask:v=[],maskAttributes:I=["title","placeholder"],unmask:A=[],block:b=[],unblock:R=[],ignore:O=[],maskFn:L,beforeAddRecordingEvent:N,beforeErrorSampling:C,blockClass:w,blockSelector:D,maskInputOptions:P,maskTextClass:x,maskTextSelector:k,ignoreClass:M}={}){this.name=Replay$1.id;const U=getPrivacyOptions({mask:v,unmask:A,block:b,unblock:R,ignore:O,blockClass:w,blockSelector:D,maskTextClass:x,maskTextSelector:k,ignoreClass:M});if(this._recordingOptions={maskAllInputs:d,maskAllText:u,maskInputOptions:{...P||{},password:!0},maskTextFn:L,maskInputFn:L,maskAttributeFn:(e,t,n)=>maskAttribute({maskAttributes:I,maskAllText:u,privacyOptions:U,key:e,value:t,el:n}),...U,slimDOMOptions:"all",inlineStylesheet:!0,inlineImages:!1,collectFonts:!0,errorHandler:e=>{try{e.__rrweb__=!0}catch(e){}}},this._initialOptions={flushMinDelay:e,flushMaxDelay:t,minReplayDuration:Math.min(n,MIN_REPLAY_DURATION_LIMIT),maxReplayDuration:Math.min(r,MAX_REPLAY_DURATION),stickySession:o,sessionSampleRate:c,errorSampleRate:l,useCompression:a,workerUrl:i,blockAllMedia:p,maskAllInputs:d,maskAllText:u,mutationBreadcrumbLimit:g,mutationLimit:h,slowClickTimeout:f,slowClickIgnoreSelectors:m,networkDetailAllowUrls:_,networkDetailDenyUrls:E,networkCaptureBodies:T,networkRequestHeaders:_getMergedNetworkHeaders(S),networkResponseHeaders:_getMergedNetworkHeaders(y),beforeAddRecordingEvent:N,beforeErrorSampling:C,_experiments:s},"number"==typeof c&&(console.warn(`[Replay] You are passing \`sessionSampleRate\` to the Replay integration.\nThis option is deprecated and will be removed soon.\nInstead, configure \`replaysSessionSampleRate\` directly in the SDK init options, e.g.:\nSentry.init({ replaysSessionSampleRate: ${c} })`),this._initialOptions.sessionSampleRate=c),"number"==typeof l&&(console.warn(`[Replay] You are passing \`errorSampleRate\` to the Replay integration.\nThis option is deprecated and will be removed soon.\nInstead, configure \`replaysOnErrorSampleRate\` directly in the SDK init options, e.g.:\nSentry.init({ replaysOnErrorSampleRate: ${l} })`),this._initialOptions.errorSampleRate=l),this._initialOptions.blockAllMedia&&(this._recordingOptions.blockSelector=this._recordingOptions.blockSelector?`${this._recordingOptions.blockSelector},${MEDIA_SELECTORS}`:MEDIA_SELECTORS),this._isInitialized&&isBrowser())throw new Error("Multiple Sentry Session Replay instances are not supported");this._isInitialized=!0}get _isInitialized(){return _initialized}set _isInitialized(e){_initialized=e}setupOnce(){isBrowser()&&(this._setup(),setTimeout((()=>this._initialize())))}start(){this._replay&&this._replay.start()}startBuffering(){this._replay&&this._replay.startBuffering()}stop(){return this._replay?this._replay.stop({forceFlush:"session"===this._replay.recordingMode}):Promise.resolve()}flush(e){return this._replay&&this._replay.isEnabled()?this._replay.sendBufferedReplayOrFlush(e):Promise.resolve()}getReplayId(){if(this._replay&&this._replay.isEnabled())return this._replay.getSessionId()}_initialize(){this._replay&&(this._maybeLoadFromReplayCanvasIntegration(),this._replay.initializeSampling())}_setup(){const e=loadReplayOptionsFromClient(this._initialOptions);this._replay=new ReplayContainer({options:e,recordingOptions:this._recordingOptions})}_maybeLoadFromReplayCanvasIntegration(){try{const e=getClient().getIntegrationByName("ReplayCanvas");if(!e)return;this._replay._canvas=e.getOptions()}catch(e){}}}function loadReplayOptionsFromClient(e){const t=getClient(),n=t&&t.getOptions(),r={sessionSampleRate:0,errorSampleRate:0,...dropUndefinedKeys(e)};return n?(null==e.sessionSampleRate&&null==e.errorSampleRate&&null==n.replaysSessionSampleRate&&null==n.replaysOnErrorSampleRate&&consoleSandbox((()=>{console.warn("Replay is disabled because neither `replaysSessionSampleRate` nor `replaysOnErrorSampleRate` are set.")})),"number"==typeof n.replaysSessionSampleRate&&(r.sessionSampleRate=n.replaysSessionSampleRate),"number"==typeof n.replaysOnErrorSampleRate&&(r.errorSampleRate=n.replaysOnErrorSampleRate),r):(consoleSandbox((()=>{console.warn("SDK client is not available.")})),r)}function _getMergedNetworkHeaders(e){return[...DEFAULT_NETWORK_HEADERS,...e.map((e=>e.toLowerCase()))]}function getReplay$1(){const e=getClient();return e&&e.getIntegrationByName&&e.getIntegrationByName("Replay")}var NodeType;function elementClassMatchesRegex(e,t){for(let n=e.classList.length;n--;){const r=e.classList[n];if(t.test(r))return!0}return!1}function distanceToMatch(e,t,n=1/0,r=0){return e?e.nodeType!==e.ELEMENT_NODE||r>n?-1:t(e)?r:distanceToMatch(e.parentNode,t,n,r+1):-1}function createMatchPredicate(e,t){return n=>{const r=n;if(null===r)return!1;try{if(e)if("string"==typeof e){if(r.matches(`.${e}`))return!0}else if(elementClassMatchesRegex(r,e))return!0;return!(!t||!r.matches(t))}catch(e){return!1}}}Replay$1.__initStatic(),function(e){e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment"}(NodeType||(NodeType={}));const DEPARTED_MIRROR_ACCESS_WARNING="Please stop import mirror directly. Instead of that,\r\nnow you can use replayer.getMirror() to access the mirror instance of a replayer,\r\nor you can use record.mirror to access the mirror instance during recording.";let _mirror={map:{},getId:()=>(console.error(DEPARTED_MIRROR_ACCESS_WARNING),-1),getNode:()=>(console.error(DEPARTED_MIRROR_ACCESS_WARNING),null),removeNodeFromMap(){console.error(DEPARTED_MIRROR_ACCESS_WARNING)},has:()=>(console.error(DEPARTED_MIRROR_ACCESS_WARNING),!1),reset(){console.error(DEPARTED_MIRROR_ACCESS_WARNING)}};function hookSetter(e,t,n,r,o=window){const a=o.Object.getOwnPropertyDescriptor(e,t);return o.Object.defineProperty(e,t,r?n:{set(e){setTimeout$1((()=>{n.set.call(this,e)}),0),a&&a.set&&a.set.call(this,e)}}),()=>hookSetter(e,t,a||{},!0)}function patch(e,t,n){try{if(!(t in e))return()=>{};const r=e[t],o=n(r);return"function"==typeof o&&(o.prototype=o.prototype||{},Object.defineProperties(o,{__rrweb_original__:{enumerable:!1,value:r}})),e[t]=o,()=>{e[t]=r}}catch(e){return()=>{}}}function closestElementOfNode(e){if(!e)return null;return e.nodeType===e.ELEMENT_NODE?e:e.parentElement}function isBlocked(e,t,n,r,o){if(!e)return!1;const a=closestElementOfNode(e);if(!a)return!1;const i=createMatchPredicate(t,n);if(!o){const e=r&&a.matches(r);return i(a)&&!e}const s=distanceToMatch(a,i);let c=-1;return!(s<0)&&(r&&(c=distanceToMatch(a,createMatchPredicate(null,r))),s>-1&&c<0||s<c)}"undefined"!=typeof window&&window.Proxy&&window.Reflect&&(_mirror=new Proxy(_mirror,{get:(e,t,n)=>("map"===t&&console.error(DEPARTED_MIRROR_ACCESS_WARNING),Reflect.get(e,t,n))})),/[1-9][0-9]{12}/.test(Date.now().toString());const cachedImplementations={};function getImplementation(e){const t=cachedImplementations[e];if(t)return t;const n=window.document;let r=window[e];if(n&&"function"==typeof n.createElement)try{const t=n.createElement("iframe");t.hidden=!0,n.head.appendChild(t);const o=t.contentWindow;o&&o[e]&&(r=o[e]),n.head.removeChild(t)}catch(e){}return cachedImplementations[e]=r.bind(window)}function onRequestAnimationFrame(...e){return getImplementation("requestAnimationFrame")(...e)}function setTimeout$1(...e){return getImplementation("setTimeout")(...e)}var CanvasContext=(e=>(e[e["2D"]=0]="2D",e[e.WebGL=1]="WebGL",e[e.WebGL2=2]="WebGL2",e))(CanvasContext||{});let errorHandler;function registerErrorHandler(e){errorHandler=e}const callbackWrapper=e=>{if(!errorHandler)return e;return(...t)=>{try{return e(...t)}catch(e){if(errorHandler&&!0===errorHandler(e))return()=>{};throw e}}};for(var chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup="undefined"==typeof Uint8Array?[]:new Uint8Array(256),i=0;i<chars.length;i++)lookup[chars.charCodeAt(i)]=i;var encode=function(e){var t,n=new Uint8Array(e),r=n.length,o="";for(t=0;t<r;t+=3)o+=chars[n[t]>>2],o+=chars[(3&n[t])<<4|n[t+1]>>4],o+=chars[(15&n[t+1])<<2|n[t+2]>>6],o+=chars[63&n[t+2]];return r%3==2?o=o.substring(0,o.length-1)+"=":r%3==1&&(o=o.substring(0,o.length-2)+"=="),o};const canvasVarMap=new Map;function variableListFor(e,t){let n=canvasVarMap.get(e);return n||(n=new Map,canvasVarMap.set(e,n)),n.has(t)||n.set(t,[]),n.get(t)}const saveWebGLVar=(e,t,n)=>{if(!e||!isInstanceOfWebGLObject(e,t)&&"object"!=typeof e)return;const r=variableListFor(n,e.constructor.name);let o=r.indexOf(e);return-1===o&&(o=r.length,r.push(e)),o};function serializeArg(e,t,n){if(e instanceof Array)return e.map((e=>serializeArg(e,t,n)));if(null===e)return e;if(e instanceof Float32Array||e instanceof Float64Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Int16Array||e instanceof Int8Array||e instanceof Uint8ClampedArray){return{rr_type:e.constructor.name,args:[Object.values(e)]}}if(e instanceof ArrayBuffer){return{rr_type:e.constructor.name,base64:encode(e)}}if(e instanceof DataView){return{rr_type:e.constructor.name,args:[serializeArg(e.buffer,t,n),e.byteOffset,e.byteLength]}}if(e instanceof HTMLImageElement){const t=e.constructor.name,{src:n}=e;return{rr_type:t,src:n}}if(e instanceof HTMLCanvasElement){return{rr_type:"HTMLImageElement",src:e.toDataURL()}}if(e instanceof ImageData){return{rr_type:e.constructor.name,args:[serializeArg(e.data,t,n),e.width,e.height]}}if(isInstanceOfWebGLObject(e,t)||"object"==typeof e){return{rr_type:e.constructor.name,index:saveWebGLVar(e,t,n)}}return e}const serializeArgs=(e,t,n)=>e.map((e=>serializeArg(e,t,n))),isInstanceOfWebGLObject=(e,t)=>{const n=["WebGLActiveInfo","WebGLBuffer","WebGLFramebuffer","WebGLProgram","WebGLRenderbuffer","WebGLShader","WebGLShaderPrecisionFormat","WebGLTexture","WebGLUniformLocation","WebGLVertexArrayObject","WebGLVertexArrayObjectOES"].filter((e=>"function"==typeof t[e]));return Boolean(n.find((n=>e instanceof t[n])))};function initCanvas2DMutationObserver(e,t,n,r,o){const a=[],i=Object.getOwnPropertyNames(t.CanvasRenderingContext2D.prototype);for(const s of i)try{if("function"!=typeof t.CanvasRenderingContext2D.prototype[s])continue;const i=patch(t.CanvasRenderingContext2D.prototype,s,(function(a){return function(...i){return isBlocked(this.canvas,n,r,o,!0)||setTimeout$1((()=>{const n=serializeArgs(i,t,this);e(this.canvas,{type:CanvasContext["2D"],property:s,args:n})}),0),a.apply(this,i)}}));a.push(i)}catch(n){const r=hookSetter(t.CanvasRenderingContext2D.prototype,s,{set(t){e(this.canvas,{type:CanvasContext["2D"],property:s,args:[t],setter:!0})}});a.push(r)}return()=>{a.forEach((e=>e()))}}function getNormalizedContextName(e){return"experimental-webgl"===e?"webgl":e}function initCanvasContextObserver(e,t,n,r,o){const a=[];try{const i=patch(e.HTMLCanvasElement.prototype,"getContext",(function(e){return function(a,...i){if(!isBlocked(this,t,n,r,!0)){const e=getNormalizedContextName(a);if("__context"in this||(this.__context=e),o&&["webgl","webgl2"].includes(e))if(i[0]&&"object"==typeof i[0]){const e=i[0];e.preserveDrawingBuffer||(e.preserveDrawingBuffer=!0)}else i.splice(0,1,{preserveDrawingBuffer:!0})}return e.apply(this,[a,...i])}}));a.push(i)}catch(e){console.error("failed to patch HTMLCanvasElement.prototype.getContext")}return()=>{a.forEach((e=>e()))}}function patchGLPrototype(e,t,n,r,o,a,i,s){const c=[],l=Object.getOwnPropertyNames(e);for(const i of l)if(!["isContextLost","canvas","drawingBufferWidth","drawingBufferHeight"].includes(i))try{if("function"!=typeof e[i])continue;const l=patch(e,i,(function(e){return function(...c){const l=e.apply(this,c);if(saveWebGLVar(l,s,this),"tagName"in this.canvas&&!isBlocked(this.canvas,r,o,a,!0)){const e=serializeArgs(c,s,this),r={type:t,property:i,args:e};n(this.canvas,r)}return l}}));c.push(l)}catch(r){const o=hookSetter(e,i,{set(e){n(this.canvas,{type:t,property:i,args:[e],setter:!0})}});c.push(o)}return c}function initCanvasWebGLMutationObserver(e,t,n,r,o,a){const i=[];return i.push(...patchGLPrototype(t.WebGLRenderingContext.prototype,CanvasContext.WebGL,e,n,r,o,a,t)),void 0!==t.WebGL2RenderingContext&&i.push(...patchGLPrototype(t.WebGL2RenderingContext.prototype,CanvasContext.WebGL2,e,n,r,o,a,t)),()=>{i.forEach((e=>e()))}}var r='for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t="undefined"==typeof Uint8Array?[]:new Uint8Array(256),a=0;a<64;a++)t[e.charCodeAt(a)]=a;var n=function(t){var a,n=new Uint8Array(t),r=n.length,s="";for(a=0;a<r;a+=3)s+=e[n[a]>>2],s+=e[(3&n[a])<<4|n[a+1]>>4],s+=e[(15&n[a+1])<<2|n[a+2]>>6],s+=e[63&n[a+2]];return r%3==2?s=s.substring(0,s.length-1)+"=":r%3==1&&(s=s.substring(0,s.length-2)+"=="),s};const r=new Map,s=new Map;const i=self;i.onmessage=async function(e){if(!("OffscreenCanvas"in globalThis))return i.postMessage({id:e.data.id});{const{id:t,bitmap:a,width:o,height:f,maxCanvasSize:c,dataURLOptions:g}=e.data,u=async function(e,t,a){const r=e+"-"+t;if("OffscreenCanvas"in globalThis){if(s.has(r))return s.get(r);const i=new OffscreenCanvas(e,t);i.getContext("2d");const o=await i.convertToBlob(a),f=await o.arrayBuffer(),c=n(f);return s.set(r,c),c}return""}(o,f,g),[h,d]=function(e,t,a){if(!a)return[e,t];const[n,r]=a;if(e<=n&&t<=r)return[e,t];let s=e,i=t;return s>n&&(i=Math.floor(n*t/e),s=n),i>r&&(s=Math.floor(r*e/t),i=r),[s,i]}(o,f,c),l=new OffscreenCanvas(h,d),w=l.getContext("bitmaprenderer"),p=h===o&&d===f?a:await createImageBitmap(a,{resizeWidth:h,resizeHeight:d,resizeQuality:"low"});w.transferFromImageBitmap(p),a.close();const y=await l.convertToBlob(g),v=y.type,b=await y.arrayBuffer(),m=n(b);if(p.close(),!r.has(t)&&await u===m)return r.set(t,m),i.postMessage({id:t});if(r.get(t)===m)return i.postMessage({id:t});i.postMessage({id:t,type:v,base64:m,width:o,height:f}),r.set(t,m)}};';function t(){const e=new Blob([r]);return URL.createObjectURL(e)}class CanvasManager{reset(){this.pendingCanvasMutations.clear(),this.resetObservers&&this.resetObservers()}freeze(){this.frozen=!0}unfreeze(){this.frozen=!1}lock(){this.locked=!0}unlock(){this.locked=!1}constructor(e){this.pendingCanvasMutations=new Map,this.rafStamps={latestId:0,invokeId:null},this.frozen=!1,this.locked=!1,this.processMutation=(e,t)=>{!(this.rafStamps.invokeId&&this.rafStamps.latestId!==this.rafStamps.invokeId)&&this.rafStamps.invokeId||(this.rafStamps.invokeId=this.rafStamps.latestId),this.pendingCanvasMutations.has(e)||this.pendingCanvasMutations.set(e,[]),this.pendingCanvasMutations.get(e).push(t)};const{sampling:t="all",win:n,blockClass:r,blockSelector:o,unblockSelector:a,maxCanvasSize:i,recordCanvas:s,dataURLOptions:c,errorHandler:l}=e;this.mutationCb=e.mutationCb,this.mirror=e.mirror,this.options=e,l&&registerErrorHandler(l),e.enableManualSnapshot||callbackWrapper((()=>{s&&"all"===t&&this.initCanvasMutationObserver(n,r,o,a),s&&"number"==typeof t&&this.initCanvasFPSObserver(t,n,r,o,a,i,{dataURLOptions:c})}))()}initCanvasFPSObserver(e,t,n,r,o,a,i){const s=initCanvasContextObserver(t,n,r,o,!0),c=this.takeSnapshot(!1,e,t,n,r,o,a,i.dataURLOptions);this.resetObservers=()=>{s(),cancelAnimationFrame(c)}}initCanvasMutationObserver(e,t,n,r){this.startRAFTimestamping(),this.startPendingCanvasMutationFlusher();const o=initCanvasContextObserver(e,t,n,r,!1),a=initCanvas2DMutationObserver(this.processMutation.bind(this),e,t,n,r),i=initCanvasWebGLMutationObserver(this.processMutation.bind(this),e,t,n,r,this.mirror);this.resetObservers=()=>{o(),a(),i()}}snapshot(e){const{options:t}=this,n=this.takeSnapshot(!0,"all"===t.sampling?2:t.sampling||2,t.win,t.blockClass,t.blockSelector,t.unblockSelector,t.maxCanvasSize,t.dataURLOptions,e);this.resetObservers=()=>{cancelAnimationFrame(n)}}takeSnapshot(e,n,r,o,a,i,s,c,l){const u=new Map,d=new Worker(t());d.onmessage=e=>{const t=e.data,{id:n}=t;if(u.set(n,!1),!("base64"in t))return;const{base64:r,type:o,width:a,height:i}=t;this.mutationCb({id:n,type:CanvasContext["2D"],commands:[{property:"clearRect",args:[0,0,a,i]},{property:"drawImage",args:[{rr_type:"ImageBitmap",args:[{rr_type:"Blob",data:[{rr_type:"ArrayBuffer",base64:r}],type:o}]},0,0,a,i]}]})};const p=1e3/n;let g,h=0;const f=t=>{h&&t-h<p||(h=t,(e=>{if(e)return[e];const t=[];return r.document.querySelectorAll("canvas").forEach((e=>{isBlocked(e,o,a,i,!0)||t.push(e)})),t})(l).forEach((t=>{const n=this.mirror.getId(t);if(!u.get(n)&&t.width&&t.height){if(u.set(n,!0),!e&&["webgl","webgl2"].includes(t.__context)){const e=t.getContext(t.__context);!1===_optionalChain([e,"optionalAccess",e=>e.getContextAttributes,"call",e=>e(),"optionalAccess",e=>e.preserveDrawingBuffer])&&e.clear(e.COLOR_BUFFER_BIT)}createImageBitmap(t).then((e=>{d.postMessage({id:n,bitmap:e,width:t.width,height:t.height,dataURLOptions:c,maxCanvasSize:s},[e])})).catch((e=>{callbackWrapper((()=>{throw e}))()}))}}))),g=onRequestAnimationFrame(f)};return g=onRequestAnimationFrame(f),g}startPendingCanvasMutationFlusher(){onRequestAnimationFrame((()=>this.flushPendingCanvasMutations()))}startRAFTimestamping(){const e=t=>{this.rafStamps.latestId=t,onRequestAnimationFrame(e)};onRequestAnimationFrame(e)}flushPendingCanvasMutations(){this.pendingCanvasMutations.forEach(((e,t)=>{const n=this.mirror.getId(t);this.flushPendingCanvasMutationFor(t,n)})),onRequestAnimationFrame((()=>this.flushPendingCanvasMutations()))}flushPendingCanvasMutationFor(e,t){if(this.frozen||this.locked)return;const n=this.pendingCanvasMutations.get(e);if(!n||-1===t)return;const r=n.map((e=>{const{type:t,...n}=e;return n})),{type:o}=n[0];this.mutationCb({id:t,type:o,commands:r}),this.pendingCanvasMutations.delete(e)}}const CANVAS_QUALITY={low:{sampling:{canvas:1},dataURLOptions:{type:"image/webp",quality:.25}},medium:{sampling:{canvas:2},dataURLOptions:{type:"image/webp",quality:.4}},high:{sampling:{canvas:4},dataURLOptions:{type:"image/webp",quality:.5}}},INTEGRATION_NAME$b="ReplayCanvas",DEFAULT_MAX_CANVAS_SIZE=1280,_replayCanvasIntegration=(e={})=>{const[t,n]=e.maxCanvasSize||[],r={quality:e.quality||"medium",enableManualSnapshot:e.enableManualSnapshot,maxCanvasSize:[t?Math.min(t,DEFAULT_MAX_CANVAS_SIZE):DEFAULT_MAX_CANVAS_SIZE,n?Math.min(n,DEFAULT_MAX_CANVAS_SIZE):DEFAULT_MAX_CANVAS_SIZE]};let o;const a=new Promise((e=>o=e));return{name:INTEGRATION_NAME$b,setupOnce(){},getOptions(){const{quality:e,enableManualSnapshot:t,maxCanvasSize:n}=r;return{enableManualSnapshot:t,recordCanvas:!0,getCanvasManager:e=>{const r=new CanvasManager({...e,enableManualSnapshot:t,maxCanvasSize:n,errorHandler:e=>{try{"object"==typeof e&&(e.__rrweb__=!0)}catch(e){}}});return o(r),r},...CANVAS_QUALITY[e||"medium"]||CANVAS_QUALITY.medium}},async snapshot(e){(await a).snapshot(e)}}},replayCanvasIntegration=defineIntegration(_replayCanvasIntegration),ReplayCanvas=convertIntegrationFnToClass(INTEGRATION_NAME$b,replayCanvasIntegration),WINDOW$3=GLOBAL_OBJ,LIGHT_BACKGROUND="#ffffff",INHERIT="inherit",SUBMIT_COLOR="rgba(108, 95, 199, 1)",LIGHT_THEME={fontFamily:"system-ui, 'Helvetica Neue', Arial, sans-serif",fontSize:"14px",background:LIGHT_BACKGROUND,backgroundHover:"#f6f6f7",foreground:"#2b2233",border:"1.5px solid rgba(41, 35, 47, 0.13)",borderRadius:"25px",boxShadow:"0px 4px 24px 0px rgba(43, 34, 51, 0.12)",success:"#268d75",error:"#df3338",submitBackground:"rgba(88, 74, 192, 1)",submitBackgroundHover:SUBMIT_COLOR,submitBorder:SUBMIT_COLOR,submitOutlineFocus:"#29232f",submitForeground:LIGHT_BACKGROUND,submitForegroundHover:LIGHT_BACKGROUND,cancelBackground:"transparent",cancelBackgroundHover:"var(--background-hover)",cancelBorder:"var(--border)",cancelOutlineFocus:"var(--input-outline-focus)",cancelForeground:"var(--foreground)",cancelForegroundHover:"var(--foreground)",inputBackground:INHERIT,inputForeground:INHERIT,inputBorder:"var(--border)",inputOutlineFocus:SUBMIT_COLOR,formBorderRadius:"20px",formContentBorderRadius:"6px"},DEFAULT_THEME={light:LIGHT_THEME,dark:{...LIGHT_THEME,background:"#29232f",backgroundHover:"#352f3b",foreground:"#ebe6ef",border:"1.5px solid rgba(235, 230, 239, 0.15)",success:"#2da98c",error:"#f55459"}},ACTOR_LABEL="Report a Bug",CANCEL_BUTTON_LABEL="Cancel",SUBMIT_BUTTON_LABEL="Send Bug Report",FORM_TITLE="Report a Bug",EMAIL_PLACEHOLDER="your.email@example.org",EMAIL_LABEL="Email",MESSAGE_PLACEHOLDER="What's the bug? What did you expect?",MESSAGE_LABEL="Description",NAME_PLACEHOLDER="Your Name",NAME_LABEL="Name",IS_REQUIRED_LABEL="(required)",SUCCESS_MESSAGE_TEXT="Thank you for your report!",FEEDBACK_WIDGET_SOURCE="widget",FEEDBACK_API_SOURCE="api";async function prepareFeedbackEvent({client:e,scope:t,event:n}){const r={};e.emit&&e.emit("preprocessEvent",n,r);const o=await prepareEvent(e.getOptions(),n,r,t,e,getIsolationScope());return null===o?(e.recordDroppedEvent("event_processor","feedback",n),null):(o.platform=o.platform||"javascript",o)}async function sendFeedbackRequest({feedback:{message:e,email:t,name:n,source:r,url:o}},{includeReplay:a=!0}={}){const i=getClient(),s=i&&i.getTransport(),c=i&&i.getDsn();if(!i||!s||!c)return;const l={contexts:{feedback:{contact_email:t,name:n,message:e,url:o,source:r}},type:"feedback"};return withScope((async e=>{e.clearBreadcrumbs(),[FEEDBACK_API_SOURCE,FEEDBACK_WIDGET_SOURCE].includes(String(r))&&e.setLevel("info");const t=await prepareFeedbackEvent({scope:e,client:i,event:l});if(!t)return;i.emit&&i.emit("beforeSendFeedback",t,{includeReplay:Boolean(a)});const n=createEventEnvelope(t,c,i.getOptions()._metadata,i.getOptions().tunnel);let o;try{o=await s.send(n)}catch(e){const t=new Error("Unable to send Feedback");try{t.cause=e}catch(e){}throw t}if(o){if("number"==typeof o.statusCode&&(o.statusCode<200||o.statusCode>=300))throw new Error("Unable to send Feedback");return o}}))}function sendFeedback({name:e,email:t,message:n,source:r=FEEDBACK_API_SOURCE,url:o=getLocationHref()},a={}){if(!n)throw new Error("Unable to submit feedback with empty message");return sendFeedbackRequest({feedback:{name:e,email:t,message:n,url:o,source:r}},a)}const DEBUG_BUILD$1="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__;function mergeOptions(e,t){return{...e,...t,themeDark:{...e.themeDark,...t.themeDark},themeLight:{...e.themeLight,...t.themeLight}}}function createActorStyles(e){const t=e.createElement("style");return t.textContent="\n.widget__actor {\n  position: fixed;\n  left: var(--left);\n  right: var(--right);\n  bottom: var(--bottom);\n  top: var(--top);\n  z-index: var(--z-index);\n\n  line-height: 16px;\n\n  display: flex;\n  align-items: center;\n  gap: 8px;\n\n  border-radius: var(--border-radius);\n  cursor: pointer;\n  font-family: inherit;\n  font-size: var(--font-size);\n  font-weight: 600;\n  padding: 16px;\n  text-decoration: none;\n  z-index: 9000;\n\n  color: var(--foreground);\n  background-color: var(--background);\n  border: var(--border);\n  box-shadow: var(--box-shadow);\n  opacity: 1;\n  transition: opacity 0.1s ease-in-out;\n}\n\n.widget__actor:hover {\n  background-color: var(--background-hover);\n}\n\n.widget__actor svg {\n  width: 16px;\n  height: 16px;\n}\n\n.widget__actor--hidden {\n  opacity: 0;\n  pointer-events: none;\n  visibility: hidden;\n}\n\n.widget__actor__text {\n}\n\n@media (max-width: 600px) {\n  .widget__actor__text {\n    display: none;\n  }\n}\n\n.feedback-icon path {\n  fill: var(--foreground);\n}\n",t}function createDialogStyles(e){const t=e.createElement("style");return t.textContent="\n.dialog {\n  line-height: 25px;\n  background-color: rgba(0, 0, 0, 0.05);\n  border: none;\n  position: fixed;\n  inset: 0;\n  z-index: 10000;\n  width: 100vw;\n  height: 100vh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  opacity: 1;\n  transition: opacity 0.2s ease-in-out;\n}\n\n.dialog:not([open]) {\n  opacity: 0;\n  pointer-events: none;\n  visibility: hidden;\n}\n.dialog:not([open]) .dialog__content {\n  transform: translate(0, -16px) scale(0.98);\n}\n\n.dialog__content {\n  position: fixed;\n  left: var(--left);\n  right: var(--right);\n  bottom: var(--bottom);\n  top: var(--top);\n\n  border: var(--border);\n  border-radius: var(--form-border-radius);\n  background-color: var(--background);\n  color: var(--foreground);\n\n  width: 320px;\n  max-width: 100%;\n  max-height: calc(100% - 2rem);\n  display: flex;\n  flex-direction: column;\n  box-shadow: var(--box-shadow);\n  transition: transform 0.2s ease-in-out;\n  transform: translate(0, 0) scale(1);\n}\n\n.dialog__header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  font-size: 20px;\n  font-weight: 600;\n  padding: 24px 24px 0 24px;\n  margin: 0;\n  margin-bottom: 16px;\n}\n\n.brand-link {\n  display: inline-flex;\n}\n\n.error {\n  color: var(--error);\n  margin-bottom: 16px;\n}\n\n.form {\n  display: grid;\n  overflow: auto;\n  flex-direction: column;\n  gap: 16px;\n  padding: 0 24px 24px;\n}\n\n.form__error-container {\n  color: var(--error);\n}\n\n.form__error-container--hidden {\n  display: none;\n}\n\n.form__label {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n  margin: 0px;\n}\n\n.form__label__text {\n  display: grid;\n  gap: 4px;\n  align-items: center;\n  grid-auto-flow: column;\n  grid-auto-columns: max-content;\n}\n\n.form__label__text--required {\n  font-size: 0.85em;\n}\n\n.form__input {\n  line-height: inherit;\n  background-color: var(--input-background);\n  box-sizing: border-box;\n  border: var(--input-border);\n  border-radius: var(--form-content-border-radius);\n  color: var(--input-foreground);\n  font-family: inherit;\n  font-size: var(--font-size);\n  font-weight: 500;\n  padding: 6px 12px;\n}\n\n.form__input::placeholder {\n  color: var(--input-foreground);\n  opacity: 0.65;\n}\n\n.form__input:focus-visible {\n  outline: 1px auto var(--input-outline-focus);\n}\n\n.form__input--textarea {\n  font-family: inherit;\n  resize: vertical;\n}\n\n.btn-group {\n  display: grid;\n  gap: 8px;\n  margin-top: 8px;\n}\n\n.btn {\n  line-height: inherit;\n  border: var(--cancel-border);\n  border-radius: var(--form-content-border-radius);\n  cursor: pointer;\n  font-family: inherit;\n  font-size: var(--font-size);\n  font-weight: 600;\n  padding: 6px 16px;\n}\n.btn[disabled] {\n  opacity: 0.6;\n  pointer-events: none;\n}\n\n.btn--primary {\n  background-color: var(--submit-background);\n  border-color: var(--submit-border);\n  color: var(--submit-foreground);\n}\n.btn--primary:hover {\n  background-color: var(--submit-background-hover);\n  color: var(--submit-foreground-hover);\n}\n.btn--primary:focus-visible {\n  outline: 1px auto var(--submit-outline-focus);\n}\n\n.btn--default {\n  background-color: var(--cancel-background);\n  color: var(--cancel-foreground);\n  font-weight: 500;\n}\n.btn--default:hover {\n  background-color: var(--cancel-background-hover);\n  color: var(--cancel-foreground-hover);\n}\n.btn--default:focus-visible {\n  outline: 1px auto var(--cancel-outline-focus);\n}\n\n.success-message {\n  background-color: var(--background);\n  border: var(--border);\n  border-radius: var(--border-radius);\n  box-shadow: var(--box-shadow);\n  font-weight: 600;\n  color: var(--success);\n  padding: 12px 24px;\n  line-height: 25px;\n  display: grid;\n  align-items: center;\n  grid-auto-flow: column;\n  gap: 6px;\n  cursor: default;\n}\n\n.success-icon path {\n  fill: var(--success);\n}\n",t}function getThemedCssVariables(e){return`\n  --background: ${e.background};\n  --background-hover: ${e.backgroundHover};\n  --foreground: ${e.foreground};\n  --error: ${e.error};\n  --success: ${e.success};\n  --border: ${e.border};\n  --border-radius: ${e.borderRadius};\n  --box-shadow: ${e.boxShadow};\n\n  --submit-background: ${e.submitBackground};\n  --submit-background-hover: ${e.submitBackgroundHover};\n  --submit-border: ${e.submitBorder};\n  --submit-outline-focus: ${e.submitOutlineFocus};\n  --submit-foreground: ${e.submitForeground};\n  --submit-foreground-hover: ${e.submitForegroundHover};\n\n  --cancel-background: ${e.cancelBackground};\n  --cancel-background-hover: ${e.cancelBackgroundHover};\n  --cancel-border: ${e.cancelBorder};\n  --cancel-outline-focus: ${e.cancelOutlineFocus};\n  --cancel-foreground: ${e.cancelForeground};\n  --cancel-foreground-hover: ${e.cancelForegroundHover};\n\n  --input-background: ${e.inputBackground};\n  --input-foreground: ${e.inputForeground};\n  --input-border: ${e.inputBorder};\n  --input-outline-focus: ${e.inputOutlineFocus};\n\n  --form-border-radius: ${e.formBorderRadius};\n  --form-content-border-radius: ${e.formContentBorderRadius};\n  `}function createMainStyles(e,t,n){const r=e.createElement("style");return r.textContent=`\n:host {\n  --bottom: 1rem;\n  --right: 1rem;\n  --top: auto;\n  --left: auto;\n  --z-index: 100000;\n  --font-family: ${n.light.fontFamily};\n  --font-size: ${n.light.fontSize};\n\n  position: fixed;\n  left: var(--left);\n  right: var(--right);\n  bottom: var(--bottom);\n  top: var(--top);\n  z-index: var(--z-index);\n\n  font-family: var(--font-family);\n  font-size: var(--font-size);\n\n  ${getThemedCssVariables("dark"===t?n.dark:n.light)}\n}\n\n${"system"===t?`\n@media (prefers-color-scheme: dark) {\n  :host {\n    ${getThemedCssVariables(n.dark)}\n  }\n}`:""}\n}`,r}function createShadowHost({id:e,colorScheme:t,themeDark:n,themeLight:r}){try{const o=WINDOW$3.document,a=o.createElement("div");a.id=e;const i=a.attachShadow({mode:"open"});return i.appendChild(createMainStyles(o,t,{dark:n,light:r})),i.appendChild(createDialogStyles(o)),{shadow:i,host:a}}catch(e){throw logger.warn("[Feedback] Browser does not support shadow DOM API"),new Error("Browser does not support shadow DOM API.")}}async function handleFeedbackSubmit(e,t,n){if(!e)return;e.hideError();try{return await sendFeedback({...t,source:FEEDBACK_WIDGET_SOURCE},n)}catch(t){DEBUG_BUILD$1&&logger.error(t),e&&e.showError("There was a problem submitting feedback, please wait and try again.")}}function setAttributesNS(e,t){return Object.entries(t).forEach((([t,n])=>{e.setAttributeNS(null,t,n)})),e}const SIZE=20,XMLNS$2="http://www.w3.org/2000/svg";function Icon(){const e=e=>WINDOW$3.document.createElementNS(XMLNS$2,e),t=setAttributesNS(e("svg"),{class:"feedback-icon",width:`${SIZE}`,height:`${SIZE}`,viewBox:`0 0 ${SIZE} ${SIZE}`,fill:"none"}),n=setAttributesNS(e("g"),{clipPath:"url(#clip0_57_80)"}),r=setAttributesNS(e("path"),{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M15.6622 15H12.3997C12.2129 14.9959 12.031 14.9396 11.8747 14.8375L8.04965 12.2H7.49956V19.1C7.4875 19.3348 7.3888 19.5568 7.22256 19.723C7.05632 19.8892 6.83435 19.9879 6.59956 20H2.04956C1.80193 19.9968 1.56535 19.8969 1.39023 19.7218C1.21511 19.5467 1.1153 19.3101 1.11206 19.0625V12.2H0.949652C0.824431 12.2017 0.700142 12.1783 0.584123 12.1311C0.468104 12.084 0.362708 12.014 0.274155 11.9255C0.185602 11.8369 0.115689 11.7315 0.0685419 11.6155C0.0213952 11.4995 -0.00202913 11.3752 -0.00034808 11.25V3.75C-0.00900498 3.62067 0.0092504 3.49095 0.0532651 3.36904C0.0972798 3.24712 0.166097 3.13566 0.255372 3.04168C0.344646 2.94771 0.452437 2.87327 0.571937 2.82307C0.691437 2.77286 0.82005 2.74798 0.949652 2.75H8.04965L11.8747 0.1625C12.031 0.0603649 12.2129 0.00407221 12.3997 0H15.6622C15.9098 0.00323746 16.1464 0.103049 16.3215 0.278167C16.4966 0.453286 16.5964 0.689866 16.5997 0.9375V3.25269C17.3969 3.42959 18.1345 3.83026 18.7211 4.41679C19.5322 5.22788 19.9878 6.32796 19.9878 7.47502C19.9878 8.62209 19.5322 9.72217 18.7211 10.5333C18.1345 11.1198 17.3969 11.5205 16.5997 11.6974V14.0125C16.6047 14.1393 16.5842 14.2659 16.5395 14.3847C16.4948 14.5035 16.4268 14.6121 16.3394 14.7042C16.252 14.7962 16.147 14.8698 16.0307 14.9206C15.9144 14.9714 15.7891 14.9984 15.6622 15ZM1.89695 10.325H1.88715V4.625H8.33715C8.52423 4.62301 8.70666 4.56654 8.86215 4.4625L12.6872 1.875H14.7247V13.125H12.6872L8.86215 10.4875C8.70666 10.3835 8.52423 10.327 8.33715 10.325H2.20217C2.15205 10.3167 2.10102 10.3125 2.04956 10.3125C1.9981 10.3125 1.94708 10.3167 1.89695 10.325ZM2.98706 12.2V18.1625H5.66206V12.2H2.98706ZM16.5997 9.93612V5.01393C16.6536 5.02355 16.7072 5.03495 16.7605 5.04814C17.1202 5.13709 17.4556 5.30487 17.7425 5.53934C18.0293 5.77381 18.2605 6.06912 18.4192 6.40389C18.578 6.73866 18.6603 7.10452 18.6603 7.47502C18.6603 7.84552 18.578 8.21139 18.4192 8.54616C18.2605 8.88093 18.0293 9.17624 17.7425 9.41071C17.4556 9.64518 17.1202 9.81296 16.7605 9.90191C16.7072 9.91509 16.6536 9.9265 16.5997 9.93612Z"});t.appendChild(n).appendChild(r);const o=e("defs"),a=setAttributesNS(e("clipPath"),{id:"clip0_57_80"}),i=setAttributesNS(e("rect"),{width:`${SIZE}`,height:`${SIZE}`,fill:"white"});return a.appendChild(i),o.appendChild(a),t.appendChild(o).appendChild(a).appendChild(i),{get el(){return t}}}function createElement(e,t,...n){const r=WINDOW$3.document.createElement(e);t&&Object.entries(t).forEach((([e,t])=>{"className"===e&&"string"==typeof t?r.setAttribute("class",t):"boolean"==typeof t&&t?r.setAttribute(e,""):"string"==typeof t?r.setAttribute(e,t):e.startsWith("on")&&"function"==typeof t&&r.addEventListener(e.substring(2).toLowerCase(),t)}));for(const e of n)appendChild(r,e);return r}function appendChild(e,t){const n=WINDOW$3.document;if(null!=t)if(Array.isArray(t))for(const n of t)appendChild(e,n);else!1===t||("string"==typeof t?e.appendChild(n.createTextNode(t)):t instanceof Node?e.appendChild(t):e.appendChild(n.createTextNode(String(t))))}function Actor({buttonLabel:e,onClick:t}){const n=createElement("button",{type:"button",className:"widget__actor","aria-label":e,"aria-hidden":"false"},Icon().el,e?createElement("span",{className:"widget__actor__text"},e):null);return n.addEventListener("click",(function(e){t&&t(e)})),{get el(){return n},show:()=>{n.classList.remove("widget__actor--hidden"),n.setAttribute("aria-hidden","false")},hide:()=>{n.classList.add("widget__actor--hidden"),n.setAttribute("aria-hidden","true")}}}function SubmitButton({label:e}){return{el:createElement("button",{type:"submit",className:"btn btn--primary","aria-label":e},e)}}function retrieveStringValue(e,t){const n=e.get(t);return"string"==typeof n?n.trim():""}function Form({nameLabel:e,namePlaceholder:t,emailLabel:n,emailPlaceholder:r,messageLabel:o,messagePlaceholder:a,isRequiredLabel:i,cancelButtonLabel:s,submitButtonLabel:c,showName:l,showEmail:u,isNameRequired:d,isEmailRequired:p,defaultName:g,defaultEmail:h,onCancel:f,onSubmit:m}){const{el:_}=SubmitButton({label:c});const E=createElement("div",{className:"form__error-container form__error-container--hidden","aria-hidden":"true"});const T=createElement("input",{id:"name",type:l?"text":"hidden","aria-hidden":l?"false":"true",name:"name",required:d,className:"form__input",placeholder:t,value:g}),S=createElement("input",{id:"email",type:u?"text":"hidden","aria-hidden":u?"false":"true",name:"email",required:p,className:"form__input",placeholder:r,value:h}),y=createElement("textarea",{id:"message",autoFocus:"true",rows:"5",name:"message",required:!0,className:"form__input form__input--textarea",placeholder:a}),v=createElement("button",{type:"button",className:"btn btn--default","aria-label":s,onClick:e=>{f&&f(e)}},s),I=createElement("form",{className:"form",onSubmit:function(e){if(e.preventDefault(),e.target instanceof HTMLFormElement)try{if(m){const t=new FormData(e.target),n={name:retrieveStringValue(t,"name"),email:retrieveStringValue(t,"email"),message:retrieveStringValue(t,"message")};m(n)}}catch(e){}}},[E,l&&createElement("label",{htmlFor:"name",className:"form__label"},[createElement("span",{className:"form__label__text"},e,d&&createElement("span",{className:"form__label__text--required"},` ${i}`)),T]),!l&&T,u&&createElement("label",{htmlFor:"email",className:"form__label"},[createElement("span",{className:"form__label__text"},n,p&&createElement("span",{className:"form__label__text--required"},` ${i}`)),S]),!u&&S,createElement("label",{htmlFor:"message",className:"form__label"},[createElement("span",{className:"form__label__text"},o,createElement("span",{className:"form__label__text--required"},` ${i}`)),y]),createElement("div",{className:"btn-group"},[_,v])]);return{get el(){return I},showError:function(e){E.textContent=e,E.classList.remove("form__error-container--hidden"),E.setAttribute("aria-hidden","false")},hideError:function(){E.textContent="",E.classList.add("form__error-container--hidden"),E.setAttribute("aria-hidden","true")}}}const XMLNS$1="http://www.w3.org/2000/svg";function Logo({colorScheme:e}){const t=e=>WINDOW$3.document.createElementNS(XMLNS$1,e),n=setAttributesNS(t("svg"),{class:"sentry-logo",width:"32",height:"30",viewBox:"0 0 72 66",fill:"none"}),r=setAttributesNS(t("path"),{transform:"translate(11, 11)",d:"M29,2.26a4.67,4.67,0,0,0-8,0L14.42,13.53A32.21,32.21,0,0,1,32.17,40.19H27.55A27.68,27.68,0,0,0,12.09,17.47L6,28a15.92,15.92,0,0,1,9.23,12.17H4.62A.76.76,0,0,1,4,39.06l2.94-5a10.74,10.74,0,0,0-3.36-1.9l-2.91,5a4.54,4.54,0,0,0,1.69,6.24A4.66,4.66,0,0,0,4.62,44H19.15a19.4,19.4,0,0,0-8-17.31l2.31-4A23.87,23.87,0,0,1,23.76,44H36.07a35.88,35.88,0,0,0-16.41-31.8l4.67-8a.77.77,0,0,1,1.05-.27c.53.29,20.29,34.77,20.66,35.17a.76.76,0,0,1-.68,1.13H40.6q.09,1.91,0,3.81h4.78A4.59,4.59,0,0,0,50,39.43a4.49,4.49,0,0,0-.62-2.28Z"});n.append(r);const o=t("defs"),a=t("style");return a.textContent=`\n    path {\n      fill: ${"dark"===e?"#fff":"#362d59"};\n    }`,"system"===e&&(a.textContent+="\n    @media (prefers-color-scheme: dark) {\n      path: {\n        fill: '#fff';\n      }\n    }\n    "),o.append(a),n.append(o),{get el(){return n}}}function Dialog({formTitle:e,showBranding:t,showName:n,showEmail:r,isNameRequired:o,isEmailRequired:a,colorScheme:i,defaultName:s,defaultEmail:c,onClosed:l,onCancel:u,onSubmit:d,...p}){let g=null;function h(){g&&(g.open=!1)}const{el:f,showError:m,hideError:_}=Form({showEmail:r,showName:n,isEmailRequired:a,isNameRequired:o,defaultName:s,defaultEmail:c,onSubmit:d,onCancel:u,...p});return g=createElement("dialog",{className:"dialog",open:!0,onClick:function(){h(),l&&l()}},createElement("div",{className:"dialog__content",onClick:e=>{e.stopPropagation()}},createElement("h2",{className:"dialog__header"},e,t&&createElement("a",{className:"brand-link",target:"_blank",href:"https://sentry.io/welcome/",title:"Powered by Sentry",rel:"noopener noreferrer"},Logo({colorScheme:i}).el)),f)),{get el(){return g},showError:m,hideError:_,open:function(){g&&(g.open=!0)},close:h,checkIsOpen:function(){return g&&!0===g.open||!1}}}const WIDTH=16,HEIGHT=17,XMLNS="http://www.w3.org/2000/svg";function SuccessIcon(){const e=e=>WINDOW$3.document.createElementNS(XMLNS,e),t=setAttributesNS(e("svg"),{class:"success-icon",width:`${WIDTH}`,height:`${HEIGHT}`,viewBox:`0 0 ${WIDTH} ${HEIGHT}`,fill:"none"}),n=setAttributesNS(e("g"),{clipPath:"url(#clip0_57_156)"}),r=setAttributesNS(e("path"),{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M3.55544 15.1518C4.87103 16.0308 6.41775 16.5 8 16.5C10.1217 16.5 12.1566 15.6571 13.6569 14.1569C15.1571 12.6566 16 10.6217 16 8.5C16 6.91775 15.5308 5.37103 14.6518 4.05544C13.7727 2.73985 12.5233 1.71447 11.0615 1.10897C9.59966 0.503466 7.99113 0.34504 6.43928 0.653721C4.88743 0.962403 3.46197 1.72433 2.34315 2.84315C1.22433 3.96197 0.462403 5.38743 0.153721 6.93928C-0.15496 8.49113 0.00346625 10.0997 0.608967 11.5615C1.21447 13.0233 2.23985 14.2727 3.55544 15.1518ZM4.40546 3.1204C5.46945 2.40946 6.72036 2.03 8 2.03C9.71595 2.03 11.3616 2.71166 12.575 3.92502C13.7883 5.13838 14.47 6.78405 14.47 8.5C14.47 9.77965 14.0905 11.0306 13.3796 12.0945C12.6687 13.1585 11.6582 13.9878 10.476 14.4775C9.29373 14.9672 7.99283 15.0953 6.73777 14.8457C5.48271 14.596 4.32987 13.9798 3.42502 13.075C2.52018 12.1701 1.90397 11.0173 1.65432 9.76224C1.40468 8.50718 1.5328 7.20628 2.0225 6.02404C2.5122 4.8418 3.34148 3.83133 4.40546 3.1204Z"}),o=setAttributesNS(e("path"),{d:"M6.68775 12.4297C6.78586 12.4745 6.89218 12.4984 7 12.5C7.11275 12.4955 7.22315 12.4664 7.32337 12.4145C7.4236 12.3627 7.51121 12.2894 7.58 12.2L12 5.63999C12.0848 5.47724 12.1071 5.28902 12.0625 5.11098C12.0178 4.93294 11.9095 4.77744 11.7579 4.67392C11.6064 4.57041 11.4221 4.52608 11.24 4.54931C11.0579 4.57254 10.8907 4.66173 10.77 4.79999L6.88 10.57L5.13 8.56999C5.06508 8.49566 4.98613 8.43488 4.89768 8.39111C4.80922 8.34735 4.713 8.32148 4.61453 8.31498C4.51605 8.30847 4.41727 8.32147 4.32382 8.35322C4.23038 8.38497 4.14413 8.43484 4.07 8.49999C3.92511 8.63217 3.83692 8.81523 3.82387 9.01092C3.81083 9.2066 3.87393 9.39976 4 9.54999L6.43 12.24C6.50187 12.3204 6.58964 12.385 6.68775 12.4297Z"});t.appendChild(n).append(o,r);const a=e("defs"),i=setAttributesNS(e("clipPath"),{id:"clip0_57_156"}),s=setAttributesNS(e("rect"),{width:`${WIDTH}`,height:`${WIDTH}`,fill:"white",transform:"translate(0 0.5)"});return i.appendChild(s),a.appendChild(i),t.appendChild(a).appendChild(i).appendChild(s),{get el(){return t}}}function SuccessMessage({message:e,onRemove:t}){function n(){r&&(r.remove(),t&&t())}const r=createElement("div",{className:"success-message",onClick:n},SuccessIcon().el,e);return{el:r,remove:n}}function createWidget({shadow:e,options:{shouldCreateActor:t=!0,...n},attachTo:r}){let o,a,i=!1;async function s(t){if(!a)return;const r=[];if(n.isNameRequired&&!t.name&&r.push(n.nameLabel),n.isEmailRequired&&!t.email&&r.push(n.emailLabel),t.message||r.push(n.messageLabel),r.length>0)return void a.showError(`Please enter in the following required fields: ${r.join(", ")}`);await handleFeedbackSubmit(a,t)?(g(),function(){if(e)try{const t=SuccessMessage({message:n.successMessageText,onRemove:()=>{r&&clearTimeout(r),l()}});if(!t.el)throw new Error("Unable to show success message");e.appendChild(t.el);const r=setTimeout((()=>{t&&t.remove()}),5e3)}catch(e){logger.error(e)}}(),n.onSubmitSuccess&&n.onSubmitSuccess()):n.onSubmitError&&n.onSubmitError()}function c(){const e=getClient(),t=e&&e.getIntegrationByName&&e.getIntegrationByName("Replay");t&&t.flush().catch((e=>{DEBUG_BUILD$1&&logger.error(e)}))}function l(){o&&o.show()}function u(){o&&o.hide()}function d(){try{if(a)return a.open(),i=!0,n.onFormOpen&&n.onFormOpen(),void c();const t=n.useSentryUser,r=getCurrentScope(),o=r&&r.getUser();if(a=Dialog({colorScheme:n.colorScheme,showBranding:n.showBranding,showName:n.showName||n.isNameRequired,showEmail:n.showEmail||n.isEmailRequired,isNameRequired:n.isNameRequired,isEmailRequired:n.isEmailRequired,formTitle:n.formTitle,cancelButtonLabel:n.cancelButtonLabel,submitButtonLabel:n.submitButtonLabel,emailLabel:n.emailLabel,emailPlaceholder:n.emailPlaceholder,messageLabel:n.messageLabel,messagePlaceholder:n.messagePlaceholder,nameLabel:n.nameLabel,namePlaceholder:n.namePlaceholder,isRequiredLabel:n.isRequiredLabel,defaultName:t&&o&&o[t.name]||"",defaultEmail:t&&o&&o[t.email]||"",onClosed:()=>{l(),i=!1,n.onFormClose&&n.onFormClose()},onCancel:()=>{p(),l()},onSubmit:s}),!a.el)throw new Error("Unable to open Feedback dialog");e.appendChild(a.el),u(),n.onFormOpen&&n.onFormOpen(),c()}catch(e){logger.error(e)}}function p(){a&&(a.close(),i=!1,n.onFormClose&&n.onFormClose())}function g(){if(a){p();const e=a.el;e&&e.remove(),a=void 0}}function h(){i||d(),u()}return r?r.addEventListener("click",h):t&&(o=Actor({buttonLabel:n.buttonLabel,onClick:h}),o.el&&e.appendChild(o.el)),{get actor(){return o},get dialog(){return a},showActor:l,hideActor:u,removeActor:function(){o&&o.el&&o.el.remove()},openDialog:d,closeDialog:p,removeDialog:g}}const doc=WINDOW$3.document,feedbackIntegration=e=>new Feedback(e);class Feedback{static __initStatic(){this.id="Feedback"}constructor({autoInject:e=!0,id:t="sentry-feedback",isEmailRequired:n=!1,isNameRequired:r=!1,showBranding:o=!0,showEmail:a=!0,showName:i=!0,useSentryUser:s={email:"email",name:"username"},themeDark:c,themeLight:l,colorScheme:u="system",buttonLabel:d=ACTOR_LABEL,cancelButtonLabel:p=CANCEL_BUTTON_LABEL,submitButtonLabel:g=SUBMIT_BUTTON_LABEL,formTitle:h=FORM_TITLE,emailPlaceholder:f=EMAIL_PLACEHOLDER,emailLabel:m=EMAIL_LABEL,messagePlaceholder:_=MESSAGE_PLACEHOLDER,messageLabel:E=MESSAGE_LABEL,namePlaceholder:T=NAME_PLACEHOLDER,nameLabel:S=NAME_LABEL,isRequiredLabel:y=IS_REQUIRED_LABEL,successMessageText:v=SUCCESS_MESSAGE_TEXT,onFormClose:I,onFormOpen:A,onSubmitError:b,onSubmitSuccess:R}={}){this.name=Feedback.id,this._host=null,this._shadow=null,this._widget=null,this._widgets=new Set,this._hasInsertedActorStyles=!1,this.options={autoInject:e,showBranding:o,id:t,isEmailRequired:n,isNameRequired:r,showEmail:a,showName:i,useSentryUser:s,colorScheme:u,themeDark:{...DEFAULT_THEME.dark,...c},themeLight:{...DEFAULT_THEME.light,...l},buttonLabel:d,cancelButtonLabel:p,submitButtonLabel:g,formTitle:h,emailLabel:m,emailPlaceholder:f,messageLabel:E,messagePlaceholder:_,nameLabel:S,namePlaceholder:T,isRequiredLabel:y,successMessageText:v,onFormClose:I,onFormOpen:A,onSubmitError:b,onSubmitSuccess:R}}setupOnce(){if(isBrowser())try{this._cleanupWidgetIfExists();const{autoInject:e}=this.options;if(!e)return;this._createWidget(this.options)}catch(e){DEBUG_BUILD$1&&logger.error(e)}}openDialog(){this._widget||this._createWidget({...this.options,shouldCreateActor:!1}),this._widget&&this._widget.openDialog()}closeDialog(){this._widget&&this._widget.closeDialog()}attachTo(e,t){try{const n=mergeOptions(this.options,t||{});return this._ensureShadowHost(n,(({shadow:t})=>{const r="string"==typeof e?doc.querySelector(e):"function"==typeof e.addEventListener?e:null;if(!r)return DEBUG_BUILD$1&&logger.error("[Feedback] Unable to attach to target element"),null;const o=createWidget({shadow:t,options:n,attachTo:r});return this._widgets.add(o),this._widget||(this._widget=o),o}))}catch(e){return DEBUG_BUILD$1&&logger.error(e),null}}createWidget(e){try{return this._createWidget(mergeOptions(this.options,e||{}))}catch(e){return DEBUG_BUILD$1&&logger.error(e),null}}removeWidget(e){if(!e)return!1;try{if(this._widgets.has(e))return e.removeActor(),e.removeDialog(),this._widgets.delete(e),this._widget===e&&(this._widget=null),!0}catch(e){DEBUG_BUILD$1&&logger.error(e)}return!1}getWidget(){return this._widget}remove(){this._host&&this._host.remove(),this._initialize()}_initialize(){this._host=null,this._shadow=null,this._widget=null,this._widgets=new Set,this._hasInsertedActorStyles=!1}_cleanupWidgetIfExists(){this._host&&this.remove();const e=doc.querySelector(`#${this.options.id}`);e&&e.remove()}_createWidget(e){return this._ensureShadowHost(e,(({shadow:t})=>{const n=createWidget({shadow:t,options:e});return!this._hasInsertedActorStyles&&n.actor&&(t.appendChild(createActorStyles(doc)),this._hasInsertedActorStyles=!0),this._widgets.add(n),this._widget||(this._widget=n),n}))}_ensureShadowHost(e,t){let n=!1;if(!this._shadow||!this._host){const{id:t,colorScheme:r,themeLight:o,themeDark:a}=e,{shadow:i,host:s}=createShadowHost({id:t,colorScheme:r,themeLight:o,themeDark:a});this._shadow=i,this._host=s,n=!0}this._host.dataset.sentryFeedbackColorscheme=e.colorScheme;const r=t({shadow:this._shadow,host:this._host});return n&&doc.body.appendChild(this._host),r}}Feedback.__initStatic();const INTEGRATION_NAME$a="CaptureConsole",_captureConsoleIntegration=(e={})=>{const t=e.levels||CONSOLE_LEVELS;return{name:INTEGRATION_NAME$a,setupOnce(){},setup(e){"console"in GLOBAL_OBJ&&addConsoleInstrumentationHandler((({args:n,level:r})=>{getClient()===e&&t.includes(r)&&consoleHandler(n,r)}))}}},captureConsoleIntegration=defineIntegration(_captureConsoleIntegration);function consoleHandler(e,t){const n={level:severityLevelFromString(t),extra:{arguments:e}};withScope((r=>{if(r.addEventProcessor((e=>(e.logger="console",addExceptionMechanism(e,{handled:!1,type:"console"}),e))),"assert"===t&&!1===e[0]){const t=`Assertion failed: ${safeJoin(e.slice(1)," ")||"console.assert"}`;return r.setExtra("arguments",e.slice(1)),void captureMessage(t,n)}const o=e.find((e=>e instanceof Error));if("error"===t&&o)return void captureException(o,n);captureMessage(safeJoin(e," "),n)}))}convertIntegrationFnToClass(INTEGRATION_NAME$a,captureConsoleIntegration);const INTEGRATION_NAME$9="Debug",_debugIntegration=(e={})=>{const t={debugger:!1,stringify:!1,...e};return{name:INTEGRATION_NAME$9,setupOnce(){},setup(e){e.on&&e.on("beforeSendEvent",((e,n)=>{t.debugger,consoleSandbox((()=>{t.stringify?(console.log(JSON.stringify(e,null,2)),n&&Object.keys(n).length&&console.log(JSON.stringify(n,null,2))):(console.log(e),n&&Object.keys(n).length&&console.log(n))}))}))}}},debugIntegration=defineIntegration(_debugIntegration);convertIntegrationFnToClass(INTEGRATION_NAME$9,debugIntegration);const DEBUG_BUILD="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__,INTEGRATION_NAME$8="Dedupe",_dedupeIntegration=()=>{let e;return{name:INTEGRATION_NAME$8,setupOnce(){},processEvent(t){if(t.type)return t;try{if(_shouldDropEvent(t,e))return DEBUG_BUILD&&logger.warn("Event dropped due to being a duplicate of previously captured event."),null}catch(e){}return e=t}}},dedupeIntegration=defineIntegration(_dedupeIntegration);function _shouldDropEvent(e,t){return!!t&&(!!_isSameMessageEvent(e,t)||!!_isSameExceptionEvent(e,t))}function _isSameMessageEvent(e,t){const n=e.message,r=t.message;return!(!n&&!r)&&(!(n&&!r||!n&&r)&&(n===r&&(!!_isSameFingerprint(e,t)&&!!_isSameStacktrace(e,t))))}function _isSameExceptionEvent(e,t){const n=_getExceptionFromEvent(t),r=_getExceptionFromEvent(e);return!(!n||!r)&&(n.type===r.type&&n.value===r.value&&(!!_isSameFingerprint(e,t)&&!!_isSameStacktrace(e,t)))}function _isSameStacktrace(e,t){let n=_getFramesFromEvent$1(e),r=_getFramesFromEvent$1(t);if(!n&&!r)return!0;if(n&&!r||!n&&r)return!1;if(r.length!==n.length)return!1;for(let e=0;e<r.length;e++){const t=r[e],o=n[e];if(t.filename!==o.filename||t.lineno!==o.lineno||t.colno!==o.colno||t.function!==o.function)return!1}return!0}function _isSameFingerprint(e,t){let n=e.fingerprint,r=t.fingerprint;if(!n&&!r)return!0;if(n&&!r||!n&&r)return!1;try{return!(n.join("")!==r.join(""))}catch(e){return!1}}function _getExceptionFromEvent(e){return e.exception&&e.exception.values&&e.exception.values[0]}function _getFramesFromEvent$1(e){const t=e.exception;if(t)try{return t.values[0].stacktrace.frames}catch(e){return}}convertIntegrationFnToClass(INTEGRATION_NAME$8,dedupeIntegration);const INTEGRATION_NAME$7="ExtraErrorData",_extraErrorDataIntegration=(e={})=>{const t=e.depth||3,n=e.captureErrorCause||!1;return{name:INTEGRATION_NAME$7,setupOnce(){},processEvent:(e,r)=>_enhanceEventWithErrorData(e,r,t,n)}},extraErrorDataIntegration=defineIntegration(_extraErrorDataIntegration);function _enhanceEventWithErrorData(e,t={},n,r){if(!t.originalException||!isError(t.originalException))return e;const o=t.originalException.name||t.originalException.constructor.name,a=_extractErrorData(t.originalException,r);if(a){const t={...e.contexts},r=normalize(a,n);return isPlainObject(r)&&(addNonEnumerableProperty(r,"__sentry_skip_normalization__",!0),t[o]=r),{...e,contexts:t}}return e}function _extractErrorData(e,t){try{const n=["name","message","stack","line","column","fileName","lineNumber","columnNumber","toJSON"],r={};for(const t of Object.keys(e)){if(-1!==n.indexOf(t))continue;const o=e[t];r[t]=isError(o)?o.toString():o}if(t&&void 0!==e.cause&&(r.cause=isError(e.cause)?e.cause.toString():e.cause),"function"==typeof e.toJSON){const t=e.toJSON();for(const e of Object.keys(t)){const n=t[e];r[e]=isError(n)?n.toString():n}}return r}catch(e){DEBUG_BUILD&&logger.error("Unable to extract extra data from the Error object:",e)}return null}convertIntegrationFnToClass(INTEGRATION_NAME$7,extraErrorDataIntegration);var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function commonjsRequire(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var localforage={exports:{}};
/*!
      localForage -- Offline Storage, Improved
      Version 1.10.0
      https://localforage.github.io/localForage
      (c) 2013-2017 Mozilla, Apache License 2.0
  */!function(e,t){e.exports=function e(t,n,r){function o(i,s){if(!n[i]){if(!t[i]){var c="function"==typeof commonjsRequire&&commonjsRequire;if(!s&&c)return c(i,!0);if(a)return a(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[i]={exports:{}};t[i][0].call(u.exports,(function(e){var n=t[i][1][e];return o(n||e)}),u,u.exports,e,t,n,r)}return n[i].exports}for(var a="function"==typeof commonjsRequire&&commonjsRequire,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,t,n){(function(e){var n,r,o=e.MutationObserver||e.WebKitMutationObserver;if(o){var a=0,i=new o(u),s=e.document.createTextNode("");i.observe(s,{characterData:!0}),n=function(){s.data=a=++a%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)};else{var c=new e.MessageChannel;c.port1.onmessage=u,n=function(){c.port2.postMessage(0)}}var l=[];function u(){var e,t;r=!0;for(var n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}r=!1}function d(e){1!==l.push(e)||r||n()}t.exports=d}).call(this,void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){var r=e(1);function o(){}var a={},i=["REJECTED"],s=["FULFILLED"],c=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==o&&g(this,e)}function u(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function d(e,t,n){r((function(){var r;try{r=t(n)}catch(t){return a.reject(e,t)}r===e?a.reject(e,new TypeError("Cannot resolve promise with itself")):a.resolve(e,r)}))}function p(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function g(e,t){var n=!1;function r(t){n||(n=!0,a.reject(e,t))}function o(t){n||(n=!0,a.resolve(e,t))}function i(){t(o,r)}var s=h(i);"error"===s.status&&r(s.value)}function h(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}function f(e){return e instanceof this?e:a.resolve(new this(o),e)}function m(e){var t=new this(o);return a.reject(t,e)}function _(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var i=new Array(n),s=0,c=-1,l=new this(o);++c<n;)u(e[c],c);return l;function u(e,o){function c(e){i[o]=e,++s!==n||r||(r=!0,a.resolve(l,i))}t.resolve(e).then(c,(function(e){r||(r=!0,a.reject(l,e))}))}}function E(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var i=-1,s=new this(o);++i<n;)c(e[i]);return s;function c(e){t.resolve(e).then((function(e){r||(r=!0,a.resolve(s,e))}),(function(e){r||(r=!0,a.reject(s,e))}))}}t.exports=l,l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===i)return this;var n=new this.constructor(o);return this.state!==c?d(n,this.state===s?e:t,this.outcome):this.queue.push(new u(n,e,t)),n},u.prototype.callFulfilled=function(e){a.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){a.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)},a.resolve=function(e,t){var n=h(p,t);if("error"===n.status)return a.reject(e,n.value);var r=n.value;if(r)g(e,r);else{e.state=s,e.outcome=t;for(var o=-1,i=e.queue.length;++o<i;)e.queue[o].callFulfilled(t)}return e},a.reject=function(e,t){e.state=i,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},l.resolve=f,l.reject=m,l.all=_,l.race=E},{1:1}],3:[function(e,t,n){(function(t){"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}var i=a();function s(){try{if(!i||!i.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}function c(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(o){if("TypeError"!==o.name)throw o;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var l=Promise;function u(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function d(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function p(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function g(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var h="local-forage-detect-blob-support",f=void 0,m={},_=Object.prototype.toString,E="readonly",T="readwrite";function S(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),o=0;o<t;o++)r[o]=e.charCodeAt(o);return n}function y(e){return new l((function(t){var n=e.transaction(h,T),r=c([""]);n.objectStore(h).put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}function v(e){return"boolean"==typeof f?l.resolve(f):y(e).then((function(e){return f=e}))}function I(e){var t=m[e.name],n={};n.promise=new l((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function A(e){var t=m[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function b(e,t){var n=m[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function R(e,t){return new l((function(n,r){if(m[e.name]=m[e.name]||M(),e.db){if(!t)return n(e.db);I(e),e.db.close()}var o=[e.name];t&&o.push(e.version);var a=i.open.apply(i,o);t&&(a.onupgradeneeded=function(t){var n=a.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(h)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),a.onerror=function(e){e.preventDefault(),r(a.error)},a.onsuccess=function(){var t=a.result;t.onversionchange=function(e){e.target.close()},n(t),A(e)}}))}function O(e){return R(e,!1)}function L(e){return R(e,!0)}function N(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,o=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),o||n){if(n){var a=e.db.version+1;a>e.version&&(e.version=a)}return!0}return!1}function C(e){return new l((function(t,n){var r=new FileReader;r.onerror=n,r.onloadend=function(n){var r=btoa(n.target.result||"");t({__local_forage_encoded_blob:!0,data:r,type:e.type})},r.readAsBinaryString(e)}))}function w(e){return c([S(atob(e.data))],{type:e.type})}function D(e){return e&&e.__local_forage_encoded_blob}function P(e){var t=this,n=t._initReady().then((function(){var e=m[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return d(n,e,e),n}function x(e){I(e);for(var t=m[e.name],n=t.forages,r=0;r<n.length;r++){var o=n[r];o._dbInfo.db&&(o._dbInfo.db.close(),o._dbInfo.db=null)}return e.db=null,O(e).then((function(t){return e.db=t,N(e)?L(e):t})).then((function(r){e.db=t.db=r;for(var o=0;o<n.length;o++)n[o]._dbInfo.db=r})).catch((function(t){throw b(e,t),t}))}function k(e,t,n,r){void 0===r&&(r=1);try{var o=e.db.transaction(e.storeName,t);n(null,o)}catch(o){if(r>0&&(!e.db||"InvalidStateError"===o.name||"NotFoundError"===o.name))return l.resolve().then((function(){if(!e.db||"NotFoundError"===o.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),L(e)})).then((function(){return x(e).then((function(){k(e,t,n,r-1)}))})).catch(n);n(o)}}function M(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function U(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var o=m[n.name];o||(o=M(),m[n.name]=o),o.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=P);var a=[];function i(){return l.resolve()}for(var s=0;s<o.forages.length;s++){var c=o.forages[s];c!==t&&a.push(c._initReady().catch(i))}var u=o.forages.slice(0);return l.all(a).then((function(){return n.db=o.db,O(n)})).then((function(e){return n.db=e,N(n,t._defaultConfig.version)?L(n):e})).then((function(e){n.db=o.db=e,t._dbInfo=n;for(var r=0;r<u.length;r++){var a=u[r];a!==t&&(a._dbInfo.db=n.db,a._dbInfo.version=n.version)}}))}function F(e,t){var n=this;e=p(e);var r=new l((function(t,r){n.ready().then((function(){k(n._dbInfo,E,(function(o,a){if(o)return r(o);try{var i=a.objectStore(n._dbInfo.storeName).get(e);i.onsuccess=function(){var e=i.result;void 0===e&&(e=null),D(e)&&(e=w(e)),t(e)},i.onerror=function(){r(i.error)}}catch(e){r(e)}}))})).catch(r)}));return u(r,t),r}function $(e,t){var n=this,r=new l((function(t,r){n.ready().then((function(){k(n._dbInfo,E,(function(o,a){if(o)return r(o);try{var i=a.objectStore(n._dbInfo.storeName).openCursor(),s=1;i.onsuccess=function(){var n=i.result;if(n){var r=n.value;D(r)&&(r=w(r));var o=e(r,n.key,s++);void 0!==o?t(o):n.continue()}else t()},i.onerror=function(){r(i.error)}}catch(e){r(e)}}))})).catch(r)}));return u(r,t),r}function B(e,t,n){var r=this;e=p(e);var o=new l((function(n,o){var a;r.ready().then((function(){return a=r._dbInfo,"[object Blob]"===_.call(t)?v(a.db).then((function(e){return e?t:C(t)})):t})).then((function(t){k(r._dbInfo,T,(function(a,i){if(a)return o(a);try{var s=i.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var c=s.put(t,e);i.oncomplete=function(){void 0===t&&(t=null),n(t)},i.onabort=i.onerror=function(){var e=c.error?c.error:c.transaction.error;o(e)}}catch(e){o(e)}}))})).catch(o)}));return u(o,n),o}function G(e,t){var n=this;e=p(e);var r=new l((function(t,r){n.ready().then((function(){k(n._dbInfo,T,(function(o,a){if(o)return r(o);try{var i=a.objectStore(n._dbInfo.storeName).delete(e);a.oncomplete=function(){t()},a.onerror=function(){r(i.error)},a.onabort=function(){var e=i.error?i.error:i.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return u(r,t),r}function W(e){var t=this,n=new l((function(e,n){t.ready().then((function(){k(t._dbInfo,T,(function(r,o){if(r)return n(r);try{var a=o.objectStore(t._dbInfo.storeName).clear();o.oncomplete=function(){e()},o.onabort=o.onerror=function(){var e=a.error?a.error:a.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return u(n,e),n}function H(e){var t=this,n=new l((function(e,n){t.ready().then((function(){k(t._dbInfo,E,(function(r,o){if(r)return n(r);try{var a=o.objectStore(t._dbInfo.storeName).count();a.onsuccess=function(){e(a.result)},a.onerror=function(){n(a.error)}}catch(e){n(e)}}))})).catch(n)}));return u(n,e),n}function V(e,t){var n=this,r=new l((function(t,r){e<0?t(null):n.ready().then((function(){k(n._dbInfo,E,(function(o,a){if(o)return r(o);try{var i=a.objectStore(n._dbInfo.storeName),s=!1,c=i.openKeyCursor();c.onsuccess=function(){var n=c.result;n?0===e||s?t(n.key):(s=!0,n.advance(e)):t(null)},c.onerror=function(){r(c.error)}}catch(e){r(e)}}))})).catch(r)}));return u(r,t),r}function q(e){var t=this,n=new l((function(e,n){t.ready().then((function(){k(t._dbInfo,E,(function(r,o){if(r)return n(r);try{var a=o.objectStore(t._dbInfo.storeName).openKeyCursor(),i=[];a.onsuccess=function(){var t=a.result;t?(i.push(t.key),t.continue()):e(i)},a.onerror=function(){n(a.error)}}catch(e){n(e)}}))})).catch(n)}));return u(n,e),n}function j(e,t){t=g.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,o=this;if(e.name){var a=e.name===n.name&&o._dbInfo.db?l.resolve(o._dbInfo.db):O(e).then((function(t){var n=m[e.name],r=n.forages;n.db=t;for(var o=0;o<r.length;o++)r[o]._dbInfo.db=t;return t}));r=e.storeName?a.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;I(e);var r=m[e.name],o=r.forages;t.close();for(var a=0;a<o.length;a++){var s=o[a];s._dbInfo.db=null,s._dbInfo.version=n}var c=new l((function(t,r){var o=i.open(e.name,n);o.onerror=function(e){o.result.close(),r(e)},o.onupgradeneeded=function(){o.result.deleteObjectStore(e.storeName)},o.onsuccess=function(){var e=o.result;e.close(),t(e)}}));return c.then((function(e){r.db=e;for(var t=0;t<o.length;t++){var n=o[t];n._dbInfo.db=e,A(n._dbInfo)}})).catch((function(t){throw(b(e,t)||l.resolve()).catch((function(){})),t}))}})):a.then((function(t){I(e);var n=m[e.name],r=n.forages;t.close();for(var o=0;o<r.length;o++)r[o]._dbInfo.db=null;var a=new l((function(t,n){var r=i.deleteDatabase(e.name);r.onerror=function(){var e=r.result;e&&e.close(),n(r.error)},r.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}}));return a.then((function(e){n.db=e;for(var t=0;t<r.length;t++)A(r[t]._dbInfo)})).catch((function(t){throw(b(e,t)||l.resolve()).catch((function(){})),t}))}))}else r=l.reject("Invalid arguments");return u(r,t),r}var z={_driver:"asyncStorage",_initStorage:U,_support:s(),iterate:$,getItem:F,setItem:B,removeItem:G,clear:W,length:H,key:V,keys:q,dropInstance:j};function J(){return"function"==typeof openDatabase}var Y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",X="~~local_forage_type~",K=/^~~local_forage_type~([^~]+)~/,Z="__lfsc__:",Q=Z.length,ee="arbf",te="blob",ne="si08",re="ui08",oe="uic8",ae="si16",ie="si32",se="ur16",ce="ui32",le="fl32",ue="fl64",de=Q+ee.length,pe=Object.prototype.toString;function ge(e){var t,n,r,o,a,i=.75*e.length,s=e.length,c=0;"="===e[e.length-1]&&(i--,"="===e[e.length-2]&&i--);var l=new ArrayBuffer(i),u=new Uint8Array(l);for(t=0;t<s;t+=4)n=Y.indexOf(e[t]),r=Y.indexOf(e[t+1]),o=Y.indexOf(e[t+2]),a=Y.indexOf(e[t+3]),u[c++]=n<<2|r>>4,u[c++]=(15&r)<<4|o>>2,u[c++]=(3&o)<<6|63&a;return l}function he(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=Y[n[t]>>2],r+=Y[(3&n[t])<<4|n[t+1]>>4],r+=Y[(15&n[t+1])<<2|n[t+2]>>6],r+=Y[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}function fe(e,t){var n="";if(e&&(n=pe.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===pe.call(e.buffer))){var r,o=Z;e instanceof ArrayBuffer?(r=e,o+=ee):(r=e.buffer,"[object Int8Array]"===n?o+=ne:"[object Uint8Array]"===n?o+=re:"[object Uint8ClampedArray]"===n?o+=oe:"[object Int16Array]"===n?o+=ae:"[object Uint16Array]"===n?o+=se:"[object Int32Array]"===n?o+=ie:"[object Uint32Array]"===n?o+=ce:"[object Float32Array]"===n?o+=le:"[object Float64Array]"===n?o+=ue:t(new Error("Failed to get type for BinaryArray"))),t(o+he(r))}else if("[object Blob]"===n){var a=new FileReader;a.onload=function(){var n=X+e.type+"~"+he(this.result);t(Z+te+n)},a.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}}function me(e){if(e.substring(0,Q)!==Z)return JSON.parse(e);var t,n=e.substring(de),r=e.substring(Q,de);if(r===te&&K.test(n)){var o=n.match(K);t=o[1],n=n.substring(o[0].length)}var a=ge(n);switch(r){case ee:return a;case te:return c([a],{type:t});case ne:return new Int8Array(a);case re:return new Uint8Array(a);case oe:return new Uint8ClampedArray(a);case ae:return new Int16Array(a);case se:return new Uint16Array(a);case ie:return new Int32Array(a);case ce:return new Uint32Array(a);case le:return new Float32Array(a);case ue:return new Float64Array(a);default:throw new Error("Unkown type: "+r)}}var _e={serialize:fe,deserialize:me,stringToBuffer:ge,bufferToString:he};function Ee(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function Te(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var o=new l((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(o){Ee(o,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=_e,o}function Se(e,t,n,r,o,a){e.executeSql(n,r,o,(function(e,i){i.code===i.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,s){s.rows.length?a(e,i):Ee(e,t,(function(){e.executeSql(n,r,o,a)}),a)}),a):a(e,i)}),a)}function ye(e,t){var n=this;e=p(e);var r=new l((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){Se(n,o,"SELECT * FROM "+o.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=o.serializer.deserialize(r)),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r}function ve(e,t){var n=this,r=new l((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){Se(n,o,"SELECT * FROM "+o.storeName,[],(function(n,r){for(var a=r.rows,i=a.length,s=0;s<i;s++){var c=a.item(s),l=c.value;if(l&&(l=o.serializer.deserialize(l)),void 0!==(l=e(l,c.key,s+1)))return void t(l)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r}function Ie(e,t,n,r){var o=this;e=p(e);var a=new l((function(a,i){o.ready().then((function(){void 0===t&&(t=null);var s=t,c=o._dbInfo;c.serializer.serialize(t,(function(t,l){l?i(l):c.db.transaction((function(n){Se(n,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){a(s)}),(function(e,t){i(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void a(Ie.apply(o,[e,s,n,r-1]));i(t)}}))}))})).catch(i)}));return u(a,n),a}function Ae(e,t,n){return Ie.apply(this,[e,t,n,1])}function be(e,t){var n=this;e=p(e);var r=new l((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){Se(n,o,"DELETE FROM "+o.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r}function Re(e){var t=this,n=new l((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){Se(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return u(n,e),n}function Oe(e){var t=this,n=new l((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){Se(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,n){var r=n.rows.item(0).c;e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return u(n,e),n}function Le(e,t){var n=this,r=new l((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){Se(n,o,"SELECT key FROM "+o.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r}function Ne(e){var t=this,n=new l((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){Se(t,r,"SELECT key FROM "+r.storeName,[],(function(t,n){for(var r=[],o=0;o<n.rows.length;o++)r.push(n.rows.item(o).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return u(n,e),n}function Ce(e){return new l((function(t,n){e.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var o=[],a=0;a<r.rows.length;a++)o.push(r.rows.item(a).name);t({db:e,storeNames:o})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}function we(e,t){t=g.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,o=this;return r=e.name?new l((function(t){var r;r=e.name===n.name?o._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t(Ce(r))})).then((function(e){return new l((function(t,n){e.db.transaction((function(r){function o(e){return new l((function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var a=[],i=0,s=e.storeNames.length;i<s;i++)a.push(o(e.storeNames[i]));l.all(a).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):l.reject("Invalid arguments"),u(r,t),r}var De={_driver:"webSQLStorage",_initStorage:Te,_support:J(),iterate:ve,getItem:ye,setItem:Ae,removeItem:be,clear:Re,length:Oe,key:Le,keys:Ne,dropInstance:we};function Pe(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}function xe(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function ke(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}function Me(){return!ke()||localStorage.length>0}function Ue(e){var t=this,n={};if(e)for(var r in e)n[r]=e[r];return n.keyPrefix=xe(e,t._defaultConfig),Me()?(t._dbInfo=n,n.serializer=_e,l.resolve()):l.reject()}function Fe(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return u(n,e),n}function $e(e,t){var n=this;e=p(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r}));return u(r,t),r}function Be(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,o=r.length,a=localStorage.length,i=1,s=0;s<a;s++){var c=localStorage.key(s);if(0===c.indexOf(r)){var l=localStorage.getItem(c);if(l&&(l=t.serializer.deserialize(l)),void 0!==(l=e(l,c.substring(o),i++)))return l}}}));return u(r,t),r}function Ge(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t}));return u(r,t),r}function We(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],o=0;o<n;o++){var a=localStorage.key(o);0===a.indexOf(e.keyPrefix)&&r.push(a.substring(e.keyPrefix.length))}return r}));return u(n,e),n}function He(e){var t=this.keys().then((function(e){return e.length}));return u(t,e),t}function Ve(e,t){var n=this;e=p(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return u(r,t),r}function qe(e,t,n){var r=this;e=p(e);var o=r.ready().then((function(){void 0===t&&(t=null);var n=t;return new l((function(o,a){var i=r._dbInfo;i.serializer.serialize(t,(function(t,r){if(r)a(r);else try{localStorage.setItem(i.keyPrefix+e,t),o(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||a(e),a(e)}}))}))}));return u(o,n),o}function je(e,t){if(t=g.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,o=this;return r=e.name?new l((function(t){e.storeName?t(xe(e,o._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):l.reject("Invalid arguments"),u(r,t),r}var ze={_driver:"localStorageWrapper",_initStorage:Ue,_support:Pe(),iterate:Be,getItem:$e,setItem:qe,removeItem:Ve,clear:Fe,length:He,key:Ge,keys:We,dropInstance:je},Je=function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},Ye=function(e,t){for(var n=e.length,r=0;r<n;){if(Je(e[r],t))return!0;r++}return!1},Xe=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Ke={},Ze={},Qe={INDEXEDDB:z,WEBSQL:De,LOCALSTORAGE:ze},et=[Qe.INDEXEDDB._driver,Qe.WEBSQL._driver,Qe.LOCALSTORAGE._driver],tt=["dropInstance"],nt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(tt),rt={description:"",driver:et.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function ot(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function at(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(Xe(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var it=function(){function e(t){for(var n in o(this,e),Qe)if(Qe.hasOwnProperty(n)){var r=Qe[n],a=r._driver;this[n]=a,Ke[a]||this.defineDriver(r)}this._defaultConfig=at({},rt),this._config=at({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":r(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var r=new l((function(t,n){try{var r=e._driver,o=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(o);for(var a=nt.concat("_initStorage"),i=0,s=a.length;i<s;i++){var c=a[i];if((!Ye(tt,c)||e[c])&&"function"!=typeof e[c])return void n(o)}var d=function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=l.reject(t);return u(n,arguments[arguments.length-1]),n}},n=0,r=tt.length;n<r;n++){var o=tt[n];e[o]||(e[o]=t(o))}};d();var p=function(n){Ke[r]&&console.info("Redefining LocalForage driver: "+r),Ke[r]=e,Ze[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(p,n):p(!!e._support):p(!0)}catch(e){n(e)}}));return d(r,t,n),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var r=Ke[e]?l.resolve(Ke[e]):l.reject(new Error("Driver not found."));return d(r,t,n),r},e.prototype.getSerializer=function(e){var t=l.resolve(_e);return d(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return d(n,e,e),n},e.prototype.setDriver=function(e,t,n){var r=this;Xe(e)||(e=[e]);var o=this._getSupportedDrivers(e);function a(){r._config.driver=r.driver()}function i(e){return r._extend(e),a(),r._ready=r._initStorage(r._config),r._ready}function s(e){return function(){var t=0;function n(){for(;t<e.length;){var o=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(o).then(i).catch(n)}a();var s=new Error("No available storage method found.");return r._driverSet=l.reject(s),r._driverSet}return n()}}var c=null!==this._driverSet?this._driverSet.catch((function(){return l.resolve()})):l.resolve();return this._driverSet=c.then((function(){var e=o[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((function(e){r._driver=e._driver,a(),r._wrapLibraryMethodsWithReady(),r._initDriver=s(o)}))})).catch((function(){a();var e=new Error("No available storage method found.");return r._driverSet=l.reject(e),r._driverSet})),d(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!Ze[e]},e.prototype._extend=function(e){at(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var o=e[n];this.supports(o)&&t.push(o)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=nt.length;e<t;e++)ot(this,nt[e])},e.prototype.createInstance=function(t){return new e(t)},e}(),st=new it;t.exports=st},{3:3}]},{},[4])(4)}(localforage);const WINDOW$2=GLOBAL_OBJ;class Offline{static __initStatic(){this.id="Offline"}constructor(e={}){this.name=Offline.id,this.maxStoredEvents=e.maxStoredEvents||30,this.offlineEventStore=localforage.exports.createInstance({name:"sentry/offlineEventStore"})}setupOnce(e,t){this.hub=t(),"addEventListener"in WINDOW$2&&WINDOW$2.addEventListener("online",(()=>{this._sendEvents().catch((()=>{DEBUG_BUILD&&logger.warn("could not send cached events")}))}));const n=e=>this.hub&&this.hub.getIntegration(Offline)&&"navigator"in WINDOW$2&&"onLine"in WINDOW$2.navigator&&!WINDOW$2.navigator.onLine?(DEBUG_BUILD&&logger.log("Event dropped due to being a offline - caching instead"),this._cacheEvent(e).then((e=>this._enforceMaxEvents())).catch((e=>{DEBUG_BUILD&&logger.warn("could not cache event while offline")})),null):e;n.id=this.name,e(n),"navigator"in WINDOW$2&&"onLine"in WINDOW$2.navigator&&WINDOW$2.navigator.onLine&&this._sendEvents().catch((()=>{DEBUG_BUILD&&logger.warn("could not send cached events")}))}async _cacheEvent(e){return this.offlineEventStore.setItem(uuid4(),normalize(e))}async _enforceMaxEvents(){const e=[];return this.offlineEventStore.iterate(((t,n,r)=>{e.push({cacheKey:n,event:t})})).then((()=>this._purgeEvents(e.sort(((e,t)=>(t.event.timestamp||0)-(e.event.timestamp||0))).slice(this.maxStoredEvents<e.length?this.maxStoredEvents:e.length).map((e=>e.cacheKey))))).catch((e=>{DEBUG_BUILD&&logger.warn("could not enforce max events")}))}async _purgeEvent(e){return this.offlineEventStore.removeItem(e)}async _purgeEvents(e){return Promise.all(e.map((e=>this._purgeEvent(e)))).then()}async _sendEvents(){return this.offlineEventStore.iterate(((e,t,n)=>{this.hub?(this.hub.captureEvent(e),this._purgeEvent(t).catch((e=>{DEBUG_BUILD&&logger.warn("could not purge event from cache")}))):DEBUG_BUILD&&logger.warn("no hub found - could not send cached event")}))}}Offline.__initStatic();const WINDOW$1=GLOBAL_OBJ,INTEGRATION_NAME$6="ReportingObserver",SETUP_CLIENTS=new WeakMap,_reportingObserverIntegration=(e={})=>{const t=e.types||["crash","deprecation","intervention"];function n(e){if(SETUP_CLIENTS.has(getClient()))for(const t of e)withScope((e=>{e.setExtra("url",t.url);const n=`ReportingObserver [${t.type}]`;let r="No details available";if(t.body){const n={};for(const e in t.body)n[e]=t.body[e];if(e.setExtra("body",n),"crash"===t.type){const e=t.body;r=[e.crashId||"",e.reason||""].join(" ").trim()||r}else{r=t.body.message||r}}captureMessage(`${n}: ${r}`)}))}return{name:INTEGRATION_NAME$6,setupOnce(){if(!supportsReportingObserver())return;new WINDOW$1.ReportingObserver(n,{buffered:!0,types:t}).observe()},setup(e){SETUP_CLIENTS.set(e,!0)}}},reportingObserverIntegration=defineIntegration(_reportingObserverIntegration);convertIntegrationFnToClass(INTEGRATION_NAME$6,reportingObserverIntegration);const INTEGRATION_NAME$5="RewriteFrames",_rewriteFramesIntegration=(e={})=>{const t=e.root,n=e.prefix||"app:///",r=e.iteratee||(e=>{if(!e.filename)return e;const r=/^[a-zA-Z]:\\/.test(e.filename)||e.filename.includes("\\")&&!e.filename.includes("/"),o=/^\//.test(e.filename);if(r||o){const o=r?e.filename.replace(/^[a-zA-Z]:/,"").replace(/\\/g,"/"):e.filename,a=t?relative(t,o):basename(o);e.filename=`${n}${a}`}return e});return{name:INTEGRATION_NAME$5,setupOnce(){},processEvent(e){let t=e;return e.exception&&Array.isArray(e.exception.values)&&(t=function(e){try{return{...e,exception:{...e.exception,values:e.exception.values.map((e=>{return{...e,...e.stacktrace&&{stacktrace:(t=e.stacktrace,{...t,frames:t&&t.frames&&t.frames.map((e=>r(e)))})}};var t}))}}}catch(t){return e}}(t)),t}}},rewriteFramesIntegration=defineIntegration(_rewriteFramesIntegration);convertIntegrationFnToClass(INTEGRATION_NAME$5,rewriteFramesIntegration);const INTEGRATION_NAME$4="SessionTiming",_sessionTimingIntegration=()=>{const e=Date.now();return{name:INTEGRATION_NAME$4,setupOnce(){},processEvent(t){const n=Date.now();return{...t,extra:{...t.extra,"session:start":e,"session:duration":n-e,"session:end":n}}}}},sessionTimingIntegration=defineIntegration(_sessionTimingIntegration);convertIntegrationFnToClass(INTEGRATION_NAME$4,sessionTimingIntegration);const INTEGRATION_NAME$3="Transaction",transactionIntegration=()=>({name:INTEGRATION_NAME$3,setupOnce(){},processEvent(e){const t=_getFramesFromEvent(e);for(let n=t.length-1;n>=0;n--){const r=t[n];if(!0===r.in_app){e.transaction=_getTransaction(r);break}}return e}});function _getFramesFromEvent(e){const t=e.exception&&e.exception.values&&e.exception.values[0];return t&&t.stacktrace&&t.stacktrace.frames||[]}function _getTransaction(e){return e.module||e.function?`${e.module||"?"}/${e.function||"?"}`:"<unknown>"}convertIntegrationFnToClass(INTEGRATION_NAME$3,transactionIntegration);const INTEGRATION_NAME$2="HttpClient",_httpClientIntegration=(e={})=>{const t={failedRequestStatusCodes:[[500,599]],failedRequestTargets:[/.*/],...e};return{name:INTEGRATION_NAME$2,setupOnce(){},setup(e){_wrapFetch(e,t),_wrapXHR(e,t)}}},httpClientIntegration=defineIntegration(_httpClientIntegration);function _fetchResponseHandler(e,t,n,r){if(_shouldCaptureResponse(e,n.status,n.url)){const e=_getRequest(t,r);let o,a,i,s;_shouldSendDefaultPii()&&([{headers:o,cookies:i},{headers:a,cookies:s}]=[{cookieHeader:"Cookie",obj:e},{cookieHeader:"Set-Cookie",obj:n}].map((({cookieHeader:e,obj:t})=>{const n=_extractFetchHeaders(t.headers);let r;try{const t=n[e]||n[e.toLowerCase()]||void 0;t&&(r=_parseCookieString(t))}catch(t){DEBUG_BUILD&&logger.log(`Could not extract cookies from header ${e}`)}return{headers:n,cookies:r}})));captureEvent(_createEvent({url:e.url,method:e.method,status:n.status,requestHeaders:o,responseHeaders:a,requestCookies:i,responseCookies:s}))}}function _xhrResponseHandler(e,t,n,r){if(_shouldCaptureResponse(e,t.status,t.responseURL)){let e,o,a;if(_shouldSendDefaultPii()){try{const e=t.getResponseHeader("Set-Cookie")||t.getResponseHeader("set-cookie")||void 0;e&&(o=_parseCookieString(e))}catch(e){DEBUG_BUILD&&logger.log("Could not extract cookies from response headers")}try{a=_getXHRResponseHeaders(t)}catch(e){DEBUG_BUILD&&logger.log("Could not extract headers from response")}e=r}captureEvent(_createEvent({url:t.responseURL,method:n,status:t.status,requestHeaders:e,responseHeaders:a,responseCookies:o}))}}function _getResponseSizeFromHeaders(e){if(e){const t=e["Content-Length"]||e["content-length"];if(t)return parseInt(t,10)}}function _parseCookieString(e){return e.split("; ").reduce(((e,t)=>{const[n,r]=t.split("=");return e[n]=r,e}),{})}function _extractFetchHeaders(e){const t={};return e.forEach(((e,n)=>{t[n]=e})),t}function _getXHRResponseHeaders(e){const t=e.getAllResponseHeaders();return t?t.split("\r\n").reduce(((e,t)=>{const[n,r]=t.split(": ");return e[n]=r,e}),{}):{}}function _isInGivenRequestTargets(e,t){return e.some((e=>"string"==typeof e?t.includes(e):e.test(t)))}function _isInGivenStatusRanges(e,t){return e.some((e=>"number"==typeof e?e===t:t>=e[0]&&t<=e[1]))}function _wrapFetch(e,t){supportsNativeFetch()&&addFetchInstrumentationHandler((n=>{if(getClient()!==e)return;const{response:r,args:o}=n,[a,i]=o;r&&_fetchResponseHandler(t,a,r,i)}))}function _wrapXHR(e,t){"XMLHttpRequest"in GLOBAL_OBJ&&addXhrInstrumentationHandler((n=>{if(getClient()!==e)return;const r=n.xhr,o=r[SENTRY_XHR_DATA_KEY];if(!o)return;const{method:a,request_headers:i}=o;try{_xhrResponseHandler(t,r,a,i)}catch(e){DEBUG_BUILD&&logger.warn("Error while extracting response event form XHR response",e)}}))}function _shouldCaptureResponse(e,t,n){return _isInGivenStatusRanges(e.failedRequestStatusCodes,t)&&_isInGivenRequestTargets(e.failedRequestTargets,n)&&!isSentryRequestUrl(n,getClient())}function _createEvent(e){const t=`HTTP Client Error with status code: ${e.status}`,n={message:t,exception:{values:[{type:"Error",value:t}]},request:{url:e.url,method:e.method,headers:e.requestHeaders,cookies:e.requestCookies},contexts:{response:{status_code:e.status,headers:e.responseHeaders,cookies:e.responseCookies,body_size:_getResponseSizeFromHeaders(e.responseHeaders)}}};return addExceptionMechanism(n,{type:"http.client",handled:!1}),n}function _getRequest(e,t){return!t&&e instanceof Request||e instanceof Request&&e.bodyUsed?e:new Request(e,t)}function _shouldSendDefaultPii(){const e=getClient();return!!e&&Boolean(e.getOptions().sendDefaultPii)}convertIntegrationFnToClass(INTEGRATION_NAME$2,httpClientIntegration);const WINDOW=GLOBAL_OBJ,DEFAULT_LINES_OF_CONTEXT=7,INTEGRATION_NAME$1="ContextLines",_contextLinesIntegration=(e={})=>{const t=null!=e.frameContextLines?e.frameContextLines:DEFAULT_LINES_OF_CONTEXT;return{name:INTEGRATION_NAME$1,setupOnce(){},processEvent:e=>addSourceContext(e,t)}},contextLinesIntegration=defineIntegration(_contextLinesIntegration);function addSourceContext(e,t){const n=WINDOW.document,r=WINDOW.location&&stripUrlQueryAndFragment(WINDOW.location.href);if(!n||!r)return e;const o=e.exception&&e.exception.values;if(!o||!o.length)return e;const a=n.documentElement.innerHTML;if(!a)return e;const i=["<!DOCTYPE html>","<html>",...a.split("\n"),"</html>"];return o.forEach((e=>{const n=e.stacktrace;n&&n.frames&&(n.frames=n.frames.map((e=>applySourceContextToFrame(e,i,r,t))))})),e}function applySourceContextToFrame(e,t,n,r){return e.filename===n&&e.lineno&&t.length?(addContextToFrame(t,e,r),e):e}function promisifyRequest(e){return new Promise(((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)}))}function createStore(e,t){const n=indexedDB.open(e);n.onupgradeneeded=()=>n.result.createObjectStore(t);const r=promisifyRequest(n);return e=>r.then((n=>e(n.transaction(t,"readwrite").objectStore(t))))}function keys(e){return promisifyRequest(e.getAllKeys())}function insert(e,t,n){return e((e=>keys(e).then((r=>{if(!(r.length>=n))return e.put(t,Math.max(...r,0)+1),promisifyRequest(e.transaction)}))))}function pop(e){return e((e=>keys(e).then((t=>{if(0!==t.length)return promisifyRequest(e.get(t[0])).then((n=>(e.delete(t[0]),promisifyRequest(e.transaction).then((()=>n)))))}))))}function createIndexedDbStore(e){let t;function n(){return null==t&&(t=createStore(e.dbName||"sentry-offline",e.storeName||"queue")),t}return{insert:async t=>{try{const r=await serializeEnvelope(t,e.textEncoder);await insert(n(),r,e.maxQueueSize||30)}catch(e){}},pop:async()=>{try{const t=await pop(n());if(t)return parseEnvelope(t,e.textEncoder||new TextEncoder,e.textDecoder||new TextDecoder)}catch(e){}}}}function makeIndexedDbOfflineTransport(e){return t=>e({...t,createStore:createIndexedDbStore})}function makeBrowserOfflineTransport(e){return makeIndexedDbOfflineTransport(makeOfflineTransport(e))}convertIntegrationFnToClass(INTEGRATION_NAME$1,contextLinesIntegration);const MS_TO_NS=1e6,THREAD_ID_STRING=String(0),THREAD_NAME="main";let OS_PLATFORM="",OS_PLATFORM_VERSION="",OS_ARCH="",OS_BROWSER=WINDOW$5.navigator&&WINDOW$5.navigator.userAgent||"",OS_MODEL="";const OS_LOCALE=WINDOW$5.navigator&&WINDOW$5.navigator.language||WINDOW$5.navigator&&WINDOW$5.navigator.languages&&WINDOW$5.navigator.languages[0]||"";function isUserAgentData(e){return"object"==typeof e&&null!==e&&"getHighEntropyValues"in e}const userAgentData=WINDOW$5.navigator&&WINDOW$5.navigator.userAgentData;function isProcessedJSSelfProfile(e){return!("thread_metadata"in e)}function enrichWithThreadInformation(e){return isProcessedJSSelfProfile(e)?convertJSSelfProfileToSampledFormat(e):e}function getTraceId(e){const t=e&&e.contexts&&e.contexts.trace&&e.contexts.trace.trace_id;return"string"==typeof t&&32!==t.length&&DEBUG_BUILD$3&&logger.log(`[Profiling] Invalid traceId: ${t} on profiled event`),"string"!=typeof t?"":t}function createProfilePayload(e,t,n,r){if("transaction"!==r.type)throw new TypeError("Profiling events may only be attached to transactions, this should never occur.");if(null==n)throw new TypeError(`Cannot construct profiling event envelope without a valid profile. Got ${n} instead.`);const o=getTraceId(r),a=enrichWithThreadInformation(n),i=t||("number"==typeof r.start_timestamp?1e3*r.start_timestamp:Date.now()),s="number"==typeof r.timestamp?1e3*r.timestamp:Date.now();return{event_id:e,timestamp:new Date(i).toISOString(),platform:"javascript",version:"1",release:r.release||"",environment:r.environment||DEFAULT_ENVIRONMENT,runtime:{name:"javascript",version:WINDOW$5.navigator.userAgent},os:{name:OS_PLATFORM,version:OS_PLATFORM_VERSION,build_number:OS_BROWSER},device:{locale:OS_LOCALE,model:OS_MODEL,manufacturer:OS_BROWSER,architecture:OS_ARCH,is_emulator:!1},debug_meta:{images:applyDebugMetadata(n.resources)},profile:a,transactions:[{name:r.transaction||"",id:r.event_id||uuid4(),trace_id:o,active_thread_id:THREAD_ID_STRING,relative_start_ns:"0",relative_end_ns:(1e6*(s-i)).toFixed(0)}]}}function isAutomatedPageLoadTransaction(e){return"pageload"===e.op}function convertJSSelfProfileToSampledFormat(e){let t,n=0;const r={samples:[],stacks:[],frames:[],thread_metadata:{[THREAD_ID_STRING]:{name:THREAD_NAME}}};if(!e.samples.length)return r;const o=e.samples[0].timestamp,a="number"==typeof performance.timeOrigin?performance.timeOrigin:browserPerformanceTimeOrigin||0,i=a-(browserPerformanceTimeOrigin||a);for(let a=0;a<e.samples.length;a++){const s=e.samples[a];if(void 0===s.stackId){void 0===t&&(t=n,r.stacks[t]=[],n++),r.samples[a]={elapsed_since_start_ns:((s.timestamp+i-o)*MS_TO_NS).toFixed(0),stack_id:t,thread_id:THREAD_ID_STRING};continue}let c=e.stacks[s.stackId];const l=[];for(;c;){l.push(c.frameId);const t=e.frames[c.frameId];void 0===r.frames[c.frameId]&&(r.frames[c.frameId]={function:t.name,abs_path:"number"==typeof t.resourceId?e.resources[t.resourceId]:void 0,lineno:t.line,colno:t.column}),c=void 0===c.parentId?void 0:e.stacks[c.parentId]}const u={elapsed_since_start_ns:((s.timestamp+i-o)*MS_TO_NS).toFixed(0),stack_id:n,thread_id:THREAD_ID_STRING};r.stacks[n]=l,r.samples[a]=u,n++}return r}function addProfilesToEnvelope(e,t){if(!t.length)return e;for(const n of t)e[1].push([{type:"profile"},n]);return e}function findProfiledTransactionsFromEnvelope(e){const t=[];return forEachEnvelopeItem(e,((e,n)=>{if("transaction"===n)for(let n=1;n<e.length;n++){const r=e[n];r&&r.contexts&&r.contexts.profile&&r.contexts.profile.profile_id&&t.push(e[n])}})),t}isUserAgentData(userAgentData)&&userAgentData.getHighEntropyValues(["architecture","model","platform","platformVersion","fullVersionList"]).then((e=>{if(OS_PLATFORM=e.platform||"",OS_ARCH=e.architecture||"",OS_MODEL=e.model||"",OS_PLATFORM_VERSION=e.platformVersion||"",e.fullVersionList&&e.fullVersionList.length>0){const t=e.fullVersionList[e.fullVersionList.length-1];OS_BROWSER=`${t.brand} ${t.version}`}})).catch((e=>{}));const debugIdStackParserCache=new WeakMap;function applyDebugMetadata(e){const t=GLOBAL_OBJ._sentryDebugIds;if(!t)return[];const n=getClient(),r=n&&n.getOptions(),o=r&&r.stackParser;if(!o)return[];let a;const i=debugIdStackParserCache.get(o);i?a=i:(a=new Map,debugIdStackParserCache.set(o,a));const s=Object.keys(t).reduce(((e,n)=>{let r;const i=a.get(n);i?r=i:(r=o(n),a.set(n,r));for(let o=r.length-1;o>=0;o--){const a=r[o],i=a&&a.filename;if(a&&i){e[i]=t[n];break}}return e}),{}),c=[];for(const t of e)t&&s[t]&&c.push({type:"sourcemap",code_file:t,debug_id:s[t]});return c}function isValidSampleRate(e){return"number"!=typeof e&&"boolean"!=typeof e||"number"==typeof e&&isNaN(e)?(DEBUG_BUILD$3&&logger.warn(`[Profiling] Invalid sample rate. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(e)} of type ${JSON.stringify(typeof e)}.`),!1):!0===e||!1===e||(!(e<0||e>1)||(DEBUG_BUILD$3&&logger.warn(`[Profiling] Invalid sample rate. Sample rate must be between 0 and 1. Got ${e}.`),!1))}function isValidProfile(e){return e.samples.length<2?(DEBUG_BUILD$3&&logger.log("[Profiling] Discarding profile because it contains less than 2 samples"),!1):!!e.frames.length||(DEBUG_BUILD$3&&logger.log("[Profiling] Discarding profile because it contains no frames"),!1)}let PROFILING_CONSTRUCTOR_FAILED=!1;const MAX_PROFILE_DURATION_MS=3e4;function isJSProfilerSupported(e){return"function"==typeof e}function startJSSelfProfile(){const e=WINDOW$5.Profiler;if(!isJSProfilerSupported(e))return void(DEBUG_BUILD$3&&logger.log("[Profiling] Profiling is not supported by this browser, Profiler interface missing on window object."));const t=Math.floor(MAX_PROFILE_DURATION_MS/10);try{return new e({sampleInterval:10,maxBufferSize:t})}catch(e){DEBUG_BUILD$3&&(logger.log("[Profiling] Failed to initialize the Profiling constructor, this is likely due to a missing 'Document-Policy': 'js-profiling' header."),logger.log("[Profiling] Disabling profiling for current user session.")),PROFILING_CONSTRUCTOR_FAILED=!0}}function shouldProfileTransaction(e){if(PROFILING_CONSTRUCTOR_FAILED)return DEBUG_BUILD$3&&logger.log("[Profiling] Profiling has been disabled for the duration of the current user session."),!1;if(!e.isRecording())return DEBUG_BUILD$3&&logger.log("[Profiling] Discarding profile because transaction was not sampled."),!1;const t=getClient(),n=t&&t.getOptions();if(!n)return DEBUG_BUILD$3&&logger.log("[Profiling] Profiling disabled, no options found."),!1;const r=n.profilesSampleRate;if(!isValidSampleRate(r))return DEBUG_BUILD$3&&logger.warn("[Profiling] Discarding profile because of invalid sample rate."),!1;if(!r)return DEBUG_BUILD$3&&logger.log("[Profiling] Discarding profile because a negative sampling decision was inherited or profileSampleRate is set to 0"),!1;return!!(!0===r||Math.random()<r)||(DEBUG_BUILD$3&&logger.log(`[Profiling] Discarding profile because it's not included in the random sample (sampling rate = ${Number(r)})`),!1)}function createProfilingEvent(e,t,n,r){return isValidProfile(n)?createProfilePayload(e,t,n,r):null}const PROFILE_MAP=new Map;function getActiveProfilesCount(){return PROFILE_MAP.size}function takeProfileFromGlobalCache(e){const t=PROFILE_MAP.get(e);return t&&PROFILE_MAP.delete(e),t}function addProfileToGlobalCache(e,t){if(PROFILE_MAP.set(e,t),PROFILE_MAP.size>30){const e=PROFILE_MAP.keys().next().value;PROFILE_MAP.delete(e)}}function onProfilingStartRouteTransaction(e){return e?shouldProfileTransaction(e)?startProfileForTransaction(e):e:(DEBUG_BUILD$3&&logger.log("[Profiling] Transaction is undefined, skipping profiling"),e)}function startProfileForTransaction(e){let t;isAutomatedPageLoadTransaction(e)&&(t=1e3*timestampInSeconds());const n=startJSSelfProfile();if(!n)return e;DEBUG_BUILD$3&&logger.log(`[Profiling] started profiling transaction: ${spanToJSON(e).description}`);const r=uuid4();async function o(){return e&&n?n.stop().then((t=>(a&&(WINDOW$5.clearTimeout(a),a=void 0),DEBUG_BUILD$3&&logger.log(`[Profiling] stopped profiling of transaction: ${spanToJSON(e).description}`),t?(addProfileToGlobalCache(r,t),null):(DEBUG_BUILD$3&&logger.log(`[Profiling] profiler returned null profile for: ${spanToJSON(e).description}`,"this may indicate an overlapping transaction or a call to stopProfiling with a profile title that was never started"),null)))).catch((e=>(DEBUG_BUILD$3&&logger.log("[Profiling] error while stopping profiler:",e),null))):null}let a=WINDOW$5.setTimeout((()=>{DEBUG_BUILD$3&&logger.log("[Profiling] max profile duration elapsed, stopping profiling for:",spanToJSON(e).description),o()}),MAX_PROFILE_DURATION_MS);const i=e.end.bind(e);return e.end=function(){return e?(o().then((()=>{e.setContext("profile",{profile_id:r,start_timestamp:t}),i()}),(()=>{i()})),e):i()},e}const INTEGRATION_NAME="BrowserProfiling",_browserProfilingIntegration=()=>({name:INTEGRATION_NAME,setupOnce(){},setup(e){const t=getCurrentScope().getTransaction();t&&isAutomatedPageLoadTransaction(t)&&shouldProfileTransaction(t)&&startProfileForTransaction(t),"function"==typeof e.on?(e.on("startTransaction",(e=>{shouldProfileTransaction(e)&&startProfileForTransaction(e)})),e.on("beforeEnvelope",(e=>{if(!getActiveProfilesCount())return;const t=findProfiledTransactionsFromEnvelope(e);if(!t.length)return;const n=[];for(const e of t){const t=e&&e.contexts,r=t&&t.profile&&t.profile.profile_id,o=t&&t.profile&&t.profile.start_timestamp;if("string"!=typeof r){DEBUG_BUILD$3&&logger.log("[Profiling] cannot find profile for a transaction without a profile context");continue}if(!r){DEBUG_BUILD$3&&logger.log("[Profiling] cannot find profile for a transaction without a profile context");continue}t&&t.profile&&delete t.profile;const a=takeProfileFromGlobalCache(r);if(!a){DEBUG_BUILD$3&&logger.log(`[Profiling] Could not retrieve profile for transaction: ${r}`);continue}const i=createProfilingEvent(r,o,a,e);i&&n.push(i)}addProfilesToEnvelope(e,n)}))):logger.warn("[Profiling] Client does not support hooks, profiling will be disabled")}}),browserProfilingIntegration=defineIntegration(_browserProfilingIntegration),BrowserProfilingIntegration=convertIntegrationFnToClass(INTEGRATION_NAME,browserProfilingIntegration);let windowIntegrations={};WINDOW$5.Sentry&&WINDOW$5.Sentry.Integrations&&(windowIntegrations=WINDOW$5.Sentry.Integrations);const INTEGRATIONS={...windowIntegrations,...Integrations,...index};var Sentry=Object.freeze({__proto__:null,Integrations:INTEGRATIONS,FunctionToString:FunctionToString,Hub:Hub,InboundFilters:InboundFilters,ModuleMetadata:ModuleMetadata,SDK_VERSION:SDK_VERSION,SEMANTIC_ATTRIBUTE_SENTRY_OP:SEMANTIC_ATTRIBUTE_SENTRY_OP,SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN:SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN,SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE:SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE,SEMANTIC_ATTRIBUTE_SENTRY_SOURCE:SEMANTIC_ATTRIBUTE_SENTRY_SOURCE,Scope:Scope,addBreadcrumb:addBreadcrumb,addEventProcessor:addEventProcessor,addGlobalEventProcessor:addGlobalEventProcessor,addIntegration:addIntegration,addTracingExtensions:addTracingExtensions,captureEvent:captureEvent,captureException:captureException,captureMessage:captureMessage,captureSession:captureSession,close:close,configureScope:configureScope,continueTrace:continueTrace,createTransport:createTransport,endSession:endSession,extractTraceparentData:extractTraceparentData,flush:flush,functionToStringIntegration:functionToStringIntegration,getActiveSpan:getActiveSpan,getActiveTransaction:getActiveTransaction,getClient:getClient,getCurrentHub:getCurrentHub,getCurrentScope:getCurrentScope,getHubFromCarrier:getHubFromCarrier,getSpanStatusFromHttpCode:getSpanStatusFromHttpCode,inboundFiltersIntegration:inboundFiltersIntegration,isInitialized:isInitialized,lastEventId:lastEventId,makeMain:makeMain,makeMultiplexedTransport:makeMultiplexedTransport,metrics:metrics,moduleMetadataIntegration:moduleMetadataIntegration,parameterize:parameterize,setContext:setContext,setCurrentClient:setCurrentClient,setExtra:setExtra,setExtras:setExtras,setHttpStatus:setHttpStatus,setMeasurement:setMeasurement,setTag:setTag,setTags:setTags,setUser:setUser,spanStatusfromHttpCode:spanStatusfromHttpCode,startInactiveSpan:startInactiveSpan,startSession:startSession,startSpan:startSpan,startSpanManual:startSpanManual,startTransaction:startTransaction,trace:trace,withActiveSpan:withActiveSpan,withIsolationScope:withIsolationScope,withScope:withScope,WINDOW:WINDOW$5,BrowserClient:BrowserClient,makeFetchTransport:makeFetchTransport,makeXHRTransport:makeXHRTransport,chromeStackLineParser:chromeStackLineParser,defaultStackLineParsers:defaultStackLineParsers,defaultStackParser:defaultStackParser,geckoStackLineParser:geckoStackLineParser,opera10StackLineParser:opera10StackLineParser,opera11StackLineParser:opera11StackLineParser,winjsStackLineParser:winjsStackLineParser,eventFromException:eventFromException,eventFromMessage:eventFromMessage,exceptionFromError:exceptionFromError,createUserFeedbackEnvelope:createUserFeedbackEnvelope,captureUserFeedback:captureUserFeedback,defaultIntegrations:defaultIntegrations,forceLoad:forceLoad,getDefaultIntegrations:getDefaultIntegrations,init:init,onLoad:onLoad,showReportDialog:showReportDialog,wrap:wrap,Breadcrumbs:Breadcrumbs,breadcrumbsIntegration:breadcrumbsIntegration,Dedupe:Dedupe,GlobalHandlers:GlobalHandlers,globalHandlersIntegration:globalHandlersIntegration,HttpContext:HttpContext,httpContextIntegration:httpContextIntegration,LinkedErrors:LinkedErrors,linkedErrorsIntegration:linkedErrorsIntegration,TryCatch:TryCatch,browserApiErrorsIntegration:browserApiErrorsIntegration,Replay:Replay$1,getReplay:getReplay$1,replayIntegration:replayIntegration$1,ReplayCanvas:ReplayCanvas,replayCanvasIntegration:replayCanvasIntegration,Feedback:Feedback,feedbackIntegration:feedbackIntegration,sendFeedback:sendFeedback,captureConsoleIntegration:captureConsoleIntegration,contextLinesIntegration:contextLinesIntegration,debugIntegration:debugIntegration,dedupeIntegration:dedupeIntegration,extraErrorDataIntegration:extraErrorDataIntegration,httpClientIntegration:httpClientIntegration,reportingObserverIntegration:reportingObserverIntegration,rewriteFramesIntegration:rewriteFramesIntegration,sessionTimingIntegration:sessionTimingIntegration,BrowserTracing:BrowserTracing,browserTracingIntegration:browserTracingIntegration,defaultRequestInstrumentationOptions:defaultRequestInstrumentationOptions,instrumentOutgoingRequests:instrumentOutgoingRequests,startBrowserTracingNavigationSpan:startBrowserTracingNavigationSpan,startBrowserTracingPageLoadSpan:startBrowserTracingPageLoadSpan,makeBrowserOfflineTransport:makeBrowserOfflineTransport,onProfilingStartRouteTransaction:onProfilingStartRouteTransaction,BrowserProfilingIntegration:BrowserProfilingIntegration,browserProfilingIntegration:browserProfilingIntegration});const getSystemLanguage=()=>{let e=navigator.languages?navigator.languages[0].substr(0,2).toUpperCase():defaultLanguage;e=checkForRegionalVariantOption(e);return supportedLanguages.map((e=>e.langCode)).includes(e)?e:defaultLanguage},getInitialLanguagePreference=()=>{const e={};return supportedLanguages.forEach((t=>{let n=t.langCode;["EN-GB","EN-US"].includes(n)&&(n="EN"),["PT-PT","PT-BR"].includes(n)&&(n="PT"),["ZH-HANT"].includes(n)&&(n="ZH"),e[n]=0})),e},transformLangCodeToSupportedLangCode=e=>e.substring(0,2).toUpperCase();function checkForRegionalVariantOption(e){return"EN"===e?"EN-GB":"PT"===e?"PT-PT":e}const isLanguageSupportedForWrite=e=>SUPPORTED_WRITE_LANGUAGES.includes(e?.substr(0,2).toUpperCase()),fuzzyFindSupportedLanguage=e=>{let t=supportedLanguages.find((t=>t.langCode.toUpperCase()===e.toUpperCase()));return t||(t=supportedLanguages.find((t=>t.langCode.substring(0,2).toUpperCase()===e.substring(0,2).toUpperCase())),t)};function getAlphabeticCharactersLength(e){try{return e.replace(/[^\p{L}]/gu,"").length}catch(t){return e.replace(/[^a-zA-Z]/g,"").length}}function formatLocale(e){const t=e.split("-");if(2===t.length){return t[0].toLowerCase()+"-"+t[1].toUpperCase()}return e}function getRegionalLanguageSet(e,t){const n=["EN-US","EN-GB","PT-PT","PT-BR","ZH-HANT"].includes(e?.toUpperCase());let r,o=e?.toUpperCase();return n&&(o=e?.toUpperCase().slice(0,2),r=t||formatLocale(e?.toUpperCase())),{langCode:o,regionalVariant:r}}function getLanguageInITAFormat(e){let t=e.split("-"),n=t[0].toLowerCase();return 2===t.length&&(n+=`-${t[1].toUpperCase()}`),n}const getInitSettings=()=>({settingSchemeVersion:39,blacklistDomains:[],blacklistDomainsForReading:[],blacklistDomainsForWriting:[],languagesForTranslation:supportedLanguages.reduce(((e,t)=>({...e,[t.langCode]:languageStatus.UNDEFINED})),{}),selectedTargetLanguage:getSystemLanguage(),isTargetLanguageConfirmed:!1,deepLProApiKey:{IS_PROD:!0,BASE_URLS:{dapApi:"https://s.deepl.com/chrome/statistics",toolingApiPro:"https://api.deepl.com/jsonrpc?client=chrome-extension,1.26.1",toolingApi:"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.26.1",toolingWriteApiPro:"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.26.1",toolingWriteApi:"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.26.1",classicApi:"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.26.1",classicApiPro:"https://api.deepl.com/jsonrpc?client=chrome-extension,1.26.1",classicApiWrite:"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.26.1",classicApiWritePro:"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.26.1",classicApiGlossary:"https://api.deepl.com/termbases/jsonrpc?client=chrome-extension,1.26.1",login:"https://www.deepl.com/auth/login",token:"https://w.deepl.com/oidc/token",logout:"https://www.deepl.com/auth/logout",feedbackSurvey:"https://deepl.typeform.com/to/MkMfP2Y6",newFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_cMvbeX0WZGvkKGi",firefoxFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_eyfDZqQmXuNTFOK",uninstallSurvey:"https://deepl.qualtrics.com/jfe/form/SV_eJxAD8c7J5hqSRU",gslidesFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_9XBLSAbDmLq5emO",deeplPro:"https://www.deepl.com/pro",deeplProWrite:"https://www.deepl.com/pro-write",deeplTranslator:"https://www.deepl.com/translator",deeplDoctrans:"https://www.deepl.com/translator/files",deeplTermsOfServiceFree:"https://www.deepl.com/en/pro-license?tab=free",deeplCreateAccount:"https://www.deepl.com/signup",extensionStorePage:"https://bit.ly/DeepL-Chrome",supportArticle:"https://support.deepl.com/hc/articles/4407580229522",deeplSupport:"https://support.deepl.com/hc",chromeWebstore:"https://chrome.google.com/webstore/detail/deepl-translate-reading-w/cofdbpoegempjloogbagkncekinflcnj",edgeWebstore:"https://microsoftedge.microsoft.com/addons/detail/deepl-translate-reading-/fancfknaplihpclbhbpclnmmjcjanbaf",firefoxWebstore:"https://addons.mozilla.org/en-US/firefox/addon/deepl-translate",firefoxShortcutDocs:"https://support.mozilla.org/kb/manage-extension-shortcuts-firefox",firefoxPrivacyPolicy:"https://addons.mozilla.org/en-US/firefox/addon/deepl-translate/privacy/",clientStateApi:"https://w.deepl.com/web",experimentsEndpoint:"https://s.deepl.com/chrome/experiments",gmailFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_db8ItFTmYBcZjYW",customerSegmentationSurveyFree:"https://deepl.qualtrics.com/jfe/form/SV_3LbBcdg4mjQuCCq?desc=TG-2071",customerSegmentationSurveyPro:"https://deepl.qualtrics.com/jfe/form/SV_3LbBcdg4mjQuCCq?desc=TG-2070",arabicSurvey:"https://deepl.qualtrics.com/jfe/form/SV_ekTrC2ePp0wn7xQ",msAddinsDeepLAds:"https://www.deepl.com/en/microsoft-365"},APP_VERSION:"1.26.1",FEATURE_FLAGS:{TRANSLATE_INPUT:!0,PAGE_TRANSLATION:!0,IMPROVE_WRITING:!0,DOCUMENT_TRANSLATION:!0,RECOMMEND_TO_A_FRIEND:!0,PRO_LOGIN:!0,WEBPAGE_CUSTOMIZER:!0,GDOCS_INTEGRATION:!0,ZENDESK_INTEGRATION:!0,GMAIL_INTEGRATION:!0,GSLIDES_INTEGRATION:!0,ON_INSTALL_ONBOARDING:!0,WHATSAPP_TRANSLATE_ALL_CHAT:!1,DEEPL_WRITE_GENERAL:!1,DEEPL_WRITE_GDOCS:!0,SHOW_CUSTOMER_SEGMENTATION_SURVEY:!1,ARABIC_SURVEY:!0,REVIEW_UI_WITH_ITA:!1}}.DEEPL_PRO_API_KEY,installationId:getUUID(),enableFullPageTranslation:!0,enableInputTranslation:!0,enableInlineTranslation:!0,languagePreferenceForWriting:getInitialLanguagePreference(),languagePreferenceForReading:getInitialLanguagePreference(),languagePreferenceForDeeplWrite:"EN-US",blacklistedPopupWidgets:[],successfulTranslations:0,successfulArabicTranslations:0,isReviewPopupShown:!1,shouldDisplayFeedbackPopup:!1,isInputHighlighterShown:!1,isInlineHighlighterShown:!1,regionalVariant:void 0,isSurveyLinkHidden:!1,isGlossaryEnabled:!1,activeTermbaseId:null,isZendeskOnboarded:!1,isZendeskEnabled:!0,isZendeskOnboardingShown:!1,zendeskFormality:"auto",zendeskSuccessfulTranslations:0,zendeskActiveTermbase:null,isGDocsEnabled:!0,isGDocsOnboardingShown:!1,gDocsSegmentation:ALTERNATIVES_SEGMENTATION_MODE.SENTENCE,gDocsWriteLang:null,isGmailEnabled:!0,wasGmailOnboardingShown:!1,successfulTranslationsGmail:0,wasGmailFeedbackPopupShown:!1,isGSlidesEnabled:!0,isGSlidesOnboardingShown:!1,wasGSlidesFeedbackPopupShown:!1,successfulTranslationsGSlides:0,isWhatsAppWebEnabled:!0,isTwitterEnabled:!0,customizationsActiveStates:{[PLATFORM_BEHAVIOURS.linkedIn]:!0},hasUserSeenAccountCreationNudge:!1,hasUserSeenPostAccountCreationOnboarding:!1,hasUserSeenProCustomerSegmentationSurvey:!1,firefoxAnonPermissionGranted:!0,firefoxPersonalPermissionGranted:!1}),ENV={prod:"production",dev:"development",test:"testing"};function getCurrentEnv(){return ENV.prod}function isDev(){return getCurrentEnv()===ENV.dev}function isProd(){return getCurrentEnv()===ENV.prod}function isTest(){return getCurrentEnv()===ENV.test}function noop$2(){}function run(e){return e()}function run_all(e){e.forEach(run)}function is_function(e){return"function"==typeof e}function safe_not_equal(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function subscribe(e,...t){if(null==e){for(const e of t)e(void 0);return noop$2}const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}const subscriber_queue=[];function readable(e,t){return{subscribe:writable(e,t).subscribe}}function writable(e,t=noop$2){let n;const r=new Set;function o(t){if(safe_not_equal(e,t)&&(e=t,n)){const t=!subscriber_queue.length;for(const t of r)t[1](),subscriber_queue.push(t,e);if(t){for(let e=0;e<subscriber_queue.length;e+=2)subscriber_queue[e][0](subscriber_queue[e+1]);subscriber_queue.length=0}}}function a(t){o(t(e))}return{set:o,update:a,subscribe:function(i,s=noop$2){const c=[i,s];return r.add(c),1===r.size&&(n=t(o,a)||noop$2),i(e),()=>{r.delete(c),0===r.size&&n&&(n(),n=null)}}}}function derived(e,t,n){const r=!Array.isArray(e),o=r?[e]:e;if(!o.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const a=t.length<2;return readable(n,((e,n)=>{let i=!1;const s=[];let c=0,l=noop$2;const u=()=>{if(c)return;l();const o=t(r?s[0]:s,e,n);a?e(o):l=is_function(o)?o:noop$2},d=o.map(((e,t)=>subscribe(e,(e=>{s[t]=e,c&=~(1<<t),i&&u()}),(()=>{c|=1<<t}))));return i=!0,u(),function(){run_all(d),l(),i=!1}}))}function sendAction(e){return new Promise(((t,n)=>{chrome.runtime.sendMessage(e,(function(e){e&&e.error&&n(e),t(e)}))}))}function createSettings(){const{subscribe:e,set:t,update:n}=writable({});return chrome.storage.sync.get(null,(e=>{t(e),chrome.storage.local.get(["isLoggedIn","isProUser","translatorServiceType","writeServiceType","apiServiceType","docTranslatorServiceType","browserInstanceId","featureSet","hasTermbaseService"],(e=>{n((t=>({...t,...e})))}))})),chrome.storage.onChanged.addListener((e=>{const t=["a_t","r_t","i_t","accountId"];let r={};for(const[n,o]of Object.entries(e))!1===t.includes(n)&&(r[n]=o.newValue);if(isDev()){const e="background-color: #324054;padding: 3px; font-size:12px;color:#e1e8c3; font-weight:600";console.log(`%c${(new Date).toISOString()} UPDATE USER SETTINGS`,e,r)}n((e=>({...e,...r})))})),{subscribe:e,set:e=>chrome.storage.sync.set(e)}}function createWebsiteSettings(){const{subscribe:e,update:t}=writable({});return chrome.runtime.onMessage.addListener((function(e,n){switch(e.action){case"newWebsiteState":e.payload&&t((t=>({...t,[n.tab.id]:{...t[n.tab.id],...e.payload,error:e.payload.error?e.payload.error:void 0}})));break;case"resetWebsiteState":e.payload&&t((t=>({...t,[n.tab.id]:{...e.payload}})))}})),{subscribe:e,fetchCurrentWebsiteSettings:()=>{chrome.tabs&&chrome.tabs.query({active:!0,currentWindow:!0},(function(e){chrome.tabs.sendMessage(e[0].id,{action:"dlGetWebsiteData"},(function(n){t((t=>({...t,[e[0].id]:{...t[e[0].id],...n}})))}))}))}}}const settings=createSettings(),allTabsSettings=createWebsiteSettings();function createExperimentState(){const{subscribe:e,set:t}=writable([]);return sendAction({action:"dlGetExperiments",payload:{forceFetch:!1}}).then((e=>t(e))),chrome.runtime.onMessage.addListener((function(e){if("dlExperimentsUpdated"===e.action)e.payload&&t(e.payload.experiments)})),{subscribe:e}}derived(allTabsSettings,(async(e,t)=>{if(!chrome.tabs)return;t(e[(await chrome.tabs.query({active:!0,currentWindow:!0}))[0].id])})),createExperimentState();const NO_SETTINGS_ERROR="No settings supplied to getServiceType",UNIDENTIFIED_SERVICE_ERROR_MESSAGE="Unidentified service name supplied to getServiceType",getServiceType=(e,t)=>{if(!e)throw new Error(NO_SETTINGS_ERROR);if(!Object.keys(SERVICE_NAME).includes(t))throw new Error(UNIDENTIFIED_SERVICE_ERROR_MESSAGE);if(!e.isLoggedIn)return SERVICE_LEVEL$1.free;switch(t){case SERVICE_NAME.TRANSLATOR:return e.translatorServiceType;case SERVICE_NAME.WRITE:return e.writeServiceType;case SERVICE_NAME.API:return e.apiServiceType;case SERVICE_NAME.DOC_TRANSLATOR:return e.docTranslatorServiceType}},userHasProServiceLevel=(e,t)=>getServiceType(e,t)===SERVICE_LEVEL$1.pro,userHasGlossaryService=e=>e.isLoggedIn&&e.hasTermbaseService,getIgnoredErrorPatterns=()=>[/Receiving end does not exist/,/message channel closed before a response was received/,/Extension context invalidated/],shouldIgnoreError=e=>!!getIgnoredErrorPatterns().some((t=>t.test(e))),initialSentryConfig={dsn:"https://f7c23f019d154c319e91e8de004727dc@errortracking.deepl.com/12",release:"deepl-browser-extension@1.26.1",environment:getCurrentEnv(),tracesSampleRate:isProd()?.1:1,sampleRate:isProd()?.1:1,ignoreErrors:getIgnoredErrorPatterns(),beforeSend(e){const t=e.message||e.exception&&e.exception.values&&e.exception.values[0].value||"";return shouldIgnoreError(t)?null:e}},createSentryUserListener=e=>{chrome.storage.sync.get(["installationId","session","isLoggedIn","translatorServiceType","writeServiceType"],(function(t){e.setTag("internal_session_id",t.session.id),e.setTag("is_translator_pro",userHasProServiceLevel(t,SERVICE_NAME.TRANSLATOR)),e.setTag("is_write_pro",userHasProServiceLevel(t,SERVICE_NAME.WRITE)),e.setTag("is_logged_in",t.isLoggedIn)})),chrome.storage.local.get("browserInstanceId",(function(t){e.setTag("browser_instance_id",t.browserInstanceId)})),chrome.storage.onChanged.addListener((t=>{t?.session?.newValue&&e.setTag("internal_session_id",t.session.newValue.id),t?.installationId&&e.setUser({id:t.installationId}),t?.browser_instance_id&&e.setTag("browser_instance_id",settings.browserInstanceId.newValue),!0!==t.isLoggedIn?.newValue&&!1!==t.isLoggedIn?.newValue||e.setTag("is_logged_in",t.isLoggedIn.newValue),t.translatorServiceType&&chrome.storage.sync.get(["isLoggedIn"],e.setTag("is_translator_pro",userHasProServiceLevel({...settings,translatorServiceType:t.translatorServiceType.newValue},SERVICE_NAME.TRANSLATOR))),t.writeServiceType&&chrome.storage.sync.get(["isLoggedIn"],e.setTag("is_write_pro",userHasProServiceLevel({...settings,writeServiceType:t.writeServiceType.newValue},SERVICE_NAME.WRITE)))}))};function trackErrorMessage(e,t){t.captureException(e)}const TOOLING_API_ERROR_CODES={PROTOCOL_ERROR:"PROTOCOL_ERROR",NETWORK_ERROR:"NETWORK_ERROR",FULL_PAGE_SERVER_ERROR:"FULL_PAGE_SERVER_ERROR",USER_UNAUTHORIZED:"-32003",USER_BLOCKED:"429",FORBIDDEN_REQUEST:"403",QUOTA_HAS_BEEN_REACHED:"1045601",TOO_MANY_REQUESTS:"1042902"},LINGUEE_API_ERROR_CODES={ENTRY_NOT_FOUND:"ENTRY_NOT_FOUND",SERVER_ERROR:"SERVER_ERROR"},EXTENSION_ERRROR_CODES={INSTALLATION_ERROR:"INSTALLATION_ERROR",TRANSLATED_INPUT_NOT_SET:"TRANSLATED_INPUT_NOT_SET",HTML_NODE_CHAR_LENGTH_TOO_LONG:"HTML_NODE_CHAR_LENGTH_TOO_LONG"},LIMITS_EXCEEDED_ERROR_CODES={TRANSLATOR_FREE_ACCOUNT_LIMIT_EXCEEDED:"TRANSLATOR_FREE_ACCOUNT_LIMIT_EXCEEDED",TRANSLATOR_ANONYMOUS_LIMIT_EXCEEDED:"TRANSLATOR_ANONYMOUS_LIMIT_EXCEEDED",TRANSLATOR_FREE_ANON_WITH_WRITE_PRO:"TRANSLATOR_FREE_ANON_WITH_WRITE_PRO",WRITE_ANON_OR_FREE_LIMIT_EXCEEDED:"WRITE_ANON_OR_FREE_LIMIT_EXCEEDED",WRITE_WITH_PRO_TRANSLATOR_LIMIT_EXCEEDED:"WRITE_WITH_PRO_TRANSLATOR_LIMIT_EXCEEDED"};class ToolingApiProtocolError extends Error{constructor(e){super(e),this.name=TOOLING_API_ERROR_CODES.PROTOCOL_ERROR,this.message=e}}class ToolingApiFullPageServerError extends Error{constructor(e){super(e),this.name=TOOLING_API_ERROR_CODES.FULL_PAGE_SERVER_ERROR,this.message=e}}class ToolingApiErrorCode extends Error{constructor(e,t){super(t),this.name=e,this.message=t}}class FreeAccountLimitExceeded extends Error{constructor(e,t){super(t),this.name=LIMITS_EXCEEDED_ERROR_CODES.TRANSLATOR_FREE_ACCOUNT_LIMIT_EXCEEDED,this.limit=e,this.message=t}}class AnonymousUserLimitExceeded extends Error{constructor(e,t){super(t),this.name=LIMITS_EXCEEDED_ERROR_CODES.TRANSLATOR_ANONYMOUS_LIMIT_EXCEEDED,this.limit=e,this.message=t}}class WriteAnonymousOrFreeUserLimitExceeded extends Error{constructor(e,t){super(t),this.name=LIMITS_EXCEEDED_ERROR_CODES.WRITE_ANON_OR_FREE_LIMIT_EXCEEDED,this.limit=e,this.message=t}}class WriteWithTranslatorProLimitExceeded extends Error{constructor(e,t){super(t),this.name=LIMITS_EXCEEDED_ERROR_CODES.WRITE_WITH_PRO_TRANSLATOR_LIMIT_EXCEEDED,this.limit=e,this.message=t}}class FreeOrAnonTranslatorWithWriteProLimitExceeded extends Error{constructor(e,t){super(t),this.name=LIMITS_EXCEEDED_ERROR_CODES.TRANSLATOR_FREE_ANON_WITH_WRITE_PRO,this.limit=e,this.message=t}}class LingueeApiErrorCode extends Error{constructor(e,t){super(t),this.name=e,this.message=t}}function handleError(e,t){try{trackErrorMessage(e,t),console.error(e)}catch(e){console.error(e)}return{error:e.name}}function getDapApiConfig(){return{url:"https://s.deepl.com/chrome/statistics"}}function getDapApiTranslationTriggerId(e){switch(e){case TRANSLATION_TRIGGER.manual:return 1;case TRANSLATION_TRIGGER.automatic:return 2;case TRANSLATION_TRIGGER.inline:return 3;case TRANSLATION_TRIGGER.input:return 4;case TRANSLATION_TRIGGER.input_alternatives:return 5;default:return 0}}function getDapApiLingueeError(e){switch(e){case LINGUEE_API_ERROR_CODES.ENTRY_NOT_FOUND:return 1;case LINGUEE_API_ERROR_CODES.SERVER_ERROR:return 2}}function getDapApiExtensionOpenedFromId(e){switch(e){case EXTENSION_CONTEXT.defaultPopup:return EXTENSION_OPENED_FROM.extensionIcon;case EXTENSION_CONTEXT.fptInjectedPopup:return EXTENSION_OPENED_FROM.fptAutoInject;default:return 0}}function getDapApiLogoClickedFromId(e){switch(e){case EXTENSION_CONTEXT.defaultPopup:return LOGO_CLICKED_FROM.defaultPopup;case EXTENSION_CONTEXT.fptInjectedPopup:return LOGO_CLICKED_FROM.injectedFptPopup;case EXTENSION_CONTEXT.inlineTooltipPopup:return LOGO_CLICKED_FROM.inlinePopup;default:return 0}}function getDapApiNotificationType(e){return e===NOTIFICATION_TYPES.hintKeyboardShortcut?1:0}function getDapApiUiLocation(e){switch(e){case UI_LOCATIONS.inputTranslationTriggerIcon:return 1;case UI_LOCATIONS.inlineTranslationTriggerIcon:return 2;case UI_LOCATIONS.inlineTranslationSettingPopup:return 3;case UI_LOCATIONS.inputTranslationSettingPopup:return 4;case UI_LOCATIONS.settingsPageFPT:return 5;case UI_LOCATIONS.settingsPageReading:return 6;case UI_LOCATIONS.settingsPageWriting:return 7;case UI_LOCATIONS.fptHideModal:return 8;case UI_LOCATIONS.inputTranslationSettingsIcon:return 9;case UI_LOCATIONS.inlineTranslationSettingsIcon:return 10;case UI_LOCATIONS.inputTranslationReadMoreLink:return 11;case UI_LOCATIONS.inlineTranslationReadMoreLink:return 12;case UI_LOCATIONS.fptTranslationReadMoreLink:return 13;case UI_LOCATIONS.extensionHubToggleSwitch:return 14;case UI_LOCATIONS.hubCustomizeShortcut:return 15;case UI_LOCATIONS.hubLoginButton:return 16;case UI_LOCATIONS.hubUpgradeToProLink:return 17;case UI_LOCATIONS.hubTryProLink:return 18;case UI_LOCATIONS.settingsPageCustomizeShortcutButton:return 19;case UI_LOCATIONS.hubFPTEnableCheckbox:return 20;case UI_LOCATIONS.hubFPTDisableCheckbox:return 21;case UI_LOCATIONS.deeplWriteIcon:return 22;case UI_LOCATIONS.hubViewIntegrations:return 23;case UI_LOCATIONS.hubCloseCustomizationsWidget:return 24;case UI_LOCATIONS.gmailOnboardingPopup:return 25;case UI_LOCATIONS.gmailOnboardingIcon:return 26;case UI_LOCATIONS.gmailCharLimitLogin:return 27;case UI_LOCATIONS.gmailFeedbackSurvey:return 28;case UI_LOCATIONS.gslidesFeedbackSurvey:return 29;case UI_LOCATIONS.gslidesCharLimitLogin:return 30;case UI_LOCATIONS.zendeskTryProLink:return 31;case UI_LOCATIONS.settingsPageIntegrations:return 32;case UI_LOCATIONS.onboardingSignUp:return 33;case UI_LOCATIONS.onboardingSkipSignUp:return 34;case UI_LOCATIONS.onboardingLoginLink:return 35;case UI_LOCATIONS.onboardingSeeAllIntegrations:return 36;case UI_LOCATIONS.inputImproveTriggerIcon:return 37;case UI_LOCATIONS.iconToggleInHubTranslator:return 38;case UI_LOCATIONS.iconToggleInHubWrite:return 39;case UI_LOCATIONS.manageIconSettings:return 40;case UI_LOCATIONS.writeLanguageSwitchedInHub:return 41;case UI_LOCATIONS.writeLanguageSwitchedInSettings:return 42;default:return 0}}function getDapApiShortcutTypes(e){return e===SHORTCUT_TYPES.triggerTranslation?1:0}function getDapApiUiActionEventId(e){switch(e){case UI_ACTION.clickOnShortcutNotifiction:return 60011;case UI_ACTION.clickOnInlineTranslationShowAlternatives:return 60026;case UI_ACTION.clickOnInlineTranslationCloseIcon:return 60027;case UI_ACTION.clickOnLogoutMenuEntry:return 60028;default:return 0}}function getDapApiUiFunctionality(e){switch(e){case UI_FUNCTIONS.inputTranslation:return 1;case UI_FUNCTIONS.inlineTranslation:return 2;case UI_FUNCTIONS.fullPageTranslation:return 3;default:return 0}}function getDapApiSettingType(e){switch(e){case SETTING_TYPES.disableEverywhere:return 1;case SETTING_TYPES.disablePerSite:return 2;case SETTING_TYPES.enableEverywhere:return 3;case SETTING_TYPES.enablePerSite:return 4;default:return 0}}function getDapApiInlinePositionType(e){switch(e){case"top":return INLINE_POSITION_TYPES.top;case"right":return INLINE_POSITION_TYPES.right;case"bottom":return INLINE_POSITION_TYPES.bottom;case"left":return INLINE_POSITION_TYPES.left;default:return 0}}function getDapOnboardingExternalLink(e){switch(e){case URL_ACTIONS.shortcut_settings:return URL_LIST.SHORTCUT_SETTINGS;case URL_ACTIONS.support_article:return URL_LIST.SUPPORT_ARTICLE;case URL_ACTIONS.external.whatsapp:return URL_LIST.EXTERNAL.WHATSAPP;case URL_ACTIONS.external.twitter:return URL_LIST.EXTERNAL.TWITTER;case URL_ACTIONS.external.youtube:return URL_LIST.EXTERNAL.YOUTUBE;case URL_ACTIONS.external.facebook:return URL_LIST.EXTERNAL.FACEBOOK;case URL_ACTIONS.external.github:return URL_LIST.EXTERNAL.GITHUB;case URL_ACTIONS.external.discord:return URL_LIST.EXTERNAL.DISCORD;case URL_ACTIONS.external.telegram:return URL_LIST.EXTERNAL.TELEGRAM;case URL_ACTIONS.external.reddit:return URL_LIST.EXTERNAL.REDDIT;case URL_ACTIONS.external.gmail:return URL_LIST.EXTERNAL.GMAIL;case URL_ACTIONS.external.gdocs:return URL_LIST.EXTERNAL.GDOCS;case URL_ACTIONS.external.gslides:return URL_LIST.EXTERNAL.GSLIDES;case URL_ACTIONS.external.msOffice:return URL_LIST.EXTERNAL.MSOFFICE;default:return""}}function getDapOnboardingStepChangeTrigger(e){switch(e){case ONBOARDING_STEP_CHANGE_TRIGGERS.openPage:return 1;case ONBOARDING_STEP_CHANGE_TRIGGERS.backButton:return 2;case ONBOARDING_STEP_CHANGE_TRIGGERS.nextButton:return 3;case ONBOARDING_STEP_CHANGE_TRIGGERS.navigation:return 4;default:return 0}}function getDapOriginStore(e){switch(e){case ORIGIN_STORE_URLS.chrome:return ORIGIN_STORE.chrome;case ORIGIN_STORE_URLS.edge:return ORIGIN_STORE.edge;case ORIGIN_STORE_URLS.firefox:return ORIGIN_STORE.firefox;case ORIGIN_STORE_URLS.local:return ORIGIN_STORE.local;default:return ORIGIN_STORE.unspecified}}function getWebsiteIdFromWebsite(e){return LANDING_ON_WEBSITE_DAP_IDS[e]||0}function getDapNicheIntegration(e){switch(e){case PLATFORM_BEHAVIOURS.default:return 1;case PLATFORM_BEHAVIOURS.gdocs:return 2;case PLATFORM_BEHAVIOURS.whatsappWeb:return 3;case PLATFORM_BEHAVIOURS.twitter:return 4;case PLATFORM_BEHAVIOURS.zendesk:return 5;case PLATFORM_BEHAVIOURS.gmail:return 6;case PLATFORM_BEHAVIOURS.gslides:return 7;case PLATFORM_BEHAVIOURS.linkedIn:return 8;default:return 0}}function getWriteStyle(e){switch(e){case WRITE_STYLE_NAMES.simple:return 1;case WRITE_STYLE_NAMES.business:return 2;case WRITE_STYLE_NAMES.academic:return 3;case WRITE_STYLE_NAMES.casual:return 4;case WRITE_STYLE_NAMES.enthusiastic:return 5;case WRITE_STYLE_NAMES.friendly:return 6;case WRITE_STYLE_NAMES.confident:return 7;case WRITE_STYLE_NAMES.diplomatic:return 8;default:return 0}}function isPayloadNecessaryForUIEvent(e){switch(e){case 60026:case 60027:return!0;default:return!1}}function getDapLogoutTrigger(e){switch(e){case LOGOUT_TRIGGER.user:return 1;case LOGOUT_TRIGGER.extension:return 2;default:return 0}}function getDapSessionTypeTrigger(e){switch(e){case SESSION_TYPE_TRIGGER.translation:return 1;case SESSION_TYPE_TRIGGER.login:return 2;default:return 0}}function getDapWhatsAppTranslator(e){switch(e){case WHATSAPP_TRANSLATOR_TYPE.message:return 1;case WHATSAPP_TRANSLATOR_TYPE.chat:return 2;default:return 0}}function getDapServiceLevel(e){switch(e){case SERVICE_LEVEL$1.free:return 1;case SERVICE_LEVEL$1.pro:return 2;case SERVICE_LEVEL$1.none:return 3;default:return 0}}function getDapGmailActionType(e){switch(e){case GMAIL_ACTION_TYPE.READING_VIEW_TRANSLATE:return 1;case GMAIL_ACTION_TYPE.COMPOSE_VIEW_TRANSLATE:return 2;case GMAIL_ACTION_TYPE.COMPOSE_VIEW_IMPROVE:return 3;default:return 0}}function getDapUpgradeNotificationType(e){switch(e){case UPGRADE_NOTIFICATION_TYPE.ANONYMOUS_USER_LIMIT_EXCEEDED:return 1;case UPGRADE_NOTIFICATION_TYPE.FREE_ACCOUNT_LIMIT_EXCEEDED:return 2;case UPGRADE_NOTIFICATION_TYPE.WRITE_ANONYMOUS_USER_LIMIT_EXCEEDED:return 3;case UPGRADE_NOTIFICATION_TYPE.WRITE_FREE_ACCOUNT_LIMIT_EXCEEDED:return 4;default:return 0}}function getDapContentProcessingModeType(e){switch(e){case TEXT_PROCESSING_MODE.translate:return 1;case TEXT_PROCESSING_MODE.write:return 2;default:return 0}}function getDapUpgradeNotificationAction(e){switch(e){case UPGRADE_NOTIFICATION_ACTION.LOGIN:return 1;case UPGRADE_NOTIFICATION_ACTION.SIGNUP:return 2;case UPGRADE_NOTIFICATION_ACTION.PRO_TRIAL:return 3;default:return 0}}function getDapAlternativesSegmentationType(e){switch(e){case ALTERNATIVES_SEGMENTATION_MODE.WORD:return 1;case ALTERNATIVES_SEGMENTATION_MODE.SENTENCE:return 2;default:return 0}}function getDapSessionType(e){switch(e){case OIDC_SESSION_TYPE.none:return 1;case OIDC_SESSION_TYPE.pro:return 2;case OIDC_SESSION_TYPE.free:return 3;default:return 0}}const PERSONAL_INFO_KEYS=["accountData","domainName"],ACCOUNT_INFO_EVENTS=[60067,60068,60069],removeKeysFromDapObject=(e,t)=>e&&"object"==typeof e?Array.isArray(e)?e.map((e=>removeKeysFromDapObject(e,t))):Object.keys(e).reduce(((n,r)=>(t.includes(r)||(n[r]=removeKeysFromDapObject(e[r],t)),n)),{}):e,adjustDapForFirefoxPermissions=(e,t=!1,n=!1)=>e?n&&t?e:!n&&ACCOUNT_INFO_EVENTS.includes(e?.eventId)?null:removeKeysFromDapObject(e,PERSONAL_INFO_KEYS):null,isDapTrackingInFirefoxAllowed=(e=!1,t=!1)=>!(!e&&!t)&&(!(!e&&t)&&(!(!e||t)||(!(!e||!t)||void 0)));async function sendDAPEvent(e){let t,n,r,o,a,i,s,c,l,u,d,p=!1;try{const e=await getSettings(["session","installationId","firefoxAnonPermissionGranted","firefoxPersonalPermissionGranted"]);n=e.session.id,t=e.installationId,u=e.firefoxAnonPermissionGranted,d=e.firefoxPersonalPermissionGranted}catch(e){console.error(`DAP: Failed to fetch settings. Error: ${e.message}`)}try{const e=await getUserInfo();p=!!e.accountId,r=getDapServiceLevel(e.translatorServiceType),o=getDapServiceLevel(e.apiServiceType),a=getDapServiceLevel(e.docTranslatorServiceType),l=getDapServiceLevel(e.writeServiceType),s=p?2===r||2===o||2===l||2===a?USER_TYPE.loggedInPro:USER_TYPE.loggedInFree:USER_TYPE.notLoggedIn,c=e.sessionType?getDapSessionType(e.sessionType):getDapSessionType(OIDC_SESSION_TYPE.none)}catch(e){console.error(`DAP: Failed to fetch user information. Error: ${e.message}`)}try{i=await getBrowserInstanceId()}catch(e){console.error(e)}const g=getPlatformMetaData(),h=await getExperimentsData(),f={eventId:void 0,extensionVersion:"1.26.1",sessionId:n,sessionType:c,installationId:t,browserInstanceId:i,originStore:getDapOriginStore(chrome.runtime.id),userInfos:{userType:s,translatorServiceType:r,apiServiceType:o,docTranslatorServiceType:a,writeServiceType:l},userAgent:g.userAgent,platform:g.platform,browser:g.browser,browserVersion:g.browserVersion,browserLang:g.browserLang,clientExperiments:h};let m=e?e(f):f;if(isFirefoxExtension()){if(!isDapTrackingInFirefoxAllowed(u,d))return;if(m=adjustDapForFirefoxPermissions(m,u,d),!m)return}return fetch(getDapApiConfig().url,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(m),credentials:"omit"}).then((e=>{e.ok||console.log(`DAP ${m.eventId} request failed: ${e}`)}))}async function sendDAPTranslationRequest(e){return sendDAPEvent((t=>({...t,eventId:60001,translationRequestData:{extensionVersion:"1.26.1",domainName:e.domainName,userId:e.installationId,translationTrigger:getDapApiTranslationTriggerId(e.trigger),translationData:{sourceLang:e.websiteLanguage,targetLang:e.targetLanguage,sourceLength:e.characterCount},...e.translationPerformance&&{translationPerformance:e.translationPerformance},nicheIntegration:getDapNicheIntegration(e.nicheIntegration||PLATFORM_BEHAVIOURS.default),...e.glossaryTrackingInfo&&{isGlossaryEnabled:e.glossaryTrackingInfo.isGlossaryEnabled,isGlossaryShared:e.glossaryTrackingInfo.isGlossaryShared,didGlossaryChangeTranslation:e.glossaryTrackingInfo.didGlossaryChangeTranslation}}})))}async function sendDAPErrorData(e){return sendDAPEvent((t=>({...t,eventId:60002,errorData:{extensionVersion:"1.26.1",errorCode:e.errorCode,errorMessage:e.errorMessage}})))}async function sendDAPTranslationErrorData(e){return sendDAPEvent((t=>({...t,eventId:60003,translationErrorData:{errorData:{extensionVersion:"1.26.1",errorCode:e.errorCode,errorMessage:e.errorMessage},targetLang:e.targetLang,domainName:e.domainName,websiteLanguage:e.websiteLanguage,sourceLength:e.characterCount,translationTrigger:getDapApiTranslationTriggerId(e.trigger),nicheIntegration:getDapNicheIntegration(e.nicheIntegration||PLATFORM_BEHAVIOURS.default)}})))}async function sendDAPContentScriptErrorData(e){return sendDAPEvent((t=>({...t,eventId:60004,contentScriptErrorData:{errorData:{extensionVersion:"1.26.1",errorCode:e.errorCode,errorMessage:e.errorMessage},domainName:e.domainName}})))}async function sendDAPInputTranslationInjection(e){return sendDAPEvent((t=>({...t,eventId:60005,inputInjectionData:{extensionVersion:"1.26.1",domainName:e.domainName}})))}async function sendDAPFTPBlockSizeExceeded(e){return sendDAPEvent((t=>({...t,eventId:60006,fptBlockSizeExceededData:{translationData:{sourceLang:e.websiteLanguage,targetLang:e.targetLanguage,sourceLength:e.characterCount},domainName:e.domainName}})))}async function sendDAPExtensionOpened(e){return sendDAPEvent((t=>({...t,eventId:60007,extensionOpenedData:{extensionVersion:"1.26.1",domainName:e.domainName,extensionOpenedFrom:e.extensionOpenedFrom}})))}async function sendDAPLogoClicked(e){return sendDAPEvent((t=>({...t,eventId:60008,logoClickedData:{extensionVersion:"1.26.1",logoClickedFrom:e.logoClickedFrom}})))}async function sendDAPNotificationViewed(e){return sendDAPEvent((t=>({...t,eventId:60009,notificationViewedData:{extensionVersion:"1.26.1",notificationType:getDapApiNotificationType(e.notificationType)}})))}async function sendDAPShortcutUsed(e){return sendDAPEvent((t=>({...t,eventId:60010,shortcutUsedData:{shortcutType:getDapApiShortcutTypes(e.shortcutType),uiLocation:getDapApiUiLocation(e.location),shortcut:e.shortcut,nicheIntegration:getDapNicheIntegration(e.nicheIntegration||PLATFORM_BEHAVIOURS.default)}})))}async function sendDAPUiAction(e){const t={eventId:getDapApiUiActionEventId(e.uiAction)};return isPayloadNecessaryForUIEvent(t.eventId)&&(t.payload={nicheIntegration:getDapNicheIntegration(e.nicheIntegration||PLATFORM_BEHAVIOURS.default)}),sendDAPEvent((e=>({...e,...t})))}async function sendDAPDocTransClick(){return sendDAPEvent((e=>({...e,eventId:60012})))}async function sendDAPRecommendToAFriendClick(){return sendDAPEvent((e=>({...e,eventId:60013})))}async function sendDAPInlineSettingOpened(e){return sendDAPEvent((t=>({...t,eventId:60014,inlineSettingOpenedData:{uiFunction:getDapApiUiFunctionality(e.uiFunction),uiLocation:getDapApiUiLocation(e.uiLocation),nicheIntegration:getDapNicheIntegration(e.nicheIntegration)}})))}async function sendDAPSettingsChanged(e){return sendDAPEvent((t=>({...t,eventId:60015,settingChangedData:{settingType:getDapApiSettingType(e.settingType),uiFunction:getDapApiUiFunctionality(e.uiFunction),uiLocation:getDapApiUiLocation(e.uiLocation),domainName:e.domainName}})))}async function sendDAPDetectLanguage(e){return sendDAPEvent((t=>({...t,eventId:60016,detectLanguageData:{domainName:e.domainName,language:e.language}})))}async function sendDAPRightClick(e){return sendDAPEvent((t=>({...t,eventId:60017,rightClickData:{domainName:e.domainName,translationType:e.translationType}})))}async function sendDAPInlinePositionChange(e){return sendDAPEvent((t=>({...t,eventId:60018,inlinePositionChangeData:{newPosition:getDapApiInlinePositionType(e.newPosition)}})))}async function sendDAPInlineDragStart(e){return sendDAPEvent((t=>({...t,eventId:60019,inlineDragStartData:{nicheIntegration:getDapNicheIntegration(e?.nicheIntegration||PLATFORM_BEHAVIOURS.default)}})))}async function sendDAPWhatsAppMessageTranslated(e){return sendDAPEvent((t=>({...t,eventId:60020,whatsAppMessageTranslatedData:{messageLang:e.messageLang,targetLang:e.targetLang,messageLength:e.messageLength,translator:getDapWhatsAppTranslator(e.translator),numberOfLanguages:e.numberOfLanguages,numberOfMessages:e.numberOfMessages}})))}async function sendDAPWhatsAppMessageTranslationFailed(e){return sendDAPEvent((t=>({...t,eventId:60021,whatsAppMessageTranslationFailedData:{errorCode:e.errorCode,domainName:e.domainName,translationConfig:{messageLength:e.messageLength,targetLang:e.targetLang,messageLang:e.messageLang,translator:getDapWhatsAppTranslator(e.translator),numberOfLanguages:e.numberOfLanguages,numberOfMessages:e.numberOfMessages}}})))}async function sendDAPTwitterTweetTranslationFailed(e){return sendDAPEvent((t=>({...t,eventId:60057,twitterTweetTranslationFailedData:{errorCode:e.errorCode,domainName:e.domainName,translationConfig:{messageLength:e.messageLength,targetLang:e.targetLang,messageLang:e.messageLang}}})))}async function sendDAPFPTHide(e){return sendDAPEvent((t=>({...t,eventId:60022,fptHideData:{hideOption:e.hideOption,sourceLang:e.sourceLang,domainName:e.domainName,uiLocation:getDapApiUiLocation(e.uiLocation)}})))}async function sendDAPInlineCopy(e){return sendDAPEvent((t=>({...t,eventId:60023,inlineCopyData:{targetLang:e.targetLang,targetLength:e.targetLength,nicheIntegration:getDapNicheIntegration(e.nicheIntegration||PLATFORM_BEHAVIOURS.default)}})))}async function sendDAPInlineListen(e){return sendDAPEvent((t=>({...t,eventId:60024,inlineListenData:{targetLang:e.targetLang,targetLength:e.targetLength,actionType:e.actionType,nicheIntegration:getDapNicheIntegration(e.nicheIntegration||PLATFORM_BEHAVIOURS.default)}})))}async function sendDAPIconHover(e){return sendDAPEvent((t=>({...t,eventId:60025,iconHoverData:{uiLocation:getDapApiUiLocation(e.uiLocation),domainName:e.domainName,nicheIntegration:getDapNicheIntegration(e.nicheIntegration||PLATFORM_BEHAVIOURS.default)}})))}async function sendDAPOnboardingStepChange(e){return sendDAPEvent((t=>({...t,eventId:60029,onboardingStepChangeData:{previousStep:e.previousStep,newStep:e.newStep,trigger:getDapOnboardingStepChangeTrigger(e.trigger),secondsOnOnboarding:e.secondsOnOnboarding,secondsOnPreviousStep:e.secondsOnPreviousStep}})))}async function sendDAPOnboardingOpenExternalPage(e){return sendDAPEvent((t=>({...t,eventId:60030,onboardingOpenExternalPageData:{url:getDapOnboardingExternalLink(e.url)}})))}async function sendDAPReadMoreClicked(e){return sendDAPEvent((t=>({...t,eventId:60031,readMoreClickedData:{uiLocation:getDapApiUiLocation(e.uiLocation)}})))}async function sendDAPLandingOnSpecificWebsite(e){return sendDAPEvent((t=>({...t,eventId:60032,landOnWebsiteData:{website:getWebsiteIdFromWebsite(e.website)}})))}async function sendDAPVoiceOverStops(e){return sendDAPEvent((t=>({...t,eventId:60033,inlineListenData:{targetLang:e.targetLang,targetLength:e.targetLength,triggerType:e.triggerType,nicheIntegration:getDapNicheIntegration(e.nicheIntegration||PLATFORM_BEHAVIOURS.default)}})))}async function sendDAPOpenInputHighlighter(e){return sendDAPEvent((t=>({...t,eventId:60034,openInputHighlighterData:{domainName:e.domainName}})))}async function sendDAPCloseInputHighlighter(e){return sendDAPEvent((t=>({...t,eventId:60035,closeInputHighlighterData:{trigger:e.trigger}})))}async function sendDAPGDocsReplaceText(e){return sendDAPEvent((t=>({...t,eventId:60036,gdocsReplaceTextData:{sourceLang:e.sourceLang,targetLang:e.targetLang,sourceLength:e.sourceLength,targetLength:e.targetLength}})))}async function sendDAPInstallSuccess(){return sendDAPEvent((e=>({...e,eventId:60037})))}async function sendDAPOpenInlineHighlighter(e){return sendDAPEvent((t=>({...t,eventId:60038,openInputHighlighterData:{domainName:e.domainName}})))}async function sendDAPCloseInlineHighlighter(e){return sendDAPEvent((t=>({...t,eventId:60039,closeInputHighlighterData:{trigger:e.trigger}})))}async function sendDAPDictionaryStatus(e){return sendDAPEvent((t=>({...t,eventId:60040,dictionaryStatus:{status:e.status,langPair:e.langPair}})))}async function sendDAPOpenDictionarySection(){return sendDAPEvent((e=>({...e,eventId:60041})))}async function sendDAPDisabledDictionaryHover(){return sendDAPEvent((e=>({...e,eventId:60042})))}async function sendDAPLingueeErrorData(e){return sendDAPEvent((t=>({...t,eventId:60043,errorData:{lingueeError:getDapApiLingueeError(e.error)}})))}async function sendDAPZendeskCustomizationEvent(e,t){let n;switch(e){case ZENDESK_CUSTOMIZATION_EVENT_TYPE.OPEN_TICKET:n=60044;break;case ZENDESK_CUSTOMIZATION_EVENT_TYPE.DETECT_TICKET_LANGUAGE:n=60045;break;case ZENDESK_CUSTOMIZATION_EVENT_TYPE.SWITCH_TICKET_LANGUAGE:n=60046;break;case ZENDESK_CUSTOMIZATION_EVENT_TYPE.ENABLE_AUTOTRANSLATE:n=60047;break;case ZENDESK_CUSTOMIZATION_EVENT_TYPE.DISABLE_AUTOTRANSLATE:n=60048;break;case ZENDESK_CUSTOMIZATION_EVENT_TYPE.TRANSLATE_MESSAGE:n=60049;break;case ZENDESK_CUSTOMIZATION_EVENT_TYPE.TRANSLATE_INPUT:n=60050;break;case ZENDESK_CUSTOMIZATION_EVENT_TYPE.ERROR:n=60051;break;default:return}return sendDAPEvent((e=>({...e,eventId:n,zendeskMetaData:{agentLanguage:t.agentLanguage,ticketLanguage:t.ticketLanguage,isTicketLanguageAutodetected:t.isTicketLanguageAutodetected,isTicketLanguageSupported:t.isTicketLanguageSupported,isAutoTranslateEnabled:t.isAutoTranslateEnabled,sourceTextLength:t.sourceTextLength,targetTextLength:t.targetTextLength,inputHasSelection:t.inputHasSelection,error:t.error}})))}async function sendDAPZendeskGlossaryConfigOpened(e){let t;if(e.glossaryConfigOpenedWithoutGlossaryPermissions?t=60084:e.glossaryConfigOpenedWithNoGlossariesFound&&(t=60085),t)return sendDAPEvent((e=>({...e,eventId:t})))}async function sendDAPLogin(){return sendDAPEvent((e=>({...e,eventId:60054})))}async function sendDAPLogout(e){const t=Math.round(await getSecondsSinceLastLogin()/60);return sendDAPEvent((n=>({...n,eventId:60055,logoutData:{trigger:getDapLogoutTrigger(e.trigger),minutesSinceLastLogin:t,reason:e.reason}})))}async function sendDAPGDocsMaxCharExceededShown(e){return sendDAPEvent((t=>({...t,eventId:60052,gdocsMaxCharExceededData:{sourceLang:e.sourceLang,targetLang:e.targetLang,sourceLength:e.sourceLength}})))}async function sendDAPGDocsMaxCharExceededTryProClicked(e){return sendDAPEvent((t=>({...t,eventId:60053,gdocsMaxCharExceededData:{sourceLang:e.sourceLang,targetLang:e.targetLang,sourceLength:e.sourceLength}})))}async function sendDAPtrackSessionType(e){return sendDAPEvent((t=>({...t,eventId:60056,sessionTypeData:{sessionType:e.sessionType,trigger:getDapSessionTypeTrigger(e.trigger)}})))}async function sendDAPOnboardingModalShown(e){let t="";try{t=await getSessionType()}catch(e){console.log(`DAP: Failed to fetch session type. Error: ${e.message}`)}return sendDAPEvent((n=>({...n,eventId:60058,onboardingModalShownData:{nicheIntegration:getDapNicheIntegration(e.nicheIntegration||PLATFORM_BEHAVIOURS.default),sessionType:t}})))}async function sendDAPUILocationClicked(e){return sendDAPEvent((t=>({...t,eventId:60059,UILocationClickedData:{uiLocation:getDapApiUiLocation(e)}})))}async function sendDAPInstallationIdCreated(){return sendDAPEvent((e=>({...e,eventId:60060})))}async function sendDAPBrowserInstanceIdCreated(){return sendDAPEvent((e=>({...e,eventId:60061})))}async function sendDAPDeeplWriteEvent(e,t){let n;switch(e){case DEEPL_WRITE_EVENT_TYPE.TEXT_REFINEMENT_REQUEST:n=60062;break;case DEEPL_WRITE_EVENT_TYPE.GDOCS_INSERT_COPY:n=60063;break;case DEEPL_WRITE_EVENT_TYPE.GDOCS_DISCARD_COPY:n=60064;break;case DEEPL_WRITE_EVENT_TYPE.GDOCS_CHAR_LIMIT_REACHED:n=60065;break;case DEEPL_WRITE_EVENT_TYPE.ERROR:n=60066;break;case DEEPL_WRITE_EVENT_TYPE.RESULT_ACCEPTED:n=60071;break;case DEEPL_WRITE_EVENT_TYPE.RESULT_REVERTED:n=60072;break;case DEEPL_WRITE_EVENT_TYPE.GET_ALTERNATIVES_FOR_INPUT:n=60088;break;default:return}return sendDAPEvent((e=>({...e,eventId:n,deeplWriteMetaData:{lang:t.lang,sourceLength:t.sourceLength,targetLength:t.targetLength,nicheIntegration:getDapNicheIntegration(t.nicheIntegration||PLATFORM_BEHAVIOURS.default),error:t.error,style:getWriteStyle(t.style)}})))}async function sendDAPSessionStarted(){if(!await isUserLoggedIn())return;const e=await getAccountID();return sendDAPEvent((t=>({...t,eventId:60067,accountData:{accountUuid:e}})))}async function sendDAPLoggedIn(){const e=await getAccountID();return sendDAPEvent((t=>({...t,eventId:60068,accountData:{accountUuid:e}})))}async function sendDAPLoggedOut(){const e=await getAccountID();return sendDAPEvent((t=>({...t,eventId:60069,accountData:{accountUuid:e}})))}async function sendDAPTranslateAcceptOrUndoEvent(e,t){let n;switch(e){case DEEPL_TRANSLATE_EVENT_TYPE.RESULT_ACCEPTED:n=60073;break;case DEEPL_TRANSLATE_EVENT_TYPE.RESULT_REVERTED:n=60074;break;default:return}return sendDAPEvent((e=>({...e,eventId:n,translationResultActionData:{sourceLang:t.sourceLang,sourceLength:t.sourceLength,targetLength:t.targetLength,nicheIntegration:getDapNicheIntegration(t.nicheIntegration||PLATFORM_BEHAVIOURS.default),error:t.error}})))}async function sendDAPCustomizationEnabled(e){return sendDAPEvent((t=>({...t,eventId:60070,customizationOnOffData:{nicheIntegration:getDapNicheIntegration(e.nicheIntegration||PLATFORM_BEHAVIOURS.default),uiLocation:getDapApiUiLocation(e.location),customizationEnabled:e.customizationEnabled}})))}async function sendDAPGmailCharLimitReached(e){return sendDAPEvent((t=>({...t,eventId:60075,gmailCharLimitReachedData:{gmailActionType:getDapGmailActionType(e.type)}})))}async function sendDAPTrackUpgradeNotificationDisplayed(e){return sendDAPEvent((t=>({...t,eventId:60076,upgradeNotificationDisplayedData:{type:getDapUpgradeNotificationType(e)}})))}async function sendDAPTrackUpgradeNotificationClosed(e){return sendDAPEvent((t=>({...t,eventId:60077,upgradeNotificationClosedData:{type:getDapUpgradeNotificationType(e)}})))}async function sendDAPTrackUpgradeNotificationAction(e,t){return sendDAPEvent((n=>({...n,eventId:60078,upgradeNotificationActionData:{type:getDapUpgradeNotificationType(e),action:getDapUpgradeNotificationAction(t)}})))}async function sendDAPAlternativesEvent(e,t){let n;switch(e){case DEEPL_ALTERNATIVE_EVENT_TYPE.ALTERNATIVES_OPENED:n=60079;break;case DEEPL_ALTERNATIVE_EVENT_TYPE.SEGMENTATION_SELECTED:n=60080;break;case DEEPL_ALTERNATIVE_EVENT_TYPE.ALTERNATIVE_SELECTED:n=80081;break;default:return}return sendDAPEvent((e=>({...e,eventId:n,alternativesMetaData:{sourceLang:t.sourceLang,targetLang:t.targetLang,nicheIntegration:getDapNicheIntegration(t.nicheIntegration||PLATFORM_BEHAVIOURS.default),contentProcessingMode:getDapContentProcessingModeType(t.contentProcessingMode),...t.alternativesSegmentation&&{alternativesSegmentation:getDapAlternativesSegmentationType(t.alternativesSegmentation)}}})))}async function sendDAPGlossaryEnabledOrDisabled(e,t){const n=e?60082:60083;return sendDAPEvent((e=>({...e,eventId:n,glossaryMetadata:{nicheIntegration:getDapNicheIntegration(t.nicheIntegration||PLATFORM_BEHAVIOURS.default)}})))}async function sendDAPTrackLanguageDetectionForTextProcessing(e){return sendDAPEvent((t=>({...t,eventId:60086,languageDetectionTextProcessingData:{detectedLanguageCode:e.lang,textLength:e.textLength,domainName:e.domainName,isReliable:e.isReliable,translationTrigger:getDapApiTranslationTriggerId(e.trigger),nicheIntegration:getDapNicheIntegration(e.nicheIntegration||PLATFORM_BEHAVIOURS.default)}})))}async function sendDAPSeeAlternativesClicked(){return sendDAPEvent((e=>({...e,eventId:60087})))}async function sendDAPAlternativeSelected(e){return sendDAPEvent((t=>({...t,eventId:60089,alternativesMetaData:{sourceLang:e.sourceLang,targetLang:e.targetLang,numberOfAlternatives:e.numberOfAlternatives,selectedAlternativeIndex:e.selectedAlternative,nicheIntegration:getDapNicheIntegration(e.nicheIntegration||PLATFORM_BEHAVIOURS.default),contentProcessingMode:getDapContentProcessingModeType(e.contentProcessingMode),...e.alternativesSegmentation&&{alternativesSegmentation:getDapAlternativesSegmentationType(e.alternativesSegmentation)}}})))}async function sendDAPTrackIframeTranslationSuccessful(){return sendDAPEvent((e=>({...e,eventId:60090})))}async function sendDAPTrackIframeTranslationFailed(e){return sendDAPEvent((t=>({...t,eventId:60091,errorData:{extensionVersion:"1.26.1",errorCode:e.errorCode,errorMessage:e.errorMessage}})))}async function sendDAPTrackAdsButtonClicked(){return sendDAPEvent((e=>({...e,eventId:60092})))}async function sendDAPTrackAdsShown(e){return sendDAPEvent((t=>({...t,eventId:60093,adsShownData:{matchedWord:e.matchedWord}})))}let db;const dbName="dlBrowserExtension",dlCache="dlCache";function connectDatabase(){return new Promise(((e,t)=>{let n=indexedDB.open(dbName,1);n.onerror=function(){t("Error creating database.")},n.onsuccess=function(t){db=t.target.result,e()},n.onupgradeneeded=function(t){db=t.target.result,db.objectStoreNames.contains(dlCache)||db.createObjectStore(dlCache,{keyPath:"id"}),e()}}))}async function writeData(e,t,n){return db||await connectDatabase(),new Promise(((r,o)=>{let a=db.transaction(n,"readwrite").objectStore(n).put({id:e,data:t,meta:{createdAt:Date.now()}});a.onsuccess=function(){r()},a.onerror=function(e){o(e)}}))}async function readData(e,t){return db||await connectDatabase(),new Promise(((n,r)=>{let o=db.transaction(t,"readonly").objectStore(t).get(e);o.onerror=function(e){r(e)},o.onsuccess=function(){o.result?n(o.result):n(null)}}))}function cacheClientState(e){return writeData("dlclientstate",e,dlCache)}async function getCachedClientState(){const e=await readData("dlclientstate",dlCache);if(!e||!e.meta)return;return(Date.now()-e.meta.createdAt)/6e4>20?void 0:e.data}function cacheExperiments(e){return writeData("dlexperiments",e,dlCache)}async function getCurrentExperiments(){try{const e=await readData("dlexperiments",dlCache);return e&&e.meta&&e.data?e.data:[]}catch(e){return[]}}async function getCachedExperiments(){const e=await readData("dlexperiments",dlCache);if(!e||!e.meta)return;return(Date.now()-e.meta.createdAt)/6e4>9||!e.data||0===e.data.length?void 0:e.data}async function getSettings(e){if(e.includes("session")){const e=await chrome.storage.sync.get(["session"]);e&&!e.session&&await createNewSession()}return new Promise(((t,n)=>{chrome.storage.sync.get(e,(r=>{r?t(r):n(`Can not get ${e}`)}))}))}async function createNewSession(){const e=getUUID();await chrome.storage.sync.set({session:{id:e,timestamp:Date.now()}});try{await sendDAPSessionStarted()}catch(e){console.error(e)}}async function updateSession(){const{session:e}=await getSettings(["session"]);!e||(Date.now()-e.timestamp)/6e4>30?await createNewSession():await chrome.storage.sync.set({session:{...e,timestamp:Date.now()}})}async function setAuthTokens(e,t,n){const r=parseJwtToken(e);return await chrome.storage.local.set({a_t:e,r_t:t,i_t:n,isLoggedIn:!(!e||!t),isProUser:!(!r||"Pro"!==r.sessionType),sessionType:r?.sessionType}),r?.sessionType}async function deleteAuthTokens(){await chrome.storage.local.remove(["a_t","r_t","i_t"]),await chrome.storage.local.set({isLoggedIn:!1,isProUser:!1,sessionType:""})}async function resetGlossary(){await chrome.storage.sync.remove(["activeTermbaseId","isGlossaryEnabled"]),await chrome.storage.sync.set({activeTermbaseId:"",isGlossaryEnabled:!1})}async function getAuthTokens(){const e=await chrome.storage.local.get(["a_t","r_t","i_t"]);return{access_token:e?e.a_t:void 0,refresh_token:e?e.r_t:void 0,id_token:e?e.i_t:void 0}}async function isUserLoggedIn(){const e=await chrome.storage.local.get(["isLoggedIn"]);return!(!e||!e.isLoggedIn)}async function getSessionType(){const e=await chrome.storage.local.get(["sessionType"]);return e?.sessionType}async function getInstallationId(){return(await chrome.storage.sync.get(["installationId"])).installationId}async function markLoginTimestamp(){await chrome.storage.local.set({last_login:Date.now()})}async function clearLoginTimestamp(){await chrome.storage.local.remove(["last_login"])}async function getSecondsSinceLastLogin(){const e=await chrome.storage.local.get(["last_login"]);return e&&e.last_login?(Date.now()-e.last_login)/1e3:0}async function setUserInfoFromClientState(e){const t=e.featureSet.translator.service,n=e.featureSet.write.service,r=e.featureSet.api.service,o=e.featureSet.documentTranslation.service,a=e.featureSet.glossary.termbaseService,i=e.featureSet.glossary.maxGlossaries;let s,c;e.loginState?.accountId&&(s=e.loginState.accountId),e.featureSet?.integrations?.browserExtension&&(c=e.featureSet?.integrations?.browserExtension),await chrome.storage.local.set({translatorServiceType:t,writeServiceType:n,apiServiceType:r,docTranslatorServiceType:o,accountId:s||"",featureSet:c,hasTermbaseService:a&&i>0})}async function getUserInfo(){return await chrome.storage.local.get(["isLoggedIn","isProUser","sessionType","translatorServiceType","writeServiceType","apiServiceType","docTranslatorServiceType","accountId","hasTermbaseService"])}async function setBrowserInstanceId(){await chrome.storage.local.set({browserInstanceId:getUUID()})}async function getBrowserInstanceId(){return(await chrome.storage.local.get(["browserInstanceId"])).browserInstanceId}async function getAccountID(){const e=await chrome.storage.local.get(["accountId","a_t","i_t"]);if(e&&e.accountId)return e.accountId;if(e&&e.a_t){const t=parseJwtToken(e.a_t),n=parseJwtToken(e.i_t);return t.sub||n.sub}}async function getExperimentsData(){let e=[];try{e=await getCurrentExperiments()}catch(e){}if(!e||0===e.length)return[];const t=e.map((e=>({id:e.id,variant:e.variant,breakout:e.breakout})));return t}async function getUserType(e="translatorServiceType"){const t=await getUserInfo(),n=!!t.accountId,r=t[e];return n?r===SERVICE_LEVEL$1.pro?USER_TYPE.loggedInPro:USER_TYPE.loggedInFree:USER_TYPE.notLoggedIn}async function getCharacterLimit(e="translatorServiceType"){const t=await getUserType(e);let n;switch(e){case"translatorServiceType":default:n=CHARACTER_LIMITS_TRANSLATOR;break;case"writeServiceType":n=CHARACTER_LIMITS_WRITE}switch(t){case USER_TYPE.notLoggedIn:return n.notLoggedIn;case USER_TYPE.loggedInFree:return n.loggedInFree;case USER_TYPE.loggedInPro:return;default:n.notLoggedIn}}async function isProServiceLevel(e){const t=await chrome.storage.local.get(["translatorServiceType","writeServiceType","apiServiceType","docTranslatorServiceType","isLoggedIn"]);return userHasProServiceLevel(t,e)}async function getAllServiceLevels(){return await chrome.storage.local.get(["translatorServiceType","writeServiceType","apiServiceType","docTranslatorServiceType","isLoggedIn"])}class HttpError extends Error{constructor(e,t){const n=new.target.prototype;super(`${e}: Status code '${t}'`),this.statusCode=t,this.__proto__=n}}class TimeoutError extends Error{constructor(e="A timeout occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class AbortError extends Error{constructor(e="An abort occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class UnsupportedTransportError extends Error{constructor(e,t){const n=new.target.prototype;super(e),this.transport=t,this.errorType="UnsupportedTransportError",this.__proto__=n}}class DisabledTransportError extends Error{constructor(e,t){const n=new.target.prototype;super(e),this.transport=t,this.errorType="DisabledTransportError",this.__proto__=n}}class FailedToStartTransportError extends Error{constructor(e,t){const n=new.target.prototype;super(e),this.transport=t,this.errorType="FailedToStartTransportError",this.__proto__=n}}class FailedToNegotiateWithServerError extends Error{constructor(e){const t=new.target.prototype;super(e),this.errorType="FailedToNegotiateWithServerError",this.__proto__=t}}class AggregateErrors extends Error{constructor(e,t){const n=new.target.prototype;super(e),this.innerErrors=t,this.__proto__=n}}class HttpResponse{constructor(e,t,n){this.statusCode=e,this.statusText=t,this.content=n}}class HttpClient{get(e,t){return this.send({...t,method:"GET",url:e})}post(e,t){return this.send({...t,method:"POST",url:e})}delete(e,t){return this.send({...t,method:"DELETE",url:e})}getCookieString(e){return""}}var LogLevel;!function(e){e[e.Trace=0]="Trace",e[e.Debug=1]="Debug",e[e.Information=2]="Information",e[e.Warning=3]="Warning",e[e.Error=4]="Error",e[e.Critical=5]="Critical",e[e.None=6]="None"}(LogLevel||(LogLevel={}));class NullLogger{constructor(){}log(e,t){}}NullLogger.instance=new NullLogger;const VERSION="8.0.7";class Arg{static isRequired(e,t){if(null==e)throw new Error(`The '${t}' argument is required.`)}static isNotEmpty(e,t){if(!e||e.match(/^\s*$/))throw new Error(`The '${t}' argument should not be empty.`)}static isIn(e,t,n){if(!(e in t))throw new Error(`Unknown ${n} value: ${e}.`)}}class Platform{static get isBrowser(){return!Platform.isNode&&"object"==typeof window&&"object"==typeof window.document}static get isWebWorker(){return!Platform.isNode&&"object"==typeof self&&"importScripts"in self}static get isReactNative(){return!Platform.isNode&&"object"==typeof window&&void 0===window.document}static get isNode(){return"undefined"!=typeof process&&process.release&&"node"===process.release.name}}function getDataDetail(e,t){let n="";return isArrayBuffer$1(e)?(n=`Binary data of length ${e.byteLength}`,t&&(n+=`. Content: '${formatArrayBuffer(e)}'`)):"string"==typeof e&&(n=`String data of length ${e.length}`,t&&(n+=`. Content: '${e}'`)),n}function formatArrayBuffer(e){const t=new Uint8Array(e);let n="";return t.forEach((e=>{n+=`0x${e<16?"0":""}${e.toString(16)} `})),n.substr(0,n.length-1)}function isArrayBuffer$1(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}async function sendMessage(e,t,n,r,o,a){const i={},[s,c]=getUserAgentHeader();i[s]=c,e.log(LogLevel.Trace,`(${t} transport) sending data. ${getDataDetail(o,a.logMessageContent)}.`);const l=isArrayBuffer$1(o)?"arraybuffer":"text",u=await n.post(r,{content:o,headers:{...i,...a.headers},responseType:l,timeout:a.timeout,withCredentials:a.withCredentials});e.log(LogLevel.Trace,`(${t} transport) request complete. Response status: ${u.statusCode}.`)}function createLogger(e){return void 0===e?new ConsoleLogger(LogLevel.Information):null===e?NullLogger.instance:void 0!==e.log?e:new ConsoleLogger(e)}class SubjectSubscription{constructor(e,t){this._subject=e,this._observer=t}dispose(){const e=this._subject.observers.indexOf(this._observer);e>-1&&this._subject.observers.splice(e,1),0===this._subject.observers.length&&this._subject.cancelCallback&&this._subject.cancelCallback().catch((e=>{}))}}class ConsoleLogger{constructor(e){this._minLevel=e,this.out=console}log(e,t){if(e>=this._minLevel){const n=`[${(new Date).toISOString()}] ${LogLevel[e]}: ${t}`;switch(e){case LogLevel.Critical:case LogLevel.Error:this.out.error(n);break;case LogLevel.Warning:this.out.warn(n);break;case LogLevel.Information:this.out.info(n);break;default:this.out.log(n)}}}}function getUserAgentHeader(){let e="X-SignalR-User-Agent";return Platform.isNode&&(e="User-Agent"),[e,constructUserAgent(VERSION,getOsName(),getRuntime(),getRuntimeVersion())]}function constructUserAgent(e,t,n,r){let o="Microsoft SignalR/";const a=e.split(".");return o+=`${a[0]}.${a[1]}`,o+=` (${e}; `,o+=t&&""!==t?`${t}; `:"Unknown OS; ",o+=`${n}`,o+=r?`; ${r}`:"; Unknown Runtime Version",o+=")",o}function getOsName(){if(!Platform.isNode)return"";switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}}function getRuntimeVersion(){if(Platform.isNode)return process.versions.node}function getRuntime(){return Platform.isNode?"NodeJS":"Browser"}function getErrorString(e){return e.stack?e.stack:e.message?e.message:`${e}`}function getGlobalThis(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("could not find global")}class FetchHttpClient extends HttpClient{constructor(e){if(super(),this._logger=e,"undefined"==typeof fetch||Platform.isNode){const e="function"==typeof __webpack_require__?__non_webpack_require__:require;this._jar=new(e("tough-cookie").CookieJar),"undefined"==typeof fetch?this._fetchType=e("node-fetch"):this._fetchType=fetch,this._fetchType=e("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(getGlobalThis());if("undefined"==typeof AbortController){const e="function"==typeof __webpack_require__?__non_webpack_require__:require;this._abortControllerType=e("abort-controller")}else this._abortControllerType=AbortController}async send(e){if(e.abortSignal&&e.abortSignal.aborted)throw new AbortError;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");const t=new this._abortControllerType;let n;e.abortSignal&&(e.abortSignal.onabort=()=>{t.abort(),n=new AbortError});let r,o=null;if(e.timeout){const r=e.timeout;o=setTimeout((()=>{t.abort(),this._logger.log(LogLevel.Warning,"Timeout from HTTP request."),n=new TimeoutError}),r)}""===e.content&&(e.content=void 0),e.content&&(e.headers=e.headers||{},isArrayBuffer$1(e.content)?e.headers["Content-Type"]="application/octet-stream":e.headers["Content-Type"]="text/plain;charset=UTF-8");try{r=await this._fetchType(e.url,{body:e.content,cache:"no-cache",credentials:!0===e.withCredentials?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:t.signal})}catch(e){if(n)throw n;throw this._logger.log(LogLevel.Warning,`Error from HTTP request. ${e}.`),e}finally{o&&clearTimeout(o),e.abortSignal&&(e.abortSignal.onabort=null)}if(!r.ok){const e=await deserializeContent(r,"text");throw new HttpError(e||r.statusText,r.status)}const a=deserializeContent(r,e.responseType),i=await a;return new HttpResponse(r.status,r.statusText,i)}getCookieString(e){let t="";return Platform.isNode&&this._jar&&this._jar.getCookies(e,((e,n)=>t=n.join("; "))),t}}function deserializeContent(e,t){let n;switch(t){case"arraybuffer":n=e.arrayBuffer();break;case"text":default:n=e.text();break;case"blob":case"document":case"json":throw new Error(`${t} is not supported.`)}return n}class XhrHttpClient extends HttpClient{constructor(e){super(),this._logger=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new AbortError):e.method?e.url?new Promise(((t,n)=>{const r=new XMLHttpRequest;r.open(e.method,e.url,!0),r.withCredentials=void 0===e.withCredentials||e.withCredentials,r.setRequestHeader("X-Requested-With","XMLHttpRequest"),""===e.content&&(e.content=void 0),e.content&&(isArrayBuffer$1(e.content)?r.setRequestHeader("Content-Type","application/octet-stream"):r.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));const o=e.headers;o&&Object.keys(o).forEach((e=>{r.setRequestHeader(e,o[e])})),e.responseType&&(r.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{r.abort(),n(new AbortError)}),e.timeout&&(r.timeout=e.timeout),r.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),r.status>=200&&r.status<300?t(new HttpResponse(r.status,r.statusText,r.response||r.responseText)):n(new HttpError(r.response||r.responseText||r.statusText,r.status))},r.onerror=()=>{this._logger.log(LogLevel.Warning,`Error from HTTP request. ${r.status}: ${r.statusText}.`),n(new HttpError(r.statusText,r.status))},r.ontimeout=()=>{this._logger.log(LogLevel.Warning,"Timeout from HTTP request."),n(new TimeoutError)},r.send(e.content)})):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class DefaultHttpClient extends HttpClient{constructor(e){if(super(),"undefined"!=typeof fetch||Platform.isNode)this._httpClient=new FetchHttpClient(e);else{if("undefined"==typeof XMLHttpRequest)throw new Error("No usable HttpClient found.");this._httpClient=new XhrHttpClient(e)}}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new AbortError):e.method?e.url?this._httpClient.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(e){return this._httpClient.getCookieString(e)}}class TextMessageFormat{static write(e){return`${e}${TextMessageFormat.RecordSeparator}`}static parse(e){if(e[e.length-1]!==TextMessageFormat.RecordSeparator)throw new Error("Message is incomplete.");const t=e.split(TextMessageFormat.RecordSeparator);return t.pop(),t}}TextMessageFormat.RecordSeparatorCode=30,TextMessageFormat.RecordSeparator=String.fromCharCode(TextMessageFormat.RecordSeparatorCode);class HandshakeProtocol{writeHandshakeRequest(e){return TextMessageFormat.write(JSON.stringify(e))}parseHandshakeResponse(e){let t,n;if(isArrayBuffer$1(e)){const r=new Uint8Array(e),o=r.indexOf(TextMessageFormat.RecordSeparatorCode);if(-1===o)throw new Error("Message is incomplete.");const a=o+1;t=String.fromCharCode.apply(null,Array.prototype.slice.call(r.slice(0,a))),n=r.byteLength>a?r.slice(a).buffer:null}else{const r=e,o=r.indexOf(TextMessageFormat.RecordSeparator);if(-1===o)throw new Error("Message is incomplete.");const a=o+1;t=r.substring(0,a),n=r.length>a?r.substring(a):null}const r=TextMessageFormat.parse(t),o=JSON.parse(r[0]);if(o.type)throw new Error("Expected a handshake response from the server.");return[n,o]}}var MessageType;!function(e){e[e.Invocation=1]="Invocation",e[e.StreamItem=2]="StreamItem",e[e.Completion=3]="Completion",e[e.StreamInvocation=4]="StreamInvocation",e[e.CancelInvocation=5]="CancelInvocation",e[e.Ping=6]="Ping",e[e.Close=7]="Close",e[e.Ack=8]="Ack",e[e.Sequence=9]="Sequence"}(MessageType||(MessageType={}));class Subject$1{constructor(){this.observers=[]}next(e){for(const t of this.observers)t.next(e)}error(e){for(const t of this.observers)t.error&&t.error(e)}complete(){for(const e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new SubjectSubscription(this,e)}}class MessageBuffer{constructor(e,t,n){this._bufferSize=1e5,this._messages=[],this._totalMessageCount=0,this._waitForSequenceMessage=!1,this._nextReceivingSequenceId=1,this._latestReceivedSequenceId=0,this._bufferedByteCount=0,this._reconnectInProgress=!1,this._protocol=e,this._connection=t,this._bufferSize=n}async _send(e){const t=this._protocol.writeMessage(e);let n=Promise.resolve();if(this._isInvocationMessage(e)){this._totalMessageCount++;let e=()=>{},r=()=>{};isArrayBuffer$1(t)?this._bufferedByteCount+=t.byteLength:this._bufferedByteCount+=t.length,this._bufferedByteCount>=this._bufferSize&&(n=new Promise(((t,n)=>{e=t,r=n}))),this._messages.push(new BufferedItem(t,this._totalMessageCount,e,r))}try{this._reconnectInProgress||await this._connection.send(t)}catch{this._disconnected()}await n}_ack(e){let t=-1;for(let n=0;n<this._messages.length;n++){const r=this._messages[n];if(r._id<=e.sequenceId)t=n,isArrayBuffer$1(r._message)?this._bufferedByteCount-=r._message.byteLength:this._bufferedByteCount-=r._message.length,r._resolver();else{if(!(this._bufferedByteCount<this._bufferSize))break;r._resolver()}}-1!==t&&(this._messages=this._messages.slice(t+1))}_shouldProcessMessage(e){if(this._waitForSequenceMessage)return e.type===MessageType.Sequence&&(this._waitForSequenceMessage=!1,!0);if(!this._isInvocationMessage(e))return!0;const t=this._nextReceivingSequenceId;return this._nextReceivingSequenceId++,t<=this._latestReceivedSequenceId?(t===this._latestReceivedSequenceId&&this._ackTimer(),!1):(this._latestReceivedSequenceId=t,this._ackTimer(),!0)}_resetSequence(e){e.sequenceId>this._nextReceivingSequenceId?this._connection.stop(new Error("Sequence ID greater than amount of messages we've received.")):this._nextReceivingSequenceId=e.sequenceId}_disconnected(){this._reconnectInProgress=!0,this._waitForSequenceMessage=!0}async _resend(){const e=0!==this._messages.length?this._messages[0]._id:this._totalMessageCount+1;await this._connection.send(this._protocol.writeMessage({type:MessageType.Sequence,sequenceId:e}));const t=this._messages;for(const e of t)await this._connection.send(e._message);this._reconnectInProgress=!1}_dispose(e){null!=e||(e=new Error("Unable to reconnect to server."));for(const t of this._messages)t._rejector(e)}_isInvocationMessage(e){switch(e.type){case MessageType.Invocation:case MessageType.StreamItem:case MessageType.Completion:case MessageType.StreamInvocation:case MessageType.CancelInvocation:return!0;case MessageType.Close:case MessageType.Sequence:case MessageType.Ping:case MessageType.Ack:return!1}}_ackTimer(){void 0===this._ackTimerHandle&&(this._ackTimerHandle=setTimeout((async()=>{try{this._reconnectInProgress||await this._connection.send(this._protocol.writeMessage({type:MessageType.Ack,sequenceId:this._latestReceivedSequenceId}))}catch{}clearTimeout(this._ackTimerHandle),this._ackTimerHandle=void 0}),1e3))}}class BufferedItem{constructor(e,t,n,r){this._message=e,this._id=t,this._resolver=n,this._rejector=r}}const DEFAULT_TIMEOUT_IN_MS=3e4,DEFAULT_PING_INTERVAL_IN_MS=15e3,DEFAULT_STATEFUL_RECONNECT_BUFFER_SIZE=1e5;var HubConnectionState;!function(e){e.Disconnected="Disconnected",e.Connecting="Connecting",e.Connected="Connected",e.Disconnecting="Disconnecting",e.Reconnecting="Reconnecting"}(HubConnectionState||(HubConnectionState={}));class HubConnection{static create(e,t,n,r,o,a,i){return new HubConnection(e,t,n,r,o,a,i)}constructor(e,t,n,r,o,a,i){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(LogLevel.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},Arg.isRequired(e,"connection"),Arg.isRequired(t,"logger"),Arg.isRequired(n,"protocol"),this.serverTimeoutInMilliseconds=null!=o?o:DEFAULT_TIMEOUT_IN_MS,this.keepAliveIntervalInMilliseconds=null!=a?a:DEFAULT_PING_INTERVAL_IN_MS,this._statefulReconnectBufferSize=null!=i?i:DEFAULT_STATEFUL_RECONNECT_BUFFER_SIZE,this._logger=t,this._protocol=n,this.connection=e,this._reconnectPolicy=r,this._handshakeProtocol=new HandshakeProtocol,this.connection.onreceive=e=>this._processIncomingData(e),this.connection.onclose=e=>this._connectionClosed(e),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=HubConnectionState.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:MessageType.Ping})}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this._connectionState!==HubConnectionState.Disconnected&&this._connectionState!==HubConnectionState.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}async _startWithStateTransitions(){if(this._connectionState!==HubConnectionState.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=HubConnectionState.Connecting,this._logger.log(LogLevel.Debug,"Starting HubConnection.");try{await this._startInternal(),Platform.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=HubConnectionState.Connected,this._connectionStarted=!0,this._logger.log(LogLevel.Debug,"HubConnection connected successfully.")}catch(e){return this._connectionState=HubConnectionState.Disconnected,this._logger.log(LogLevel.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}}async _startInternal(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;const e=new Promise(((e,t)=>{this._handshakeResolver=e,this._handshakeRejecter=t}));await this.connection.start(this._protocol.transferFormat);try{let t=this._protocol.version;this.connection.features.reconnect||(t=1);const n={protocol:this._protocol.name,version:t};if(this._logger.log(LogLevel.Debug,"Sending handshake request."),await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(n)),this._logger.log(LogLevel.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),await e,this._stopDuringStartError)throw this._stopDuringStartError;(this.connection.features.reconnect||!1)&&(this._messageBuffer=new MessageBuffer(this._protocol,this.connection,this._statefulReconnectBufferSize),this.connection.features.disconnected=this._messageBuffer._disconnected.bind(this._messageBuffer),this.connection.features.resend=()=>{if(this._messageBuffer)return this._messageBuffer._resend()}),this.connection.features.inherentKeepAlive||await this._sendMessage(this._cachedPingMessage)}catch(e){throw this._logger.log(LogLevel.Debug,`Hub handshake failed with error '${e}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),await this.connection.stop(e),e}}async stop(){const e=this._startPromise;this.connection.features.reconnect=!1,this._stopPromise=this._stopInternal(),await this._stopPromise;try{await e}catch(e){}}_stopInternal(e){if(this._connectionState===HubConnectionState.Disconnected)return this._logger.log(LogLevel.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this._connectionState===HubConnectionState.Disconnecting)return this._logger.log(LogLevel.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;const t=this._connectionState;return this._connectionState=HubConnectionState.Disconnecting,this._logger.log(LogLevel.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(LogLevel.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(t===HubConnectionState.Connected&&this._sendCloseMessage(),this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=e||new AbortError("The connection was stopped before the hub handshake could complete."),this.connection.stop(e))}async _sendCloseMessage(){try{await this._sendWithProtocol(this._createCloseMessage())}catch{}}stream(e,...t){const[n,r]=this._replaceStreamingParams(t),o=this._createStreamInvocation(e,t,r);let a;const i=new Subject$1;return i.cancelCallback=()=>{const e=this._createCancelInvocation(o.invocationId);return delete this._callbacks[o.invocationId],a.then((()=>this._sendWithProtocol(e)))},this._callbacks[o.invocationId]=(e,t)=>{t?i.error(t):e&&(e.type===MessageType.Completion?e.error?i.error(new Error(e.error)):i.complete():i.next(e.item))},a=this._sendWithProtocol(o).catch((e=>{i.error(e),delete this._callbacks[o.invocationId]})),this._launchStreams(n,a),i}_sendMessage(e){return this._resetKeepAliveInterval(),this.connection.send(e)}_sendWithProtocol(e){return this._messageBuffer?this._messageBuffer._send(e):this._sendMessage(this._protocol.writeMessage(e))}send(e,...t){const[n,r]=this._replaceStreamingParams(t),o=this._sendWithProtocol(this._createInvocation(e,t,!0,r));return this._launchStreams(n,o),o}invoke(e,...t){const[n,r]=this._replaceStreamingParams(t),o=this._createInvocation(e,t,!1,r),a=new Promise(((e,t)=>{this._callbacks[o.invocationId]=(n,r)=>{r?t(r):n&&(n.type===MessageType.Completion?n.error?t(new Error(n.error)):e(n.result):t(new Error(`Unexpected message type: ${n.type}`)))};const r=this._sendWithProtocol(o).catch((e=>{t(e),delete this._callbacks[o.invocationId]}));this._launchStreams(n,r)}));return a}on(e,t){e&&t&&(e=e.toLowerCase(),this._methods[e]||(this._methods[e]=[]),-1===this._methods[e].indexOf(t)&&this._methods[e].push(t))}off(e,t){if(!e)return;e=e.toLowerCase();const n=this._methods[e];if(n)if(t){const r=n.indexOf(t);-1!==r&&(n.splice(r,1),0===n.length&&delete this._methods[e])}else delete this._methods[e]}onclose(e){e&&this._closedCallbacks.push(e)}onreconnecting(e){e&&this._reconnectingCallbacks.push(e)}onreconnected(e){e&&this._reconnectedCallbacks.push(e)}_processIncomingData(e){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(e=this._processHandshakeResponse(e),this._receivedHandshakeResponse=!0),e){const t=this._protocol.parseMessages(e,this._logger);for(const e of t)if(!this._messageBuffer||this._messageBuffer._shouldProcessMessage(e))switch(e.type){case MessageType.Invocation:this._invokeClientMethod(e).catch((e=>{this._logger.log(LogLevel.Error,`Invoke client method threw error: ${getErrorString(e)}`)}));break;case MessageType.StreamItem:case MessageType.Completion:{const t=this._callbacks[e.invocationId];if(t){e.type===MessageType.Completion&&delete this._callbacks[e.invocationId];try{t(e)}catch(e){this._logger.log(LogLevel.Error,`Stream callback threw error: ${getErrorString(e)}`)}}break}case MessageType.Ping:break;case MessageType.Close:{this._logger.log(LogLevel.Information,"Close message received from server.");const t=e.error?new Error("Server returned an error on close: "+e.error):void 0;!0===e.allowReconnect?this.connection.stop(t):this._stopPromise=this._stopInternal(t);break}case MessageType.Ack:this._messageBuffer&&this._messageBuffer._ack(e);break;case MessageType.Sequence:this._messageBuffer&&this._messageBuffer._resetSequence(e);break;default:this._logger.log(LogLevel.Warning,`Invalid message type: ${e.type}.`)}}this._resetTimeoutPeriod()}_processHandshakeResponse(e){let t,n;try{[n,t]=this._handshakeProtocol.parseHandshakeResponse(e)}catch(e){const t="Error parsing handshake response: "+e;this._logger.log(LogLevel.Error,t);const n=new Error(t);throw this._handshakeRejecter(n),n}if(t.error){const e="Server returned handshake error: "+t.error;this._logger.log(LogLevel.Error,e);const n=new Error(e);throw this._handshakeRejecter(n),n}return this._logger.log(LogLevel.Debug,"Server handshake complete."),this._handshakeResolver(),n}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=(new Date).getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if(!(this.connection.features&&this.connection.features.inherentKeepAlive||(this._timeoutHandle=setTimeout((()=>this.serverTimeout()),this.serverTimeoutInMilliseconds),void 0!==this._pingServerHandle))){let e=this._nextKeepAlive-(new Date).getTime();e<0&&(e=0),this._pingServerHandle=setTimeout((async()=>{if(this._connectionState===HubConnectionState.Connected)try{await this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}}),e)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async _invokeClientMethod(e){const t=e.target.toLowerCase(),n=this._methods[t];if(!n)return this._logger.log(LogLevel.Warning,`No client method with the name '${t}' found.`),void(e.invocationId&&(this._logger.log(LogLevel.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),await this._sendWithProtocol(this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null))));const r=n.slice(),o=!!e.invocationId;let a,i,s;for(const n of r)try{const r=a;a=await n.apply(this,e.arguments),o&&a&&r&&(this._logger.log(LogLevel.Error,`Multiple results provided for '${t}'. Sending error to server.`),s=this._createCompletionMessage(e.invocationId,"Client provided multiple results.",null)),i=void 0}catch(e){i=e,this._logger.log(LogLevel.Error,`A callback for the method '${t}' threw error '${e}'.`)}s?await this._sendWithProtocol(s):o?(i?s=this._createCompletionMessage(e.invocationId,`${i}`,null):void 0!==a?s=this._createCompletionMessage(e.invocationId,null,a):(this._logger.log(LogLevel.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),s=this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)),await this._sendWithProtocol(s)):a&&this._logger.log(LogLevel.Error,`Result given for '${t}' method but server is not expecting a result.`)}_connectionClosed(e){this._logger.log(LogLevel.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||e||new AbortError("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(e||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===HubConnectionState.Disconnecting?this._completeClose(e):this._connectionState===HubConnectionState.Connected&&this._reconnectPolicy?this._reconnect(e):this._connectionState===HubConnectionState.Connected&&this._completeClose(e)}_completeClose(e){if(this._connectionStarted){this._connectionState=HubConnectionState.Disconnected,this._connectionStarted=!1,this._messageBuffer&&(this._messageBuffer._dispose(null!=e?e:new Error("Connection closed.")),this._messageBuffer=void 0),Platform.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach((t=>t.apply(this,[e])))}catch(t){this._logger.log(LogLevel.Error,`An onclose callback called with error '${e}' threw error '${t}'.`)}}}async _reconnect(e){const t=Date.now();let n=0,r=void 0!==e?e:new Error("Attempting to reconnect due to a unknown error."),o=this._getNextRetryDelay(n++,0,r);if(null===o)return this._logger.log(LogLevel.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),void this._completeClose(e);if(this._connectionState=HubConnectionState.Reconnecting,e?this._logger.log(LogLevel.Information,`Connection reconnecting because of error '${e}'.`):this._logger.log(LogLevel.Information,"Connection reconnecting."),0!==this._reconnectingCallbacks.length){try{this._reconnectingCallbacks.forEach((t=>t.apply(this,[e])))}catch(t){this._logger.log(LogLevel.Error,`An onreconnecting callback called with error '${e}' threw error '${t}'.`)}if(this._connectionState!==HubConnectionState.Reconnecting)return void this._logger.log(LogLevel.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.")}for(;null!==o;){if(this._logger.log(LogLevel.Information,`Reconnect attempt number ${n} will start in ${o} ms.`),await new Promise((e=>{this._reconnectDelayHandle=setTimeout(e,o)})),this._reconnectDelayHandle=void 0,this._connectionState!==HubConnectionState.Reconnecting)return void this._logger.log(LogLevel.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");try{if(await this._startInternal(),this._connectionState=HubConnectionState.Connected,this._logger.log(LogLevel.Information,"HubConnection reconnected successfully."),0!==this._reconnectedCallbacks.length)try{this._reconnectedCallbacks.forEach((e=>e.apply(this,[this.connection.connectionId])))}catch(e){this._logger.log(LogLevel.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${e}'.`)}return}catch(e){if(this._logger.log(LogLevel.Information,`Reconnect attempt failed because of error '${e}'.`),this._connectionState!==HubConnectionState.Reconnecting)return this._logger.log(LogLevel.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),void(this._connectionState===HubConnectionState.Disconnecting&&this._completeClose());r=e instanceof Error?e:new Error(e.toString()),o=this._getNextRetryDelay(n++,Date.now()-t,r)}}this._logger.log(LogLevel.Information,`Reconnect retries have been exhausted after ${Date.now()-t} ms and ${n} failed attempts. Connection disconnecting.`),this._completeClose()}_getNextRetryDelay(e,t,n){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:t,previousRetryCount:e,retryReason:n})}catch(n){return this._logger.log(LogLevel.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${t}) threw error '${n}'.`),null}}_cancelCallbacksWithError(e){const t=this._callbacks;this._callbacks={},Object.keys(t).forEach((n=>{const r=t[n];try{r(null,e)}catch(t){this._logger.log(LogLevel.Error,`Stream 'error' callback called with '${e}' threw error: ${getErrorString(t)}`)}}))}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(e,t,n,r){if(n)return 0!==r.length?{arguments:t,streamIds:r,target:e,type:MessageType.Invocation}:{arguments:t,target:e,type:MessageType.Invocation};{const n=this._invocationId;return this._invocationId++,0!==r.length?{arguments:t,invocationId:n.toString(),streamIds:r,target:e,type:MessageType.Invocation}:{arguments:t,invocationId:n.toString(),target:e,type:MessageType.Invocation}}}_launchStreams(e,t){if(0!==e.length){t||(t=Promise.resolve());for(const n in e)e[n].subscribe({complete:()=>{t=t.then((()=>this._sendWithProtocol(this._createCompletionMessage(n))))},error:e=>{let r;r=e instanceof Error?e.message:e&&e.toString?e.toString():"Unknown error",t=t.then((()=>this._sendWithProtocol(this._createCompletionMessage(n,r))))},next:e=>{t=t.then((()=>this._sendWithProtocol(this._createStreamItemMessage(n,e))))}})}}_replaceStreamingParams(e){const t=[],n=[];for(let r=0;r<e.length;r++){const o=e[r];if(this._isObservable(o)){const a=this._invocationId;this._invocationId++,t[a]=o,n.push(a.toString()),e.splice(r,1)}}return[t,n]}_isObservable(e){return e&&e.subscribe&&"function"==typeof e.subscribe}_createStreamInvocation(e,t,n){const r=this._invocationId;return this._invocationId++,0!==n.length?{arguments:t,invocationId:r.toString(),streamIds:n,target:e,type:MessageType.StreamInvocation}:{arguments:t,invocationId:r.toString(),target:e,type:MessageType.StreamInvocation}}_createCancelInvocation(e){return{invocationId:e,type:MessageType.CancelInvocation}}_createStreamItemMessage(e,t){return{invocationId:e,item:t,type:MessageType.StreamItem}}_createCompletionMessage(e,t,n){return t?{error:t,invocationId:e,type:MessageType.Completion}:{invocationId:e,result:n,type:MessageType.Completion}}_createCloseMessage(){return{type:MessageType.Close}}}const DEFAULT_RETRY_DELAYS_IN_MILLISECONDS=[0,2e3,1e4,3e4,null];class DefaultReconnectPolicy{constructor(e){this._retryDelays=void 0!==e?[...e,null]:DEFAULT_RETRY_DELAYS_IN_MILLISECONDS}nextRetryDelayInMilliseconds(e){return this._retryDelays[e.previousRetryCount]}}class HeaderNames{}HeaderNames.Authorization="Authorization",HeaderNames.Cookie="Cookie";class AccessTokenHttpClient extends HttpClient{constructor(e,t){super(),this._innerClient=e,this._accessTokenFactory=t}async send(e){let t=!0;this._accessTokenFactory&&(!this._accessToken||e.url&&e.url.indexOf("/negotiate?")>0)&&(t=!1,this._accessToken=await this._accessTokenFactory()),this._setAuthorizationHeader(e);const n=await this._innerClient.send(e);return t&&401===n.statusCode&&this._accessTokenFactory?(this._accessToken=await this._accessTokenFactory(),this._setAuthorizationHeader(e),await this._innerClient.send(e)):n}_setAuthorizationHeader(e){e.headers||(e.headers={}),this._accessToken?e.headers[HeaderNames.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&e.headers[HeaderNames.Authorization]&&delete e.headers[HeaderNames.Authorization]}getCookieString(e){return this._innerClient.getCookieString(e)}}var HttpTransportType,TransferFormat;!function(e){e[e.None=0]="None",e[e.WebSockets=1]="WebSockets",e[e.ServerSentEvents=2]="ServerSentEvents",e[e.LongPolling=4]="LongPolling"}(HttpTransportType||(HttpTransportType={})),function(e){e[e.Text=1]="Text",e[e.Binary=2]="Binary"}(TransferFormat||(TransferFormat={}));class AbortController$1{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}}class LongPollingTransport{get pollAborted(){return this._pollAbort.aborted}constructor(e,t,n){this._httpClient=e,this._logger=t,this._pollAbort=new AbortController$1,this._options=n,this._running=!1,this.onreceive=null,this.onclose=null}async connect(e,t){if(Arg.isRequired(e,"url"),Arg.isRequired(t,"transferFormat"),Arg.isIn(t,TransferFormat,"transferFormat"),this._url=e,this._logger.log(LogLevel.Trace,"(LongPolling transport) Connecting."),t===TransferFormat.Binary&&"undefined"!=typeof XMLHttpRequest&&"string"!=typeof(new XMLHttpRequest).responseType)throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");const[n,r]=getUserAgentHeader(),o={[n]:r,...this._options.headers},a={abortSignal:this._pollAbort.signal,headers:o,timeout:1e5,withCredentials:this._options.withCredentials};t===TransferFormat.Binary&&(a.responseType="arraybuffer");const i=`${e}&_=${Date.now()}`;this._logger.log(LogLevel.Trace,`(LongPolling transport) polling: ${i}.`);const s=await this._httpClient.get(i,a);200!==s.statusCode?(this._logger.log(LogLevel.Error,`(LongPolling transport) Unexpected response code: ${s.statusCode}.`),this._closeError=new HttpError(s.statusText||"",s.statusCode),this._running=!1):this._running=!0,this._receiving=this._poll(this._url,a)}async _poll(e,t){try{for(;this._running;)try{const n=`${e}&_=${Date.now()}`;this._logger.log(LogLevel.Trace,`(LongPolling transport) polling: ${n}.`);const r=await this._httpClient.get(n,t);204===r.statusCode?(this._logger.log(LogLevel.Information,"(LongPolling transport) Poll terminated by server."),this._running=!1):200!==r.statusCode?(this._logger.log(LogLevel.Error,`(LongPolling transport) Unexpected response code: ${r.statusCode}.`),this._closeError=new HttpError(r.statusText||"",r.statusCode),this._running=!1):r.content?(this._logger.log(LogLevel.Trace,`(LongPolling transport) data received. ${getDataDetail(r.content,this._options.logMessageContent)}.`),this.onreceive&&this.onreceive(r.content)):this._logger.log(LogLevel.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(e){this._running?e instanceof TimeoutError?this._logger.log(LogLevel.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this._closeError=e,this._running=!1):this._logger.log(LogLevel.Trace,`(LongPolling transport) Poll errored after shutdown: ${e.message}`)}}finally{this._logger.log(LogLevel.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this._raiseOnClose()}}async send(e){return this._running?sendMessage(this._logger,"LongPolling",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this._logger.log(LogLevel.Trace,"(LongPolling transport) Stopping polling."),this._running=!1,this._pollAbort.abort();try{await this._receiving,this._logger.log(LogLevel.Trace,`(LongPolling transport) sending DELETE request to ${this._url}.`);const e={},[t,n]=getUserAgentHeader();e[t]=n;const r={headers:{...e,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials};let o;try{await this._httpClient.delete(this._url,r)}catch(e){o=e}o?o instanceof HttpError&&(404===o.statusCode?this._logger.log(LogLevel.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this._logger.log(LogLevel.Trace,`(LongPolling transport) Error sending a DELETE request: ${o}`)):this._logger.log(LogLevel.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this._logger.log(LogLevel.Trace,"(LongPolling transport) Stop finished."),this._raiseOnClose()}}_raiseOnClose(){if(this.onclose){let e="(LongPolling transport) Firing onclose event.";this._closeError&&(e+=" Error: "+this._closeError),this._logger.log(LogLevel.Trace,e),this.onclose(this._closeError)}}}class ServerSentEventsTransport{constructor(e,t,n,r){this._httpClient=e,this._accessToken=t,this._logger=n,this._options=r,this.onreceive=null,this.onclose=null}async connect(e,t){return Arg.isRequired(e,"url"),Arg.isRequired(t,"transferFormat"),Arg.isIn(t,TransferFormat,"transferFormat"),this._logger.log(LogLevel.Trace,"(SSE transport) Connecting."),this._url=e,this._accessToken&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this._accessToken)}`),new Promise(((n,r)=>{let o,a=!1;if(t===TransferFormat.Text){if(Platform.isBrowser||Platform.isWebWorker)o=new this._options.EventSource(e,{withCredentials:this._options.withCredentials});else{const t=this._httpClient.getCookieString(e),n={};n.Cookie=t;const[r,a]=getUserAgentHeader();n[r]=a,o=new this._options.EventSource(e,{withCredentials:this._options.withCredentials,headers:{...n,...this._options.headers}})}try{o.onmessage=e=>{if(this.onreceive)try{this._logger.log(LogLevel.Trace,`(SSE transport) data received. ${getDataDetail(e.data,this._options.logMessageContent)}.`),this.onreceive(e.data)}catch(e){return void this._close(e)}},o.onerror=e=>{a?this._close():r(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},o.onopen=()=>{this._logger.log(LogLevel.Information,`SSE connected to ${this._url}`),this._eventSource=o,a=!0,n()}}catch(e){return void r(e)}}else r(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))}))}async send(e){return this._eventSource?sendMessage(this._logger,"SSE",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this._close(),Promise.resolve()}_close(e){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(e))}}class WebSocketTransport{constructor(e,t,n,r,o,a){this._logger=n,this._accessTokenFactory=t,this._logMessageContent=r,this._webSocketConstructor=o,this._httpClient=e,this.onreceive=null,this.onclose=null,this._headers=a}async connect(e,t){let n;return Arg.isRequired(e,"url"),Arg.isRequired(t,"transferFormat"),Arg.isIn(t,TransferFormat,"transferFormat"),this._logger.log(LogLevel.Trace,"(WebSockets transport) Connecting."),this._accessTokenFactory&&(n=await this._accessTokenFactory()),new Promise(((r,o)=>{let a;e=e.replace(/^http/,"ws");const i=this._httpClient.getCookieString(e);let s=!1;if(Platform.isNode||Platform.isReactNative){const t={},[r,o]=getUserAgentHeader();t[r]=o,n&&(t[HeaderNames.Authorization]=`Bearer ${n}`),i&&(t[HeaderNames.Cookie]=i),a=new this._webSocketConstructor(e,void 0,{headers:{...t,...this._headers}})}else n&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(n)}`);a||(a=new this._webSocketConstructor(e)),t===TransferFormat.Binary&&(a.binaryType="arraybuffer"),a.onopen=t=>{this._logger.log(LogLevel.Information,`WebSocket connected to ${e}.`),this._webSocket=a,s=!0,r()},a.onerror=e=>{let t=null;t="undefined"!=typeof ErrorEvent&&e instanceof ErrorEvent?e.error:"There was an error with the transport",this._logger.log(LogLevel.Information,`(WebSockets transport) ${t}.`)},a.onmessage=e=>{if(this._logger.log(LogLevel.Trace,`(WebSockets transport) data received. ${getDataDetail(e.data,this._logMessageContent)}.`),this.onreceive)try{this.onreceive(e.data)}catch(e){return void this._close(e)}},a.onclose=e=>{if(s)this._close(e);else{let t=null;t="undefined"!=typeof ErrorEvent&&e instanceof ErrorEvent?e.error:"WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",o(new Error(t))}}}))}send(e){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(LogLevel.Trace,`(WebSockets transport) sending data. ${getDataDetail(e,this._logMessageContent)}.`),this._webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(e){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(LogLevel.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!this._isCloseEvent(e)||!1!==e.wasClean&&1e3===e.code?e instanceof Error?this.onclose(e):this.onclose():this.onclose(new Error(`WebSocket closed with status code: ${e.code} (${e.reason||"no reason given"}).`)))}_isCloseEvent(e){return e&&"boolean"==typeof e.wasClean&&"number"==typeof e.code}}const MAX_REDIRECTS=100;class HttpConnection{constructor(e,t={}){if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,Arg.isRequired(e,"url"),this._logger=createLogger(t.logger),this.baseUrl=this._resolveUrl(e),(t=t||{}).logMessageContent=void 0!==t.logMessageContent&&t.logMessageContent,"boolean"!=typeof t.withCredentials&&void 0!==t.withCredentials)throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");t.withCredentials=void 0===t.withCredentials||t.withCredentials,t.timeout=void 0===t.timeout?1e5:t.timeout;let n=null,r=null;if(Platform.isNode&&"undefined"!=typeof require){const e="function"==typeof __webpack_require__?__non_webpack_require__:require;n=e("ws"),r=e("eventsource")}Platform.isNode||"undefined"==typeof WebSocket||t.WebSocket?Platform.isNode&&!t.WebSocket&&n&&(t.WebSocket=n):t.WebSocket=WebSocket,Platform.isNode||"undefined"==typeof EventSource||t.EventSource?Platform.isNode&&!t.EventSource&&void 0!==r&&(t.EventSource=r):t.EventSource=EventSource,this._httpClient=new AccessTokenHttpClient(t.httpClient||new DefaultHttpClient(this._logger),t.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=t,this.onreceive=null,this.onclose=null}async start(e){if(e=e||TransferFormat.Binary,Arg.isIn(e,TransferFormat,"transferFormat"),this._logger.log(LogLevel.Debug,`Starting connection with transfer format '${TransferFormat[e]}'.`),"Disconnected"!==this._connectionState)return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this._connectionState="Connecting",this._startInternalPromise=this._startInternal(e),await this._startInternalPromise,"Disconnecting"===this._connectionState){const e="Failed to start the HttpConnection before stop() was called.";return this._logger.log(LogLevel.Error,e),await this._stopPromise,Promise.reject(new AbortError(e))}if("Connected"!==this._connectionState){const e="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this._logger.log(LogLevel.Error,e),Promise.reject(new AbortError(e))}this._connectionStarted=!0}send(e){return"Connected"!==this._connectionState?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new TransportSendQueue(this.transport)),this._sendQueue.send(e))}async stop(e){return"Disconnected"===this._connectionState?(this._logger.log(LogLevel.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnected state.`),Promise.resolve()):"Disconnecting"===this._connectionState?(this._logger.log(LogLevel.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise):(this._connectionState="Disconnecting",this._stopPromise=new Promise((e=>{this._stopPromiseResolver=e})),await this._stopInternal(e),void await this._stopPromise)}async _stopInternal(e){this._stopError=e;try{await this._startInternalPromise}catch(e){}if(this.transport){try{await this.transport.stop()}catch(e){this._logger.log(LogLevel.Error,`HttpConnection.transport.stop() threw error '${e}'.`),this._stopConnection()}this.transport=void 0}else this._logger.log(LogLevel.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async _startInternal(e){let t=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory,this._httpClient._accessTokenFactory=this._accessTokenFactory;try{if(this._options.skipNegotiation){if(this._options.transport!==HttpTransportType.WebSockets)throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");this.transport=this._constructTransport(HttpTransportType.WebSockets),await this._startTransport(t,e)}else{let n=null,r=0;do{if(n=await this._getNegotiationResponse(t),"Disconnecting"===this._connectionState||"Disconnected"===this._connectionState)throw new AbortError("The connection was stopped during negotiation.");if(n.error)throw new Error(n.error);if(n.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(n.url&&(t=n.url),n.accessToken){const e=n.accessToken;this._accessTokenFactory=()=>e,this._httpClient._accessToken=e,this._httpClient._accessTokenFactory=void 0}r++}while(n.url&&r<MAX_REDIRECTS);if(r===MAX_REDIRECTS&&n.url)throw new Error("Negotiate redirection limit exceeded.");await this._createTransport(t,this._options.transport,n,e)}this.transport instanceof LongPollingTransport&&(this.features.inherentKeepAlive=!0),"Connecting"===this._connectionState&&(this._logger.log(LogLevel.Debug,"The HttpConnection connected successfully."),this._connectionState="Connected")}catch(e){return this._logger.log(LogLevel.Error,"Failed to start the connection: "+e),this._connectionState="Disconnected",this.transport=void 0,this._stopPromiseResolver(),Promise.reject(e)}}async _getNegotiationResponse(e){const t={},[n,r]=getUserAgentHeader();t[n]=r;const o=this._resolveNegotiateUrl(e);this._logger.log(LogLevel.Debug,`Sending negotiation request: ${o}.`);try{const e=await this._httpClient.post(o,{content:"",headers:{...t,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials});if(200!==e.statusCode)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${e.statusCode}'`));const n=JSON.parse(e.content);return(!n.negotiateVersion||n.negotiateVersion<1)&&(n.connectionToken=n.connectionId),n.useStatefulReconnect&&!0!==this._options._useStatefulReconnect?Promise.reject(new FailedToNegotiateWithServerError("Client didn't negotiate Stateful Reconnect but the server did.")):n}catch(e){let t="Failed to complete negotiation with the server: "+e;return e instanceof HttpError&&404===e.statusCode&&(t+=" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this._logger.log(LogLevel.Error,t),Promise.reject(new FailedToNegotiateWithServerError(t))}}_createConnectUrl(e,t){return t?e+(-1===e.indexOf("?")?"?":"&")+`id=${t}`:e}async _createTransport(e,t,n,r){let o=this._createConnectUrl(e,n.connectionToken);if(this._isITransport(t))return this._logger.log(LogLevel.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=t,await this._startTransport(o,r),void(this.connectionId=n.connectionId);const a=[],i=n.availableTransports||[];let s=n;for(const n of i){const i=this._resolveTransportOrError(n,t,r,!0===(null==s?void 0:s.useStatefulReconnect));if(i instanceof Error)a.push(`${n.transport} failed:`),a.push(i);else if(this._isITransport(i)){if(this.transport=i,!s){try{s=await this._getNegotiationResponse(e)}catch(e){return Promise.reject(e)}o=this._createConnectUrl(e,s.connectionToken)}try{return await this._startTransport(o,r),void(this.connectionId=s.connectionId)}catch(e){if(this._logger.log(LogLevel.Error,`Failed to start the transport '${n.transport}': ${e}`),s=void 0,a.push(new FailedToStartTransportError(`${n.transport} failed: ${e}`,HttpTransportType[n.transport])),"Connecting"!==this._connectionState){const e="Failed to select transport before stop() was called.";return this._logger.log(LogLevel.Debug,e),Promise.reject(new AbortError(e))}}}}return a.length>0?Promise.reject(new AggregateErrors(`Unable to connect to the server with any of the available transports. ${a.join(" ")}`,a)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}_constructTransport(e){switch(e){case HttpTransportType.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new WebSocketTransport(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case HttpTransportType.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new ServerSentEventsTransport(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case HttpTransportType.LongPolling:return new LongPollingTransport(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${e}.`)}}_startTransport(e,t){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=async n=>{let r=!1;if(this.features.reconnect){try{this.features.disconnected(),await this.transport.connect(e,t),await this.features.resend()}catch{r=!0}r&&this._stopConnection(n)}else this._stopConnection(n)}:this.transport.onclose=e=>this._stopConnection(e),this.transport.connect(e,t)}_resolveTransportOrError(e,t,n,r){const o=HttpTransportType[e.transport];if(null==o)return this._logger.log(LogLevel.Debug,`Skipping transport '${e.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${e.transport}' because it is not supported by this client.`);if(!transportMatches(t,o))return this._logger.log(LogLevel.Debug,`Skipping transport '${HttpTransportType[o]}' because it was disabled by the client.`),new DisabledTransportError(`'${HttpTransportType[o]}' is disabled by the client.`,o);if(!(e.transferFormats.map((e=>TransferFormat[e])).indexOf(n)>=0))return this._logger.log(LogLevel.Debug,`Skipping transport '${HttpTransportType[o]}' because it does not support the requested transfer format '${TransferFormat[n]}'.`),new Error(`'${HttpTransportType[o]}' does not support ${TransferFormat[n]}.`);if(o===HttpTransportType.WebSockets&&!this._options.WebSocket||o===HttpTransportType.ServerSentEvents&&!this._options.EventSource)return this._logger.log(LogLevel.Debug,`Skipping transport '${HttpTransportType[o]}' because it is not supported in your environment.'`),new UnsupportedTransportError(`'${HttpTransportType[o]}' is not supported in your environment.`,o);this._logger.log(LogLevel.Debug,`Selecting transport '${HttpTransportType[o]}'.`);try{return this.features.reconnect=o===HttpTransportType.WebSockets?r:void 0,this._constructTransport(o)}catch(e){return e}}_isITransport(e){return e&&"object"==typeof e&&"connect"in e}_stopConnection(e){if(this._logger.log(LogLevel.Debug,`HttpConnection.stopConnection(${e}) called while in state ${this._connectionState}.`),this.transport=void 0,e=this._stopError||e,this._stopError=void 0,"Disconnected"!==this._connectionState){if("Connecting"===this._connectionState)throw this._logger.log(LogLevel.Warning,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${e}) was called while the connection is still in the connecting state.`);if("Disconnecting"===this._connectionState&&this._stopPromiseResolver(),e?this._logger.log(LogLevel.Error,`Connection disconnected with error '${e}'.`):this._logger.log(LogLevel.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch((e=>{this._logger.log(LogLevel.Error,`TransportSendQueue.stop() threw error '${e}'.`)})),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(e)}catch(t){this._logger.log(LogLevel.Error,`HttpConnection.onclose(${e}) threw error '${t}'.`)}}}else this._logger.log(LogLevel.Debug,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is already in the disconnected state.`)}_resolveUrl(e){if(0===e.lastIndexOf("https://",0)||0===e.lastIndexOf("http://",0))return e;if(!Platform.isBrowser)throw new Error(`Cannot resolve '${e}'.`);const t=window.document.createElement("a");return t.href=e,this._logger.log(LogLevel.Information,`Normalizing '${e}' to '${t.href}'.`),t.href}_resolveNegotiateUrl(e){const t=new URL(e);t.pathname.endsWith("/")?t.pathname+="negotiate":t.pathname+="/negotiate";const n=new URLSearchParams(t.searchParams);return n.has("negotiateVersion")||n.append("negotiateVersion",this._negotiateVersion.toString()),n.has("useStatefulReconnect")?"true"===n.get("useStatefulReconnect")&&(this._options._useStatefulReconnect=!0):!0===this._options._useStatefulReconnect&&n.append("useStatefulReconnect","true"),t.search=n.toString(),t.toString()}}function transportMatches(e,t){return!e||!!(t&e)}class TransportSendQueue{constructor(e){this._transport=e,this._buffer=[],this._executing=!0,this._sendBufferedData=new PromiseSource,this._transportResult=new PromiseSource,this._sendLoopPromise=this._sendLoop()}send(e){return this._bufferData(e),this._transportResult||(this._transportResult=new PromiseSource),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(e){if(this._buffer.length&&typeof this._buffer[0]!=typeof e)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof e}`);this._buffer.push(e),this._sendBufferedData.resolve()}async _sendLoop(){for(;;){if(await this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new PromiseSource;const e=this._transportResult;this._transportResult=void 0;const t="string"==typeof this._buffer[0]?this._buffer.join(""):TransportSendQueue._concatBuffers(this._buffer);this._buffer.length=0;try{await this._transport.send(t),e.resolve()}catch(t){e.reject(t)}}}static _concatBuffers(e){const t=e.map((e=>e.byteLength)).reduce(((e,t)=>e+t)),n=new Uint8Array(t);let r=0;for(const t of e)n.set(new Uint8Array(t),r),r+=t.byteLength;return n.buffer}}class PromiseSource{constructor(){this.promise=new Promise(((e,t)=>[this._resolver,this._rejecter]=[e,t]))}resolve(){this._resolver()}reject(e){this._rejecter(e)}}const JSON_HUB_PROTOCOL_NAME="json";class JsonHubProtocol{constructor(){this.name=JSON_HUB_PROTOCOL_NAME,this.version=2,this.transferFormat=TransferFormat.Text}parseMessages(e,t){if("string"!=typeof e)throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];null===t&&(t=NullLogger.instance);const n=TextMessageFormat.parse(e),r=[];for(const e of n){const n=JSON.parse(e);if("number"!=typeof n.type)throw new Error("Invalid payload.");switch(n.type){case MessageType.Invocation:this._isInvocationMessage(n);break;case MessageType.StreamItem:this._isStreamItemMessage(n);break;case MessageType.Completion:this._isCompletionMessage(n);break;case MessageType.Ping:case MessageType.Close:break;case MessageType.Ack:this._isAckMessage(n);break;case MessageType.Sequence:this._isSequenceMessage(n);break;default:t.log(LogLevel.Information,"Unknown message type '"+n.type+"' ignored.");continue}r.push(n)}return r}writeMessage(e){return TextMessageFormat.write(JSON.stringify(e))}_isInvocationMessage(e){this._assertNotEmptyString(e.target,"Invalid payload for Invocation message."),void 0!==e.invocationId&&this._assertNotEmptyString(e.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(e){if(this._assertNotEmptyString(e.invocationId,"Invalid payload for StreamItem message."),void 0===e.item)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this._assertNotEmptyString(e.error,"Invalid payload for Completion message."),this._assertNotEmptyString(e.invocationId,"Invalid payload for Completion message.")}_isAckMessage(e){if("number"!=typeof e.sequenceId)throw new Error("Invalid SequenceId for Ack message.")}_isSequenceMessage(e){if("number"!=typeof e.sequenceId)throw new Error("Invalid SequenceId for Sequence message.")}_assertNotEmptyString(e,t){if("string"!=typeof e||""===e)throw new Error(t)}}const LogLevelNameMapping={trace:LogLevel.Trace,debug:LogLevel.Debug,info:LogLevel.Information,information:LogLevel.Information,warn:LogLevel.Warning,warning:LogLevel.Warning,error:LogLevel.Error,critical:LogLevel.Critical,none:LogLevel.None};function parseLogLevel(e){const t=LogLevelNameMapping[e.toLowerCase()];if(void 0!==t)return t;throw new Error(`Unknown log level: ${e}`)}class HubConnectionBuilder{configureLogging(e){if(Arg.isRequired(e,"logging"),isLogger(e))this.logger=e;else if("string"==typeof e){const t=parseLogLevel(e);this.logger=new ConsoleLogger(t)}else this.logger=new ConsoleLogger(e);return this}withUrl(e,t){return Arg.isRequired(e,"url"),Arg.isNotEmpty(e,"url"),this.url=e,this.httpConnectionOptions="object"==typeof t?{...this.httpConnectionOptions,...t}:{...this.httpConnectionOptions,transport:t},this}withHubProtocol(e){return Arg.isRequired(e,"protocol"),this.protocol=e,this}withAutomaticReconnect(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new DefaultReconnectPolicy(e):this.reconnectPolicy=e:this.reconnectPolicy=new DefaultReconnectPolicy,this}withServerTimeout(e){return Arg.isRequired(e,"milliseconds"),this._serverTimeoutInMilliseconds=e,this}withKeepAliveInterval(e){return Arg.isRequired(e,"milliseconds"),this._keepAliveIntervalInMilliseconds=e,this}withStatefulReconnect(e){return void 0===this.httpConnectionOptions&&(this.httpConnectionOptions={}),this.httpConnectionOptions._useStatefulReconnect=!0,this._statefulReconnectBufferSize=null==e?void 0:e.bufferSize,this}build(){const e=this.httpConnectionOptions||{};if(void 0===e.logger&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");const t=new HttpConnection(this.url,e);return HubConnection.create(t,this.logger||NullLogger.instance,this.protocol||new JsonHubProtocol,this.reconnectPolicy,this._serverTimeoutInMilliseconds,this._keepAliveIntervalInMilliseconds,this._statefulReconnectBufferSize)}}function isLogger(e){return void 0!==e.log}var UINT32_MAX=4294967295,_a,_b,_c;function setUint64(e,t,n){var r=n/4294967296,o=n;e.setUint32(t,r),e.setUint32(t+4,o)}function setInt64(e,t,n){var r=Math.floor(n/4294967296),o=n;e.setUint32(t,r),e.setUint32(t+4,o)}function getInt64(e,t){return 4294967296*e.getInt32(t)+e.getUint32(t+4)}function getUint64(e,t){return 4294967296*e.getUint32(t)+e.getUint32(t+4)}var TEXT_ENCODING_AVAILABLE=("undefined"==typeof process||"never"!==(null===(_a=null===process||void 0===process?void 0:process.env)||void 0===_a?void 0:_a.TEXT_ENCODING))&&"undefined"!=typeof TextEncoder&&"undefined"!=typeof TextDecoder;function utf8Count(e){for(var t=e.length,n=0,r=0;r<t;){var o=e.charCodeAt(r++);if(4294967168&o)if(4294965248&o){if(o>=55296&&o<=56319&&r<t){var a=e.charCodeAt(r);56320==(64512&a)&&(++r,o=((1023&o)<<10)+(1023&a)+65536)}n+=4294901760&o?4:3}else n+=2;else n++}return n}function utf8EncodeJs(e,t,n){for(var r=e.length,o=n,a=0;a<r;){var i=e.charCodeAt(a++);if(4294967168&i){if(4294965248&i){if(i>=55296&&i<=56319&&a<r){var s=e.charCodeAt(a);56320==(64512&s)&&(++a,i=((1023&i)<<10)+(1023&s)+65536)}4294901760&i?(t[o++]=i>>18&7|240,t[o++]=i>>12&63|128,t[o++]=i>>6&63|128):(t[o++]=i>>12&15|224,t[o++]=i>>6&63|128)}else t[o++]=i>>6&31|192;t[o++]=63&i|128}else t[o++]=i}}var sharedTextEncoder=TEXT_ENCODING_AVAILABLE?new TextEncoder:void 0,TEXT_ENCODER_THRESHOLD=TEXT_ENCODING_AVAILABLE?"undefined"!=typeof process&&"force"!==(null===(_b=null===process||void 0===process?void 0:process.env)||void 0===_b?void 0:_b.TEXT_ENCODING)?200:0:UINT32_MAX;function utf8EncodeTEencode(e,t,n){t.set(sharedTextEncoder.encode(e),n)}function utf8EncodeTEencodeInto(e,t,n){sharedTextEncoder.encodeInto(e,t.subarray(n))}var utf8EncodeTE=(null==sharedTextEncoder?void 0:sharedTextEncoder.encodeInto)?utf8EncodeTEencodeInto:utf8EncodeTEencode,CHUNK_SIZE=4096;function utf8DecodeJs(e,t,n){for(var r=t,o=r+n,a=[],i="";r<o;){var s=e[r++];if(128&s)if(192==(224&s)){var c=63&e[r++];a.push((31&s)<<6|c)}else if(224==(240&s)){c=63&e[r++];var l=63&e[r++];a.push((31&s)<<12|c<<6|l)}else if(240==(248&s)){var u=(7&s)<<18|(c=63&e[r++])<<12|(l=63&e[r++])<<6|63&e[r++];u>65535&&(u-=65536,a.push(u>>>10&1023|55296),u=56320|1023&u),a.push(u)}else a.push(s);else a.push(s);a.length>=CHUNK_SIZE&&(i+=String.fromCharCode.apply(String,a),a.length=0)}return a.length>0&&(i+=String.fromCharCode.apply(String,a)),i}var sharedTextDecoder=TEXT_ENCODING_AVAILABLE?new TextDecoder:null,TEXT_DECODER_THRESHOLD=TEXT_ENCODING_AVAILABLE?"undefined"!=typeof process&&"force"!==(null===(_c=null===process||void 0===process?void 0:process.env)||void 0===_c?void 0:_c.TEXT_DECODER)?200:0:UINT32_MAX;function utf8DecodeTD(e,t,n){var r=e.subarray(t,t+n);return sharedTextDecoder.decode(r)}var ExtData=function(e,t){this.type=e,this.data=t},__extends$1=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),DecodeError=function(e){function t(n){var r=e.call(this,n)||this,o=Object.create(t.prototype);return Object.setPrototypeOf(r,o),Object.defineProperty(r,"name",{configurable:!0,enumerable:!1,value:t.name}),r}return __extends$1(t,e),t}(Error),EXT_TIMESTAMP=-1,TIMESTAMP32_MAX_SEC=4294967295,TIMESTAMP64_MAX_SEC=17179869183;function encodeTimeSpecToTimestamp(e){var t=e.sec,n=e.nsec;if(t>=0&&n>=0&&t<=TIMESTAMP64_MAX_SEC){if(0===n&&t<=TIMESTAMP32_MAX_SEC){var r=new Uint8Array(4);return(i=new DataView(r.buffer)).setUint32(0,t),r}var o=t/4294967296,a=4294967295&t;r=new Uint8Array(8);return(i=new DataView(r.buffer)).setUint32(0,n<<2|3&o),i.setUint32(4,a),r}var i;r=new Uint8Array(12);return(i=new DataView(r.buffer)).setUint32(0,n),setInt64(i,4,t),r}function encodeDateToTimeSpec(e){var t=e.getTime(),n=Math.floor(t/1e3),r=1e6*(t-1e3*n),o=Math.floor(r/1e9);return{sec:n+o,nsec:r-1e9*o}}function encodeTimestampExtension(e){return e instanceof Date?encodeTimeSpecToTimestamp(encodeDateToTimeSpec(e)):null}function decodeTimestampToTimeSpec(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);switch(e.byteLength){case 4:return{sec:t.getUint32(0),nsec:0};case 8:var n=t.getUint32(0);return{sec:4294967296*(3&n)+t.getUint32(4),nsec:n>>>2};case 12:return{sec:getInt64(t,4),nsec:t.getUint32(0)};default:throw new DecodeError("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(e.length))}}function decodeTimestampExtension(e){var t=decodeTimestampToTimeSpec(e);return new Date(1e3*t.sec+t.nsec/1e6)}var timestampExtension={type:EXT_TIMESTAMP,encode:encodeTimestampExtension,decode:decodeTimestampExtension},ExtensionCodec=function(){function e(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(timestampExtension)}return e.prototype.register=function(e){var t=e.type,n=e.encode,r=e.decode;if(t>=0)this.encoders[t]=n,this.decoders[t]=r;else{var o=1+t;this.builtInEncoders[o]=n,this.builtInDecoders[o]=r}},e.prototype.tryToEncode=function(e,t){for(var n=0;n<this.builtInEncoders.length;n++){if(null!=(r=this.builtInEncoders[n]))if(null!=(o=r(e,t)))return new ExtData(-1-n,o)}for(n=0;n<this.encoders.length;n++){var r,o;if(null!=(r=this.encoders[n]))if(null!=(o=r(e,t)))return new ExtData(n,o)}return e instanceof ExtData?e:null},e.prototype.decode=function(e,t,n){var r=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return r?r(e,t,n):new ExtData(t,e)},e.defaultCodec=new e,e}();function ensureUint8Array(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer?new Uint8Array(e):Uint8Array.from(e)}function createDataView(e){if(e instanceof ArrayBuffer)return new DataView(e);var t=ensureUint8Array(e);return new DataView(t.buffer,t.byteOffset,t.byteLength)}var DEFAULT_MAX_DEPTH=100,DEFAULT_INITIAL_BUFFER_SIZE=2048,Encoder=function(){function e(e,t,n,r,o,a,i,s){void 0===e&&(e=ExtensionCodec.defaultCodec),void 0===t&&(t=void 0),void 0===n&&(n=DEFAULT_MAX_DEPTH),void 0===r&&(r=DEFAULT_INITIAL_BUFFER_SIZE),void 0===o&&(o=!1),void 0===a&&(a=!1),void 0===i&&(i=!1),void 0===s&&(s=!1),this.extensionCodec=e,this.context=t,this.maxDepth=n,this.initialBufferSize=r,this.sortKeys=o,this.forceFloat32=a,this.ignoreUndefined=i,this.forceIntegerToFloat=s,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return e.prototype.reinitializeState=function(){this.pos=0},e.prototype.encodeSharedRef=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)},e.prototype.encode=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)},e.prototype.doEncode=function(e,t){if(t>this.maxDepth)throw new Error("Too deep objects in depth ".concat(t));null==e?this.encodeNil():"boolean"==typeof e?this.encodeBoolean(e):"number"==typeof e?this.encodeNumber(e):"string"==typeof e?this.encodeString(e):this.encodeObject(e,t)},e.prototype.ensureBufferSizeToWrite=function(e){var t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(2*t)},e.prototype.resizeBuffer=function(e){var t=new ArrayBuffer(e),n=new Uint8Array(t),r=new DataView(t);n.set(this.bytes),this.view=r,this.bytes=n},e.prototype.encodeNil=function(){this.writeU8(192)},e.prototype.encodeBoolean=function(e){!1===e?this.writeU8(194):this.writeU8(195)},e.prototype.encodeNumber=function(e){Number.isSafeInteger(e)&&!this.forceIntegerToFloat?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):(this.writeU8(211),this.writeI64(e)):this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))},e.prototype.writeStringHeader=function(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else{if(!(e<4294967296))throw new Error("Too long string: ".concat(e," bytes in UTF-8"));this.writeU8(219),this.writeU32(e)}},e.prototype.encodeString=function(e){if(e.length>TEXT_ENCODER_THRESHOLD){var t=utf8Count(e);this.ensureBufferSizeToWrite(5+t),this.writeStringHeader(t),utf8EncodeTE(e,this.bytes,this.pos),this.pos+=t}else{t=utf8Count(e);this.ensureBufferSizeToWrite(5+t),this.writeStringHeader(t),utf8EncodeJs(e,this.bytes,this.pos),this.pos+=t}},e.prototype.encodeObject=function(e,t){var n=this.extensionCodec.tryToEncode(e,this.context);if(null!=n)this.encodeExtension(n);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else{if("object"!=typeof e)throw new Error("Unrecognized object: ".concat(Object.prototype.toString.apply(e)));this.encodeMap(e,t)}},e.prototype.encodeBinary=function(e){var t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else{if(!(t<4294967296))throw new Error("Too large binary: ".concat(t));this.writeU8(198),this.writeU32(t)}var n=ensureUint8Array(e);this.writeU8a(n)},e.prototype.encodeArray=function(e,t){var n=e.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else{if(!(n<4294967296))throw new Error("Too large array: ".concat(n));this.writeU8(221),this.writeU32(n)}for(var r=0,o=e;r<o.length;r++){var a=o[r];this.doEncode(a,t+1)}},e.prototype.countWithoutUndefined=function(e,t){for(var n=0,r=0,o=t;r<o.length;r++){void 0!==e[o[r]]&&n++}return n},e.prototype.encodeMap=function(e,t){var n=Object.keys(e);this.sortKeys&&n.sort();var r=this.ignoreUndefined?this.countWithoutUndefined(e,n):n.length;if(r<16)this.writeU8(128+r);else if(r<65536)this.writeU8(222),this.writeU16(r);else{if(!(r<4294967296))throw new Error("Too large map object: ".concat(r));this.writeU8(223),this.writeU32(r)}for(var o=0,a=n;o<a.length;o++){var i=a[o],s=e[i];this.ignoreUndefined&&void 0===s||(this.encodeString(i),this.doEncode(s,t+1))}},e.prototype.encodeExtension=function(e){var t=e.data.length;if(1===t)this.writeU8(212);else if(2===t)this.writeU8(213);else if(4===t)this.writeU8(214);else if(8===t)this.writeU8(215);else if(16===t)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else{if(!(t<4294967296))throw new Error("Too large extension object: ".concat(t));this.writeU8(201),this.writeU32(t)}this.writeI8(e.type),this.writeU8a(e.data)},e.prototype.writeU8=function(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++},e.prototype.writeU8a=function(e){var t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t},e.prototype.writeI8=function(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++},e.prototype.writeU16=function(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2},e.prototype.writeI16=function(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2},e.prototype.writeU32=function(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4},e.prototype.writeI32=function(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4},e.prototype.writeF32=function(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4},e.prototype.writeF64=function(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8},e.prototype.writeU64=function(e){this.ensureBufferSizeToWrite(8),setUint64(this.view,this.pos,e),this.pos+=8},e.prototype.writeI64=function(e){this.ensureBufferSizeToWrite(8),setInt64(this.view,this.pos,e),this.pos+=8},e}();function prettyByte(e){return"".concat(e<0?"-":"","0x").concat(Math.abs(e).toString(16).padStart(2,"0"))}var DEFAULT_MAX_KEY_LENGTH=16,DEFAULT_MAX_LENGTH_PER_KEY=16,CachedKeyDecoder=function(){function e(e,t){void 0===e&&(e=DEFAULT_MAX_KEY_LENGTH),void 0===t&&(t=DEFAULT_MAX_LENGTH_PER_KEY),this.maxKeyLength=e,this.maxLengthPerKey=t,this.hit=0,this.miss=0,this.caches=[];for(var n=0;n<this.maxKeyLength;n++)this.caches.push([])}return e.prototype.canBeCached=function(e){return e>0&&e<=this.maxKeyLength},e.prototype.find=function(e,t,n){e:for(var r=0,o=this.caches[n-1];r<o.length;r++){for(var a=o[r],i=a.bytes,s=0;s<n;s++)if(i[s]!==e[t+s])continue e;return a.str}return null},e.prototype.store=function(e,t){var n=this.caches[e.length-1],r={bytes:e,str:t};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=r:n.push(r)},e.prototype.decode=function(e,t,n){var r=this.find(e,t,n);if(null!=r)return this.hit++,r;this.miss++;var o=utf8DecodeJs(e,t,n),a=Uint8Array.prototype.slice.call(e,t,t+n);return this.store(a,o),o},e}(),__awaiter$2=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},__generator$1=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},__asyncValues$1=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,o,(t=e[n](t)).done,t.value)}))}}},__await$1=function(e){return this instanceof __await$1?(this.v=e,this):new __await$1(e)},__asyncGenerator$1=function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),a=[];return r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r;function i(e){o[e]&&(r[e]=function(t){return new Promise((function(n,r){a.push([e,t,n,r])>1||s(e,t)}))})}function s(e,t){try{!function(e){e.value instanceof __await$1?Promise.resolve(e.value.v).then(c,l):u(a[0][2],e)}(o[e](t))}catch(e){u(a[0][3],e)}}function c(e){s("next",e)}function l(e){s("throw",e)}function u(e,t){e(t),a.shift(),a.length&&s(a[0][0],a[0][1])}},isValidMapKeyType=function(e){var t=typeof e;return"string"===t||"number"===t},HEAD_BYTE_REQUIRED=-1,EMPTY_VIEW=new DataView(new ArrayBuffer(0)),EMPTY_BYTES=new Uint8Array(EMPTY_VIEW.buffer),DataViewIndexOutOfBoundsError=function(){try{EMPTY_VIEW.getInt8(0)}catch(e){return e.constructor}throw new Error("never reached")}(),MORE_DATA=new DataViewIndexOutOfBoundsError("Insufficient data"),sharedCachedKeyDecoder=new CachedKeyDecoder,Decoder=function(){function e(e,t,n,r,o,a,i,s){void 0===e&&(e=ExtensionCodec.defaultCodec),void 0===t&&(t=void 0),void 0===n&&(n=UINT32_MAX),void 0===r&&(r=UINT32_MAX),void 0===o&&(o=UINT32_MAX),void 0===a&&(a=UINT32_MAX),void 0===i&&(i=UINT32_MAX),void 0===s&&(s=sharedCachedKeyDecoder),this.extensionCodec=e,this.context=t,this.maxStrLength=n,this.maxBinLength=r,this.maxArrayLength=o,this.maxMapLength=a,this.maxExtLength=i,this.keyDecoder=s,this.totalPos=0,this.pos=0,this.view=EMPTY_VIEW,this.bytes=EMPTY_BYTES,this.headByte=HEAD_BYTE_REQUIRED,this.stack=[]}return e.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=HEAD_BYTE_REQUIRED,this.stack.length=0},e.prototype.setBuffer=function(e){this.bytes=ensureUint8Array(e),this.view=createDataView(this.bytes),this.pos=0},e.prototype.appendBuffer=function(e){if(this.headByte!==HEAD_BYTE_REQUIRED||this.hasRemaining(1)){var t=this.bytes.subarray(this.pos),n=ensureUint8Array(e),r=new Uint8Array(t.length+n.length);r.set(t),r.set(n,t.length),this.setBuffer(r)}else this.setBuffer(e)},e.prototype.hasRemaining=function(e){return this.view.byteLength-this.pos>=e},e.prototype.createExtraByteError=function(e){var t=this.view,n=this.pos;return new RangeError("Extra ".concat(t.byteLength-n," of ").concat(t.byteLength," byte(s) found at buffer[").concat(e,"]"))},e.prototype.decode=function(e){this.reinitializeState(),this.setBuffer(e);var t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t},e.prototype.decodeMulti=function(e){return __generator$1(this,(function(t){switch(t.label){case 0:this.reinitializeState(),this.setBuffer(e),t.label=1;case 1:return this.hasRemaining(1)?[4,this.doDecodeSync()]:[3,3];case 2:return t.sent(),[3,1];case 3:return[2]}}))},e.prototype.decodeAsync=function(e){var t,n,r,o;return __awaiter$2(this,void 0,void 0,(function(){var a,i,s,c,l,u,d,p;return __generator$1(this,(function(g){switch(g.label){case 0:a=!1,g.label=1;case 1:g.trys.push([1,6,7,12]),t=__asyncValues$1(e),g.label=2;case 2:return[4,t.next()];case 3:if((n=g.sent()).done)return[3,5];if(s=n.value,a)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s);try{i=this.doDecodeSync(),a=!0}catch(e){if(!(e instanceof DataViewIndexOutOfBoundsError))throw e}this.totalPos+=this.pos,g.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return c=g.sent(),r={error:c},[3,12];case 7:return g.trys.push([7,,10,11]),n&&!n.done&&(o=t.return)?[4,o.call(t)]:[3,9];case 8:g.sent(),g.label=9;case 9:return[3,11];case 10:if(r)throw r.error;return[7];case 11:return[7];case 12:if(a){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,i]}throw u=(l=this).headByte,d=l.pos,p=l.totalPos,new RangeError("Insufficient data in parsing ".concat(prettyByte(u)," at ").concat(p," (").concat(d," in the current buffer)"))}}))}))},e.prototype.decodeArrayStream=function(e){return this.decodeMultiAsync(e,!0)},e.prototype.decodeStream=function(e){return this.decodeMultiAsync(e,!1)},e.prototype.decodeMultiAsync=function(e,t){return __asyncGenerator$1(this,arguments,(function(){var n,r,o,a,i,s,c,l,u;return __generator$1(this,(function(d){switch(d.label){case 0:n=t,r=-1,d.label=1;case 1:d.trys.push([1,13,14,19]),o=__asyncValues$1(e),d.label=2;case 2:return[4,__await$1(o.next())];case 3:if((a=d.sent()).done)return[3,12];if(i=a.value,t&&0===r)throw this.createExtraByteError(this.totalPos);this.appendBuffer(i),n&&(r=this.readArraySize(),n=!1,this.complete()),d.label=4;case 4:d.trys.push([4,9,,10]),d.label=5;case 5:return[4,__await$1(this.doDecodeSync())];case 6:return[4,d.sent()];case 7:return d.sent(),0==--r?[3,8]:[3,5];case 8:return[3,10];case 9:if(!((s=d.sent())instanceof DataViewIndexOutOfBoundsError))throw s;return[3,10];case 10:this.totalPos+=this.pos,d.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return c=d.sent(),l={error:c},[3,19];case 14:return d.trys.push([14,,17,18]),a&&!a.done&&(u=o.return)?[4,__await$1(u.call(o))]:[3,16];case 15:d.sent(),d.label=16;case 16:return[3,18];case 17:if(l)throw l.error;return[7];case 18:return[7];case 19:return[2]}}))}))},e.prototype.doDecodeSync=function(){e:for(;;){var e=this.readHeadByte(),t=void 0;if(e>=224)t=e-256;else if(e<192)if(e<128)t=e;else if(e<144){if(0!==(r=e-128)){this.pushMapState(r),this.complete();continue e}t={}}else if(e<160){if(0!==(r=e-144)){this.pushArrayState(r),this.complete();continue e}t=[]}else{var n=e-160;t=this.decodeUtf8String(n,0)}else if(192===e)t=null;else if(194===e)t=!1;else if(195===e)t=!0;else if(202===e)t=this.readF32();else if(203===e)t=this.readF64();else if(204===e)t=this.readU8();else if(205===e)t=this.readU16();else if(206===e)t=this.readU32();else if(207===e)t=this.readU64();else if(208===e)t=this.readI8();else if(209===e)t=this.readI16();else if(210===e)t=this.readI32();else if(211===e)t=this.readI64();else if(217===e){n=this.lookU8();t=this.decodeUtf8String(n,1)}else if(218===e){n=this.lookU16();t=this.decodeUtf8String(n,2)}else if(219===e){n=this.lookU32();t=this.decodeUtf8String(n,4)}else if(220===e){if(0!==(r=this.readU16())){this.pushArrayState(r),this.complete();continue e}t=[]}else if(221===e){if(0!==(r=this.readU32())){this.pushArrayState(r),this.complete();continue e}t=[]}else if(222===e){if(0!==(r=this.readU16())){this.pushMapState(r),this.complete();continue e}t={}}else if(223===e){if(0!==(r=this.readU32())){this.pushMapState(r),this.complete();continue e}t={}}else if(196===e){var r=this.lookU8();t=this.decodeBinary(r,1)}else if(197===e){r=this.lookU16();t=this.decodeBinary(r,2)}else if(198===e){r=this.lookU32();t=this.decodeBinary(r,4)}else if(212===e)t=this.decodeExtension(1,0);else if(213===e)t=this.decodeExtension(2,0);else if(214===e)t=this.decodeExtension(4,0);else if(215===e)t=this.decodeExtension(8,0);else if(216===e)t=this.decodeExtension(16,0);else if(199===e){r=this.lookU8();t=this.decodeExtension(r,1)}else if(200===e){r=this.lookU16();t=this.decodeExtension(r,2)}else{if(201!==e)throw new DecodeError("Unrecognized type byte: ".concat(prettyByte(e)));r=this.lookU32();t=this.decodeExtension(r,4)}this.complete();for(var o=this.stack;o.length>0;){var a=o[o.length-1];if(0===a.type){if(a.array[a.position]=t,a.position++,a.position!==a.size)continue e;o.pop(),t=a.array}else{if(1===a.type){if(!isValidMapKeyType(t))throw new DecodeError("The type of key must be string or number but "+typeof t);if("__proto__"===t)throw new DecodeError("The key __proto__ is not allowed");a.key=t,a.type=2;continue e}if(a.map[a.key]=t,a.readCount++,a.readCount!==a.size){a.key=null,a.type=1;continue e}o.pop(),t=a.map}}return t}},e.prototype.readHeadByte=function(){return this.headByte===HEAD_BYTE_REQUIRED&&(this.headByte=this.readU8()),this.headByte},e.prototype.complete=function(){this.headByte=HEAD_BYTE_REQUIRED},e.prototype.readArraySize=function(){var e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:if(e<160)return e-144;throw new DecodeError("Unrecognized array type byte: ".concat(prettyByte(e)))}},e.prototype.pushMapState=function(e){if(e>this.maxMapLength)throw new DecodeError("Max length exceeded: map length (".concat(e,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:1,size:e,key:null,readCount:0,map:{}})},e.prototype.pushArrayState=function(e){if(e>this.maxArrayLength)throw new DecodeError("Max length exceeded: array length (".concat(e,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:0,size:e,array:new Array(e),position:0})},e.prototype.decodeUtf8String=function(e,t){var n;if(e>this.maxStrLength)throw new DecodeError("Max length exceeded: UTF-8 byte length (".concat(e,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+t+e)throw MORE_DATA;var r,o=this.pos+t;return r=this.stateIsMapKey()&&(null===(n=this.keyDecoder)||void 0===n?void 0:n.canBeCached(e))?this.keyDecoder.decode(this.bytes,o,e):e>TEXT_DECODER_THRESHOLD?utf8DecodeTD(this.bytes,o,e):utf8DecodeJs(this.bytes,o,e),this.pos+=t+e,r},e.prototype.stateIsMapKey=function(){return this.stack.length>0&&1===this.stack[this.stack.length-1].type},e.prototype.decodeBinary=function(e,t){if(e>this.maxBinLength)throw new DecodeError("Max length exceeded: bin length (".concat(e,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining(e+t))throw MORE_DATA;var n=this.pos+t,r=this.bytes.subarray(n,n+e);return this.pos+=t+e,r},e.prototype.decodeExtension=function(e,t){if(e>this.maxExtLength)throw new DecodeError("Max length exceeded: ext length (".concat(e,") > maxExtLength (").concat(this.maxExtLength,")"));var n=this.view.getInt8(this.pos+t),r=this.decodeBinary(e,t+1);return this.extensionCodec.decode(r,n,this.context)},e.prototype.lookU8=function(){return this.view.getUint8(this.pos)},e.prototype.lookU16=function(){return this.view.getUint16(this.pos)},e.prototype.lookU32=function(){return this.view.getUint32(this.pos)},e.prototype.readU8=function(){var e=this.view.getUint8(this.pos);return this.pos++,e},e.prototype.readI8=function(){var e=this.view.getInt8(this.pos);return this.pos++,e},e.prototype.readU16=function(){var e=this.view.getUint16(this.pos);return this.pos+=2,e},e.prototype.readI16=function(){var e=this.view.getInt16(this.pos);return this.pos+=2,e},e.prototype.readU32=function(){var e=this.view.getUint32(this.pos);return this.pos+=4,e},e.prototype.readI32=function(){var e=this.view.getInt32(this.pos);return this.pos+=4,e},e.prototype.readU64=function(){var e=getUint64(this.view,this.pos);return this.pos+=8,e},e.prototype.readI64=function(){var e=getInt64(this.view,this.pos);return this.pos+=8,e},e.prototype.readF32=function(){var e=this.view.getFloat32(this.pos);return this.pos+=4,e},e.prototype.readF64=function(){var e=this.view.getFloat64(this.pos);return this.pos+=8,e},e}();class BinaryMessageFormat{static write(e){let t=e.byteLength||e.length;const n=[];do{let e=127&t;t>>=7,t>0&&(e|=128),n.push(e)}while(t>0);t=e.byteLength||e.length;const r=new Uint8Array(n.length+t);return r.set(n,0),r.set(e,n.length),r.buffer}static parse(e){const t=[],n=new Uint8Array(e),r=[0,7,14,21,28];for(let o=0;o<e.byteLength;){let a,i=0,s=0;do{a=n[o+i],s|=(127&a)<<r[i],i++}while(i<Math.min(5,e.byteLength-o)&&128&a);if(128&a&&i<5)throw new Error("Cannot read message size.");if(5===i&&a>7)throw new Error("Messages bigger than 2GB are not supported.");if(!(n.byteLength>=o+i+s))throw new Error("Incomplete message.");t.push(n.slice?n.slice(o+i,o+i+s):n.subarray(o+i,o+i+s)),o=o+i+s}return t}}function isArrayBuffer(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}const SERIALIZED_PING_MESSAGE=new Uint8Array([145,MessageType.Ping]);class MessagePackHubProtocol{constructor(e){this.name="messagepack",this.version=2,this.transferFormat=TransferFormat.Binary,this._errorResult=1,this._voidResult=2,this._nonVoidResult=3,e=e||{},this._encoder=new Encoder(e.extensionCodec,e.context,e.maxDepth,e.initialBufferSize,e.sortKeys,e.forceFloat32,e.ignoreUndefined,e.forceIntegerToFloat),this._decoder=new Decoder(e.extensionCodec,e.context,e.maxStrLength,e.maxBinLength,e.maxArrayLength,e.maxMapLength,e.maxExtLength)}parseMessages(e,t){if(!isArrayBuffer(e))throw new Error("Invalid input for MessagePack hub protocol. Expected an ArrayBuffer.");null===t&&(t=NullLogger.instance);const n=BinaryMessageFormat.parse(e),r=[];for(const e of n){const n=this._parseMessage(e,t);n&&r.push(n)}return r}writeMessage(e){switch(e.type){case MessageType.Invocation:return this._writeInvocation(e);case MessageType.StreamInvocation:return this._writeStreamInvocation(e);case MessageType.StreamItem:return this._writeStreamItem(e);case MessageType.Completion:return this._writeCompletion(e);case MessageType.Ping:return BinaryMessageFormat.write(SERIALIZED_PING_MESSAGE);case MessageType.CancelInvocation:return this._writeCancelInvocation(e);case MessageType.Close:return this._writeClose();case MessageType.Ack:return this._writeAck(e);case MessageType.Sequence:return this._writeSequence(e);default:throw new Error("Invalid message type.")}}_parseMessage(e,t){if(0===e.length)throw new Error("Invalid payload.");const n=this._decoder.decode(e);if(0===n.length||!(n instanceof Array))throw new Error("Invalid payload.");const r=n[0];switch(r){case MessageType.Invocation:return this._createInvocationMessage(this._readHeaders(n),n);case MessageType.StreamItem:return this._createStreamItemMessage(this._readHeaders(n),n);case MessageType.Completion:return this._createCompletionMessage(this._readHeaders(n),n);case MessageType.Ping:return this._createPingMessage(n);case MessageType.Close:return this._createCloseMessage(n);case MessageType.Ack:return this._createAckMessage(n);case MessageType.Sequence:return this._createSequenceMessage(n);default:return t.log(LogLevel.Information,"Unknown message type '"+r+"' ignored."),null}}_createCloseMessage(e){if(e.length<2)throw new Error("Invalid payload for Close message.");return{allowReconnect:e.length>=3?e[2]:void 0,error:e[1],type:MessageType.Close}}_createPingMessage(e){if(e.length<1)throw new Error("Invalid payload for Ping message.");return{type:MessageType.Ping}}_createInvocationMessage(e,t){if(t.length<5)throw new Error("Invalid payload for Invocation message.");const n=t[2];return n?{arguments:t[4],headers:e,invocationId:n,streamIds:[],target:t[3],type:MessageType.Invocation}:{arguments:t[4],headers:e,streamIds:[],target:t[3],type:MessageType.Invocation}}_createStreamItemMessage(e,t){if(t.length<4)throw new Error("Invalid payload for StreamItem message.");return{headers:e,invocationId:t[2],item:t[3],type:MessageType.StreamItem}}_createCompletionMessage(e,t){if(t.length<4)throw new Error("Invalid payload for Completion message.");const n=t[3];if(n!==this._voidResult&&t.length<5)throw new Error("Invalid payload for Completion message.");let r,o;switch(n){case this._errorResult:r=t[4];break;case this._nonVoidResult:o=t[4]}return{error:r,headers:e,invocationId:t[2],result:o,type:MessageType.Completion}}_createAckMessage(e){if(e.length<1)throw new Error("Invalid payload for Ack message.");return{sequenceId:e[1],type:MessageType.Ack}}_createSequenceMessage(e){if(e.length<1)throw new Error("Invalid payload for Sequence message.");return{sequenceId:e[1],type:MessageType.Sequence}}_writeInvocation(e){let t;return t=e.streamIds?this._encoder.encode([MessageType.Invocation,e.headers||{},e.invocationId||null,e.target,e.arguments,e.streamIds]):this._encoder.encode([MessageType.Invocation,e.headers||{},e.invocationId||null,e.target,e.arguments]),BinaryMessageFormat.write(t.slice())}_writeStreamInvocation(e){let t;return t=e.streamIds?this._encoder.encode([MessageType.StreamInvocation,e.headers||{},e.invocationId,e.target,e.arguments,e.streamIds]):this._encoder.encode([MessageType.StreamInvocation,e.headers||{},e.invocationId,e.target,e.arguments]),BinaryMessageFormat.write(t.slice())}_writeStreamItem(e){const t=this._encoder.encode([MessageType.StreamItem,e.headers||{},e.invocationId,e.item]);return BinaryMessageFormat.write(t.slice())}_writeCompletion(e){const t=e.error?this._errorResult:void 0!==e.result?this._nonVoidResult:this._voidResult;let n;switch(t){case this._errorResult:n=this._encoder.encode([MessageType.Completion,e.headers||{},e.invocationId,t,e.error]);break;case this._voidResult:n=this._encoder.encode([MessageType.Completion,e.headers||{},e.invocationId,t]);break;case this._nonVoidResult:n=this._encoder.encode([MessageType.Completion,e.headers||{},e.invocationId,t,e.result])}return BinaryMessageFormat.write(n.slice())}_writeCancelInvocation(e){const t=this._encoder.encode([MessageType.CancelInvocation,e.headers||{},e.invocationId]);return BinaryMessageFormat.write(t.slice())}_writeClose(){const e=this._encoder.encode([MessageType.Close,null]);return BinaryMessageFormat.write(e.slice())}_writeAck(e){const t=this._encoder.encode([MessageType.Ack,e.sequenceId]);return BinaryMessageFormat.write(t.slice())}_writeSequence(e){const t=this._encoder.encode([MessageType.Sequence,e.sequenceId]);return BinaryMessageFormat.write(t.slice())}_readHeaders(e){const t=e[1];if("object"!=typeof t)throw new Error("Invalid headers.");return t}}var extendStatics=function(e,t){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},extendStatics(e,t)};function __extends(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function __awaiter$1(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))}function __generator(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}function __values$1(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i}function __spreadArray(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}function __await(e){return this instanceof __await?(this.v=e,this):new __await(e)}function __asyncGenerator(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),a=[];return r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r;function i(e){o[e]&&(r[e]=function(t){return new Promise((function(n,r){a.push([e,t,n,r])>1||s(e,t)}))})}function s(e,t){try{!function(e){e.value instanceof __await?Promise.resolve(e.value.v).then(c,l):u(a[0][2],e)}(o[e](t))}catch(e){u(a[0][3],e)}}function c(e){s("next",e)}function l(e){s("throw",e)}function u(e,t){e(t),a.shift(),a.length&&s(a[0][0],a[0][1])}}function __asyncValues(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values$1?__values$1(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,o,(t=e[n](t)).done,t.value)}))}}}function isFunction(e){return"function"==typeof e}function createErrorClass(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}"function"==typeof SuppressedError&&SuppressedError;var UnsubscriptionError=createErrorClass((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function arrRemove(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var Subscription=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,n,r,o;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var i=__values$1(a),s=i.next();!s.done;s=i.next()){s.value.remove(this)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}else a.remove(this);var c=this.initialTeardown;if(isFunction(c))try{c()}catch(e){o=e instanceof UnsubscriptionError?e.errors:[e]}var l=this._finalizers;if(l){this._finalizers=null;try{for(var u=__values$1(l),d=u.next();!d.done;d=u.next()){var p=d.value;try{execFinalizer(p)}catch(e){o=null!=o?o:[],e instanceof UnsubscriptionError?o=__spreadArray(__spreadArray([],__read(o)),__read(e.errors)):o.push(e)}}}catch(e){n={error:e}}finally{try{d&&!d.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}if(o)throw new UnsubscriptionError(o)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)execFinalizer(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&arrRemove(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&arrRemove(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}(),EMPTY_SUBSCRIPTION=Subscription.EMPTY;function isSubscription(e){return e instanceof Subscription||e&&"closed"in e&&isFunction(e.remove)&&isFunction(e.add)&&isFunction(e.unsubscribe)}function execFinalizer(e){isFunction(e)?e():e.unsubscribe()}var config={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},timeoutProvider={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,__spreadArray([e,t],__read(n)))},clearTimeout:function(e){return clearTimeout(e)},delegate:void 0};function reportUnhandledError(e){timeoutProvider.setTimeout((function(){throw e}))}function noop$1(){}function errorContext(e){e()}var Subscriber=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,isSubscription(t)&&t.add(n)):n.destination=EMPTY_OBSERVER,n}return __extends(t,e),t.create=function(e,t,n){return new SafeSubscriber(e,t,n)},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Subscription),_bind=Function.prototype.bind;function bind(e,t){return _bind.call(e,t)}var ConsumerObserver=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){handleUnhandledError(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){handleUnhandledError(e)}else handleUnhandledError(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){handleUnhandledError(e)}},e}(),SafeSubscriber=function(e){function t(t,n,r){var o,a,i=e.call(this)||this;isFunction(t)||!t?o={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:i&&config.useDeprecatedNextContext?((a=Object.create(t)).unsubscribe=function(){return i.unsubscribe()},o={next:t.next&&bind(t.next,a),error:t.error&&bind(t.error,a),complete:t.complete&&bind(t.complete,a)}):o=t;return i.destination=new ConsumerObserver(o),i}return __extends(t,e),t}(Subscriber);function handleUnhandledError(e){reportUnhandledError(e)}function defaultErrorHandler(e){throw e}var EMPTY_OBSERVER={closed:!0,next:noop$1,error:defaultErrorHandler,complete:noop$1},observable="function"==typeof Symbol&&Symbol.observable||"@@observable";function identity(e){return e}function pipeFromArray(e){return 0===e.length?identity:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var Observable=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this,o=isSubscriber(e)?e:new SafeSubscriber(e,t,n);return errorContext((function(){var e=r,t=e.operator,n=e.source;o.add(t?t.call(o,n):n?r._subscribe(o):r._trySubscribe(o))})),o},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=getPromiseCtor(t))((function(t,r){var o=new SafeSubscriber({next:function(t){try{e(t)}catch(e){r(e),o.unsubscribe()}},error:r,complete:t});n.subscribe(o)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[observable]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return pipeFromArray(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=getPromiseCtor(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function getPromiseCtor(e){var t;return null!==(t=null!=e?e:config.Promise)&&void 0!==t?t:Promise}function isObserver(e){return e&&isFunction(e.next)&&isFunction(e.error)&&isFunction(e.complete)}function isSubscriber(e){return e&&e instanceof Subscriber||isObserver(e)&&isSubscription(e)}function hasLift(e){return isFunction(null==e?void 0:e.lift)}function operate(e){return function(t){if(hasLift(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function createOperatorSubscriber(e,t,n,r,o){return new OperatorSubscriber(e,t,n,r,o)}var OperatorSubscriber=function(e){function t(t,n,r,o,a,i){var s=e.call(this,t)||this;return s.onFinalize=a,s.shouldUnsubscribe=i,s._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,s._error=o?function(e){try{o(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,s._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,s}return __extends(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(Subscriber);function refCount(){return operate((function(e,t){var n=null;e._refCount++;var r=createOperatorSubscriber(t,void 0,void 0,void 0,(function(){if(!e||e._refCount<=0||0<--e._refCount)n=null;else{var r=e._connection,o=n;n=null,!r||o&&r!==o||r.unsubscribe(),t.unsubscribe()}}));e.subscribe(r),r.closed||(n=e.connect())}))}!function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subjectFactory=n,r._subject=null,r._refCount=0,r._connection=null,hasLift(t)&&(r.lift=t.lift),r}__extends(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype._teardown=function(){this._refCount=0;var e=this._connection;this._subject=this._connection=null,null==e||e.unsubscribe()},t.prototype.connect=function(){var e=this,t=this._connection;if(!t){t=this._connection=new Subscription;var n=this.getSubject();t.add(this.source.subscribe(createOperatorSubscriber(n,void 0,(function(){e._teardown(),n.complete()}),(function(t){e._teardown(),n.error(t)}),(function(){return e._teardown()})))),t.closed&&(this._connection=null,t=Subscription.EMPTY)}return t},t.prototype.refCount=function(){return refCount()(this)}}(Observable);var performanceTimestampProvider={now:function(){return(performanceTimestampProvider.delegate||performance).now()},delegate:void 0},animationFrameProvider={schedule:function(e){var t=requestAnimationFrame,n=cancelAnimationFrame,r=t((function(t){n=void 0,e(t)}));return new Subscription((function(){return null==n?void 0:n(r)}))},requestAnimationFrame:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=animationFrameProvider.delegate;return((null==n?void 0:n.requestAnimationFrame)||requestAnimationFrame).apply(void 0,__spreadArray([],__read(e)))},cancelAnimationFrame:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return cancelAnimationFrame.apply(void 0,__spreadArray([],__read(e)))},delegate:void 0};function animationFramesFactory(e){return new Observable((function(t){var n=e||performanceTimestampProvider,r=n.now(),o=0,a=function(){t.closed||(o=animationFrameProvider.requestAnimationFrame((function(i){o=0;var s=n.now();t.next({timestamp:e?s:i,elapsed:s-r}),a()})))};return a(),function(){o&&animationFrameProvider.cancelAnimationFrame(o)}}))}animationFramesFactory();var ObjectUnsubscribedError=createErrorClass((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),Subject=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return __extends(t,e),t.prototype.lift=function(e){var t=new AnonymousSubject(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new ObjectUnsubscribedError},t.prototype.next=function(e){var t=this;errorContext((function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var o=__values$1(t.currentObservers),a=o.next();!a.done;a=o.next()){a.value.next(e)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;errorContext((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;errorContext((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.hasError,o=n.isStopped,a=n.observers;return r||o?EMPTY_SUBSCRIPTION:(this.currentObservers=null,a.push(e),new Subscription((function(){t.currentObservers=null,arrRemove(a,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t.thrownError,o=t.isStopped;n?e.error(r):o&&e.complete()},t.prototype.asObservable=function(){var e=new Observable;return e.source=this,e},t.create=function(e,t){return new AnonymousSubject(e,t)},t}(Observable),AnonymousSubject=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return __extends(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:EMPTY_SUBSCRIPTION},t}(Subject),BehaviorSubject=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return __extends(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e.hasError,n=e.thrownError,r=e._value;if(t)throw n;return this._throwIfClosed(),r},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(Subject),dateTimestampProvider={now:function(){return(dateTimestampProvider.delegate||Date).now()},delegate:void 0},ReplaySubject=function(e){function t(t,n,r){void 0===t&&(t=1/0),void 0===n&&(n=1/0),void 0===r&&(r=dateTimestampProvider);var o=e.call(this)||this;return o._bufferSize=t,o._windowTime=n,o._timestampProvider=r,o._buffer=[],o._infiniteTimeWindow=!0,o._infiniteTimeWindow=n===1/0,o._bufferSize=Math.max(1,t),o._windowTime=Math.max(1,n),o}return __extends(t,e),t.prototype.next=function(t){var n=this,r=n.isStopped,o=n._buffer,a=n._infiniteTimeWindow,i=n._timestampProvider,s=n._windowTime;r||(o.push(t),!a&&o.push(i.now()+s)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),n=this._infiniteTimeWindow,r=this._buffer.slice(),o=0;o<r.length&&!e.closed;o+=n?1:2)e.next(r[o]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this,t=e._bufferSize,n=e._timestampProvider,r=e._buffer,o=e._infiniteTimeWindow,a=(o?1:2)*t;if(t<1/0&&a<r.length&&r.splice(0,r.length-a),!o){for(var i=n.now(),s=0,c=1;c<r.length&&r[c]<=i;c+=2)s=c;s&&r.splice(0,s+1)}},t}(Subject);!function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._value=null,t._hasValue=!1,t._isComplete=!1,t}__extends(t,e),t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t._hasValue,o=t._value,a=t.thrownError,i=t.isStopped,s=t._isComplete;n?e.error(a):(i||s)&&(r&&e.next(o),e.complete())},t.prototype.next=function(e){this.isStopped||(this._value=e,this._hasValue=!0)},t.prototype.complete=function(){var t=this,n=t._hasValue,r=t._value;t._isComplete||(this._isComplete=!0,n&&e.prototype.next.call(this,r),e.prototype.complete.call(this))}}(Subject);var Action=function(e){function t(t,n){return e.call(this)||this}return __extends(t,e),t.prototype.schedule=function(e,t){return this},t}(Subscription),intervalProvider={setInterval:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setInterval.apply(void 0,__spreadArray([e,t],__read(n)))},clearInterval:function(e){return clearInterval(e)},delegate:void 0},AsyncAction=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return __extends(t,e),t.prototype.schedule=function(e,t){var n;if(void 0===t&&(t=0),this.closed)return this;this.state=e;var r=this.id,o=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(o,r,t)),this.pending=!0,this.delay=t,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(o,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),intervalProvider.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return t;null!=t&&intervalProvider.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n,r=!1;try{this.work(e)}catch(e){r=!0,n=e||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,n=this.scheduler,r=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,arrRemove(r,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(Action),nextHandle=1,resolved,activeHandles={};function findAndClearHandle(e){return e in activeHandles&&(delete activeHandles[e],!0)}var Immediate={setImmediate:function(e){var t=nextHandle++;return activeHandles[t]=!0,resolved||(resolved=Promise.resolve()),resolved.then((function(){return findAndClearHandle(t)&&e()})),t},clearImmediate:function(e){findAndClearHandle(e)}},setImmediate=Immediate.setImmediate,clearImmediate=Immediate.clearImmediate,immediateProvider={setImmediate:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=immediateProvider.delegate;return((null==n?void 0:n.setImmediate)||setImmediate).apply(void 0,__spreadArray([],__read(e)))},clearImmediate:function(e){return clearImmediate(e)},delegate:void 0},AsapAction=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return __extends(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t._scheduled||(t._scheduled=immediateProvider.setImmediate(t.flush.bind(t,void 0))))},t.prototype.recycleAsyncId=function(t,n,r){var o;if(void 0===r&&(r=0),null!=r?r>0:this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);var a=t.actions;null!=n&&(null===(o=a[a.length-1])||void 0===o?void 0:o.id)!==n&&(immediateProvider.clearImmediate(n),t._scheduled===n&&(t._scheduled=void 0))},t}(AsyncAction),Scheduler=function(){function e(t,n){void 0===n&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=dateTimestampProvider.now,e}(),AsyncScheduler=function(e){function t(t,n){void 0===n&&(n=Scheduler.now);var r=e.call(this,t,n)||this;return r.actions=[],r._active=!1,r}return __extends(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(Scheduler),AsapScheduler=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.flush=function(e){this._active=!0;var t=this._scheduled;this._scheduled=void 0;var n,r=this.actions;e=e||r.shift();do{if(n=e.execute(e.state,e.delay))break}while((e=r[0])&&e.id===t&&r.shift());if(this._active=!1,n){for(;(e=r[0])&&e.id===t&&r.shift();)e.unsubscribe();throw n}},t}(AsyncScheduler);new AsapScheduler(AsapAction),new AsyncScheduler(AsyncAction);var QueueAction=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return __extends(t,e),t.prototype.schedule=function(t,n){return void 0===n&&(n=0),n>0?e.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,n){return n>0||this.closed?e.prototype.execute.call(this,t,n):this._execute(t,n)},t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!=r&&r>0||null==r&&this.delay>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.flush(this),0)},t}(AsyncAction),QueueScheduler=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(AsyncScheduler);new QueueScheduler(QueueAction);var AnimationFrameAction=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return __extends(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t._scheduled||(t._scheduled=animationFrameProvider.requestAnimationFrame((function(){return t.flush(void 0)}))))},t.prototype.recycleAsyncId=function(t,n,r){var o;if(void 0===r&&(r=0),null!=r?r>0:this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);var a=t.actions;null!=n&&(null===(o=a[a.length-1])||void 0===o?void 0:o.id)!==n&&(animationFrameProvider.cancelAnimationFrame(n),t._scheduled=void 0)},t}(AsyncAction),AnimationFrameScheduler=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.flush=function(e){this._active=!0;var t=this._scheduled;this._scheduled=void 0;var n,r=this.actions;e=e||r.shift();do{if(n=e.execute(e.state,e.delay))break}while((e=r[0])&&e.id===t&&r.shift());if(this._active=!1,n){for(;(e=r[0])&&e.id===t&&r.shift();)e.unsubscribe();throw n}},t}(AsyncScheduler);new AnimationFrameScheduler(AnimationFrameAction),function(e){function t(t,n){void 0===t&&(t=VirtualAction),void 0===n&&(n=1/0);var r=e.call(this,t,(function(){return r.frame}))||this;return r.maxFrames=n,r.frame=0,r.index=-1,r}__extends(t,e),t.prototype.flush=function(){for(var e,t,n=this.actions,r=this.maxFrames;(t=n[0])&&t.delay<=r&&(n.shift(),this.frame=t.delay,!(e=t.execute(t.state,t.delay))););if(e){for(;t=n.shift();)t.unsubscribe();throw e}},t.frameTimeFactor=10}(AsyncScheduler);var VirtualAction=function(e){function t(t,n,r){void 0===r&&(r=t.index+=1);var o=e.call(this,t,n)||this;return o.scheduler=t,o.work=n,o.index=r,o.active=!0,o.index=t.index=r,o}return __extends(t,e),t.prototype.schedule=function(n,r){if(void 0===r&&(r=0),Number.isFinite(r)){if(!this.id)return e.prototype.schedule.call(this,n,r);this.active=!1;var o=new t(this.scheduler,this.work);return this.add(o),o.schedule(n,r)}return Subscription.EMPTY},t.prototype.requestAsyncId=function(e,n,r){void 0===r&&(r=0),this.delay=e.frame+r;var o=e.actions;return o.push(this),o.sort(t.sortActions),1},t.prototype.recycleAsyncId=function(e,t,n){},t.prototype._execute=function(t,n){if(!0===this.active)return e.prototype._execute.call(this,t,n)},t.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1},t}(AsyncAction),EMPTY=new Observable((function(e){return e.complete()}));function isScheduler(e){return e&&isFunction(e.schedule)}function last(e){return e[e.length-1]}function popResultSelector(e){return isFunction(last(e))?e.pop():void 0}function popScheduler(e){return isScheduler(last(e))?e.pop():void 0}function popNumber(e,t){return"number"==typeof last(e)?e.pop():t}var isArrayLike=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function isPromise(e){return isFunction(null==e?void 0:e.then)}function isInteropObservable(e){return isFunction(e[observable])}function isAsyncIterable(e){return Symbol.asyncIterator&&isFunction(null==e?void 0:e[Symbol.asyncIterator])}function createInvalidObservableTypeError(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function getSymbolIterator(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var iterator=getSymbolIterator(),NotificationKind;function isIterable(e){return isFunction(null==e?void 0:e[iterator])}function readableStreamLikeToAsyncGenerator(e){return __asyncGenerator(this,arguments,(function(){var t,n,r;return __generator(this,(function(o){switch(o.label){case 0:t=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,__await(t.read())];case 3:return n=o.sent(),r=n.value,n.done?[4,__await(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,__await(r)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function isReadableStreamLike(e){return isFunction(null==e?void 0:e.getReader)}function innerFrom(e){if(e instanceof Observable)return e;if(null!=e){if(isInteropObservable(e))return fromInteropObservable(e);if(isArrayLike(e))return fromArrayLike(e);if(isPromise(e))return fromPromise(e);if(isAsyncIterable(e))return fromAsyncIterable(e);if(isIterable(e))return fromIterable(e);if(isReadableStreamLike(e))return fromReadableStreamLike(e)}throw createInvalidObservableTypeError(e)}function fromInteropObservable(e){return new Observable((function(t){var n=e[observable]();if(isFunction(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")}))}function fromArrayLike(e){return new Observable((function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()}))}function fromPromise(e){return new Observable((function(t){e.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,reportUnhandledError)}))}function fromIterable(e){return new Observable((function(t){var n,r;try{for(var o=__values$1(e),a=o.next();!a.done;a=o.next()){var i=a.value;if(t.next(i),t.closed)return}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}t.complete()}))}function fromAsyncIterable(e){return new Observable((function(t){process$1(e,t).catch((function(e){return t.error(e)}))}))}function fromReadableStreamLike(e){return fromAsyncIterable(readableStreamLikeToAsyncGenerator(e))}function process$1(e,t){var n,r,o,a;return __awaiter$1(this,void 0,void 0,(function(){var i,s;return __generator(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=__asyncValues(e),c.label=1;case 1:return[4,n.next()];case 2:if((r=c.sent()).done)return[3,4];if(i=r.value,t.next(i),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=c.sent(),o={error:s},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(a=n.return)?[4,a.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))}function executeSchedule(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=!1);var a=t.schedule((function(){n(),o?e.add(this.schedule(null,r)):this.unsubscribe()}),r);if(e.add(a),!o)return a}function observeOn(e,t){return void 0===t&&(t=0),operate((function(n,r){n.subscribe(createOperatorSubscriber(r,(function(n){return executeSchedule(r,e,(function(){return r.next(n)}),t)}),(function(){return executeSchedule(r,e,(function(){return r.complete()}),t)}),(function(n){return executeSchedule(r,e,(function(){return r.error(n)}),t)})))}))}function subscribeOn(e,t){return void 0===t&&(t=0),operate((function(n,r){r.add(e.schedule((function(){return n.subscribe(r)}),t))}))}function scheduleObservable(e,t){return innerFrom(e).pipe(subscribeOn(t),observeOn(t))}function schedulePromise(e,t){return innerFrom(e).pipe(subscribeOn(t),observeOn(t))}function scheduleArray(e,t){return new Observable((function(n){var r=0;return t.schedule((function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())}))}))}function scheduleIterable(e,t){return new Observable((function(n){var r;return executeSchedule(n,t,(function(){r=e[iterator](),executeSchedule(n,t,(function(){var e,t,o;try{t=(e=r.next()).value,o=e.done}catch(e){return void n.error(e)}o?n.complete():n.next(t)}),0,!0)})),function(){return isFunction(null==r?void 0:r.return)&&r.return()}}))}function scheduleAsyncIterable(e,t){if(!e)throw new Error("Iterable cannot be null");return new Observable((function(n){executeSchedule(n,t,(function(){var r=e[Symbol.asyncIterator]();executeSchedule(n,t,(function(){r.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))}function scheduleReadableStreamLike(e,t){return scheduleAsyncIterable(readableStreamLikeToAsyncGenerator(e),t)}function scheduled(e,t){if(null!=e){if(isInteropObservable(e))return scheduleObservable(e,t);if(isArrayLike(e))return scheduleArray(e,t);if(isPromise(e))return schedulePromise(e,t);if(isAsyncIterable(e))return scheduleAsyncIterable(e,t);if(isIterable(e))return scheduleIterable(e,t);if(isReadableStreamLike(e))return scheduleReadableStreamLike(e,t)}throw createInvalidObservableTypeError(e)}function from(e,t){return t?scheduled(e,t):innerFrom(e)}function map(e,t){return operate((function(n,r){var o=0;n.subscribe(createOperatorSubscriber(r,(function(n){r.next(e.call(t,n,o++))})))}))}!function(e){e.NEXT="N",e.ERROR="E",e.COMPLETE="C"}(NotificationKind||(NotificationKind={})),createErrorClass((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}})),createErrorClass((function(e){return function(){e(this),this.name="ArgumentOutOfRangeError",this.message="argument out of range"}})),createErrorClass((function(e){return function(t){e(this),this.name="NotFoundError",this.message=t}})),createErrorClass((function(e){return function(t){e(this),this.name="SequenceError",this.message=t}})),createErrorClass((function(e){return function(t){void 0===t&&(t=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}}));var isArray$1=Array.isArray;function callOrApply(e,t){return isArray$1(t)?e.apply(void 0,__spreadArray([],__read(t))):e(t)}function mapOneOrManyArgs(e){return map((function(t){return callOrApply(e,t)}))}var isArray=Array.isArray,getPrototypeOf=Object.getPrototypeOf,objectProto=Object.prototype,getKeys=Object.keys;function argsArgArrayOrObject(e){if(1===e.length){var t=e[0];if(isArray(t))return{args:t,keys:null};if(isPOJO(t)){var n=getKeys(t);return{args:n.map((function(e){return t[e]})),keys:n}}}return{args:e,keys:null}}function isPOJO(e){return e&&"object"==typeof e&&getPrototypeOf(e)===objectProto}function createObject(e,t){return e.reduce((function(e,n,r){return e[n]=t[r],e}),{})}function combineLatest(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=popScheduler(e),r=popResultSelector(e),o=argsArgArrayOrObject(e),a=o.args,i=o.keys;if(0===a.length)return from([],n);var s=new Observable(combineLatestInit(a,n,i?function(e){return createObject(i,e)}:identity));return r?s.pipe(mapOneOrManyArgs(r)):s}function combineLatestInit(e,t,n){return void 0===n&&(n=identity),function(r){maybeSchedule(t,(function(){for(var o=e.length,a=new Array(o),i=o,s=o,c=function(o){maybeSchedule(t,(function(){var c=from(e[o],t),l=!1;c.subscribe(createOperatorSubscriber(r,(function(e){a[o]=e,l||(l=!0,s--),s||r.next(n(a.slice()))}),(function(){--i||r.complete()})))}),r)},l=0;l<o;l++)c(l)}),r)}}function maybeSchedule(e,t,n){e?executeSchedule(n,e,t):t()}function mergeInternals(e,t,n,r,o,a,i,s){var c=[],l=0,u=0,d=!1,p=function(){!d||c.length||l||t.complete()},g=function(e){return l<r?h(e):c.push(e)},h=function(e){a&&t.next(e),l++;var s=!1;innerFrom(n(e,u++)).subscribe(createOperatorSubscriber(t,(function(e){null==o||o(e),a?g(e):t.next(e)}),(function(){s=!0}),void 0,(function(){if(s)try{l--;for(var e=function(){var e=c.shift();i?executeSchedule(t,i,(function(){return h(e)})):h(e)};c.length&&l<r;)e();p()}catch(e){t.error(e)}})))};return e.subscribe(createOperatorSubscriber(t,g,(function(){d=!0,p()}))),function(){null==s||s()}}function mergeMap(e,t,n){return void 0===n&&(n=1/0),isFunction(t)?mergeMap((function(n,r){return map((function(e,o){return t(n,e,r,o)}))(innerFrom(e(n,r)))}),n):("number"==typeof t&&(n=t),operate((function(t,r){return mergeInternals(t,r,e,n)})))}function mergeAll(e){return void 0===e&&(e=1/0),mergeMap(identity,e)}function merge(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=popScheduler(e),r=popNumber(e,1/0),o=e;return o.length?1===o.length?innerFrom(o[0]):mergeAll(r)(from(o,n)):EMPTY}function filter(e,t){return operate((function(n,r){var o=0;n.subscribe(createOperatorSubscriber(r,(function(n){return e.call(t,n,o++)&&r.next(n)})))}))}function scanInternals(e,t,n,r,o){return function(a,i){var s=n,c=t,l=0;a.subscribe(createOperatorSubscriber(i,(function(t){var n=l++;c=s?e(c,t,n):(s=!0,t),r&&i.next(c)}),o&&function(){s&&i.next(c),i.complete()}))}}function scan(e,t){return operate(scanInternals(e,t,arguments.length>=2,!0))}function share(e){void 0===e&&(e={});var t=e.connector,n=void 0===t?function(){return new Subject}:t,r=e.resetOnError,o=void 0===r||r,a=e.resetOnComplete,i=void 0===a||a,s=e.resetOnRefCountZero,c=void 0===s||s;return function(e){var t,r,a,s=0,l=!1,u=!1,d=function(){null==r||r.unsubscribe(),r=void 0},p=function(){d(),t=a=void 0,l=u=!1},g=function(){var e=t;p(),null==e||e.unsubscribe()};return operate((function(e,h){s++,u||l||d();var f=a=null!=a?a:n();h.add((function(){0!==--s||u||l||(r=handleReset(g,c))})),f.subscribe(h),!t&&s>0&&(t=new SafeSubscriber({next:function(e){return f.next(e)},error:function(e){u=!0,d(),r=handleReset(p,o,e),f.error(e)},complete:function(){l=!0,d(),r=handleReset(p,i),f.complete()}}),innerFrom(e).subscribe(t))}))(e)}}function handleReset(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!0!==t){if(!1!==t){var o=new SafeSubscriber({next:function(){o.unsubscribe(),e()}});return innerFrom(t.apply(void 0,__spreadArray([],__read(n)))).subscribe(o)}}else e()}function shareReplay(e,t,n){var r,o,a,i,s=!1;return e&&"object"==typeof e?(r=e.bufferSize,i=void 0===r?1/0:r,o=e.windowTime,t=void 0===o?1/0:o,s=void 0!==(a=e.refCount)&&a,n=e.scheduler):i=null!=e?e:1/0,share({connector:function(){return new ReplaySubject(i,t,n)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:s})}function skipUntil(e){return operate((function(t,n){var r=!1,o=createOperatorSubscriber(n,(function(){null==o||o.unsubscribe(),r=!0}),noop$1);innerFrom(e).subscribe(o),t.subscribe(createOperatorSubscriber(n,(function(e){return r&&n.next(e)})))}))}function switchMap(e,t){return operate((function(n,r){var o=null,a=0,i=!1,s=function(){return i&&!o&&r.complete()};n.subscribe(createOperatorSubscriber(r,(function(n){null==o||o.unsubscribe();var i=0,c=a++;innerFrom(e(n,c)).subscribe(o=createOperatorSubscriber(r,(function(e){return r.next(t?t(n,e,c,i++):e)}),(function(){o=null,s()})))}),(function(){i=!0,s()})))}))}function tap(e,t,n){var r=isFunction(e)||t||n?{next:e,error:t,complete:n}:e;return r?operate((function(e,t){var n;null===(n=r.subscribe)||void 0===n||n.call(r);var o=!0;e.subscribe(createOperatorSubscriber(t,(function(e){var n;null===(n=r.next)||void 0===n||n.call(r,e),t.next(e)}),(function(){var e;o=!1,null===(e=r.complete)||void 0===e||e.call(r),t.complete()}),(function(e){var n;o=!1,null===(n=r.error)||void 0===n||n.call(r,e),t.error(e)}),(function(){var e,t;o&&(null===(e=r.unsubscribe)||void 0===e||e.call(r)),null===(t=r.finalize)||void 0===t||t.call(r)})))})):identity}new Observable(noop$1);var minimal$1={exports:{}},indexMinimal={},minimal={},aspromise,hasRequiredAspromise;function requireAspromise(){if(hasRequiredAspromise)return aspromise;return hasRequiredAspromise=1,aspromise=function(e,t){var n=new Array(arguments.length-1),r=0,o=2,a=!0;for(;o<arguments.length;)n[r++]=arguments[o++];return new Promise((function(o,i){n[r]=function(e){if(a)if(a=!1,e)i(e);else{for(var t=new Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];o.apply(null,t)}};try{e.apply(t||null,n)}catch(e){a&&(a=!1,i(e))}}))},aspromise}var base64$1={},hasRequiredBase64;function requireBase64(){return hasRequiredBase64||(hasRequiredBase64=1,function(e){var t=e;t.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};for(var n=new Array(64),r=new Array(123),o=0;o<64;)r[n[o]=o<26?o+65:o<52?o+71:o<62?o-4:o-59|43]=o++;t.encode=function(e,t,r){for(var o,a=null,i=[],s=0,c=0;t<r;){var l=e[t++];switch(c){case 0:i[s++]=n[l>>2],o=(3&l)<<4,c=1;break;case 1:i[s++]=n[o|l>>4],o=(15&l)<<2,c=2;break;case 2:i[s++]=n[o|l>>6],i[s++]=n[63&l],c=0}s>8191&&((a||(a=[])).push(String.fromCharCode.apply(String,i)),s=0)}return c&&(i[s++]=n[o],i[s++]=61,1===c&&(i[s++]=61)),a?(s&&a.push(String.fromCharCode.apply(String,i.slice(0,s))),a.join("")):String.fromCharCode.apply(String,i.slice(0,s))};var a="invalid encoding";t.decode=function(e,t,n){for(var o,i=n,s=0,c=0;c<e.length;){var l=e.charCodeAt(c++);if(61===l&&s>1)break;if(void 0===(l=r[l]))throw Error(a);switch(s){case 0:o=l,s=1;break;case 1:t[n++]=o<<2|(48&l)>>4,o=l,s=2;break;case 2:t[n++]=(15&o)<<4|(60&l)>>2,o=l,s=3;break;case 3:t[n++]=(3&o)<<6|l,s=0}}if(1===s)throw Error(a);return n-i},t.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}}(base64$1)),base64$1}var eventemitter=EventEmitter;function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},EventEmitter.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var n=this._listeners[e],r=0;r<n.length;)n[r].fn===t?n.splice(r,1):++r;return this},EventEmitter.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,n)}return this};var float=factory(factory);function factory(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),n=new Uint8Array(t.buffer),r=128===n[3];function o(e,r,o){t[0]=e,r[o]=n[0],r[o+1]=n[1],r[o+2]=n[2],r[o+3]=n[3]}function a(e,r,o){t[0]=e,r[o]=n[3],r[o+1]=n[2],r[o+2]=n[1],r[o+3]=n[0]}function i(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],t[0]}function s(e,r){return n[3]=e[r],n[2]=e[r+1],n[1]=e[r+2],n[0]=e[r+3],t[0]}e.writeFloatLE=r?o:a,e.writeFloatBE=r?a:o,e.readFloatLE=r?i:s,e.readFloatBE=r?s:i}():function(){function t(e,t,n,r){var o=t<0?1:0;if(o&&(t=-t),0===t)e(1/t>0?0:2147483648,n,r);else if(isNaN(t))e(2143289344,n,r);else if(t>34028234663852886e22)e((o<<31|2139095040)>>>0,n,r);else if(t<11754943508222875e-54)e((o<<31|Math.round(t/1401298464324817e-60))>>>0,n,r);else{var a=Math.floor(Math.log(t)/Math.LN2);e((o<<31|a+127<<23|8388607&Math.round(t*Math.pow(2,-a)*8388608))>>>0,n,r)}}function n(e,t,n){var r=e(t,n),o=2*(r>>31)+1,a=r>>>23&255,i=8388607&r;return 255===a?i?NaN:o*(1/0):0===a?1401298464324817e-60*o*i:o*Math.pow(2,a-150)*(i+8388608)}e.writeFloatLE=t.bind(null,writeUintLE),e.writeFloatBE=t.bind(null,writeUintBE),e.readFloatLE=n.bind(null,readUintLE),e.readFloatBE=n.bind(null,readUintBE)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),n=new Uint8Array(t.buffer),r=128===n[7];function o(e,r,o){t[0]=e,r[o]=n[0],r[o+1]=n[1],r[o+2]=n[2],r[o+3]=n[3],r[o+4]=n[4],r[o+5]=n[5],r[o+6]=n[6],r[o+7]=n[7]}function a(e,r,o){t[0]=e,r[o]=n[7],r[o+1]=n[6],r[o+2]=n[5],r[o+3]=n[4],r[o+4]=n[3],r[o+5]=n[2],r[o+6]=n[1],r[o+7]=n[0]}function i(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],n[4]=e[r+4],n[5]=e[r+5],n[6]=e[r+6],n[7]=e[r+7],t[0]}function s(e,r){return n[7]=e[r],n[6]=e[r+1],n[5]=e[r+2],n[4]=e[r+3],n[3]=e[r+4],n[2]=e[r+5],n[1]=e[r+6],n[0]=e[r+7],t[0]}e.writeDoubleLE=r?o:a,e.writeDoubleBE=r?a:o,e.readDoubleLE=r?i:s,e.readDoubleBE=r?s:i}():function(){function t(e,t,n,r,o,a){var i=r<0?1:0;if(i&&(r=-r),0===r)e(0,o,a+t),e(1/r>0?0:2147483648,o,a+n);else if(isNaN(r))e(0,o,a+t),e(2146959360,o,a+n);else if(r>17976931348623157e292)e(0,o,a+t),e((i<<31|2146435072)>>>0,o,a+n);else{var s;if(r<22250738585072014e-324)e((s=r/5e-324)>>>0,o,a+t),e((i<<31|s/4294967296)>>>0,o,a+n);else{var c=Math.floor(Math.log(r)/Math.LN2);1024===c&&(c=1023),e(4503599627370496*(s=r*Math.pow(2,-c))>>>0,o,a+t),e((i<<31|c+1023<<20|1048576*s&1048575)>>>0,o,a+n)}}}function n(e,t,n,r,o){var a=e(r,o+t),i=e(r,o+n),s=2*(i>>31)+1,c=i>>>20&2047,l=4294967296*(1048575&i)+a;return 2047===c?l?NaN:s*(1/0):0===c?5e-324*s*l:s*Math.pow(2,c-1075)*(l+4503599627370496)}e.writeDoubleLE=t.bind(null,writeUintLE,0,4),e.writeDoubleBE=t.bind(null,writeUintBE,4,0),e.readDoubleLE=n.bind(null,readUintLE,0,4),e.readDoubleBE=n.bind(null,readUintBE,4,0)}(),e}function writeUintLE(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function writeUintBE(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function readUintLE(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function readUintBE(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}var utf8$2={},hasRequiredUtf8;function requireUtf8(){return hasRequiredUtf8||(hasRequiredUtf8=1,function(e){var t=e;t.length=function(e){for(var t=0,n=0,r=0;r<e.length;++r)(n=e.charCodeAt(r))<128?t+=1:n<2048?t+=2:55296==(64512&n)&&56320==(64512&e.charCodeAt(r+1))?(++r,t+=4):t+=3;return t},t.read=function(e,t,n){if(n-t<1)return"";for(var r,o=null,a=[],i=0;t<n;)(r=e[t++])<128?a[i++]=r:r>191&&r<224?a[i++]=(31&r)<<6|63&e[t++]:r>239&&r<365?(r=((7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,a[i++]=55296+(r>>10),a[i++]=56320+(1023&r)):a[i++]=(15&r)<<12|(63&e[t++])<<6|63&e[t++],i>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,a)),i=0);return o?(i&&o.push(String.fromCharCode.apply(String,a.slice(0,i))),o.join("")):String.fromCharCode.apply(String,a.slice(0,i))},t.write=function(e,t,n){for(var r,o,a=n,i=0;i<e.length;++i)(r=e.charCodeAt(i))<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&56320==(64512&(o=e.charCodeAt(i+1)))?(r=65536+((1023&r)<<10)+(1023&o),++i,t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128);return n-a}}(utf8$2)),utf8$2}var pool_1=pool,longbits,hasRequiredLongbits,hasRequiredMinimal;function pool(e,t,n){var r=n||8192,o=r>>>1,a=null,i=r;return function(n){if(n<1||n>o)return e(n);i+n>r&&(a=e(r),i=0);var s=t.call(a,i,i+=n);return 7&i&&(i=1+(7|i)),s}}function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=t;var e=requireMinimal();function t(e,t){this.lo=e>>>0,this.hi=t>>>0}var n=t.zero=new t(0,0);n.toNumber=function(){return 0},n.zzEncode=n.zzDecode=function(){return this},n.length=function(){return 1};var r=t.zeroHash="\0\0\0\0\0\0\0\0";t.fromNumber=function(e){if(0===e)return n;var r=e<0;r&&(e=-e);var o=e>>>0,a=(e-o)/4294967296>>>0;return r&&(a=~a>>>0,o=~o>>>0,++o>4294967295&&(o=0,++a>4294967295&&(a=0))),new t(o,a)},t.from=function(r){if("number"==typeof r)return t.fromNumber(r);if(e.isString(r)){if(!e.Long)return t.fromNumber(parseInt(r,10));r=e.Long.fromString(r)}return r.low||r.high?new t(r.low>>>0,r.high>>>0):n},t.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},t.prototype.toLong=function(t){return e.Long?new e.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var o=String.prototype.charCodeAt;return t.fromHash=function(e){return e===r?n:new t((o.call(e,0)|o.call(e,1)<<8|o.call(e,2)<<16|o.call(e,3)<<24)>>>0,(o.call(e,4)|o.call(e,5)<<8|o.call(e,6)<<16|o.call(e,7)<<24)>>>0)},t.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},t.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},t.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},t.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10},longbits}function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(e){var t=e;function n(e,t,n){for(var r=Object.keys(t),o=0;o<r.length;++o)void 0!==e[r[o]]&&n||(e[r[o]]=t[r[o]]);return e}function r(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),r&&n(this,r)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}t.asPromise=requireAspromise(),t.base64=requireBase64(),t.EventEmitter=eventemitter,t.float=float,t.inquire=inquire_1,t.utf8=requireUtf8(),t.pool=pool_1,t.LongBits=requireLongbits(),t.isNode=Boolean(void 0!==commonjsGlobal&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),t.global=t.isNode&&commonjsGlobal||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||commonjsGlobal,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.isString=function(e){return"string"==typeof e||e instanceof String},t.isObject=function(e){return e&&"object"==typeof e},t.isset=t.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},t.Buffer=function(){try{var e=t.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(e){return"number"==typeof e?t.Buffer?t._Buffer_allocUnsafe(e):new t.Array(e):t.Buffer?t._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},t.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(e){return e?t.LongBits.from(e).toHash():t.LongBits.zeroHash},t.longFromHash=function(e,n){var r=t.LongBits.fromHash(e);return t.Long?t.Long.fromBits(r.lo,r.hi,n):r.toNumber(Boolean(n))},t.merge=n,t.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},t.newError=r,t.ProtocolError=r("ProtocolError"),t.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},t.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var e=t.Buffer;e?(t._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},t._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):t._Buffer_from=t._Buffer_allocUnsafe=null}}(minimal)),minimal}var writer=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function noop(){}function State(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};function writeByte(e,t,n){t[n]=255&e}function writeVarint32(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e}function VarintOp(e,t){this.len=e,this.next=void 0,this.val=t}function writeVarint64(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function writeFixed32(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}Writer$1.create=create$1(),Writer$1.alloc=function(e){return new util$4.Array(e)},util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray)),Writer$1.prototype._push=function(e,t,n){return this.tail=this.tail.next=new Op(e,t,n),this.len+=t,this},VarintOp.prototype=Object.create(Op.prototype),VarintOp.prototype.fn=writeVarint32,Writer$1.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new VarintOp((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},Writer$1.prototype.int32=function(e){return e<0?this._push(writeVarint64,10,LongBits$1.fromNumber(e)):this.uint32(e)},Writer$1.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},Writer$1.prototype.uint64=function(e){var t=LongBits$1.from(e);return this._push(writeVarint64,t.length(),t)},Writer$1.prototype.int64=Writer$1.prototype.uint64,Writer$1.prototype.sint64=function(e){var t=LongBits$1.from(e).zzEncode();return this._push(writeVarint64,t.length(),t)},Writer$1.prototype.bool=function(e){return this._push(writeByte,1,e?1:0)},Writer$1.prototype.fixed32=function(e){return this._push(writeFixed32,4,e>>>0)},Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32,Writer$1.prototype.fixed64=function(e){var t=LongBits$1.from(e);return this._push(writeFixed32,4,t.lo)._push(writeFixed32,4,t.hi)},Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64,Writer$1.prototype.float=function(e){return this._push(util$4.float.writeFloatLE,4,e)},Writer$1.prototype.double=function(e){return this._push(util$4.float.writeDoubleLE,8,e)};var writeBytes=util$4.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};Writer$1.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(writeByte,1,0);if(util$4.isString(e)){var n=Writer$1.alloc(t=base64.length(e));base64.decode(e,n,0),e=n}return this.uint32(t)._push(writeBytes,t,e)},Writer$1.prototype.string=function(e){var t=utf8$1.length(e);return t?this.uint32(t)._push(utf8$1.write,t,e):this._push(writeByte,1,0)},Writer$1.prototype.fork=function(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this},Writer$1.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this},Writer$1.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},Writer$1.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},Writer$1._configure=function(e){BufferWriter$1=e,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}function writeStringBuffer(e,t,n){e.length<40?util$3.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&"set"===util$3.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},BufferWriter.prototype.bytes=function(e){util$3.isString(e)&&(e=util$3._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(BufferWriter.writeBytesBuffer,t,e),this},BufferWriter.prototype.string=function(e){var t=util$3.Buffer.byteLength(e);return this.uint32(t),t&&this._push(writeStringBuffer,t,e),this},BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Reader$1(e){this.buf=e,this.pos=0,this.len=e.length}var create_array="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")},create=function(){return util$2.Buffer?function(e){return(Reader$1.create=function(e){return util$2.Buffer.isBuffer(e)?new BufferReader$1(e):create_array(e)})(e)}:create_array},value;function readLongVarint(){var e=new LongBits(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function readFixed32_end(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.create=create(),Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice,Reader$1.prototype.uint32=(value=4294967295,function(){if(value=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return value;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return value}),Reader$1.prototype.int32=function(){return 0|this.uint32()},Reader$1.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)},Reader$1.prototype.bool=function(){return 0!==this.uint32()},Reader$1.prototype.fixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.sfixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return 0|readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.float=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var e=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},Reader$1.prototype.double=function(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var e=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},Reader$1.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw indexOutOfRange(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,n);if(t===n){var r=util$2.Buffer;return r?r.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,n)},Reader$1.prototype.string=function(){var e=this.bytes();return utf8.read(e,0,e.length)},Reader$1.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw indexOutOfRange(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw indexOutOfRange(this)}while(128&this.buf[this.pos++]);return this},Reader$1.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},Reader$1._configure=function(e){BufferReader$1=e,Reader$1.create=create(),BufferReader$1._configure();var t=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[t](!1)},uint64:function(){return readLongVarint.call(this)[t](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[t](!1)},fixed64:function(){return readFixed64.call(this)[t](!0)},sfixed64:function(){return readFixed64.call(this)[t](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(e){Reader.call(this,e)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)},BufferReader.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},BufferReader._configure();var rpc={},service=Service,util=requireMinimal();function Service(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service,Service.prototype.rpcCall=function e(t,n,r,o,a){if(!o)throw TypeError("request must be specified");var i=this;if(!a)return util.asPromise(e,i,t,n,r,o);if(i.rpcImpl)try{return i.rpcImpl(t,n[i.requestDelimited?"encodeDelimited":"encode"](o).finish(),(function(e,n){if(e)return i.emit("error",e,t),a(e);if(null!==n){if(!(n instanceof r))try{n=r[i.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return i.emit("error",e,t),a(e)}return i.emit("data",n,t),a(null,n)}i.end(!0)}))}catch(e){return i.emit("error",e,t),void setTimeout((function(){a(e)}),0)}else setTimeout((function(){a(Error("already ended"))}),0)},Service.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},function(e){e.Service=service}(rpc);var roots={};!function(e){var t=e;function n(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}t.build="minimal",t.Writer=writer,t.BufferWriter=writer_buffer,t.Reader=reader,t.BufferReader=reader_buffer,t.util=requireMinimal(),t.rpc=rpc,t.roots=roots,t.configure=n,n()}(indexMinimal),function(e){e.exports=indexMinimal}(minimal$1);var _m0=getDefaultExportFromCjs(minimal$1.exports),MessagePackTypeCode,StatusCode;function statusCodeFromJSON(e){switch(e){case 0:case"STATUS_CODE_UNSPECIFIED":return StatusCode.UNSPECIFIED;case 1:case"STATUS_CODE_CANCELLED":return StatusCode.CANCELLED;case 2:case"STATUS_CODE_UNKNOWN":return StatusCode.UNKNOWN;case 3:case"STATUS_CODE_INVALID_ARGUMENT":return StatusCode.INVALID_ARGUMENT;case 4:case"STATUS_CODE_DEADLINE_EXCEEDED":return StatusCode.DEADLINE_EXCEEDED;case 5:case"STATUS_CODE_NOT_FOUND":return StatusCode.NOT_FOUND;case 6:case"STATUS_CODE_ALREADY_EXISTS":return StatusCode.ALREADY_EXISTS;case 7:case"STATUS_CODE_PERMISSION_DENIED":return StatusCode.PERMISSION_DENIED;case 8:case"STATUS_CODE_RESOURCE_EXHAUSTED":return StatusCode.RESOURCE_EXHAUSTED;case 9:case"STATUS_CODE_FAILED_PRECONDITION":return StatusCode.FAILED_PRECONDITION;case 10:case"STATUS_CODE_ABORTED":return StatusCode.ABORTED;case 11:case"STATUS_CODE_OUT_OF_RANGE":return StatusCode.OUT_OF_RANGE;case 12:case"STATUS_CODE_UNIMPLEMENTED":return StatusCode.UNIMPLEMENTED;case 13:case"STATUS_CODE_INTERNAL":return StatusCode.INTERNAL;case 14:case"STATUS_CODE_UNAVAILABLE":return StatusCode.UNAVAILABLE;case 15:case"STATUS_CODE_DATA_LOSS":return StatusCode.DATA_LOSS;case 16:case"STATUS_CODE_UNAUTHENTICATED":return StatusCode.UNAUTHENTICATED;default:throw new globalThis.Error("Unrecognized enum value "+e+" for enum StatusCode")}}function statusCodeToJSON(e){switch(e){case StatusCode.UNSPECIFIED:return"STATUS_CODE_UNSPECIFIED";case StatusCode.CANCELLED:return"STATUS_CODE_CANCELLED";case StatusCode.UNKNOWN:return"STATUS_CODE_UNKNOWN";case StatusCode.INVALID_ARGUMENT:return"STATUS_CODE_INVALID_ARGUMENT";case StatusCode.DEADLINE_EXCEEDED:return"STATUS_CODE_DEADLINE_EXCEEDED";case StatusCode.NOT_FOUND:return"STATUS_CODE_NOT_FOUND";case StatusCode.ALREADY_EXISTS:return"STATUS_CODE_ALREADY_EXISTS";case StatusCode.PERMISSION_DENIED:return"STATUS_CODE_PERMISSION_DENIED";case StatusCode.RESOURCE_EXHAUSTED:return"STATUS_CODE_RESOURCE_EXHAUSTED";case StatusCode.FAILED_PRECONDITION:return"STATUS_CODE_FAILED_PRECONDITION";case StatusCode.ABORTED:return"STATUS_CODE_ABORTED";case StatusCode.OUT_OF_RANGE:return"STATUS_CODE_OUT_OF_RANGE";case StatusCode.UNIMPLEMENTED:return"STATUS_CODE_UNIMPLEMENTED";case StatusCode.INTERNAL:return"STATUS_CODE_INTERNAL";case StatusCode.UNAVAILABLE:return"STATUS_CODE_UNAVAILABLE";case StatusCode.DATA_LOSS:return"STATUS_CODE_DATA_LOSS";case StatusCode.UNAUTHENTICATED:return"STATUS_CODE_UNAUTHENTICATED";default:throw new globalThis.Error("Unrecognized enum value "+e+" for enum StatusCode")}}function createBaseDetailCode(){return{$type:"deepl.pb.interactive_text_api.signalr.DetailCode",value:""}}!function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.START_SESSION_REQUEST=1]="START_SESSION_REQUEST",e[e.START_SESSION_RESPONSE=2]="START_SESSION_RESPONSE",e[e.EVENT_VERSION=3]="EVENT_VERSION",e[e.PARTICIPANT_REQUEST=4]="PARTICIPANT_REQUEST",e[e.PARTICIPANT_RESPONSE=5]="PARTICIPANT_RESPONSE",e[e.CLIENT_ERROR_INFO=6]="CLIENT_ERROR_INFO"}(MessagePackTypeCode||(MessagePackTypeCode={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED"}(StatusCode||(StatusCode={}));const DetailCode={$type:"deepl.pb.interactive_text_api.signalr.DetailCode",encode:(e,t=_m0.Writer.create())=>(""!==e.value&&t.uint32(10).string(e.value),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseDetailCode();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.value=n.string();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:DetailCode.$type,value:isSet$5(e.value)?globalThis.String(e.value):""}),toJSON(e){const t={};return""!==e.value&&(t.value=e.value),t}};function createBaseClientErrorInfo(){return{$type:"deepl.pb.interactive_text_api.signalr.ClientErrorInfo",statusCode:0,detailCode:void 0,fallbackDetailCodes:[]}}const ClientErrorInfo={$type:"deepl.pb.interactive_text_api.signalr.ClientErrorInfo",encode(e,t=_m0.Writer.create()){0!==e.statusCode&&t.uint32(8).int32(e.statusCode),void 0!==e.detailCode&&DetailCode.encode(e.detailCode,t.uint32(18).fork()).ldelim();for(const n of e.fallbackDetailCodes)DetailCode.encode(n,t.uint32(26).fork()).ldelim();return t},decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseClientErrorInfo();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(8!==e)break;o.statusCode=n.int32();continue;case 2:if(18!==e)break;o.detailCode=DetailCode.decode(n,n.uint32());continue;case 3:if(26!==e)break;o.fallbackDetailCodes.push(DetailCode.decode(n,n.uint32()));continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:ClientErrorInfo.$type,statusCode:isSet$5(e.statusCode)?statusCodeFromJSON(e.statusCode):0,detailCode:isSet$5(e.detailCode)?DetailCode.fromJSON(e.detailCode):void 0,fallbackDetailCodes:globalThis.Array.isArray(null==e?void 0:e.fallbackDetailCodes)?e.fallbackDetailCodes.map((e=>DetailCode.fromJSON(e))):[]}),toJSON(e){var t;const n={};return 0!==e.statusCode&&(n.statusCode=statusCodeToJSON(e.statusCode)),void 0!==e.detailCode&&(n.detailCode=DetailCode.toJSON(e.detailCode)),(null===(t=e.fallbackDetailCodes)||void 0===t?void 0:t.length)&&(n.fallbackDetailCodes=e.fallbackDetailCodes.map((e=>DetailCode.toJSON(e)))),n}};function isSet$5(e){return null!=e}
/**
   * @license
   * Copyright 2009 The Closure Library Authors
   * Copyright 2020 Daniel Wirtz / The long.js Authors.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *     http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *
   * SPDX-License-Identifier: Apache-2.0
   */var wasm=null;try{wasm=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function Long(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function isLong(e){return!0===(e&&e.__isLong__)}function ctz32(e){var t=Math.clz32(e&-e);return e?31-t:t}Long.prototype.__isLong__,Object.defineProperty(Long.prototype,"__isLong__",{value:!0}),Long.isLong=isLong;var INT_CACHE={},UINT_CACHE={};function fromInt(e,t){var n,r,o;return t?(o=0<=(e>>>=0)&&e<256)&&(r=UINT_CACHE[e])?r:(n=fromBits(e,0,!0),o&&(UINT_CACHE[e]=n),n):(o=-128<=(e|=0)&&e<128)&&(r=INT_CACHE[e])?r:(n=fromBits(e,e<0?-1:0,!1),o&&(INT_CACHE[e]=n),n)}function fromNumber(e,t){if(isNaN(e))return t?UZERO:ZERO;if(t){if(e<0)return UZERO;if(e>=TWO_PWR_64_DBL)return MAX_UNSIGNED_VALUE}else{if(e<=-TWO_PWR_63_DBL)return MIN_VALUE;if(e+1>=TWO_PWR_63_DBL)return MAX_VALUE}return e<0?fromNumber(-e,t).neg():fromBits(e%TWO_PWR_32_DBL|0,e/TWO_PWR_32_DBL|0,t)}function fromBits(e,t,n){return new Long(e,t,n)}Long.fromInt=fromInt,Long.fromNumber=fromNumber,Long.fromBits=fromBits;var pow_dbl=Math.pow;function fromString(e,t,n){if(0===e.length)throw Error("empty string");if("number"==typeof t?(n=t,t=!1):t=!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?UZERO:ZERO;if((n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return fromString(e.substring(1),t,n).neg();for(var o=fromNumber(pow_dbl(n,8)),a=ZERO,i=0;i<e.length;i+=8){var s=Math.min(8,e.length-i),c=parseInt(e.substring(i,i+s),n);if(s<8){var l=fromNumber(pow_dbl(n,s));a=a.mul(l).add(fromNumber(c))}else a=(a=a.mul(o)).add(fromNumber(c))}return a.unsigned=t,a}function fromValue(e,t){return"number"==typeof e?fromNumber(e,t):"string"==typeof e?fromString(e,t):fromBits(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}Long.fromString=fromString,Long.fromValue=fromValue;var TWO_PWR_16_DBL=65536,TWO_PWR_24_DBL=1<<24,TWO_PWR_32_DBL=TWO_PWR_16_DBL*TWO_PWR_16_DBL,TWO_PWR_64_DBL=TWO_PWR_32_DBL*TWO_PWR_32_DBL,TWO_PWR_63_DBL=TWO_PWR_64_DBL/2,TWO_PWR_24=fromInt(TWO_PWR_24_DBL),ZERO=fromInt(0);Long.ZERO=ZERO;var UZERO=fromInt(0,!0);Long.UZERO=UZERO;var ONE=fromInt(1);Long.ONE=ONE;var UONE=fromInt(1,!0);Long.UONE=UONE;var NEG_ONE=fromInt(-1);Long.NEG_ONE=NEG_ONE;var MAX_VALUE=fromBits(-1,2147483647,!1);Long.MAX_VALUE=MAX_VALUE;var MAX_UNSIGNED_VALUE=fromBits(-1,-1,!0);Long.MAX_UNSIGNED_VALUE=MAX_UNSIGNED_VALUE;var MIN_VALUE=fromBits(0,-2147483648,!1);Long.MIN_VALUE=MIN_VALUE;var LongPrototype=Long.prototype;function createBaseTimestamp(){return{$type:"google.protobuf.Timestamp",seconds:0,nanos:0}}LongPrototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},LongPrototype.toNumber=function(){return this.unsigned?(this.high>>>0)*TWO_PWR_32_DBL+(this.low>>>0):this.high*TWO_PWR_32_DBL+(this.low>>>0)},LongPrototype.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(MIN_VALUE)){var t=fromNumber(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var o=fromNumber(pow_dbl(e,6),this.unsigned),a=this,i="";;){var s=a.div(o),c=(a.sub(s.mul(o)).toInt()>>>0).toString(e);if((a=s).isZero())return c+i;for(;c.length<6;)c="0"+c;i=""+c+i}},LongPrototype.getHighBits=function(){return this.high},LongPrototype.getHighBitsUnsigned=function(){return this.high>>>0},LongPrototype.getLowBits=function(){return this.low},LongPrototype.getLowBitsUnsigned=function(){return this.low>>>0},LongPrototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(MIN_VALUE)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return 0!=this.high?t+33:t+1},LongPrototype.isZero=function(){return 0===this.high&&0===this.low},LongPrototype.eqz=LongPrototype.isZero,LongPrototype.isNegative=function(){return!this.unsigned&&this.high<0},LongPrototype.isPositive=function(){return this.unsigned||this.high>=0},LongPrototype.isOdd=function(){return!(1&~this.low)},LongPrototype.isEven=function(){return!(1&this.low)},LongPrototype.equals=function(e){return isLong(e)||(e=fromValue(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&(this.high===e.high&&this.low===e.low)},LongPrototype.eq=LongPrototype.equals,LongPrototype.notEquals=function(e){return!this.eq(e)},LongPrototype.neq=LongPrototype.notEquals,LongPrototype.ne=LongPrototype.notEquals,LongPrototype.lessThan=function(e){return this.comp(e)<0},LongPrototype.lt=LongPrototype.lessThan,LongPrototype.lessThanOrEqual=function(e){return this.comp(e)<=0},LongPrototype.lte=LongPrototype.lessThanOrEqual,LongPrototype.le=LongPrototype.lessThanOrEqual,LongPrototype.greaterThan=function(e){return this.comp(e)>0},LongPrototype.gt=LongPrototype.greaterThan,LongPrototype.greaterThanOrEqual=function(e){return this.comp(e)>=0},LongPrototype.gte=LongPrototype.greaterThanOrEqual,LongPrototype.ge=LongPrototype.greaterThanOrEqual,LongPrototype.compare=function(e){if(isLong(e)||(e=fromValue(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},LongPrototype.comp=LongPrototype.compare,LongPrototype.negate=function(){return!this.unsigned&&this.eq(MIN_VALUE)?MIN_VALUE:this.not().add(ONE)},LongPrototype.neg=LongPrototype.negate,LongPrototype.add=function(e){isLong(e)||(e=fromValue(e));var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,o=65535&this.low,a=e.high>>>16,i=65535&e.high,s=e.low>>>16,c=0,l=0,u=0,d=0;return u+=(d+=o+(65535&e.low))>>>16,l+=(u+=r+s)>>>16,c+=(l+=n+i)>>>16,c+=t+a,fromBits((u&=65535)<<16|(d&=65535),(c&=65535)<<16|(l&=65535),this.unsigned)},LongPrototype.subtract=function(e){return isLong(e)||(e=fromValue(e)),this.add(e.neg())},LongPrototype.sub=LongPrototype.subtract,LongPrototype.multiply=function(e){if(this.isZero())return this;if(isLong(e)||(e=fromValue(e)),wasm)return fromBits(wasm.mul(this.low,this.high,e.low,e.high),wasm.get_high(),this.unsigned);if(e.isZero())return this.unsigned?UZERO:ZERO;if(this.eq(MIN_VALUE))return e.isOdd()?MIN_VALUE:ZERO;if(e.eq(MIN_VALUE))return this.isOdd()?MIN_VALUE:ZERO;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(TWO_PWR_24)&&e.lt(TWO_PWR_24))return fromNumber(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,o=65535&this.low,a=e.high>>>16,i=65535&e.high,s=e.low>>>16,c=65535&e.low,l=0,u=0,d=0,p=0;return d+=(p+=o*c)>>>16,u+=(d+=r*c)>>>16,d&=65535,u+=(d+=o*s)>>>16,l+=(u+=n*c)>>>16,u&=65535,l+=(u+=r*s)>>>16,u&=65535,l+=(u+=o*i)>>>16,l+=t*c+n*s+r*i+o*a,fromBits((d&=65535)<<16|(p&=65535),(l&=65535)<<16|(u&=65535),this.unsigned)},LongPrototype.mul=LongPrototype.multiply,LongPrototype.divide=function(e){if(isLong(e)||(e=fromValue(e)),e.isZero())throw Error("division by zero");var t,n,r;if(wasm)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?fromBits((this.unsigned?wasm.div_u:wasm.div_s)(this.low,this.high,e.low,e.high),wasm.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?UZERO:ZERO;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return UZERO;if(e.gt(this.shru(1)))return UONE;r=UZERO}else{if(this.eq(MIN_VALUE))return e.eq(ONE)||e.eq(NEG_ONE)?MIN_VALUE:e.eq(MIN_VALUE)?ONE:(t=this.shr(1).div(e).shl(1)).eq(ZERO)?e.isNegative()?ONE:NEG_ONE:(n=this.sub(e.mul(t)),r=t.add(n.div(e)));if(e.eq(MIN_VALUE))return this.unsigned?UZERO:ZERO;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=ZERO}for(n=this;n.gte(e);){t=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(t)/Math.LN2),a=o<=48?1:pow_dbl(2,o-48),i=fromNumber(t),s=i.mul(e);s.isNegative()||s.gt(n);)s=(i=fromNumber(t-=a,this.unsigned)).mul(e);i.isZero()&&(i=ONE),r=r.add(i),n=n.sub(s)}return r},LongPrototype.div=LongPrototype.divide,LongPrototype.modulo=function(e){return isLong(e)||(e=fromValue(e)),wasm?fromBits((this.unsigned?wasm.rem_u:wasm.rem_s)(this.low,this.high,e.low,e.high),wasm.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},LongPrototype.mod=LongPrototype.modulo,LongPrototype.rem=LongPrototype.modulo,LongPrototype.not=function(){return fromBits(~this.low,~this.high,this.unsigned)},LongPrototype.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},LongPrototype.clz=LongPrototype.countLeadingZeros,LongPrototype.countTrailingZeros=function(){return this.low?ctz32(this.low):ctz32(this.high)+32},LongPrototype.ctz=LongPrototype.countTrailingZeros,LongPrototype.and=function(e){return isLong(e)||(e=fromValue(e)),fromBits(this.low&e.low,this.high&e.high,this.unsigned)},LongPrototype.or=function(e){return isLong(e)||(e=fromValue(e)),fromBits(this.low|e.low,this.high|e.high,this.unsigned)},LongPrototype.xor=function(e){return isLong(e)||(e=fromValue(e)),fromBits(this.low^e.low,this.high^e.high,this.unsigned)},LongPrototype.shiftLeft=function(e){return isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?fromBits(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):fromBits(0,this.low<<e-32,this.unsigned)},LongPrototype.shl=LongPrototype.shiftLeft,LongPrototype.shiftRight=function(e){return isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?fromBits(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):fromBits(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},LongPrototype.shr=LongPrototype.shiftRight,LongPrototype.shiftRightUnsigned=function(e){return isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?fromBits(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):fromBits(32===e?this.high:this.high>>>e-32,0,this.unsigned)},LongPrototype.shru=LongPrototype.shiftRightUnsigned,LongPrototype.shr_u=LongPrototype.shiftRightUnsigned,LongPrototype.rotateLeft=function(e){var t;return isLong(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?fromBits(this.high,this.low,this.unsigned):e<32?(t=32-e,fromBits(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(t=32-(e-=32),fromBits(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},LongPrototype.rotl=LongPrototype.rotateLeft,LongPrototype.rotateRight=function(e){var t;return isLong(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?fromBits(this.high,this.low,this.unsigned):e<32?(t=32-e,fromBits(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(t=32-(e-=32),fromBits(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},LongPrototype.rotr=LongPrototype.rotateRight,LongPrototype.toSigned=function(){return this.unsigned?fromBits(this.low,this.high,!1):this},LongPrototype.toUnsigned=function(){return this.unsigned?this:fromBits(this.low,this.high,!0)},LongPrototype.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},LongPrototype.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},LongPrototype.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},Long.fromBytes=function(e,t,n){return n?Long.fromBytesLE(e,t):Long.fromBytesBE(e,t)},Long.fromBytesLE=function(e,t){return new Long(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},Long.fromBytesBE=function(e,t){return new Long(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const Timestamp={$type:"google.protobuf.Timestamp",encode:(e,t=_m0.Writer.create())=>(0!==e.seconds&&t.uint32(8).int64(e.seconds),0!==e.nanos&&t.uint32(16).int32(e.nanos),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseTimestamp();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(8!==e)break;o.seconds=longToNumber(n.int64());continue;case 2:if(16!==e)break;o.nanos=n.int32();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:Timestamp.$type,seconds:isSet$4(e.seconds)?globalThis.Number(e.seconds):0,nanos:isSet$4(e.nanos)?globalThis.Number(e.nanos):0}),toJSON(e){const t={};return 0!==e.seconds&&(t.seconds=Math.round(e.seconds)),0!==e.nanos&&(t.nanos=Math.round(e.nanos)),t}};function longToNumber(e){if(e.gt(globalThis.Number.MAX_SAFE_INTEGER))throw new globalThis.Error("Value is larger than Number.MAX_SAFE_INTEGER");return e.toNumber()}function isSet$4(e){return null!=e}function createBaseInt32Value(){return{$type:"google.protobuf.Int32Value",value:0}}_m0.util.Long!==Long&&(_m0.util.Long=Long,_m0.configure());const Int32Value={$type:"google.protobuf.Int32Value",encode:(e,t=_m0.Writer.create())=>(0!==e.value&&t.uint32(8).int32(e.value),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseInt32Value();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(8!==e)break;o.value=n.int32();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:Int32Value.$type,value:isSet$3(e.value)?globalThis.Number(e.value):0}),toJSON(e){const t={};return 0!==e.value&&(t.value=Math.round(e.value)),t}};function isSet$3(e){return null!=e}function createBaseTextRange(){return{$type:"deepl.pb.interactive_text_api.TextRange",start:0,end:0}}_m0.util.Long!==Long&&(_m0.util.Long=Long,_m0.configure());const TextRange={$type:"deepl.pb.interactive_text_api.TextRange",encode:(e,t=_m0.Writer.create())=>(0!==e.start&&t.uint32(8).int32(e.start),0!==e.end&&t.uint32(16).int32(e.end),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseTextRange();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(8!==e)break;o.start=n.int32();continue;case 2:if(16!==e)break;o.end=n.int32();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:TextRange.$type,start:isSet$2(e.start)?globalThis.Number(e.start):0,end:isSet$2(e.end)?globalThis.Number(e.end):0}),toJSON(e){const t={};return 0!==e.start&&(t.start=Math.round(e.start)),0!==e.end&&(t.end=Math.round(e.end)),t}};function isSet$2(e){return null!=e}var CalculatedSourceLanguageOrigin,TextDirection;function calculatedSourceLanguageOriginFromJSON(e){switch(e){case 0:case"CALCULATED_SOURCE_LANGUAGE_ORIGIN_UNSPECIFIED":return CalculatedSourceLanguageOrigin.UNSPECIFIED;case 1:case"CALCULATED_SOURCE_LANGUAGE_ORIGIN_REQUESTED_LANGUAGE":return CalculatedSourceLanguageOrigin.REQUESTED_LANGUAGE;case 2:case"CALCULATED_SOURCE_LANGUAGE_ORIGIN_LANGUAGE_DETECTION":return CalculatedSourceLanguageOrigin.LANGUAGE_DETECTION;default:throw new globalThis.Error("Unrecognized enum value "+e+" for enum CalculatedSourceLanguageOrigin")}}function calculatedSourceLanguageOriginToJSON(e){switch(e){case CalculatedSourceLanguageOrigin.UNSPECIFIED:return"CALCULATED_SOURCE_LANGUAGE_ORIGIN_UNSPECIFIED";case CalculatedSourceLanguageOrigin.REQUESTED_LANGUAGE:return"CALCULATED_SOURCE_LANGUAGE_ORIGIN_REQUESTED_LANGUAGE";case CalculatedSourceLanguageOrigin.LANGUAGE_DETECTION:return"CALCULATED_SOURCE_LANGUAGE_ORIGIN_LANGUAGE_DETECTION";default:throw new globalThis.Error("Unrecognized enum value "+e+" for enum CalculatedSourceLanguageOrigin")}}function textDirectionFromJSON(e){switch(e){case 0:case"TEXT_DIRECTION_UNSPECIFIED":return TextDirection.UNSPECIFIED;case 1:case"TEXT_DIRECTION_LEFT_TO_RIGHT":return TextDirection.LEFT_TO_RIGHT;case 2:case"TEXT_DIRECTION_RIGHT_TO_LEFT":return TextDirection.RIGHT_TO_LEFT;default:throw new globalThis.Error("Unrecognized enum value "+e+" for enum TextDirection")}}function textDirectionToJSON(e){switch(e){case TextDirection.UNSPECIFIED:return"TEXT_DIRECTION_UNSPECIFIED";case TextDirection.LEFT_TO_RIGHT:return"TEXT_DIRECTION_LEFT_TO_RIGHT";case TextDirection.RIGHT_TO_LEFT:return"TEXT_DIRECTION_RIGHT_TO_LEFT";default:throw new globalThis.Error("Unrecognized enum value "+e+" for enum TextDirection")}}function createBaseTextUnitAnnotationPayload(){return{$type:"deepl.pb.interactive_text_api.translator.TextUnitAnnotationPayload",textUnitId:void 0}}!function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.REQUESTED_LANGUAGE=1]="REQUESTED_LANGUAGE",e[e.LANGUAGE_DETECTION=2]="LANGUAGE_DETECTION"}(CalculatedSourceLanguageOrigin||(CalculatedSourceLanguageOrigin={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.LEFT_TO_RIGHT=1]="LEFT_TO_RIGHT",e[e.RIGHT_TO_LEFT=2]="RIGHT_TO_LEFT"}(TextDirection||(TextDirection={}));const TextUnitAnnotationPayload={$type:"deepl.pb.interactive_text_api.translator.TextUnitAnnotationPayload",encode:(e,t=_m0.Writer.create())=>(void 0!==e.textUnitId&&TextUnitId.encode(e.textUnitId,t.uint32(10).fork()).ldelim(),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseTextUnitAnnotationPayload();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.textUnitId=TextUnitId.decode(n,n.uint32());continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:TextUnitAnnotationPayload.$type,textUnitId:isSet$1(e.textUnitId)?TextUnitId.fromJSON(e.textUnitId):void 0}),toJSON(e){const t={};return void 0!==e.textUnitId&&(t.textUnitId=TextUnitId.toJSON(e.textUnitId)),t}};function createBaseRequestWordAlternativesAnnotationPayload(){return{$type:"deepl.pb.interactive_text_api.translator.RequestWordAlternativesAnnotationPayload",flowId:void 0}}const RequestWordAlternativesAnnotationPayload={$type:"deepl.pb.interactive_text_api.translator.RequestWordAlternativesAnnotationPayload",encode:(e,t=_m0.Writer.create())=>(void 0!==e.flowId&&WordAlternativesFlowId.encode(e.flowId,t.uint32(10).fork()).ldelim(),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseRequestWordAlternativesAnnotationPayload();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.flowId=WordAlternativesFlowId.decode(n,n.uint32());continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:RequestWordAlternativesAnnotationPayload.$type,flowId:isSet$1(e.flowId)?WordAlternativesFlowId.fromJSON(e.flowId):void 0}),toJSON(e){const t={};return void 0!==e.flowId&&(t.flowId=WordAlternativesFlowId.toJSON(e.flowId)),t}};function createBaseProvidedWordAlternativesAnnotationPayload(){return{$type:"deepl.pb.interactive_text_api.translator.ProvidedWordAlternativesAnnotationPayload",flowId:void 0,alternatives:[]}}const ProvidedWordAlternativesAnnotationPayload={$type:"deepl.pb.interactive_text_api.translator.ProvidedWordAlternativesAnnotationPayload",encode(e,t=_m0.Writer.create()){void 0!==e.flowId&&WordAlternativesFlowId.encode(e.flowId,t.uint32(10).fork()).ldelim();for(const n of e.alternatives)WordAlternative.encode(n,t.uint32(18).fork()).ldelim();return t},decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseProvidedWordAlternativesAnnotationPayload();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.flowId=WordAlternativesFlowId.decode(n,n.uint32());continue;case 2:if(18!==e)break;o.alternatives.push(WordAlternative.decode(n,n.uint32()));continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:ProvidedWordAlternativesAnnotationPayload.$type,flowId:isSet$1(e.flowId)?WordAlternativesFlowId.fromJSON(e.flowId):void 0,alternatives:globalThis.Array.isArray(null==e?void 0:e.alternatives)?e.alternatives.map((e=>WordAlternative.fromJSON(e))):[]}),toJSON(e){var t;const n={};return void 0!==e.flowId&&(n.flowId=WordAlternativesFlowId.toJSON(e.flowId)),(null===(t=e.alternatives)||void 0===t?void 0:t.length)&&(n.alternatives=e.alternatives.map((e=>WordAlternative.toJSON(e)))),n}};function createBaseSelectWordAlternativeAnnotationPayload(){return{$type:"deepl.pb.interactive_text_api.translator.SelectWordAlternativeAnnotationPayload",flowId:void 0,selection:""}}const SelectWordAlternativeAnnotationPayload={$type:"deepl.pb.interactive_text_api.translator.SelectWordAlternativeAnnotationPayload",encode:(e,t=_m0.Writer.create())=>(void 0!==e.flowId&&WordAlternativesFlowId.encode(e.flowId,t.uint32(10).fork()).ldelim(),""!==e.selection&&t.uint32(18).string(e.selection),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseSelectWordAlternativeAnnotationPayload();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.flowId=WordAlternativesFlowId.decode(n,n.uint32());continue;case 2:if(18!==e)break;o.selection=n.string();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:SelectWordAlternativeAnnotationPayload.$type,flowId:isSet$1(e.flowId)?WordAlternativesFlowId.fromJSON(e.flowId):void 0,selection:isSet$1(e.selection)?globalThis.String(e.selection):""}),toJSON(e){const t={};return void 0!==e.flowId&&(t.flowId=WordAlternativesFlowId.toJSON(e.flowId)),""!==e.selection&&(t.selection=e.selection),t}};function createBaseRequestTextUnitAlternativesAnnotationPayload(){return{$type:"deepl.pb.interactive_text_api.translator.RequestTextUnitAlternativesAnnotationPayload",flowId:void 0}}const RequestTextUnitAlternativesAnnotationPayload={$type:"deepl.pb.interactive_text_api.translator.RequestTextUnitAlternativesAnnotationPayload",encode:(e,t=_m0.Writer.create())=>(void 0!==e.flowId&&TextUnitAlternativesFlowId.encode(e.flowId,t.uint32(10).fork()).ldelim(),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseRequestTextUnitAlternativesAnnotationPayload();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.flowId=TextUnitAlternativesFlowId.decode(n,n.uint32());continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:RequestTextUnitAlternativesAnnotationPayload.$type,flowId:isSet$1(e.flowId)?TextUnitAlternativesFlowId.fromJSON(e.flowId):void 0}),toJSON(e){const t={};return void 0!==e.flowId&&(t.flowId=TextUnitAlternativesFlowId.toJSON(e.flowId)),t}};function createBaseProvidedTextUnitAlternativesAnnotationPayload(){return{$type:"deepl.pb.interactive_text_api.translator.ProvidedTextUnitAlternativesAnnotationPayload",flowId:void 0,alternatives:[]}}const ProvidedTextUnitAlternativesAnnotationPayload={$type:"deepl.pb.interactive_text_api.translator.ProvidedTextUnitAlternativesAnnotationPayload",encode(e,t=_m0.Writer.create()){void 0!==e.flowId&&TextUnitAlternativesFlowId.encode(e.flowId,t.uint32(10).fork()).ldelim();for(const n of e.alternatives)TextUnitAlternative.encode(n,t.uint32(18).fork()).ldelim();return t},decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseProvidedTextUnitAlternativesAnnotationPayload();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.flowId=TextUnitAlternativesFlowId.decode(n,n.uint32());continue;case 2:if(18!==e)break;o.alternatives.push(TextUnitAlternative.decode(n,n.uint32()));continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:ProvidedTextUnitAlternativesAnnotationPayload.$type,flowId:isSet$1(e.flowId)?TextUnitAlternativesFlowId.fromJSON(e.flowId):void 0,alternatives:globalThis.Array.isArray(null==e?void 0:e.alternatives)?e.alternatives.map((e=>TextUnitAlternative.fromJSON(e))):[]}),toJSON(e){var t;const n={};return void 0!==e.flowId&&(n.flowId=TextUnitAlternativesFlowId.toJSON(e.flowId)),(null===(t=e.alternatives)||void 0===t?void 0:t.length)&&(n.alternatives=e.alternatives.map((e=>TextUnitAlternative.toJSON(e)))),n}};function createBaseSelectTextUnitAlternativeAnnotationPayload(){return{$type:"deepl.pb.interactive_text_api.translator.SelectTextUnitAlternativeAnnotationPayload",flowId:void 0,selection:""}}const SelectTextUnitAlternativeAnnotationPayload={$type:"deepl.pb.interactive_text_api.translator.SelectTextUnitAlternativeAnnotationPayload",encode:(e,t=_m0.Writer.create())=>(void 0!==e.flowId&&TextUnitAlternativesFlowId.encode(e.flowId,t.uint32(10).fork()).ldelim(),""!==e.selection&&t.uint32(18).string(e.selection),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseSelectTextUnitAlternativeAnnotationPayload();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.flowId=TextUnitAlternativesFlowId.decode(n,n.uint32());continue;case 2:if(18!==e)break;o.selection=n.string();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:SelectTextUnitAlternativeAnnotationPayload.$type,flowId:isSet$1(e.flowId)?TextUnitAlternativesFlowId.fromJSON(e.flowId):void 0,selection:isSet$1(e.selection)?globalThis.String(e.selection):""}),toJSON(e){const t={};return void 0!==e.flowId&&(t.flowId=TextUnitAlternativesFlowId.toJSON(e.flowId)),""!==e.selection&&(t.selection=e.selection),t}};function createBaseRequestAutocompletionAnnotationPayload(){return{$type:"deepl.pb.interactive_text_api.translator.RequestAutocompletionAnnotationPayload",flowId:void 0}}const RequestAutocompletionAnnotationPayload={$type:"deepl.pb.interactive_text_api.translator.RequestAutocompletionAnnotationPayload",encode:(e,t=_m0.Writer.create())=>(void 0!==e.flowId&&AutocompletionFlowId.encode(e.flowId,t.uint32(10).fork()).ldelim(),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseRequestAutocompletionAnnotationPayload();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.flowId=AutocompletionFlowId.decode(n,n.uint32());continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:RequestAutocompletionAnnotationPayload.$type,flowId:isSet$1(e.flowId)?AutocompletionFlowId.fromJSON(e.flowId):void 0}),toJSON(e){const t={};return void 0!==e.flowId&&(t.flowId=AutocompletionFlowId.toJSON(e.flowId)),t}};function createBaseProvidedAutocompletionAnnotationPayload(){return{$type:"deepl.pb.interactive_text_api.translator.ProvidedAutocompletionAnnotationPayload",flowId:void 0,autocompletions:[]}}const ProvidedAutocompletionAnnotationPayload={$type:"deepl.pb.interactive_text_api.translator.ProvidedAutocompletionAnnotationPayload",encode(e,t=_m0.Writer.create()){void 0!==e.flowId&&AutocompletionFlowId.encode(e.flowId,t.uint32(10).fork()).ldelim();for(const n of e.autocompletions)TextUnitAlternative.encode(n,t.uint32(18).fork()).ldelim();return t},decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseProvidedAutocompletionAnnotationPayload();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.flowId=AutocompletionFlowId.decode(n,n.uint32());continue;case 2:if(18!==e)break;o.autocompletions.push(TextUnitAlternative.decode(n,n.uint32()));continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:ProvidedAutocompletionAnnotationPayload.$type,flowId:isSet$1(e.flowId)?AutocompletionFlowId.fromJSON(e.flowId):void 0,autocompletions:globalThis.Array.isArray(null==e?void 0:e.autocompletions)?e.autocompletions.map((e=>TextUnitAlternative.fromJSON(e))):[]}),toJSON(e){var t;const n={};return void 0!==e.flowId&&(n.flowId=AutocompletionFlowId.toJSON(e.flowId)),(null===(t=e.autocompletions)||void 0===t?void 0:t.length)&&(n.autocompletions=e.autocompletions.map((e=>TextUnitAlternative.toJSON(e)))),n}};function createBaseSelectAutocompletionAnnotationPayload(){return{$type:"deepl.pb.interactive_text_api.translator.SelectAutocompletionAnnotationPayload",flowId:void 0,selection:""}}const SelectAutocompletionAnnotationPayload={$type:"deepl.pb.interactive_text_api.translator.SelectAutocompletionAnnotationPayload",encode:(e,t=_m0.Writer.create())=>(void 0!==e.flowId&&AutocompletionFlowId.encode(e.flowId,t.uint32(10).fork()).ldelim(),""!==e.selection&&t.uint32(18).string(e.selection),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseSelectAutocompletionAnnotationPayload();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.flowId=AutocompletionFlowId.decode(n,n.uint32());continue;case 2:if(18!==e)break;o.selection=n.string();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:SelectAutocompletionAnnotationPayload.$type,flowId:isSet$1(e.flowId)?AutocompletionFlowId.fromJSON(e.flowId):void 0,selection:isSet$1(e.selection)?globalThis.String(e.selection):""}),toJSON(e){const t={};return void 0!==e.flowId&&(t.flowId=AutocompletionFlowId.toJSON(e.flowId)),""!==e.selection&&(t.selection=e.selection),t}};function createBaseProvidedAutomaticTextUnitAlternativesAnnotationPayload(){return{$type:"deepl.pb.interactive_text_api.translator.ProvidedAutomaticTextUnitAlternativesAnnotationPayload",alternatives:[]}}const ProvidedAutomaticTextUnitAlternativesAnnotationPayload={$type:"deepl.pb.interactive_text_api.translator.ProvidedAutomaticTextUnitAlternativesAnnotationPayload",encode(e,t=_m0.Writer.create()){for(const n of e.alternatives)TextUnitAlternative.encode(n,t.uint32(10).fork()).ldelim();return t},decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseProvidedAutomaticTextUnitAlternativesAnnotationPayload();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.alternatives.push(TextUnitAlternative.decode(n,n.uint32()));continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:ProvidedAutomaticTextUnitAlternativesAnnotationPayload.$type,alternatives:globalThis.Array.isArray(null==e?void 0:e.alternatives)?e.alternatives.map((e=>TextUnitAlternative.fromJSON(e))):[]}),toJSON(e){var t;const n={};return(null===(t=e.alternatives)||void 0===t?void 0:t.length)&&(n.alternatives=e.alternatives.map((e=>TextUnitAlternative.toJSON(e)))),n}};function createBaseSelectAutomaticTextUnitAlternativeAnnotationPayload(){return{$type:"deepl.pb.interactive_text_api.translator.SelectAutomaticTextUnitAlternativeAnnotationPayload",selection:""}}const SelectAutomaticTextUnitAlternativeAnnotationPayload={$type:"deepl.pb.interactive_text_api.translator.SelectAutomaticTextUnitAlternativeAnnotationPayload",encode:(e,t=_m0.Writer.create())=>(""!==e.selection&&t.uint32(10).string(e.selection),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseSelectAutomaticTextUnitAlternativeAnnotationPayload();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.selection=n.string();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:SelectAutomaticTextUnitAlternativeAnnotationPayload.$type,selection:isSet$1(e.selection)?globalThis.String(e.selection):""}),toJSON(e){const t={};return""!==e.selection&&(t.selection=e.selection),t}};function createBaseGlossaryReplacementAnnotationPayload(){return{$type:"deepl.pb.interactive_text_api.translator.GlossaryReplacementAnnotationPayload",replacement:void 0}}const GlossaryReplacementAnnotationPayload={$type:"deepl.pb.interactive_text_api.translator.GlossaryReplacementAnnotationPayload",encode:(e,t=_m0.Writer.create())=>(void 0!==e.replacement&&GlossaryEntry.encode(e.replacement,t.uint32(10).fork()).ldelim(),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseGlossaryReplacementAnnotationPayload();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.replacement=GlossaryEntry.decode(n,n.uint32());continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:GlossaryReplacementAnnotationPayload.$type,replacement:isSet$1(e.replacement)?GlossaryEntry.fromJSON(e.replacement):void 0}),toJSON(e){const t={};return void 0!==e.replacement&&(t.replacement=GlossaryEntry.toJSON(e.replacement)),t}};function createBaseSourceLanguagesPropertyValue(){return{$type:"deepl.pb.interactive_text_api.translator.SourceLanguagesPropertyValue",sourceLanguages:[]}}const SourceLanguagesPropertyValue={$type:"deepl.pb.interactive_text_api.translator.SourceLanguagesPropertyValue",encode(e,t=_m0.Writer.create()){for(const n of e.sourceLanguages)SourceLanguage.encode(n,t.uint32(10).fork()).ldelim();return t},decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseSourceLanguagesPropertyValue();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.sourceLanguages.push(SourceLanguage.decode(n,n.uint32()));continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:SourceLanguagesPropertyValue.$type,sourceLanguages:globalThis.Array.isArray(null==e?void 0:e.sourceLanguages)?e.sourceLanguages.map((e=>SourceLanguage.fromJSON(e))):[]}),toJSON(e){var t;const n={};return(null===(t=e.sourceLanguages)||void 0===t?void 0:t.length)&&(n.sourceLanguages=e.sourceLanguages.map((e=>SourceLanguage.toJSON(e)))),n}};function createBaseTargetLanguagesPropertyValue(){return{$type:"deepl.pb.interactive_text_api.translator.TargetLanguagesPropertyValue",targetLanguages:[]}}const TargetLanguagesPropertyValue={$type:"deepl.pb.interactive_text_api.translator.TargetLanguagesPropertyValue",encode(e,t=_m0.Writer.create()){for(const n of e.targetLanguages)TargetLanguage.encode(n,t.uint32(10).fork()).ldelim();return t},decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseTargetLanguagesPropertyValue();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.targetLanguages.push(TargetLanguage.decode(n,n.uint32()));continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:TargetLanguagesPropertyValue.$type,targetLanguages:globalThis.Array.isArray(null==e?void 0:e.targetLanguages)?e.targetLanguages.map((e=>TargetLanguage.fromJSON(e))):[]}),toJSON(e){var t;const n={};return(null===(t=e.targetLanguages)||void 0===t?void 0:t.length)&&(n.targetLanguages=e.targetLanguages.map((e=>TargetLanguage.toJSON(e)))),n}};function createBaseRequestedSourceLanguagePropertyValue(){return{$type:"deepl.pb.interactive_text_api.translator.RequestedSourceLanguagePropertyValue",sourceLanguage:void 0}}const RequestedSourceLanguagePropertyValue={$type:"deepl.pb.interactive_text_api.translator.RequestedSourceLanguagePropertyValue",encode:(e,t=_m0.Writer.create())=>(void 0!==e.sourceLanguage&&SourceLanguage.encode(e.sourceLanguage,t.uint32(10).fork()).ldelim(),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseRequestedSourceLanguagePropertyValue();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.sourceLanguage=SourceLanguage.decode(n,n.uint32());continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:RequestedSourceLanguagePropertyValue.$type,sourceLanguage:isSet$1(e.sourceLanguage)?SourceLanguage.fromJSON(e.sourceLanguage):void 0}),toJSON(e){const t={};return void 0!==e.sourceLanguage&&(t.sourceLanguage=SourceLanguage.toJSON(e.sourceLanguage)),t}};function createBaseCalculatedSourceLanguagePropertyValue(){return{$type:"deepl.pb.interactive_text_api.translator.CalculatedSourceLanguagePropertyValue",sourceLanguage:void 0,origin:0}}const CalculatedSourceLanguagePropertyValue={$type:"deepl.pb.interactive_text_api.translator.CalculatedSourceLanguagePropertyValue",encode:(e,t=_m0.Writer.create())=>(void 0!==e.sourceLanguage&&SourceLanguage.encode(e.sourceLanguage,t.uint32(10).fork()).ldelim(),0!==e.origin&&t.uint32(16).int32(e.origin),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseCalculatedSourceLanguagePropertyValue();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.sourceLanguage=SourceLanguage.decode(n,n.uint32());continue;case 2:if(16!==e)break;o.origin=n.int32();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:CalculatedSourceLanguagePropertyValue.$type,sourceLanguage:isSet$1(e.sourceLanguage)?SourceLanguage.fromJSON(e.sourceLanguage):void 0,origin:isSet$1(e.origin)?calculatedSourceLanguageOriginFromJSON(e.origin):0}),toJSON(e){const t={};return void 0!==e.sourceLanguage&&(t.sourceLanguage=SourceLanguage.toJSON(e.sourceLanguage)),0!==e.origin&&(t.origin=calculatedSourceLanguageOriginToJSON(e.origin)),t}};function createBaseRequestedTargetLanguagePropertyValue(){return{$type:"deepl.pb.interactive_text_api.translator.RequestedTargetLanguagePropertyValue",targetLanguage:void 0}}const RequestedTargetLanguagePropertyValue={$type:"deepl.pb.interactive_text_api.translator.RequestedTargetLanguagePropertyValue",encode:(e,t=_m0.Writer.create())=>(void 0!==e.targetLanguage&&TargetLanguage.encode(e.targetLanguage,t.uint32(10).fork()).ldelim(),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseRequestedTargetLanguagePropertyValue();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.targetLanguage=TargetLanguage.decode(n,n.uint32());continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:RequestedTargetLanguagePropertyValue.$type,targetLanguage:isSet$1(e.targetLanguage)?TargetLanguage.fromJSON(e.targetLanguage):void 0}),toJSON(e){const t={};return void 0!==e.targetLanguage&&(t.targetLanguage=TargetLanguage.toJSON(e.targetLanguage)),t}};function createBaseCalculatedTargetLanguagePropertyValue(){return{$type:"deepl.pb.interactive_text_api.translator.CalculatedTargetLanguagePropertyValue",targetLanguage:void 0}}const CalculatedTargetLanguagePropertyValue={$type:"deepl.pb.interactive_text_api.translator.CalculatedTargetLanguagePropertyValue",encode:(e,t=_m0.Writer.create())=>(void 0!==e.targetLanguage&&TargetLanguage.encode(e.targetLanguage,t.uint32(10).fork()).ldelim(),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseCalculatedTargetLanguagePropertyValue();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.targetLanguage=TargetLanguage.decode(n,n.uint32());continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:CalculatedTargetLanguagePropertyValue.$type,targetLanguage:isSet$1(e.targetLanguage)?TargetLanguage.fromJSON(e.targetLanguage):void 0}),toJSON(e){const t={};return void 0!==e.targetLanguage&&(t.targetLanguage=TargetLanguage.toJSON(e.targetLanguage)),t}};function createBaseTaskMetaInfo(){return{$type:"deepl.pb.interactive_text_api.translator.TaskMetaInfo",progressInPercent:0}}const TaskMetaInfo={$type:"deepl.pb.interactive_text_api.translator.TaskMetaInfo",encode:(e,t=_m0.Writer.create())=>(0!==e.progressInPercent&&t.uint32(8).int32(e.progressInPercent),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseTaskMetaInfo();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(8!==e)break;o.progressInPercent=n.int32();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:TaskMetaInfo.$type,progressInPercent:isSet$1(e.progressInPercent)?globalThis.Number(e.progressInPercent):0}),toJSON(e){const t={};return 0!==e.progressInPercent&&(t.progressInPercent=Math.round(e.progressInPercent)),t}};function createBaseFormalityModesPropertyValue(){return{$type:"deepl.pb.interactive_text_api.translator.FormalityModesPropertyValue",formalityModes:[]}}const FormalityModesPropertyValue={$type:"deepl.pb.interactive_text_api.translator.FormalityModesPropertyValue",encode(e,t=_m0.Writer.create()){for(const n of e.formalityModes)FormalityMode.encode(n,t.uint32(10).fork()).ldelim();return t},decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseFormalityModesPropertyValue();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.formalityModes.push(FormalityMode.decode(n,n.uint32()));continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:FormalityModesPropertyValue.$type,formalityModes:globalThis.Array.isArray(null==e?void 0:e.formalityModes)?e.formalityModes.map((e=>FormalityMode.fromJSON(e))):[]}),toJSON(e){var t;const n={};return(null===(t=e.formalityModes)||void 0===t?void 0:t.length)&&(n.formalityModes=e.formalityModes.map((e=>FormalityMode.toJSON(e)))),n}};function createBaseFormalityModePropertyValue(){return{$type:"deepl.pb.interactive_text_api.translator.FormalityModePropertyValue",formalityMode:void 0}}const FormalityModePropertyValue={$type:"deepl.pb.interactive_text_api.translator.FormalityModePropertyValue",encode:(e,t=_m0.Writer.create())=>(void 0!==e.formalityMode&&FormalityMode.encode(e.formalityMode,t.uint32(10).fork()).ldelim(),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseFormalityModePropertyValue();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.formalityMode=FormalityMode.decode(n,n.uint32());continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:FormalityModePropertyValue.$type,formalityMode:isSet$1(e.formalityMode)?FormalityMode.fromJSON(e.formalityMode):void 0}),toJSON(e){const t={};return void 0!==e.formalityMode&&(t.formalityMode=FormalityMode.toJSON(e.formalityMode)),t}};function createBaseLanguageModelsPropertyValue(){return{$type:"deepl.pb.interactive_text_api.translator.LanguageModelsPropertyValue",languageModels:[]}}const LanguageModelsPropertyValue={$type:"deepl.pb.interactive_text_api.translator.LanguageModelsPropertyValue",encode(e,t=_m0.Writer.create()){for(const n of e.languageModels)LanguageModel.encode(n,t.uint32(10).fork()).ldelim();return t},decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseLanguageModelsPropertyValue();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.languageModels.push(LanguageModel.decode(n,n.uint32()));continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:LanguageModelsPropertyValue.$type,languageModels:globalThis.Array.isArray(null==e?void 0:e.languageModels)?e.languageModels.map((e=>LanguageModel.fromJSON(e))):[]}),toJSON(e){var t;const n={};return(null===(t=e.languageModels)||void 0===t?void 0:t.length)&&(n.languageModels=e.languageModels.map((e=>LanguageModel.toJSON(e)))),n}};function createBaseLanguageModelPropertyValue(){return{$type:"deepl.pb.interactive_text_api.translator.LanguageModelPropertyValue",languageModel:void 0}}const LanguageModelPropertyValue={$type:"deepl.pb.interactive_text_api.translator.LanguageModelPropertyValue",encode:(e,t=_m0.Writer.create())=>(void 0!==e.languageModel&&LanguageModel.encode(e.languageModel,t.uint32(10).fork()).ldelim(),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseLanguageModelPropertyValue();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.languageModel=LanguageModel.decode(n,n.uint32());continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:LanguageModelPropertyValue.$type,languageModel:isSet$1(e.languageModel)?LanguageModel.fromJSON(e.languageModel):void 0}),toJSON(e){const t={};return void 0!==e.languageModel&&(t.languageModel=LanguageModel.toJSON(e.languageModel)),t}};function createBaseGlossarySupportPropertyValue(){return{$type:"deepl.pb.interactive_text_api.translator.GlossarySupportPropertyValue"}}const GlossarySupportPropertyValue={$type:"deepl.pb.interactive_text_api.translator.GlossarySupportPropertyValue",encode:(e,t=_m0.Writer.create())=>t,decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseGlossarySupportPropertyValue();for(;n.pos<r;){const e=n.uint32();if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:GlossarySupportPropertyValue.$type}),toJSON:e=>({})};function createBaseGlossaryIdPropertyValue(){return{$type:"deepl.pb.interactive_text_api.translator.GlossaryIdPropertyValue",glossaryId:void 0}}const GlossaryIdPropertyValue={$type:"deepl.pb.interactive_text_api.translator.GlossaryIdPropertyValue",encode:(e,t=_m0.Writer.create())=>(void 0!==e.glossaryId&&GlossaryId.encode(e.glossaryId,t.uint32(10).fork()).ldelim(),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseGlossaryIdPropertyValue();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.glossaryId=GlossaryId.decode(n,n.uint32());continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:GlossaryIdPropertyValue.$type,glossaryId:isSet$1(e.glossaryId)?GlossaryId.fromJSON(e.glossaryId):void 0}),toJSON(e){const t={};return void 0!==e.glossaryId&&(t.glossaryId=GlossaryId.toJSON(e.glossaryId)),t}};function createBaseTextDirectionPropertyValue(){return{$type:"deepl.pb.interactive_text_api.translator.TextDirectionPropertyValue",textDirection:0}}const TextDirectionPropertyValue={$type:"deepl.pb.interactive_text_api.translator.TextDirectionPropertyValue",encode:(e,t=_m0.Writer.create())=>(0!==e.textDirection&&t.uint32(8).int32(e.textDirection),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseTextDirectionPropertyValue();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(8!==e)break;o.textDirection=n.int32();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:TextDirectionPropertyValue.$type,textDirection:isSet$1(e.textDirection)?textDirectionFromJSON(e.textDirection):0}),toJSON(e){const t={};return 0!==e.textDirection&&(t.textDirection=textDirectionToJSON(e.textDirection)),t}};function createBaseMaximumTextLengthPropertyValue(){return{$type:"deepl.pb.interactive_text_api.translator.MaximumTextLengthPropertyValue",max:0}}const MaximumTextLengthPropertyValue={$type:"deepl.pb.interactive_text_api.translator.MaximumTextLengthPropertyValue",encode:(e,t=_m0.Writer.create())=>(0!==e.max&&t.uint32(8).int32(e.max),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseMaximumTextLengthPropertyValue();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(8!==e)break;o.max=n.int32();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:MaximumTextLengthPropertyValue.$type,max:isSet$1(e.max)?globalThis.Number(e.max):0}),toJSON(e){const t={};return 0!==e.max&&(t.max=Math.round(e.max)),t}};function createBaseSessionOptions(){return{$type:"deepl.pb.interactive_text_api.translator.SessionOptions",enableTranscription:!1}}const SessionOptions={$type:"deepl.pb.interactive_text_api.translator.SessionOptions",encode:(e,t=_m0.Writer.create())=>(!1!==e.enableTranscription&&t.uint32(8).bool(e.enableTranscription),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseSessionOptions();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(8!==e)break;o.enableTranscription=n.bool();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:SessionOptions.$type,enableTranscription:!!isSet$1(e.enableTranscription)&&globalThis.Boolean(e.enableTranscription)}),toJSON(e){const t={};return!1!==e.enableTranscription&&(t.enableTranscription=e.enableTranscription),t}};function createBaseFormalityMode(){return{$type:"deepl.pb.interactive_text_api.translator.FormalityMode",value:""}}const FormalityMode={$type:"deepl.pb.interactive_text_api.translator.FormalityMode",encode:(e,t=_m0.Writer.create())=>(""!==e.value&&t.uint32(10).string(e.value),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseFormalityMode();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.value=n.string();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:FormalityMode.$type,value:isSet$1(e.value)?globalThis.String(e.value):""}),toJSON(e){const t={};return""!==e.value&&(t.value=e.value),t}};function createBaseLanguageModel(){return{$type:"deepl.pb.interactive_text_api.translator.LanguageModel",value:""}}const LanguageModel={$type:"deepl.pb.interactive_text_api.translator.LanguageModel",encode:(e,t=_m0.Writer.create())=>(""!==e.value&&t.uint32(10).string(e.value),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseLanguageModel();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.value=n.string();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:LanguageModel.$type,value:isSet$1(e.value)?globalThis.String(e.value):""}),toJSON(e){const t={};return""!==e.value&&(t.value=e.value),t}};function createBaseGlossaryId(){return{$type:"deepl.pb.interactive_text_api.translator.GlossaryId",id:""}}const GlossaryId={$type:"deepl.pb.interactive_text_api.translator.GlossaryId",encode:(e,t=_m0.Writer.create())=>(""!==e.id&&t.uint32(10).string(e.id),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseGlossaryId();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.id=n.string();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:GlossaryId.$type,id:isSet$1(e.id)?globalThis.String(e.id):""}),toJSON(e){const t={};return""!==e.id&&(t.id=e.id),t}};function createBaseGlossaryEntry(){return{$type:"deepl.pb.interactive_text_api.translator.GlossaryEntry",source:"",target:""}}const GlossaryEntry={$type:"deepl.pb.interactive_text_api.translator.GlossaryEntry",encode:(e,t=_m0.Writer.create())=>(""!==e.source&&t.uint32(10).string(e.source),""!==e.target&&t.uint32(18).string(e.target),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseGlossaryEntry();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.source=n.string();continue;case 2:if(18!==e)break;o.target=n.string();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:GlossaryEntry.$type,source:isSet$1(e.source)?globalThis.String(e.source):"",target:isSet$1(e.target)?globalThis.String(e.target):""}),toJSON(e){const t={};return""!==e.source&&(t.source=e.source),""!==e.target&&(t.target=e.target),t}};function createBaseGlossaryList(){return{$type:"deepl.pb.interactive_text_api.translator.GlossaryList",glossaryEntries:[]}}const GlossaryList={$type:"deepl.pb.interactive_text_api.translator.GlossaryList",encode(e,t=_m0.Writer.create()){for(const n of e.glossaryEntries)GlossaryEntry.encode(n,t.uint32(10).fork()).ldelim();return t},decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseGlossaryList();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.glossaryEntries.push(GlossaryEntry.decode(n,n.uint32()));continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:GlossaryList.$type,glossaryEntries:globalThis.Array.isArray(null==e?void 0:e.glossaryEntries)?e.glossaryEntries.map((e=>GlossaryEntry.fromJSON(e))):[]}),toJSON(e){var t;const n={};return(null===(t=e.glossaryEntries)||void 0===t?void 0:t.length)&&(n.glossaryEntries=e.glossaryEntries.map((e=>GlossaryEntry.toJSON(e)))),n}};function createBaseSourceLanguage(){return{$type:"deepl.pb.interactive_text_api.translator.SourceLanguage",code:""}}const SourceLanguage={$type:"deepl.pb.interactive_text_api.translator.SourceLanguage",encode:(e,t=_m0.Writer.create())=>(""!==e.code&&t.uint32(10).string(e.code),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseSourceLanguage();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.code=n.string();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:SourceLanguage.$type,code:isSet$1(e.code)?globalThis.String(e.code):""}),toJSON(e){const t={};return""!==e.code&&(t.code=e.code),t}};function createBaseTargetLanguage(){return{$type:"deepl.pb.interactive_text_api.translator.TargetLanguage",code:""}}const TargetLanguage={$type:"deepl.pb.interactive_text_api.translator.TargetLanguage",encode:(e,t=_m0.Writer.create())=>(""!==e.code&&t.uint32(10).string(e.code),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseTargetLanguage();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.code=n.string();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:TargetLanguage.$type,code:isSet$1(e.code)?globalThis.String(e.code):""}),toJSON(e){const t={};return""!==e.code&&(t.code=e.code),t}};function createBaseTextUnitId(){return{$type:"deepl.pb.interactive_text_api.translator.TextUnitId",value:""}}const TextUnitId={$type:"deepl.pb.interactive_text_api.translator.TextUnitId",encode:(e,t=_m0.Writer.create())=>(""!==e.value&&t.uint32(10).string(e.value),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseTextUnitId();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.value=n.string();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:TextUnitId.$type,value:isSet$1(e.value)?globalThis.String(e.value):""}),toJSON(e){const t={};return""!==e.value&&(t.value=e.value),t}};function createBaseWordAlternative(){return{$type:"deepl.pb.interactive_text_api.translator.WordAlternative",text:""}}const WordAlternative={$type:"deepl.pb.interactive_text_api.translator.WordAlternative",encode:(e,t=_m0.Writer.create())=>(""!==e.text&&t.uint32(10).string(e.text),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseWordAlternative();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.text=n.string();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:WordAlternative.$type,text:isSet$1(e.text)?globalThis.String(e.text):""}),toJSON(e){const t={};return""!==e.text&&(t.text=e.text),t}};function createBaseWordAlternativesFlowId(){return{$type:"deepl.pb.interactive_text_api.translator.WordAlternativesFlowId",value:""}}const WordAlternativesFlowId={$type:"deepl.pb.interactive_text_api.translator.WordAlternativesFlowId",encode:(e,t=_m0.Writer.create())=>(""!==e.value&&t.uint32(10).string(e.value),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseWordAlternativesFlowId();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.value=n.string();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:WordAlternativesFlowId.$type,value:isSet$1(e.value)?globalThis.String(e.value):""}),toJSON(e){const t={};return""!==e.value&&(t.value=e.value),t}};function createBaseTextUnitAlternative(){return{$type:"deepl.pb.interactive_text_api.translator.TextUnitAlternative",text:"",glossaryHighlights:[],transcription:""}}const TextUnitAlternative={$type:"deepl.pb.interactive_text_api.translator.TextUnitAlternative",encode(e,t=_m0.Writer.create()){""!==e.text&&t.uint32(10).string(e.text);for(const n of e.glossaryHighlights)GlossaryHighlight.encode(n,t.uint32(18).fork()).ldelim();return""!==e.transcription&&t.uint32(26).string(e.transcription),t},decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseTextUnitAlternative();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.text=n.string();continue;case 2:if(18!==e)break;o.glossaryHighlights.push(GlossaryHighlight.decode(n,n.uint32()));continue;case 3:if(26!==e)break;o.transcription=n.string();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:TextUnitAlternative.$type,text:isSet$1(e.text)?globalThis.String(e.text):"",glossaryHighlights:globalThis.Array.isArray(null==e?void 0:e.glossaryHighlights)?e.glossaryHighlights.map((e=>GlossaryHighlight.fromJSON(e))):[],transcription:isSet$1(e.transcription)?globalThis.String(e.transcription):""}),toJSON(e){var t;const n={};return""!==e.text&&(n.text=e.text),(null===(t=e.glossaryHighlights)||void 0===t?void 0:t.length)&&(n.glossaryHighlights=e.glossaryHighlights.map((e=>GlossaryHighlight.toJSON(e)))),""!==e.transcription&&(n.transcription=e.transcription),n}};function createBaseGlossaryHighlight(){return{$type:"deepl.pb.interactive_text_api.translator.GlossaryHighlight",entry:void 0,ranges:[]}}const GlossaryHighlight={$type:"deepl.pb.interactive_text_api.translator.GlossaryHighlight",encode(e,t=_m0.Writer.create()){void 0!==e.entry&&GlossaryEntry.encode(e.entry,t.uint32(10).fork()).ldelim();for(const n of e.ranges)TextRange.encode(n,t.uint32(18).fork()).ldelim();return t},decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseGlossaryHighlight();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.entry=GlossaryEntry.decode(n,n.uint32());continue;case 2:if(18!==e)break;o.ranges.push(TextRange.decode(n,n.uint32()));continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:GlossaryHighlight.$type,entry:isSet$1(e.entry)?GlossaryEntry.fromJSON(e.entry):void 0,ranges:globalThis.Array.isArray(null==e?void 0:e.ranges)?e.ranges.map((e=>TextRange.fromJSON(e))):[]}),toJSON(e){var t;const n={};return void 0!==e.entry&&(n.entry=GlossaryEntry.toJSON(e.entry)),(null===(t=e.ranges)||void 0===t?void 0:t.length)&&(n.ranges=e.ranges.map((e=>TextRange.toJSON(e)))),n}};function createBaseTextUnitAlternativesFlowId(){return{$type:"deepl.pb.interactive_text_api.translator.TextUnitAlternativesFlowId",value:""}}const TextUnitAlternativesFlowId={$type:"deepl.pb.interactive_text_api.translator.TextUnitAlternativesFlowId",encode:(e,t=_m0.Writer.create())=>(""!==e.value&&t.uint32(10).string(e.value),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseTextUnitAlternativesFlowId();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.value=n.string();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:TextUnitAlternativesFlowId.$type,value:isSet$1(e.value)?globalThis.String(e.value):""}),toJSON(e){const t={};return""!==e.value&&(t.value=e.value),t}};function createBaseAutocompletionFlowId(){return{$type:"deepl.pb.interactive_text_api.translator.AutocompletionFlowId",value:""}}const AutocompletionFlowId={$type:"deepl.pb.interactive_text_api.translator.AutocompletionFlowId",encode:(e,t=_m0.Writer.create())=>(""!==e.value&&t.uint32(10).string(e.value),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseAutocompletionFlowId();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.value=n.string();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:AutocompletionFlowId.$type,value:isSet$1(e.value)?globalThis.String(e.value):""}),toJSON(e){const t={};return""!==e.value&&(t.value=e.value),t}};function isSet$1(e){return null!=e}var FieldName,PropertyName,SessionMode;function fieldNameFromJSON(e){switch(e){case 0:case"FIELD_NAME_UNSPECIFIED":return FieldName.UNSPECIFIED;case 1:case"FIELD_NAME_TRANSLATOR_SOURCE_TEXT":return FieldName.TRANSLATOR_SOURCE_TEXT;case 2:case"FIELD_NAME_TRANSLATOR_TARGET_TEXT":return FieldName.TRANSLATOR_TARGET_TEXT;case 4:case"FIELD_NAME_TRANSLATOR_TARGET_TRANSCRIPTION_TEXT":return FieldName.TRANSLATOR_TARGET_TRANSCRIPTION_TEXT;default:throw new globalThis.Error("Unrecognized enum value "+e+" for enum FieldName")}}function fieldNameToJSON(e){switch(e){case FieldName.UNSPECIFIED:return"FIELD_NAME_UNSPECIFIED";case FieldName.TRANSLATOR_SOURCE_TEXT:return"FIELD_NAME_TRANSLATOR_SOURCE_TEXT";case FieldName.TRANSLATOR_TARGET_TEXT:return"FIELD_NAME_TRANSLATOR_TARGET_TEXT";case FieldName.TRANSLATOR_TARGET_TRANSCRIPTION_TEXT:return"FIELD_NAME_TRANSLATOR_TARGET_TRANSCRIPTION_TEXT";default:throw new globalThis.Error("Unrecognized enum value "+e+" for enum FieldName")}}function propertyNameFromJSON(e){switch(e){case 0:case"PROPERTY_NAME_UNSPECIFIED":return PropertyName.UNSPECIFIED;case 1:case"PROPERTY_NAME_TRANSLATOR_SOURCE_LANGUAGES":return PropertyName.TRANSLATOR_SOURCE_LANGUAGES;case 2:case"PROPERTY_NAME_TRANSLATOR_TARGET_LANGUAGES":return PropertyName.TRANSLATOR_TARGET_LANGUAGES;case 3:case"PROPERTY_NAME_TRANSLATOR_REQUESTED_SOURCE_LANGUAGE":return PropertyName.TRANSLATOR_REQUESTED_SOURCE_LANGUAGE;case 4:case"PROPERTY_NAME_TRANSLATOR_CALCULATED_SOURCE_LANGUAGE":return PropertyName.TRANSLATOR_CALCULATED_SOURCE_LANGUAGE;case 5:case"PROPERTY_NAME_TRANSLATOR_REQUESTED_TARGET_LANGUAGE":return PropertyName.TRANSLATOR_REQUESTED_TARGET_LANGUAGE;case 7:case"PROPERTY_NAME_TRANSLATOR_FORMALITY_MODES":return PropertyName.TRANSLATOR_FORMALITY_MODES;case 8:case"PROPERTY_NAME_TRANSLATOR_FORMALITY_MODE":return PropertyName.TRANSLATOR_FORMALITY_MODE;case 9:case"PROPERTY_NAME_TRANSLATOR_GLOSSARY_SUPPORT":return PropertyName.TRANSLATOR_GLOSSARY_SUPPORT;case 10:case"PROPERTY_NAME_TRANSLATOR_GLOSSARY_LIST":return PropertyName.TRANSLATOR_GLOSSARY_LIST;case 12:case"PROPERTY_NAME_TRANSLATOR_TEXT_DIRECTION":return PropertyName.TRANSLATOR_TEXT_DIRECTION;case 13:case"PROPERTY_NAME_TRANSLATOR_GLOSSARY_SUGGESTIONS":return PropertyName.TRANSLATOR_GLOSSARY_SUGGESTIONS;case 14:case"PROPERTY_NAME_MAXIMUM_TEXT_LENGTH":return PropertyName.MAXIMUM_TEXT_LENGTH;case 15:case"PROPERTY_NAME_TRANSLATOR_LANGUAGE_MODELS":return PropertyName.TRANSLATOR_LANGUAGE_MODELS;case 16:case"PROPERTY_NAME_TRANSLATOR_LANGUAGE_MODEL":return PropertyName.TRANSLATOR_LANGUAGE_MODEL;case 17:case"PROPERTY_NAME_TRANSLATOR_GLOSSARY_ID":return PropertyName.TRANSLATOR_GLOSSARY_ID;case 18:case"PROPERTY_NAME_TRANSLATOR_CALCULATED_TARGET_LANGUAGE":return PropertyName.TRANSLATOR_CALCULATED_TARGET_LANGUAGE;default:throw new globalThis.Error("Unrecognized enum value "+e+" for enum PropertyName")}}function propertyNameToJSON(e){switch(e){case PropertyName.UNSPECIFIED:return"PROPERTY_NAME_UNSPECIFIED";case PropertyName.TRANSLATOR_SOURCE_LANGUAGES:return"PROPERTY_NAME_TRANSLATOR_SOURCE_LANGUAGES";case PropertyName.TRANSLATOR_TARGET_LANGUAGES:return"PROPERTY_NAME_TRANSLATOR_TARGET_LANGUAGES";case PropertyName.TRANSLATOR_REQUESTED_SOURCE_LANGUAGE:return"PROPERTY_NAME_TRANSLATOR_REQUESTED_SOURCE_LANGUAGE";case PropertyName.TRANSLATOR_CALCULATED_SOURCE_LANGUAGE:return"PROPERTY_NAME_TRANSLATOR_CALCULATED_SOURCE_LANGUAGE";case PropertyName.TRANSLATOR_REQUESTED_TARGET_LANGUAGE:return"PROPERTY_NAME_TRANSLATOR_REQUESTED_TARGET_LANGUAGE";case PropertyName.TRANSLATOR_FORMALITY_MODES:return"PROPERTY_NAME_TRANSLATOR_FORMALITY_MODES";case PropertyName.TRANSLATOR_FORMALITY_MODE:return"PROPERTY_NAME_TRANSLATOR_FORMALITY_MODE";case PropertyName.TRANSLATOR_GLOSSARY_SUPPORT:return"PROPERTY_NAME_TRANSLATOR_GLOSSARY_SUPPORT";case PropertyName.TRANSLATOR_GLOSSARY_LIST:return"PROPERTY_NAME_TRANSLATOR_GLOSSARY_LIST";case PropertyName.TRANSLATOR_TEXT_DIRECTION:return"PROPERTY_NAME_TRANSLATOR_TEXT_DIRECTION";case PropertyName.TRANSLATOR_GLOSSARY_SUGGESTIONS:return"PROPERTY_NAME_TRANSLATOR_GLOSSARY_SUGGESTIONS";case PropertyName.MAXIMUM_TEXT_LENGTH:return"PROPERTY_NAME_MAXIMUM_TEXT_LENGTH";case PropertyName.TRANSLATOR_LANGUAGE_MODELS:return"PROPERTY_NAME_TRANSLATOR_LANGUAGE_MODELS";case PropertyName.TRANSLATOR_LANGUAGE_MODEL:return"PROPERTY_NAME_TRANSLATOR_LANGUAGE_MODEL";case PropertyName.TRANSLATOR_GLOSSARY_ID:return"PROPERTY_NAME_TRANSLATOR_GLOSSARY_ID";case PropertyName.TRANSLATOR_CALCULATED_TARGET_LANGUAGE:return"PROPERTY_NAME_TRANSLATOR_CALCULATED_TARGET_LANGUAGE";default:throw new globalThis.Error("Unrecognized enum value "+e+" for enum PropertyName")}}function sessionModeFromJSON(e){switch(e){case 0:case"SESSION_MODE_UNSPECIFIED":return SessionMode.UNSPECIFIED;case 1:case"SESSION_MODE_TRANSLATOR":return SessionMode.TRANSLATOR;case 2:case"SESSION_MODE_WRITE":return SessionMode.WRITE;default:throw new globalThis.Error("Unrecognized enum value "+e+" for enum SessionMode")}}function sessionModeToJSON(e){switch(e){case SessionMode.UNSPECIFIED:return"SESSION_MODE_UNSPECIFIED";case SessionMode.TRANSLATOR:return"SESSION_MODE_TRANSLATOR";case SessionMode.WRITE:return"SESSION_MODE_WRITE";default:throw new globalThis.Error("Unrecognized enum value "+e+" for enum SessionMode")}}function createBaseTextChangeOperation(){return{$type:"deepl.pb.interactive_text_api.TextChangeOperation",range:void 0,text:""}}!function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.TRANSLATOR_SOURCE_TEXT=1]="TRANSLATOR_SOURCE_TEXT",e[e.TRANSLATOR_TARGET_TEXT=2]="TRANSLATOR_TARGET_TEXT",e[e.TRANSLATOR_TARGET_TRANSCRIPTION_TEXT=4]="TRANSLATOR_TARGET_TRANSCRIPTION_TEXT"}(FieldName||(FieldName={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.TRANSLATOR_SOURCE_LANGUAGES=1]="TRANSLATOR_SOURCE_LANGUAGES",e[e.TRANSLATOR_TARGET_LANGUAGES=2]="TRANSLATOR_TARGET_LANGUAGES",e[e.TRANSLATOR_REQUESTED_SOURCE_LANGUAGE=3]="TRANSLATOR_REQUESTED_SOURCE_LANGUAGE",e[e.TRANSLATOR_CALCULATED_SOURCE_LANGUAGE=4]="TRANSLATOR_CALCULATED_SOURCE_LANGUAGE",e[e.TRANSLATOR_REQUESTED_TARGET_LANGUAGE=5]="TRANSLATOR_REQUESTED_TARGET_LANGUAGE",e[e.TRANSLATOR_FORMALITY_MODES=7]="TRANSLATOR_FORMALITY_MODES",e[e.TRANSLATOR_FORMALITY_MODE=8]="TRANSLATOR_FORMALITY_MODE",e[e.TRANSLATOR_GLOSSARY_SUPPORT=9]="TRANSLATOR_GLOSSARY_SUPPORT",e[e.TRANSLATOR_GLOSSARY_LIST=10]="TRANSLATOR_GLOSSARY_LIST",e[e.TRANSLATOR_TEXT_DIRECTION=12]="TRANSLATOR_TEXT_DIRECTION",e[e.TRANSLATOR_GLOSSARY_SUGGESTIONS=13]="TRANSLATOR_GLOSSARY_SUGGESTIONS",e[e.MAXIMUM_TEXT_LENGTH=14]="MAXIMUM_TEXT_LENGTH",e[e.TRANSLATOR_LANGUAGE_MODELS=15]="TRANSLATOR_LANGUAGE_MODELS",e[e.TRANSLATOR_LANGUAGE_MODEL=16]="TRANSLATOR_LANGUAGE_MODEL",e[e.TRANSLATOR_GLOSSARY_ID=17]="TRANSLATOR_GLOSSARY_ID",e[e.TRANSLATOR_CALCULATED_TARGET_LANGUAGE=18]="TRANSLATOR_CALCULATED_TARGET_LANGUAGE"}(PropertyName||(PropertyName={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.TRANSLATOR=1]="TRANSLATOR",e[e.WRITE=2]="WRITE"}(SessionMode||(SessionMode={}));const TextChangeOperation={$type:"deepl.pb.interactive_text_api.TextChangeOperation",encode:(e,t=_m0.Writer.create())=>(void 0!==e.range&&TextRange.encode(e.range,t.uint32(10).fork()).ldelim(),""!==e.text&&t.uint32(18).string(e.text),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseTextChangeOperation();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.range=TextRange.decode(n,n.uint32());continue;case 2:if(18!==e)break;o.text=n.string();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:TextChangeOperation.$type,range:isSet(e.range)?TextRange.fromJSON(e.range):void 0,text:isSet(e.text)?globalThis.String(e.text):""}),toJSON(e){const t={};return void 0!==e.range&&(t.range=TextRange.toJSON(e.range)),""!==e.text&&(t.text=e.text),t}};function createBaseCreateAnnotationOperation(){return{$type:"deepl.pb.interactive_text_api.CreateAnnotationOperation",annotationId:void 0,range:void 0,translatorTextUnitPayload:void 0,translatorRequestWordAlternativesPayload:void 0,translatorProvidedWordAlternativesPayload:void 0,translatorSelectWordAlternativePayload:void 0,translatorGlossaryReplacementPayload:void 0,translatorRequestTextUnitAlternativesPayload:void 0,translatorProvidedTextUnitAlternativesPayload:void 0,translatorSelectTextUnitAlternativePayload:void 0,translatorRequestAutocompletionPayload:void 0,translatorProvidedAutocompletionPayload:void 0,translatorSelectAutocompletionPayload:void 0,translatorProvidedAutomaticTextUnitAlternativesPayload:void 0,translatorSelectAutomaticTextUnitAlternativePayload:void 0}}const CreateAnnotationOperation={$type:"deepl.pb.interactive_text_api.CreateAnnotationOperation",encode:(e,t=_m0.Writer.create())=>(void 0!==e.annotationId&&AnnotationId.encode(e.annotationId,t.uint32(10).fork()).ldelim(),void 0!==e.range&&TextRange.encode(e.range,t.uint32(18).fork()).ldelim(),void 0!==e.translatorTextUnitPayload&&TextUnitAnnotationPayload.encode(e.translatorTextUnitPayload,t.uint32(26).fork()).ldelim(),void 0!==e.translatorRequestWordAlternativesPayload&&RequestWordAlternativesAnnotationPayload.encode(e.translatorRequestWordAlternativesPayload,t.uint32(34).fork()).ldelim(),void 0!==e.translatorProvidedWordAlternativesPayload&&ProvidedWordAlternativesAnnotationPayload.encode(e.translatorProvidedWordAlternativesPayload,t.uint32(42).fork()).ldelim(),void 0!==e.translatorSelectWordAlternativePayload&&SelectWordAlternativeAnnotationPayload.encode(e.translatorSelectWordAlternativePayload,t.uint32(50).fork()).ldelim(),void 0!==e.translatorGlossaryReplacementPayload&&GlossaryReplacementAnnotationPayload.encode(e.translatorGlossaryReplacementPayload,t.uint32(58).fork()).ldelim(),void 0!==e.translatorRequestTextUnitAlternativesPayload&&RequestTextUnitAlternativesAnnotationPayload.encode(e.translatorRequestTextUnitAlternativesPayload,t.uint32(66).fork()).ldelim(),void 0!==e.translatorProvidedTextUnitAlternativesPayload&&ProvidedTextUnitAlternativesAnnotationPayload.encode(e.translatorProvidedTextUnitAlternativesPayload,t.uint32(74).fork()).ldelim(),void 0!==e.translatorSelectTextUnitAlternativePayload&&SelectTextUnitAlternativeAnnotationPayload.encode(e.translatorSelectTextUnitAlternativePayload,t.uint32(82).fork()).ldelim(),void 0!==e.translatorRequestAutocompletionPayload&&RequestAutocompletionAnnotationPayload.encode(e.translatorRequestAutocompletionPayload,t.uint32(90).fork()).ldelim(),void 0!==e.translatorProvidedAutocompletionPayload&&ProvidedAutocompletionAnnotationPayload.encode(e.translatorProvidedAutocompletionPayload,t.uint32(98).fork()).ldelim(),void 0!==e.translatorSelectAutocompletionPayload&&SelectAutocompletionAnnotationPayload.encode(e.translatorSelectAutocompletionPayload,t.uint32(106).fork()).ldelim(),void 0!==e.translatorProvidedAutomaticTextUnitAlternativesPayload&&ProvidedAutomaticTextUnitAlternativesAnnotationPayload.encode(e.translatorProvidedAutomaticTextUnitAlternativesPayload,t.uint32(114).fork()).ldelim(),void 0!==e.translatorSelectAutomaticTextUnitAlternativePayload&&SelectAutomaticTextUnitAlternativeAnnotationPayload.encode(e.translatorSelectAutomaticTextUnitAlternativePayload,t.uint32(122).fork()).ldelim(),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseCreateAnnotationOperation();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.annotationId=AnnotationId.decode(n,n.uint32());continue;case 2:if(18!==e)break;o.range=TextRange.decode(n,n.uint32());continue;case 3:if(26!==e)break;o.translatorTextUnitPayload=TextUnitAnnotationPayload.decode(n,n.uint32());continue;case 4:if(34!==e)break;o.translatorRequestWordAlternativesPayload=RequestWordAlternativesAnnotationPayload.decode(n,n.uint32());continue;case 5:if(42!==e)break;o.translatorProvidedWordAlternativesPayload=ProvidedWordAlternativesAnnotationPayload.decode(n,n.uint32());continue;case 6:if(50!==e)break;o.translatorSelectWordAlternativePayload=SelectWordAlternativeAnnotationPayload.decode(n,n.uint32());continue;case 7:if(58!==e)break;o.translatorGlossaryReplacementPayload=GlossaryReplacementAnnotationPayload.decode(n,n.uint32());continue;case 8:if(66!==e)break;o.translatorRequestTextUnitAlternativesPayload=RequestTextUnitAlternativesAnnotationPayload.decode(n,n.uint32());continue;case 9:if(74!==e)break;o.translatorProvidedTextUnitAlternativesPayload=ProvidedTextUnitAlternativesAnnotationPayload.decode(n,n.uint32());continue;case 10:if(82!==e)break;o.translatorSelectTextUnitAlternativePayload=SelectTextUnitAlternativeAnnotationPayload.decode(n,n.uint32());continue;case 11:if(90!==e)break;o.translatorRequestAutocompletionPayload=RequestAutocompletionAnnotationPayload.decode(n,n.uint32());continue;case 12:if(98!==e)break;o.translatorProvidedAutocompletionPayload=ProvidedAutocompletionAnnotationPayload.decode(n,n.uint32());continue;case 13:if(106!==e)break;o.translatorSelectAutocompletionPayload=SelectAutocompletionAnnotationPayload.decode(n,n.uint32());continue;case 14:if(114!==e)break;o.translatorProvidedAutomaticTextUnitAlternativesPayload=ProvidedAutomaticTextUnitAlternativesAnnotationPayload.decode(n,n.uint32());continue;case 15:if(122!==e)break;o.translatorSelectAutomaticTextUnitAlternativePayload=SelectAutomaticTextUnitAlternativeAnnotationPayload.decode(n,n.uint32());continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:CreateAnnotationOperation.$type,annotationId:isSet(e.annotationId)?AnnotationId.fromJSON(e.annotationId):void 0,range:isSet(e.range)?TextRange.fromJSON(e.range):void 0,translatorTextUnitPayload:isSet(e.translatorTextUnitPayload)?TextUnitAnnotationPayload.fromJSON(e.translatorTextUnitPayload):void 0,translatorRequestWordAlternativesPayload:isSet(e.translatorRequestWordAlternativesPayload)?RequestWordAlternativesAnnotationPayload.fromJSON(e.translatorRequestWordAlternativesPayload):void 0,translatorProvidedWordAlternativesPayload:isSet(e.translatorProvidedWordAlternativesPayload)?ProvidedWordAlternativesAnnotationPayload.fromJSON(e.translatorProvidedWordAlternativesPayload):void 0,translatorSelectWordAlternativePayload:isSet(e.translatorSelectWordAlternativePayload)?SelectWordAlternativeAnnotationPayload.fromJSON(e.translatorSelectWordAlternativePayload):void 0,translatorGlossaryReplacementPayload:isSet(e.translatorGlossaryReplacementPayload)?GlossaryReplacementAnnotationPayload.fromJSON(e.translatorGlossaryReplacementPayload):void 0,translatorRequestTextUnitAlternativesPayload:isSet(e.translatorRequestTextUnitAlternativesPayload)?RequestTextUnitAlternativesAnnotationPayload.fromJSON(e.translatorRequestTextUnitAlternativesPayload):void 0,translatorProvidedTextUnitAlternativesPayload:isSet(e.translatorProvidedTextUnitAlternativesPayload)?ProvidedTextUnitAlternativesAnnotationPayload.fromJSON(e.translatorProvidedTextUnitAlternativesPayload):void 0,translatorSelectTextUnitAlternativePayload:isSet(e.translatorSelectTextUnitAlternativePayload)?SelectTextUnitAlternativeAnnotationPayload.fromJSON(e.translatorSelectTextUnitAlternativePayload):void 0,translatorRequestAutocompletionPayload:isSet(e.translatorRequestAutocompletionPayload)?RequestAutocompletionAnnotationPayload.fromJSON(e.translatorRequestAutocompletionPayload):void 0,translatorProvidedAutocompletionPayload:isSet(e.translatorProvidedAutocompletionPayload)?ProvidedAutocompletionAnnotationPayload.fromJSON(e.translatorProvidedAutocompletionPayload):void 0,translatorSelectAutocompletionPayload:isSet(e.translatorSelectAutocompletionPayload)?SelectAutocompletionAnnotationPayload.fromJSON(e.translatorSelectAutocompletionPayload):void 0,translatorProvidedAutomaticTextUnitAlternativesPayload:isSet(e.translatorProvidedAutomaticTextUnitAlternativesPayload)?ProvidedAutomaticTextUnitAlternativesAnnotationPayload.fromJSON(e.translatorProvidedAutomaticTextUnitAlternativesPayload):void 0,translatorSelectAutomaticTextUnitAlternativePayload:isSet(e.translatorSelectAutomaticTextUnitAlternativePayload)?SelectAutomaticTextUnitAlternativeAnnotationPayload.fromJSON(e.translatorSelectAutomaticTextUnitAlternativePayload):void 0}),toJSON(e){const t={};return void 0!==e.annotationId&&(t.annotationId=AnnotationId.toJSON(e.annotationId)),void 0!==e.range&&(t.range=TextRange.toJSON(e.range)),void 0!==e.translatorTextUnitPayload&&(t.translatorTextUnitPayload=TextUnitAnnotationPayload.toJSON(e.translatorTextUnitPayload)),void 0!==e.translatorRequestWordAlternativesPayload&&(t.translatorRequestWordAlternativesPayload=RequestWordAlternativesAnnotationPayload.toJSON(e.translatorRequestWordAlternativesPayload)),void 0!==e.translatorProvidedWordAlternativesPayload&&(t.translatorProvidedWordAlternativesPayload=ProvidedWordAlternativesAnnotationPayload.toJSON(e.translatorProvidedWordAlternativesPayload)),void 0!==e.translatorSelectWordAlternativePayload&&(t.translatorSelectWordAlternativePayload=SelectWordAlternativeAnnotationPayload.toJSON(e.translatorSelectWordAlternativePayload)),void 0!==e.translatorGlossaryReplacementPayload&&(t.translatorGlossaryReplacementPayload=GlossaryReplacementAnnotationPayload.toJSON(e.translatorGlossaryReplacementPayload)),void 0!==e.translatorRequestTextUnitAlternativesPayload&&(t.translatorRequestTextUnitAlternativesPayload=RequestTextUnitAlternativesAnnotationPayload.toJSON(e.translatorRequestTextUnitAlternativesPayload)),void 0!==e.translatorProvidedTextUnitAlternativesPayload&&(t.translatorProvidedTextUnitAlternativesPayload=ProvidedTextUnitAlternativesAnnotationPayload.toJSON(e.translatorProvidedTextUnitAlternativesPayload)),void 0!==e.translatorSelectTextUnitAlternativePayload&&(t.translatorSelectTextUnitAlternativePayload=SelectTextUnitAlternativeAnnotationPayload.toJSON(e.translatorSelectTextUnitAlternativePayload)),void 0!==e.translatorRequestAutocompletionPayload&&(t.translatorRequestAutocompletionPayload=RequestAutocompletionAnnotationPayload.toJSON(e.translatorRequestAutocompletionPayload)),void 0!==e.translatorProvidedAutocompletionPayload&&(t.translatorProvidedAutocompletionPayload=ProvidedAutocompletionAnnotationPayload.toJSON(e.translatorProvidedAutocompletionPayload)),void 0!==e.translatorSelectAutocompletionPayload&&(t.translatorSelectAutocompletionPayload=SelectAutocompletionAnnotationPayload.toJSON(e.translatorSelectAutocompletionPayload)),void 0!==e.translatorProvidedAutomaticTextUnitAlternativesPayload&&(t.translatorProvidedAutomaticTextUnitAlternativesPayload=ProvidedAutomaticTextUnitAlternativesAnnotationPayload.toJSON(e.translatorProvidedAutomaticTextUnitAlternativesPayload)),void 0!==e.translatorSelectAutomaticTextUnitAlternativePayload&&(t.translatorSelectAutomaticTextUnitAlternativePayload=SelectAutomaticTextUnitAlternativeAnnotationPayload.toJSON(e.translatorSelectAutomaticTextUnitAlternativePayload)),t}};function createBaseRemoveAnnotationOperation(){return{$type:"deepl.pb.interactive_text_api.RemoveAnnotationOperation",annotationId:void 0}}const RemoveAnnotationOperation={$type:"deepl.pb.interactive_text_api.RemoveAnnotationOperation",encode:(e,t=_m0.Writer.create())=>(void 0!==e.annotationId&&AnnotationId.encode(e.annotationId,t.uint32(10).fork()).ldelim(),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseRemoveAnnotationOperation();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.annotationId=AnnotationId.decode(n,n.uint32());continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:RemoveAnnotationOperation.$type,annotationId:isSet(e.annotationId)?AnnotationId.fromJSON(e.annotationId):void 0}),toJSON(e){const t={};return void 0!==e.annotationId&&(t.annotationId=AnnotationId.toJSON(e.annotationId)),t}};function createBaseSetPropertyOperation(){return{$type:"deepl.pb.interactive_text_api.SetPropertyOperation",propertyName:0,translatorSourceLanguagesValue:void 0,translatorTargetLanguagesValue:void 0,translatorRequestedSourceLanguageValue:void 0,translatorRequestedTargetLanguageValue:void 0,translatorFormalityModesValue:void 0,translatorFormalityModeValue:void 0,translatorGlossarySupportValue:void 0,translatorGlossaryListValue:void 0,textDirectionValue:void 0,translatorCalculatedSourceLanguageValue:void 0,maximumTextLengthValue:void 0,translatorLanguageModelsValue:void 0,translatorLanguageModelValue:void 0,translatorGlossaryIdValue:void 0,translatorCalculatedTargetLanguageValue:void 0}}const SetPropertyOperation={$type:"deepl.pb.interactive_text_api.SetPropertyOperation",encode:(e,t=_m0.Writer.create())=>(0!==e.propertyName&&t.uint32(8).int32(e.propertyName),void 0!==e.translatorSourceLanguagesValue&&SourceLanguagesPropertyValue.encode(e.translatorSourceLanguagesValue,t.uint32(18).fork()).ldelim(),void 0!==e.translatorTargetLanguagesValue&&TargetLanguagesPropertyValue.encode(e.translatorTargetLanguagesValue,t.uint32(26).fork()).ldelim(),void 0!==e.translatorRequestedSourceLanguageValue&&RequestedSourceLanguagePropertyValue.encode(e.translatorRequestedSourceLanguageValue,t.uint32(34).fork()).ldelim(),void 0!==e.translatorRequestedTargetLanguageValue&&RequestedTargetLanguagePropertyValue.encode(e.translatorRequestedTargetLanguageValue,t.uint32(42).fork()).ldelim(),void 0!==e.translatorFormalityModesValue&&FormalityModesPropertyValue.encode(e.translatorFormalityModesValue,t.uint32(58).fork()).ldelim(),void 0!==e.translatorFormalityModeValue&&FormalityModePropertyValue.encode(e.translatorFormalityModeValue,t.uint32(66).fork()).ldelim(),void 0!==e.translatorGlossarySupportValue&&GlossarySupportPropertyValue.encode(e.translatorGlossarySupportValue,t.uint32(74).fork()).ldelim(),void 0!==e.translatorGlossaryListValue&&GlossaryList.encode(e.translatorGlossaryListValue,t.uint32(82).fork()).ldelim(),void 0!==e.textDirectionValue&&TextDirectionPropertyValue.encode(e.textDirectionValue,t.uint32(98).fork()).ldelim(),void 0!==e.translatorCalculatedSourceLanguageValue&&CalculatedSourceLanguagePropertyValue.encode(e.translatorCalculatedSourceLanguageValue,t.uint32(106).fork()).ldelim(),void 0!==e.maximumTextLengthValue&&MaximumTextLengthPropertyValue.encode(e.maximumTextLengthValue,t.uint32(114).fork()).ldelim(),void 0!==e.translatorLanguageModelsValue&&LanguageModelsPropertyValue.encode(e.translatorLanguageModelsValue,t.uint32(122).fork()).ldelim(),void 0!==e.translatorLanguageModelValue&&LanguageModelPropertyValue.encode(e.translatorLanguageModelValue,t.uint32(130).fork()).ldelim(),void 0!==e.translatorGlossaryIdValue&&GlossaryIdPropertyValue.encode(e.translatorGlossaryIdValue,t.uint32(138).fork()).ldelim(),void 0!==e.translatorCalculatedTargetLanguageValue&&CalculatedTargetLanguagePropertyValue.encode(e.translatorCalculatedTargetLanguageValue,t.uint32(146).fork()).ldelim(),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseSetPropertyOperation();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(8!==e)break;o.propertyName=n.int32();continue;case 2:if(18!==e)break;o.translatorSourceLanguagesValue=SourceLanguagesPropertyValue.decode(n,n.uint32());continue;case 3:if(26!==e)break;o.translatorTargetLanguagesValue=TargetLanguagesPropertyValue.decode(n,n.uint32());continue;case 4:if(34!==e)break;o.translatorRequestedSourceLanguageValue=RequestedSourceLanguagePropertyValue.decode(n,n.uint32());continue;case 5:if(42!==e)break;o.translatorRequestedTargetLanguageValue=RequestedTargetLanguagePropertyValue.decode(n,n.uint32());continue;case 7:if(58!==e)break;o.translatorFormalityModesValue=FormalityModesPropertyValue.decode(n,n.uint32());continue;case 8:if(66!==e)break;o.translatorFormalityModeValue=FormalityModePropertyValue.decode(n,n.uint32());continue;case 9:if(74!==e)break;o.translatorGlossarySupportValue=GlossarySupportPropertyValue.decode(n,n.uint32());continue;case 10:if(82!==e)break;o.translatorGlossaryListValue=GlossaryList.decode(n,n.uint32());continue;case 12:if(98!==e)break;o.textDirectionValue=TextDirectionPropertyValue.decode(n,n.uint32());continue;case 13:if(106!==e)break;o.translatorCalculatedSourceLanguageValue=CalculatedSourceLanguagePropertyValue.decode(n,n.uint32());continue;case 14:if(114!==e)break;o.maximumTextLengthValue=MaximumTextLengthPropertyValue.decode(n,n.uint32());continue;case 15:if(122!==e)break;o.translatorLanguageModelsValue=LanguageModelsPropertyValue.decode(n,n.uint32());continue;case 16:if(130!==e)break;o.translatorLanguageModelValue=LanguageModelPropertyValue.decode(n,n.uint32());continue;case 17:if(138!==e)break;o.translatorGlossaryIdValue=GlossaryIdPropertyValue.decode(n,n.uint32());continue;case 18:if(146!==e)break;o.translatorCalculatedTargetLanguageValue=CalculatedTargetLanguagePropertyValue.decode(n,n.uint32());continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:SetPropertyOperation.$type,propertyName:isSet(e.propertyName)?propertyNameFromJSON(e.propertyName):0,translatorSourceLanguagesValue:isSet(e.translatorSourceLanguagesValue)?SourceLanguagesPropertyValue.fromJSON(e.translatorSourceLanguagesValue):void 0,translatorTargetLanguagesValue:isSet(e.translatorTargetLanguagesValue)?TargetLanguagesPropertyValue.fromJSON(e.translatorTargetLanguagesValue):void 0,translatorRequestedSourceLanguageValue:isSet(e.translatorRequestedSourceLanguageValue)?RequestedSourceLanguagePropertyValue.fromJSON(e.translatorRequestedSourceLanguageValue):void 0,translatorRequestedTargetLanguageValue:isSet(e.translatorRequestedTargetLanguageValue)?RequestedTargetLanguagePropertyValue.fromJSON(e.translatorRequestedTargetLanguageValue):void 0,translatorFormalityModesValue:isSet(e.translatorFormalityModesValue)?FormalityModesPropertyValue.fromJSON(e.translatorFormalityModesValue):void 0,translatorFormalityModeValue:isSet(e.translatorFormalityModeValue)?FormalityModePropertyValue.fromJSON(e.translatorFormalityModeValue):void 0,translatorGlossarySupportValue:isSet(e.translatorGlossarySupportValue)?GlossarySupportPropertyValue.fromJSON(e.translatorGlossarySupportValue):void 0,translatorGlossaryListValue:isSet(e.translatorGlossaryListValue)?GlossaryList.fromJSON(e.translatorGlossaryListValue):void 0,textDirectionValue:isSet(e.textDirectionValue)?TextDirectionPropertyValue.fromJSON(e.textDirectionValue):void 0,translatorCalculatedSourceLanguageValue:isSet(e.translatorCalculatedSourceLanguageValue)?CalculatedSourceLanguagePropertyValue.fromJSON(e.translatorCalculatedSourceLanguageValue):void 0,maximumTextLengthValue:isSet(e.maximumTextLengthValue)?MaximumTextLengthPropertyValue.fromJSON(e.maximumTextLengthValue):void 0,translatorLanguageModelsValue:isSet(e.translatorLanguageModelsValue)?LanguageModelsPropertyValue.fromJSON(e.translatorLanguageModelsValue):void 0,translatorLanguageModelValue:isSet(e.translatorLanguageModelValue)?LanguageModelPropertyValue.fromJSON(e.translatorLanguageModelValue):void 0,translatorGlossaryIdValue:isSet(e.translatorGlossaryIdValue)?GlossaryIdPropertyValue.fromJSON(e.translatorGlossaryIdValue):void 0,translatorCalculatedTargetLanguageValue:isSet(e.translatorCalculatedTargetLanguageValue)?CalculatedTargetLanguagePropertyValue.fromJSON(e.translatorCalculatedTargetLanguageValue):void 0}),toJSON(e){const t={};return 0!==e.propertyName&&(t.propertyName=propertyNameToJSON(e.propertyName)),void 0!==e.translatorSourceLanguagesValue&&(t.translatorSourceLanguagesValue=SourceLanguagesPropertyValue.toJSON(e.translatorSourceLanguagesValue)),void 0!==e.translatorTargetLanguagesValue&&(t.translatorTargetLanguagesValue=TargetLanguagesPropertyValue.toJSON(e.translatorTargetLanguagesValue)),void 0!==e.translatorRequestedSourceLanguageValue&&(t.translatorRequestedSourceLanguageValue=RequestedSourceLanguagePropertyValue.toJSON(e.translatorRequestedSourceLanguageValue)),void 0!==e.translatorRequestedTargetLanguageValue&&(t.translatorRequestedTargetLanguageValue=RequestedTargetLanguagePropertyValue.toJSON(e.translatorRequestedTargetLanguageValue)),void 0!==e.translatorFormalityModesValue&&(t.translatorFormalityModesValue=FormalityModesPropertyValue.toJSON(e.translatorFormalityModesValue)),void 0!==e.translatorFormalityModeValue&&(t.translatorFormalityModeValue=FormalityModePropertyValue.toJSON(e.translatorFormalityModeValue)),void 0!==e.translatorGlossarySupportValue&&(t.translatorGlossarySupportValue=GlossarySupportPropertyValue.toJSON(e.translatorGlossarySupportValue)),void 0!==e.translatorGlossaryListValue&&(t.translatorGlossaryListValue=GlossaryList.toJSON(e.translatorGlossaryListValue)),void 0!==e.textDirectionValue&&(t.textDirectionValue=TextDirectionPropertyValue.toJSON(e.textDirectionValue)),void 0!==e.translatorCalculatedSourceLanguageValue&&(t.translatorCalculatedSourceLanguageValue=CalculatedSourceLanguagePropertyValue.toJSON(e.translatorCalculatedSourceLanguageValue)),void 0!==e.maximumTextLengthValue&&(t.maximumTextLengthValue=MaximumTextLengthPropertyValue.toJSON(e.maximumTextLengthValue)),void 0!==e.translatorLanguageModelsValue&&(t.translatorLanguageModelsValue=LanguageModelsPropertyValue.toJSON(e.translatorLanguageModelsValue)),void 0!==e.translatorLanguageModelValue&&(t.translatorLanguageModelValue=LanguageModelPropertyValue.toJSON(e.translatorLanguageModelValue)),void 0!==e.translatorGlossaryIdValue&&(t.translatorGlossaryIdValue=GlossaryIdPropertyValue.toJSON(e.translatorGlossaryIdValue)),void 0!==e.translatorCalculatedTargetLanguageValue&&(t.translatorCalculatedTargetLanguageValue=CalculatedTargetLanguagePropertyValue.toJSON(e.translatorCalculatedTargetLanguageValue)),t}};function createBaseStartSessionRequest(){return{$type:"deepl.pb.interactive_text_api.StartSessionRequest",sessionMode:0,baseDocument:void 0,translatorSessionOptions:void 0}}const StartSessionRequest={$type:"deepl.pb.interactive_text_api.StartSessionRequest",encode:(e,t=_m0.Writer.create())=>(0!==e.sessionMode&&t.uint32(8).int32(e.sessionMode),void 0!==e.baseDocument&&BaseDocument.encode(e.baseDocument,t.uint32(18).fork()).ldelim(),void 0!==e.translatorSessionOptions&&SessionOptions.encode(e.translatorSessionOptions,t.uint32(26).fork()).ldelim(),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseStartSessionRequest();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(8!==e)break;o.sessionMode=n.int32();continue;case 2:if(18!==e)break;o.baseDocument=BaseDocument.decode(n,n.uint32());continue;case 3:if(26!==e)break;o.translatorSessionOptions=SessionOptions.decode(n,n.uint32());continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:StartSessionRequest.$type,sessionMode:isSet(e.sessionMode)?sessionModeFromJSON(e.sessionMode):0,baseDocument:isSet(e.baseDocument)?BaseDocument.fromJSON(e.baseDocument):void 0,translatorSessionOptions:isSet(e.translatorSessionOptions)?SessionOptions.fromJSON(e.translatorSessionOptions):void 0}),toJSON(e){const t={};return 0!==e.sessionMode&&(t.sessionMode=sessionModeToJSON(e.sessionMode)),void 0!==e.baseDocument&&(t.baseDocument=BaseDocument.toJSON(e.baseDocument)),void 0!==e.translatorSessionOptions&&(t.translatorSessionOptions=SessionOptions.toJSON(e.translatorSessionOptions)),t}};function createBaseStartSessionResponse(){return{$type:"deepl.pb.interactive_text_api.StartSessionResponse",sessionId:void 0,participantId:void 0,sessionToken:"",versionRemovedAt:void 0}}const StartSessionResponse={$type:"deepl.pb.interactive_text_api.StartSessionResponse",encode:(e,t=_m0.Writer.create())=>(void 0!==e.sessionId&&SessionId.encode(e.sessionId,t.uint32(10).fork()).ldelim(),void 0!==e.participantId&&ParticipantId.encode(e.participantId,t.uint32(18).fork()).ldelim(),""!==e.sessionToken&&t.uint32(26).string(e.sessionToken),void 0!==e.versionRemovedAt&&Timestamp.encode(toTimestamp(e.versionRemovedAt),t.uint32(34).fork()).ldelim(),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseStartSessionResponse();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.sessionId=SessionId.decode(n,n.uint32());continue;case 2:if(18!==e)break;o.participantId=ParticipantId.decode(n,n.uint32());continue;case 3:if(26!==e)break;o.sessionToken=n.string();continue;case 4:if(34!==e)break;o.versionRemovedAt=fromTimestamp(Timestamp.decode(n,n.uint32()));continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:StartSessionResponse.$type,sessionId:isSet(e.sessionId)?SessionId.fromJSON(e.sessionId):void 0,participantId:isSet(e.participantId)?ParticipantId.fromJSON(e.participantId):void 0,sessionToken:isSet(e.sessionToken)?globalThis.String(e.sessionToken):"",versionRemovedAt:isSet(e.versionRemovedAt)?fromJsonTimestamp(e.versionRemovedAt):void 0}),toJSON(e){const t={};return void 0!==e.sessionId&&(t.sessionId=SessionId.toJSON(e.sessionId)),void 0!==e.participantId&&(t.participantId=ParticipantId.toJSON(e.participantId)),""!==e.sessionToken&&(t.sessionToken=e.sessionToken),void 0!==e.versionRemovedAt&&(t.versionRemovedAt=e.versionRemovedAt.toISOString()),t}};function createBaseParticipantRequest(){return{$type:"deepl.pb.interactive_text_api.ParticipantRequest",appendMessage:void 0,updateAuthenticationTokenMessage:void 0}}const ParticipantRequest={$type:"deepl.pb.interactive_text_api.ParticipantRequest",encode:(e,t=_m0.Writer.create())=>(void 0!==e.appendMessage&&AppendMessage.encode(e.appendMessage,t.uint32(10).fork()).ldelim(),void 0!==e.updateAuthenticationTokenMessage&&UpdateAuthenticationTokenMessage.encode(e.updateAuthenticationTokenMessage,t.uint32(18).fork()).ldelim(),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseParticipantRequest();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.appendMessage=AppendMessage.decode(n,n.uint32());continue;case 2:if(18!==e)break;o.updateAuthenticationTokenMessage=UpdateAuthenticationTokenMessage.decode(n,n.uint32());continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:ParticipantRequest.$type,appendMessage:isSet(e.appendMessage)?AppendMessage.fromJSON(e.appendMessage):void 0,updateAuthenticationTokenMessage:isSet(e.updateAuthenticationTokenMessage)?UpdateAuthenticationTokenMessage.fromJSON(e.updateAuthenticationTokenMessage):void 0}),toJSON(e){const t={};return void 0!==e.appendMessage&&(t.appendMessage=AppendMessage.toJSON(e.appendMessage)),void 0!==e.updateAuthenticationTokenMessage&&(t.updateAuthenticationTokenMessage=UpdateAuthenticationTokenMessage.toJSON(e.updateAuthenticationTokenMessage)),t}};function createBaseParticipantResponse(){return{$type:"deepl.pb.interactive_text_api.ParticipantResponse",confirmedMessage:void 0,initializedMessage:void 0,publishedMessage:void 0,metaInfoMessage:void 0}}const ParticipantResponse={$type:"deepl.pb.interactive_text_api.ParticipantResponse",encode:(e,t=_m0.Writer.create())=>(void 0!==e.confirmedMessage&&ConfirmedMessage.encode(e.confirmedMessage,t.uint32(10).fork()).ldelim(),void 0!==e.initializedMessage&&InitializedMessage.encode(e.initializedMessage,t.uint32(18).fork()).ldelim(),void 0!==e.publishedMessage&&PublishedMessage.encode(e.publishedMessage,t.uint32(26).fork()).ldelim(),void 0!==e.metaInfoMessage&&MetaInfoMessage.encode(e.metaInfoMessage,t.uint32(34).fork()).ldelim(),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseParticipantResponse();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.confirmedMessage=ConfirmedMessage.decode(n,n.uint32());continue;case 2:if(18!==e)break;o.initializedMessage=InitializedMessage.decode(n,n.uint32());continue;case 3:if(26!==e)break;o.publishedMessage=PublishedMessage.decode(n,n.uint32());continue;case 4:if(34!==e)break;o.metaInfoMessage=MetaInfoMessage.decode(n,n.uint32());continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:ParticipantResponse.$type,confirmedMessage:isSet(e.confirmedMessage)?ConfirmedMessage.fromJSON(e.confirmedMessage):void 0,initializedMessage:isSet(e.initializedMessage)?InitializedMessage.fromJSON(e.initializedMessage):void 0,publishedMessage:isSet(e.publishedMessage)?PublishedMessage.fromJSON(e.publishedMessage):void 0,metaInfoMessage:isSet(e.metaInfoMessage)?MetaInfoMessage.fromJSON(e.metaInfoMessage):void 0}),toJSON(e){const t={};return void 0!==e.confirmedMessage&&(t.confirmedMessage=ConfirmedMessage.toJSON(e.confirmedMessage)),void 0!==e.initializedMessage&&(t.initializedMessage=InitializedMessage.toJSON(e.initializedMessage)),void 0!==e.publishedMessage&&(t.publishedMessage=PublishedMessage.toJSON(e.publishedMessage)),void 0!==e.metaInfoMessage&&(t.metaInfoMessage=MetaInfoMessage.toJSON(e.metaInfoMessage)),t}};function createBaseConfirmedMessage(){return{$type:"deepl.pb.interactive_text_api.ConfirmedMessage",currentVersion:void 0}}const ConfirmedMessage={$type:"deepl.pb.interactive_text_api.ConfirmedMessage",encode:(e,t=_m0.Writer.create())=>(void 0!==e.currentVersion&&EventVersion.encode(e.currentVersion,t.uint32(10).fork()).ldelim(),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseConfirmedMessage();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.currentVersion=EventVersion.decode(n,n.uint32());continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:ConfirmedMessage.$type,currentVersion:isSet(e.currentVersion)?EventVersion.fromJSON(e.currentVersion):void 0}),toJSON(e){const t={};return void 0!==e.currentVersion&&(t.currentVersion=EventVersion.toJSON(e.currentVersion)),t}};function createBaseInitializedMessage(){return{$type:"deepl.pb.interactive_text_api.InitializedMessage"}}const InitializedMessage={$type:"deepl.pb.interactive_text_api.InitializedMessage",encode:(e,t=_m0.Writer.create())=>t,decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseInitializedMessage();for(;n.pos<r;){const e=n.uint32();if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:InitializedMessage.$type}),toJSON:e=>({})};function createBasePublishedMessage(){return{$type:"deepl.pb.interactive_text_api.PublishedMessage",events:[],currentVersion:void 0}}const PublishedMessage={$type:"deepl.pb.interactive_text_api.PublishedMessage",encode(e,t=_m0.Writer.create()){for(const n of e.events)FieldEvent.encode(n,t.uint32(10).fork()).ldelim();return void 0!==e.currentVersion&&EventVersion.encode(e.currentVersion,t.uint32(18).fork()).ldelim(),t},decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBasePublishedMessage();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.events.push(FieldEvent.decode(n,n.uint32()));continue;case 2:if(18!==e)break;o.currentVersion=EventVersion.decode(n,n.uint32());continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:PublishedMessage.$type,events:globalThis.Array.isArray(null==e?void 0:e.events)?e.events.map((e=>FieldEvent.fromJSON(e))):[],currentVersion:isSet(e.currentVersion)?EventVersion.fromJSON(e.currentVersion):void 0}),toJSON(e){var t;const n={};return(null===(t=e.events)||void 0===t?void 0:t.length)&&(n.events=e.events.map((e=>FieldEvent.toJSON(e)))),void 0!==e.currentVersion&&(n.currentVersion=EventVersion.toJSON(e.currentVersion)),n}};function createBaseMetaInfoMessage(){return{$type:"deepl.pb.interactive_text_api.MetaInfoMessage",idle:void 0,translatorTaskMetaInfo:void 0}}const MetaInfoMessage={$type:"deepl.pb.interactive_text_api.MetaInfoMessage",encode:(e,t=_m0.Writer.create())=>(void 0!==e.idle&&Idle.encode(e.idle,t.uint32(10).fork()).ldelim(),void 0!==e.translatorTaskMetaInfo&&TaskMetaInfo.encode(e.translatorTaskMetaInfo,t.uint32(18).fork()).ldelim(),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseMetaInfoMessage();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.idle=Idle.decode(n,n.uint32());continue;case 2:if(18!==e)break;o.translatorTaskMetaInfo=TaskMetaInfo.decode(n,n.uint32());continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:MetaInfoMessage.$type,idle:isSet(e.idle)?Idle.fromJSON(e.idle):void 0,translatorTaskMetaInfo:isSet(e.translatorTaskMetaInfo)?TaskMetaInfo.fromJSON(e.translatorTaskMetaInfo):void 0}),toJSON(e){const t={};return void 0!==e.idle&&(t.idle=Idle.toJSON(e.idle)),void 0!==e.translatorTaskMetaInfo&&(t.translatorTaskMetaInfo=TaskMetaInfo.toJSON(e.translatorTaskMetaInfo)),t}};function createBaseIdle(){return{$type:"deepl.pb.interactive_text_api.Idle",eventVersion:void 0}}const Idle={$type:"deepl.pb.interactive_text_api.Idle",encode:(e,t=_m0.Writer.create())=>(void 0!==e.eventVersion&&EventVersion.encode(e.eventVersion,t.uint32(10).fork()).ldelim(),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseIdle();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.eventVersion=EventVersion.decode(n,n.uint32());continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:Idle.$type,eventVersion:isSet(e.eventVersion)?EventVersion.fromJSON(e.eventVersion):void 0}),toJSON(e){const t={};return void 0!==e.eventVersion&&(t.eventVersion=EventVersion.toJSON(e.eventVersion)),t}};function createBaseAppendMessage(){return{$type:"deepl.pb.interactive_text_api.AppendMessage",events:[],baseVersion:void 0}}const AppendMessage={$type:"deepl.pb.interactive_text_api.AppendMessage",encode(e,t=_m0.Writer.create()){for(const n of e.events)FieldEvent.encode(n,t.uint32(10).fork()).ldelim();return void 0!==e.baseVersion&&EventVersion.encode(e.baseVersion,t.uint32(18).fork()).ldelim(),t},decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseAppendMessage();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.events.push(FieldEvent.decode(n,n.uint32()));continue;case 2:if(18!==e)break;o.baseVersion=EventVersion.decode(n,n.uint32());continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:AppendMessage.$type,events:globalThis.Array.isArray(null==e?void 0:e.events)?e.events.map((e=>FieldEvent.fromJSON(e))):[],baseVersion:isSet(e.baseVersion)?EventVersion.fromJSON(e.baseVersion):void 0}),toJSON(e){var t;const n={};return(null===(t=e.events)||void 0===t?void 0:t.length)&&(n.events=e.events.map((e=>FieldEvent.toJSON(e)))),void 0!==e.baseVersion&&(n.baseVersion=EventVersion.toJSON(e.baseVersion)),n}};function createBaseUpdateAuthenticationTokenMessage(){return{$type:"deepl.pb.interactive_text_api.UpdateAuthenticationTokenMessage",token:""}}const UpdateAuthenticationTokenMessage={$type:"deepl.pb.interactive_text_api.UpdateAuthenticationTokenMessage",encode:(e,t=_m0.Writer.create())=>(""!==e.token&&t.uint32(10).string(e.token),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseUpdateAuthenticationTokenMessage();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.token=n.string();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:UpdateAuthenticationTokenMessage.$type,token:isSet(e.token)?globalThis.String(e.token):""}),toJSON(e){const t={};return""!==e.token&&(t.token=e.token),t}};function createBaseSessionId(){return{$type:"deepl.pb.interactive_text_api.SessionId",value:""}}const SessionId={$type:"deepl.pb.interactive_text_api.SessionId",encode:(e,t=_m0.Writer.create())=>(""!==e.value&&t.uint32(10).string(e.value),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseSessionId();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.value=n.string();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:SessionId.$type,value:isSet(e.value)?globalThis.String(e.value):""}),toJSON(e){const t={};return""!==e.value&&(t.value=e.value),t}};function createBaseEventVersion(){return{$type:"deepl.pb.interactive_text_api.EventVersion",version:void 0}}const EventVersion={$type:"deepl.pb.interactive_text_api.EventVersion",encode:(e,t=_m0.Writer.create())=>(void 0!==e.version&&Int32Value.encode({$type:"google.protobuf.Int32Value",value:e.version},t.uint32(10).fork()).ldelim(),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseEventVersion();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.version=Int32Value.decode(n,n.uint32()).value;continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:EventVersion.$type,version:isSet(e.version)?Number(e.version):void 0}),toJSON(e){const t={};return void 0!==e.version&&(t.version=e.version),t}};function createBaseFieldEvent(){return{$type:"deepl.pb.interactive_text_api.FieldEvent",fieldName:0,textChangeOperation:void 0,createAnnotationOperation:void 0,removeAnnotationOperation:void 0,setPropertyOperation:void 0,participantId:void 0}}const FieldEvent={$type:"deepl.pb.interactive_text_api.FieldEvent",encode:(e,t=_m0.Writer.create())=>(0!==e.fieldName&&t.uint32(8).int32(e.fieldName),void 0!==e.textChangeOperation&&TextChangeOperation.encode(e.textChangeOperation,t.uint32(18).fork()).ldelim(),void 0!==e.createAnnotationOperation&&CreateAnnotationOperation.encode(e.createAnnotationOperation,t.uint32(26).fork()).ldelim(),void 0!==e.removeAnnotationOperation&&RemoveAnnotationOperation.encode(e.removeAnnotationOperation,t.uint32(34).fork()).ldelim(),void 0!==e.setPropertyOperation&&SetPropertyOperation.encode(e.setPropertyOperation,t.uint32(42).fork()).ldelim(),void 0!==e.participantId&&ParticipantId.encode(e.participantId,t.uint32(50).fork()).ldelim(),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseFieldEvent();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(8!==e)break;o.fieldName=n.int32();continue;case 2:if(18!==e)break;o.textChangeOperation=TextChangeOperation.decode(n,n.uint32());continue;case 3:if(26!==e)break;o.createAnnotationOperation=CreateAnnotationOperation.decode(n,n.uint32());continue;case 4:if(34!==e)break;o.removeAnnotationOperation=RemoveAnnotationOperation.decode(n,n.uint32());continue;case 5:if(42!==e)break;o.setPropertyOperation=SetPropertyOperation.decode(n,n.uint32());continue;case 6:if(50!==e)break;o.participantId=ParticipantId.decode(n,n.uint32());continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:FieldEvent.$type,fieldName:isSet(e.fieldName)?fieldNameFromJSON(e.fieldName):0,textChangeOperation:isSet(e.textChangeOperation)?TextChangeOperation.fromJSON(e.textChangeOperation):void 0,createAnnotationOperation:isSet(e.createAnnotationOperation)?CreateAnnotationOperation.fromJSON(e.createAnnotationOperation):void 0,removeAnnotationOperation:isSet(e.removeAnnotationOperation)?RemoveAnnotationOperation.fromJSON(e.removeAnnotationOperation):void 0,setPropertyOperation:isSet(e.setPropertyOperation)?SetPropertyOperation.fromJSON(e.setPropertyOperation):void 0,participantId:isSet(e.participantId)?ParticipantId.fromJSON(e.participantId):void 0}),toJSON(e){const t={};return 0!==e.fieldName&&(t.fieldName=fieldNameToJSON(e.fieldName)),void 0!==e.textChangeOperation&&(t.textChangeOperation=TextChangeOperation.toJSON(e.textChangeOperation)),void 0!==e.createAnnotationOperation&&(t.createAnnotationOperation=CreateAnnotationOperation.toJSON(e.createAnnotationOperation)),void 0!==e.removeAnnotationOperation&&(t.removeAnnotationOperation=RemoveAnnotationOperation.toJSON(e.removeAnnotationOperation)),void 0!==e.setPropertyOperation&&(t.setPropertyOperation=SetPropertyOperation.toJSON(e.setPropertyOperation)),void 0!==e.participantId&&(t.participantId=ParticipantId.toJSON(e.participantId)),t}};function createBaseParticipantId(){return{$type:"deepl.pb.interactive_text_api.ParticipantId",value:0}}const ParticipantId={$type:"deepl.pb.interactive_text_api.ParticipantId",encode:(e,t=_m0.Writer.create())=>(0!==e.value&&t.uint32(8).int32(e.value),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseParticipantId();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(8!==e)break;o.value=n.int32();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:ParticipantId.$type,value:isSet(e.value)?globalThis.Number(e.value):0}),toJSON(e){const t={};return 0!==e.value&&(t.value=Math.round(e.value)),t}};function createBaseAnnotationId(){return{$type:"deepl.pb.interactive_text_api.AnnotationId",value:""}}const AnnotationId={$type:"deepl.pb.interactive_text_api.AnnotationId",encode:(e,t=_m0.Writer.create())=>(""!==e.value&&t.uint32(10).string(e.value),t),decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseAnnotationId();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.value=n.string();continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:AnnotationId.$type,value:isSet(e.value)?globalThis.String(e.value):""}),toJSON(e){const t={};return""!==e.value&&(t.value=e.value),t}};function createBaseBaseDocument(){return{$type:"deepl.pb.interactive_text_api.BaseDocument",fields:[]}}const BaseDocument={$type:"deepl.pb.interactive_text_api.BaseDocument",encode(e,t=_m0.Writer.create()){for(const n of e.fields)Field$1.encode(n,t.uint32(10).fork()).ldelim();return t},decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseBaseDocument();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(10!==e)break;o.fields.push(Field$1.decode(n,n.uint32()));continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:BaseDocument.$type,fields:globalThis.Array.isArray(null==e?void 0:e.fields)?e.fields.map((e=>Field$1.fromJSON(e))):[]}),toJSON(e){var t;const n={};return(null===(t=e.fields)||void 0===t?void 0:t.length)&&(n.fields=e.fields.map((e=>Field$1.toJSON(e)))),n}};function createBaseField(){return{$type:"deepl.pb.interactive_text_api.Field",fieldName:0,text:"",annotations:[],properties:[]}}const Field$1={$type:"deepl.pb.interactive_text_api.Field",encode(e,t=_m0.Writer.create()){0!==e.fieldName&&t.uint32(8).int32(e.fieldName),""!==e.text&&t.uint32(18).string(e.text);for(const n of e.annotations)CreateAnnotationOperation.encode(n,t.uint32(26).fork()).ldelim();for(const n of e.properties)SetPropertyOperation.encode(n,t.uint32(34).fork()).ldelim();return t},decode(e,t){const n=e instanceof _m0.Reader?e:_m0.Reader.create(e);let r=void 0===t?n.len:n.pos+t;const o=createBaseField();for(;n.pos<r;){const e=n.uint32();switch(e>>>3){case 1:if(8!==e)break;o.fieldName=n.int32();continue;case 2:if(18!==e)break;o.text=n.string();continue;case 3:if(26!==e)break;o.annotations.push(CreateAnnotationOperation.decode(n,n.uint32()));continue;case 4:if(34!==e)break;o.properties.push(SetPropertyOperation.decode(n,n.uint32()));continue}if(4==(7&e)||0===e)break;n.skipType(7&e)}return o},fromJSON:e=>({$type:Field$1.$type,fieldName:isSet(e.fieldName)?fieldNameFromJSON(e.fieldName):0,text:isSet(e.text)?globalThis.String(e.text):"",annotations:globalThis.Array.isArray(null==e?void 0:e.annotations)?e.annotations.map((e=>CreateAnnotationOperation.fromJSON(e))):[],properties:globalThis.Array.isArray(null==e?void 0:e.properties)?e.properties.map((e=>SetPropertyOperation.fromJSON(e))):[]}),toJSON(e){var t,n;const r={};return 0!==e.fieldName&&(r.fieldName=fieldNameToJSON(e.fieldName)),""!==e.text&&(r.text=e.text),(null===(t=e.annotations)||void 0===t?void 0:t.length)&&(r.annotations=e.annotations.map((e=>CreateAnnotationOperation.toJSON(e)))),(null===(n=e.properties)||void 0===n?void 0:n.length)&&(r.properties=e.properties.map((e=>SetPropertyOperation.toJSON(e)))),r}};function toTimestamp(e){return{$type:"google.protobuf.Timestamp",seconds:Math.trunc(e.getTime()/1e3),nanos:e.getTime()%1e3*1e6}}function fromTimestamp(e){let t=1e3*(e.seconds||0);return t+=(e.nanos||0)/1e6,new globalThis.Date(t)}function fromJsonTimestamp(e){return e instanceof globalThis.Date?e:"string"==typeof e?new globalThis.Date(e):fromTimestamp(Timestamp.fromJSON(e))}function isSet(e){return null!=e}function isObject(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function createProtobufExtensionCodec(){const e=new ExtensionCodec;return e.register({type:MessagePackTypeCode.START_SESSION_REQUEST,encode:e=>isObject(e)&&"sessionMode"in e?StartSessionRequest.encode(e).finish():null,decode:e=>StartSessionRequest.decode(e)}),e.register({type:MessagePackTypeCode.START_SESSION_RESPONSE,encode:e=>isObject(e)&&"sessionId"in e&&"participantId"in e&&"sessionToken"in e?StartSessionResponse.encode(e).finish():null,decode:e=>StartSessionResponse.decode(e)}),e.register({type:MessagePackTypeCode.EVENT_VERSION,encode:e=>isObject(e)&&"version"in e?EventVersion.encode(e).finish():null,decode:e=>EventVersion.decode(e)}),e.register({type:MessagePackTypeCode.PARTICIPANT_REQUEST,encode:e=>isObject(e)&&("appendMessage"in e||"updateAuthenticationTokenMessage"in e)?ParticipantRequest.encode(e).finish():null,decode:e=>ParticipantRequest.decode(e)}),e.register({type:MessagePackTypeCode.PARTICIPANT_RESPONSE,encode:e=>isObject(e)&&"confirmedMessage"in e&&"initializedMessage"in e&&"publishedMessage"in e?ParticipantResponse.encode(e).finish():null,decode:e=>ParticipantResponse.decode(e)}),e.register({type:MessagePackTypeCode.CLIENT_ERROR_INFO,encode:e=>isObject(e)&&"statusCode"in e&&"detailCode"in e&&"fallbackDetailCodes"in e?ClientErrorInfo.encode(e).finish():null,decode:e=>ClientErrorInfo.decode(e)}),e}function extractAnnotationPayload(e){if(e.translatorTextUnitPayload)return e.translatorTextUnitPayload;if(e.translatorRequestWordAlternativesPayload)return e.translatorRequestWordAlternativesPayload;if(e.translatorProvidedWordAlternativesPayload)return e.translatorProvidedWordAlternativesPayload;if(e.translatorSelectWordAlternativePayload)return e.translatorSelectWordAlternativePayload;if(e.translatorGlossaryReplacementPayload)return e.translatorGlossaryReplacementPayload;if(e.translatorRequestTextUnitAlternativesPayload)return e.translatorRequestTextUnitAlternativesPayload;if(e.translatorProvidedTextUnitAlternativesPayload)return e.translatorProvidedTextUnitAlternativesPayload;if(e.translatorSelectTextUnitAlternativePayload)return e.translatorSelectTextUnitAlternativePayload;if(e.translatorRequestAutocompletionPayload)return e.translatorRequestAutocompletionPayload;if(e.translatorProvidedAutocompletionPayload)return e.translatorProvidedAutocompletionPayload;if(e.translatorSelectAutocompletionPayload)return e.translatorSelectAutocompletionPayload;if(e.translatorProvidedAutomaticTextUnitAlternativesPayload)return e.translatorProvidedAutomaticTextUnitAlternativesPayload;if(e.translatorSelectAutomaticTextUnitAlternativePayload)return e.translatorSelectAutomaticTextUnitAlternativePayload;throw new Error("CreateAnnotationOperation does not contain a known payload")}function setAnnotationPayload(e,t){switch(t.$type){case TextUnitAnnotationPayload.$type:return Object.assign(Object.assign({},e),{translatorTextUnitPayload:t});case RequestWordAlternativesAnnotationPayload.$type:return Object.assign(Object.assign({},e),{translatorRequestWordAlternativesPayload:t});case ProvidedWordAlternativesAnnotationPayload.$type:return Object.assign(Object.assign({},e),{translatorProvidedWordAlternativesPayload:t});case SelectWordAlternativeAnnotationPayload.$type:return Object.assign(Object.assign({},e),{translatorSelectWordAlternativePayload:t});case GlossaryReplacementAnnotationPayload.$type:return Object.assign(Object.assign({},e),{translatorGlossaryReplacementPayload:t});case RequestTextUnitAlternativesAnnotationPayload.$type:return Object.assign(Object.assign({},e),{translatorRequestTextUnitAlternativesPayload:t});case ProvidedTextUnitAlternativesAnnotationPayload.$type:return Object.assign(Object.assign({},e),{translatorProvidedTextUnitAlternativesPayload:t});case SelectTextUnitAlternativeAnnotationPayload.$type:return Object.assign(Object.assign({},e),{translatorSelectTextUnitAlternativePayload:t});case RequestAutocompletionAnnotationPayload.$type:return Object.assign(Object.assign({},e),{translatorRequestAutocompletionPayload:t});case ProvidedAutocompletionAnnotationPayload.$type:return Object.assign(Object.assign({},e),{translatorProvidedAutocompletionPayload:t});case SelectAutocompletionAnnotationPayload.$type:return Object.assign(Object.assign({},e),{translatorSelectAutocompletionPayload:t});case ProvidedAutomaticTextUnitAlternativesAnnotationPayload.$type:return Object.assign(Object.assign({},e),{translatorProvidedAutomaticTextUnitAlternativesPayload:t});case SelectAutomaticTextUnitAlternativeAnnotationPayload.$type:return Object.assign(Object.assign({},e),{translatorSelectAutomaticTextUnitAlternativePayload:t})}}function extractPropertyValue(e){return e.translatorSourceLanguagesValue?e.translatorSourceLanguagesValue:e.translatorTargetLanguagesValue?e.translatorTargetLanguagesValue:e.translatorRequestedSourceLanguageValue?e.translatorRequestedSourceLanguageValue:e.translatorCalculatedSourceLanguageValue?e.translatorCalculatedSourceLanguageValue:e.translatorRequestedTargetLanguageValue?e.translatorRequestedTargetLanguageValue:e.translatorCalculatedTargetLanguageValue?e.translatorCalculatedTargetLanguageValue:e.translatorFormalityModesValue?e.translatorFormalityModesValue:e.translatorFormalityModeValue?e.translatorFormalityModeValue:e.translatorGlossarySupportValue?e.translatorGlossarySupportValue:e.translatorGlossaryListValue?e.translatorGlossaryListValue:e.translatorGlossaryIdValue?e.translatorGlossaryIdValue:e.translatorLanguageModelsValue?e.translatorLanguageModelsValue:e.translatorLanguageModelValue?e.translatorLanguageModelValue:e.textDirectionValue?e.textDirectionValue:e.maximumTextLengthValue?e.maximumTextLengthValue:void 0}function setPropertyValue(e,t){switch(t.$type){case SourceLanguagesPropertyValue.$type:return Object.assign(Object.assign({},e),{translatorSourceLanguagesValue:t});case RequestedSourceLanguagePropertyValue.$type:return Object.assign(Object.assign({},e),{translatorRequestedSourceLanguageValue:t});case CalculatedSourceLanguagePropertyValue.$type:return Object.assign(Object.assign({},e),{translatorCalculatedSourceLanguageValue:t});case TargetLanguagesPropertyValue.$type:return Object.assign(Object.assign({},e),{translatorTargetLanguagesValue:t});case RequestedTargetLanguagePropertyValue.$type:return Object.assign(Object.assign({},e),{translatorRequestedTargetLanguageValue:t});case CalculatedTargetLanguagePropertyValue.$type:return Object.assign(Object.assign({},e),{translatorCalculatedTargetLanguageValue:t});case FormalityModesPropertyValue.$type:return Object.assign(Object.assign({},e),{translatorFormalityModesValue:t});case FormalityModePropertyValue.$type:return Object.assign(Object.assign({},e),{translatorFormalityModeValue:t});case GlossarySupportPropertyValue.$type:return Object.assign(Object.assign({},e),{translatorGlossarySupportValue:t});case GlossaryList.$type:return Object.assign(Object.assign({},e),{translatorGlossaryListValue:t});case GlossaryIdPropertyValue.$type:return Object.assign(Object.assign({},e),{translatorGlossaryIdValue:t});case LanguageModelsPropertyValue.$type:return Object.assign(Object.assign({},e),{translatorLanguageModelsValue:t});case LanguageModelPropertyValue.$type:return Object.assign(Object.assign({},e),{translatorLanguageModelValue:t});case TextDirectionPropertyValue.$type:return Object.assign(Object.assign({},e),{textDirectionValue:t});case MaximumTextLengthPropertyValue.$type:return Object.assign(Object.assign({},e),{maximumTextLengthValue:t})}}function isTextChangeOperation(e){return e.$type===TextChangeOperation.$type}function isCreateAnnotationOperation(e){return e.$type===CreateAnnotationOperation.$type}function isRemoveAnnotationOperation(e){return e.$type===RemoveAnnotationOperation.$type}function isSetPropertyOperation(e){return e.$type===SetPropertyOperation.$type}function extractOperation(e){if(e.textChangeOperation)return e.textChangeOperation;if(e.createAnnotationOperation)return e.createAnnotationOperation;if(e.removeAnnotationOperation)return e.removeAnnotationOperation;if(e.setPropertyOperation)return e.setPropertyOperation;throw new Error("FieldEvent does not contain an operation")}function wrapFieldEvent(e,t,n){const r={fieldName:t,participantId:n,$type:FieldEvent.$type};switch(e.$type){case TextChangeOperation.$type:return Object.assign(Object.assign({},r),{textChangeOperation:e});case CreateAnnotationOperation.$type:return Object.assign(Object.assign({},r),{createAnnotationOperation:e});case RemoveAnnotationOperation.$type:return Object.assign(Object.assign({},r),{removeAnnotationOperation:e});case SetPropertyOperation.$type:return Object.assign(Object.assign({},r),{setPropertyOperation:e})}}function createTextChangeOperation(e,t,n){return{$type:TextChangeOperation.$type,range:{$type:TextRange.$type,start:e,end:t},text:n}}function createCreateAnnotationOperation(e,t,n,r){return setAnnotationPayload({$type:CreateAnnotationOperation.$type,annotationId:e,range:{$type:TextRange.$type,start:t,end:n}},r)}function createRemoveAnnotationOperation(e){return{$type:RemoveAnnotationOperation.$type,annotationId:e}}function wrapSetPropertyOperation(e,t){const n={$type:SetPropertyOperation.$type,propertyName:e};return void 0===t?n:setPropertyValue(n,t)}class Client{constructor(e,t,n){this.name=e,this.sessionMode=t,this.document=n,this.bufferedInitialEvents=[]}addChangeHandler(e){this.onChange=e,this.onChange(this.bufferedInitialEvents),this.bufferedInitialEvents=[]}applyFieldEvent(e){this.document.applyItaEvent(e)}publishChange(e,t){const n=t.map((t=>wrapFieldEvent(t,e)));this.publishEvents(n)}publishChanges(e){const t=e.flatMap((([e,t])=>t.map((t=>wrapFieldEvent(t,e)))));this.publishEvents(t)}publishEvents(e){this.onChange?this.onChange(e):this.bufferedInitialEvents=[...this.bufferedInitialEvents,...e]}}class Document$1{constructor(){this.fields=[]}registerField(e){return this.fields.push(e),e}applyItaEvent(e){const t=this.fields.find((t=>t.name===e.fieldName));t&&t.applyOperation(extractOperation(e))}serialize(){return{$type:BaseDocument.$type,fields:this.fields.map((e=>e.serialize()))}}prettyPrint(){return{fields:this.fields.map((e=>e.prettyPrint()))}}reset(){this.fields.forEach((e=>e.reset()))}}const applyTextChangeOperation=(e,t)=>{if(void 0===t.range||t.range.start>e.length||t.range.start<0||t.range.end>e.length||t.range.end<0||t.range.start>t.range.end)throw new Error("Tried to apply out of range operation to string");return e.slice(0,t.range.start)+t.text+e.slice(t.range.end)},TRANSLATOR_DEFAULTS={requestedSourceLanguage:"autodetect",requestedTargetLanguage:"en-US",maximumTextLength:500},defaultAnnotationContainerConfig={requiresTransformation:!1};class AnnotationsContainer{constructor(e,t){this.payloadType=e,this.annotations=new BehaviorSubject([]),this.payloads=this.annotations.pipe(map((e=>e.map((e=>e.specificPayload))))),this.config=Object.assign(Object.assign({},defaultAnnotationContainerConfig),t)}applyCreateAnnotationOperation(e){const t=[...this.annotations.value,e];this.annotations.next(t)}applyRemoveAnnotationOperation(e){const t=this.annotations.value.filter((t=>{var n,r;return(null===(n=t.operation.annotationId)||void 0===n?void 0:n.value)!==(null===(r=e.annotationId)||void 0===r?void 0:r.value)}));this.annotations.next(t)}add(e,t,n){const r=createCreateAnnotationOperation({$type:AnnotationId.$type,value:crypto.randomUUID()},e,t,n);return this.annotations.next([...this.annotations.value,{operation:r,specificPayload:n}]),[r]}set(e){this.annotations.next(e)}removeAnnotation(e){const t=this.annotations.value.filter((t=>{var n;return(null===(n=t.operation.annotationId)||void 0===n?void 0:n.value)===(null==e?void 0:e.value)})).map((e=>createRemoveAnnotationOperation(e.operation.annotationId))),n=this.annotations.value.filter((t=>{var n;return(null===(n=t.operation.annotationId)||void 0===n?void 0:n.value)!==(null==e?void 0:e.value)}));return this.annotations.next(n),t}serialize(){return this.annotations.value.map((e=>e.operation))}prettyPrint(){return this.annotations.value.map((e=>{var t;return{id:null===(t=e.operation.annotationId)||void 0===t?void 0:t.value,range:e.operation.range,annotationPayload:e.specificPayload}}))}reset(){this.annotations.next([])}}function Diff(){}function buildValues(e,t,n,r,o){for(var a,i=[];t;)i.push(t),a=t.previousComponent,delete t.previousComponent,t=a;i.reverse();for(var s=0,c=i.length,l=0,u=0;s<c;s++){var d=i[s];if(d.removed){if(d.value=e.join(r.slice(u,u+d.count)),u+=d.count,s&&i[s-1].added){var p=i[s-1];i[s-1]=i[s],i[s]=p}}else{if(!d.added&&o){var g=n.slice(l,l+d.count);g=g.map((function(e,t){var n=r[u+t];return n.length>e.length?n:e})),d.value=e.join(g)}else d.value=e.join(n.slice(l,l+d.count));l+=d.count,d.added||(u+=d.count)}}var h=i[c-1];return c>1&&"string"==typeof h.value&&(h.added||h.removed)&&e.equals("",h.value)&&(i[c-2].value+=h.value,i.pop()),i}Diff.prototype={diff:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=r.callback;"function"==typeof r&&(o=r,r={}),this.options=r;var a=this;function i(e){return o?(setTimeout((function(){o(void 0,e)}),0),!0):e}e=this.castInput(e),t=this.castInput(t),e=this.removeEmpty(this.tokenize(e));var s=(t=this.removeEmpty(this.tokenize(t))).length,c=e.length,l=1,u=s+c;r.maxEditLength&&(u=Math.min(u,r.maxEditLength));var d=null!==(n=r.timeout)&&void 0!==n?n:1/0,p=Date.now()+d,g=[{oldPos:-1,lastComponent:void 0}],h=this.extractCommon(g[0],t,e,0);if(g[0].oldPos+1>=c&&h+1>=s)return i([{value:this.join(t),count:t.length}]);var f=-1/0,m=1/0;function _(){for(var n=Math.max(f,-l);n<=Math.min(m,l);n+=2){var r=void 0,o=g[n-1],u=g[n+1];o&&(g[n-1]=void 0);var d=!1;if(u){var p=u.oldPos-n;d=u&&0<=p&&p<s}var _=o&&o.oldPos+1<c;if(d||_){if(r=!_||d&&o.oldPos+1<u.oldPos?a.addToPath(u,!0,void 0,0):a.addToPath(o,void 0,!0,1),h=a.extractCommon(r,t,e,n),r.oldPos+1>=c&&h+1>=s)return i(buildValues(a,r.lastComponent,t,e,a.useLongestToken));g[n]=r,r.oldPos+1>=c&&(m=Math.min(m,n-1)),h+1>=s&&(f=Math.max(f,n+1))}else g[n]=void 0}l++}if(o)!function e(){setTimeout((function(){if(l>u||Date.now()>p)return o();_()||e()}),0)}();else for(;l<=u&&Date.now()<=p;){var E=_();if(E)return E}},addToPath:function(e,t,n,r){var o=e.lastComponent;return o&&o.added===t&&o.removed===n?{oldPos:e.oldPos+r,lastComponent:{count:o.count+1,added:t,removed:n,previousComponent:o.previousComponent}}:{oldPos:e.oldPos+r,lastComponent:{count:1,added:t,removed:n,previousComponent:o}}},extractCommon:function(e,t,n,r){for(var o=t.length,a=n.length,i=e.oldPos,s=i-r,c=0;s+1<o&&i+1<a&&this.equals(t[s+1],n[i+1]);)s++,i++,c++;return c&&(e.lastComponent={count:c,previousComponent:e.lastComponent}),e.oldPos=i,s},equals:function(e,t){return this.options.comparator?this.options.comparator(e,t):e===t||this.options.ignoreCase&&e.toLowerCase()===t.toLowerCase()},removeEmpty:function(e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(e[n]);return t},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};var characterDiff=new Diff;function diffChars(e,t,n){return characterDiff.diff(e,t,n)}var extendedWordChars=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,reWhitespace=/\S/,wordDiff=new Diff;wordDiff.equals=function(e,t){return this.options.ignoreCase&&(e=e.toLowerCase(),t=t.toLowerCase()),e===t||this.options.ignoreWhitespace&&!reWhitespace.test(e)&&!reWhitespace.test(t)},wordDiff.tokenize=function(e){for(var t=e.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),n=0;n<t.length-1;n++)!t[n+1]&&t[n+2]&&extendedWordChars.test(t[n])&&extendedWordChars.test(t[n+2])&&(t[n]+=t[n+2],t.splice(n+1,2),n--);return t};var lineDiff=new Diff;lineDiff.tokenize=function(e){this.options.stripTrailingCr&&(e=e.replace(/\r\n/g,"\n"));var t=[],n=e.split(/(\n|\r\n)/);n[n.length-1]||n.pop();for(var r=0;r<n.length;r++){var o=n[r];r%2&&!this.options.newlineIsToken?t[t.length-1]+=o:(this.options.ignoreWhitespace&&(o=o.trim()),t.push(o))}return t};var sentenceDiff=new Diff;sentenceDiff.tokenize=function(e){return e.split(/(\S.+?[.!?])(?=\s+|$)/)};var cssDiff=new Diff;function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}cssDiff.tokenize=function(e){return e.split(/([{}:;,]|\s+)/)};var objectPrototypeToString=Object.prototype.toString,jsonDiff=new Diff;function canonicalize(e,t,n,r,o){var a,i;for(t=t||[],n=n||[],r&&(e=r(o,e)),a=0;a<t.length;a+=1)if(t[a]===e)return n[a];if("[object Array]"===objectPrototypeToString.call(e)){for(t.push(e),i=new Array(e.length),n.push(i),a=0;a<e.length;a+=1)i[a]=canonicalize(e[a],t,n,r,o);return t.pop(),n.pop(),i}if(e&&e.toJSON&&(e=e.toJSON()),"object"===_typeof(e)&&null!==e){t.push(e),i={},n.push(i);var s,c=[];for(s in e)e.hasOwnProperty(s)&&c.push(s);for(c.sort(),a=0;a<c.length;a+=1)i[s=c[a]]=canonicalize(e[s],t,n,r,s);t.pop(),n.pop()}else i=e;return i}jsonDiff.useLongestToken=!0,jsonDiff.tokenize=lineDiff.tokenize,jsonDiff.castInput=function(e){var t=this.options,n=t.undefinedReplacement,r=t.stringifyReplacer,o=void 0===r?function(e,t){return void 0===t?n:t}:r;return"string"==typeof e?e:JSON.stringify(canonicalize(e,null,null,o),o,"  ")},jsonDiff.equals=function(e,t){return Diff.prototype.equals.call(jsonDiff,e.replace(/,([\r\n])/g,"$1"),t.replace(/,([\r\n])/g,"$1"))};var arrayDiff=new Diff;function extractTextChangeEvents(e,t){const n=diffChars(e,t,{ignoreCase:!1});let r=0;const o=[];return n.forEach((e=>{e.added?(o.push(createTextChangeOperation(r,r,e.value)),r+=e.value.length):e.removed?o.push(createTextChangeOperation(r,r+e.value.length,"")):r+=e.value.length})),o}function wrapRequest(e){return e.$type===AppendMessage.$type?{$type:ParticipantRequest.$type,appendMessage:e}:{$type:ParticipantRequest.$type,updateAuthenticationTokenMessage:e}}function isNoOpTextChange(e){var t,n;return void 0!==e&&(null===(t=e.range)||void 0===t?void 0:t.start)===(null===(n=e.range)||void 0===n?void 0:n.end)&&0===e.text.length}function compactChanges(e){return e.reduce(((e,t)=>{if(isNoOpTextChange(t.textChangeOperation))return e;if(0===e.length)return[t];const n=e.at(-1);if(n.fieldName!==t.fieldName||!t.textChangeOperation||!n.textChangeOperation)return[...e,t];const r=n.textChangeOperation,o=t.textChangeOperation,a=o.range.start-r.range.start,i=o.range.end-r.range.start,s=Math.max(0,a),c=Math.min(r.text.length,i);if(s>c)return[...e,t];const l=Math.min(0,a),u=i-a-(c-s),d=wrapFieldEvent(createTextChangeOperation(r.range.start+l,r.range.end+l+u,r.text.slice(0,s)+o.text+r.text.slice(c)),t.fieldName);return[...e.slice(0,-1),d]}),new Array)}arrayDiff.tokenize=function(e){return e.slice()},arrayDiff.join=arrayDiff.removeEmpty=function(e){return e};const isFieldEvent=e=>"participantId"in e;var OperationOrder;function createTextRange(e,t){return{$type:TextRange.$type,start:e,end:t}}!function(e){e[e.BaseThenNew=0]="BaseThenNew",e[e.NewThenBase=1]="NewThenBase"}(OperationOrder||(OperationOrder={}));const transformTextChangeOntoTextChange=(e,t,n)=>{const r=e.range,o=t.range;if(r.start>o.end)return t;const a=e.text.length+r.start-r.end;if(r.end<o.start)return Object.assign(Object.assign({},t),{range:createTextRange(o.start+a,o.end+a)});const i=r.start<o.start||r.start===o.start&&n===OperationOrder.BaseThenNew,s=r.end<o.end;if(i){const n=r.start+e.text.length;return s?Object.assign(Object.assign({},t),{range:createTextRange(n,o.end+a)}):Object.assign(Object.assign({},t),{range:createTextRange(n,n)})}return s?Object.assign(Object.assign({},t),{range:createTextRange(o.start,o.end+a),text:t.text+e.text}):Object.assign(Object.assign({},t),{range:createTextRange(o.start,r.start)})},transformCreateAnnotationOntoTextChange=(e,t)=>{const n=e.range,r=t.range;if(n.start>r.end)return t;const o=e.text.length+n.start-n.end;if(n.end<r.start)return Object.assign(Object.assign({},t),{range:createTextRange(r.start+o,r.end+o)});const a=n.start<r.start,i=n.end<r.end,s=n.start+e.text.length;return a?i?Object.assign(Object.assign({},t),{range:createTextRange(s,r.end+o)}):n.end===r.end?Object.assign(Object.assign({},t),{range:createTextRange(s,s)}):Object.assign(Object.assign({},t),{range:createTextRange(n.start,n.start)}):i?n.start===r.start?Object.assign(Object.assign({},t),{range:createTextRange(s,r.end+o)}):Object.assign(Object.assign({},t),{range:createTextRange(r.start,r.end+o)}):Object.assign(Object.assign({},t),{range:createTextRange(r.start,s)})},transformSetPropertyOntoSetProperty=(e,t,n)=>e.propertyName!==t.propertyName||n===OperationOrder.BaseThenNew?t:e,transform=(e,t,n=OperationOrder.BaseThenNew)=>{var r,o;if(isRemoveAnnotationOperation(t)||isRemoveAnnotationOperation(e)||isCreateAnnotationOperation(e)||isTextChangeOperation(e)&&(null===(r=e.range)||void 0===r?void 0:r.start)===(null===(o=e.range)||void 0===o?void 0:o.end)&&0===e.text.length)return t;if(isSetPropertyOperation(e)&&isSetPropertyOperation(t))return transformSetPropertyOntoSetProperty(e,t,n);if(isSetPropertyOperation(e)||isSetPropertyOperation(t))return t;if(isTextChangeOperation(e)&&isTextChangeOperation(t))return transformTextChangeOntoTextChange(e,t,n);if(isTextChangeOperation(e)&&isCreateAnnotationOperation(t))return transformCreateAnnotationOntoTextChange(e,t);throw new Error(`Operational transform for operations of type [${null==e?void 0:e.$type}, ${null==t?void 0:t.$type}] not implemented.`)},pairwiseTransform=(e,t)=>[transform(t,e,OperationOrder.NewThenBase),transform(e,t,OperationOrder.BaseThenNew)],transformMany=(e,t)=>{let n=[...e];const r=t.map((e=>{let t=e;return n=n.map((e=>{const[n,r]=pairwiseTransform(e,t);return t=r,n})),t}));return[n,r]},transformEvents=(e,t)=>{let n=[...t];return{transformedIncomingEvents:e.map((e=>{let t=extractOperation(e);return n=n.map((n=>{if(e.fieldName!==n.fieldName)return n;const[r,o]=pairwiseTransform(extractOperation(e),extractOperation(n));return t=r,isFieldEvent(n)?wrapFieldEvent(o,n.fieldName,n.participantId):wrapFieldEvent(o,n.fieldName)})),wrapFieldEvent(t,e.fieldName,e.participantId)})),transformedExistingEvents:n}};class Field{constructor(e){this.name=e,this.content=new BehaviorSubject(""),this.annotations=[],this.annotationsRequiringTransformation=[],this.changeNotifier=new Subject,this.wasChanged=this.changeNotifier.asObservable(),this.properties=new Map}registerAnnotation(e){return e.config.requiresTransformation&&this.annotationsRequiringTransformation.push(e),this.annotations.push(e),e}registerProperty(e){return this.properties.set(e.propertyName,e),e}applyOperation(e){isTextChangeOperation(e)?this.applyTextChangeOperation(e):isCreateAnnotationOperation(e)?this.applyCreateAnnotationOperation(e):isRemoveAnnotationOperation(e)?this.applyRemoveAnnotationOperation(e):isSetPropertyOperation(e)&&this.applySetPropertyOperation(e)}applyTextChangeOperation(e){const t=applyTextChangeOperation(this.content.value,e);this.content.next(t),this.changeNotifier.next();for(const t of this.annotationsRequiringTransformation){const n=t.annotations.value.map((t=>Object.assign(Object.assign({},t),{operation:transform(e,t.operation)})));t.set(n)}}applyCreateAnnotationOperation(e){const t=extractAnnotationPayload(e),n=this.annotations.find((e=>e.payloadType===t.$type));n&&(n.applyCreateAnnotationOperation({operation:e,specificPayload:t}),this.changeNotifier.next())}applyRemoveAnnotationOperation(e){this.annotations.forEach((t=>t.applyRemoveAnnotationOperation(e))),this.changeNotifier.next()}applySetPropertyOperation(e){const{propertyName:t}=e,n=this.properties.get(t);n&&(n.applySetPropertyOperation(e),this.changeNotifier.next())}update(e){const t=extractTextChangeEvents(this.content.value,e);this.content.next(e),this.changeNotifier.next();for(const e of this.annotationsRequiringTransformation){const n=e.annotations.value,[r,o]=transformMany(t,n.map((e=>e.operation)));e.set(o.map(((e,t)=>Object.assign(Object.assign({},n[t]),{operation:e}))))}return t}serialize(){return{$type:Field$1.$type,fieldName:this.name,text:this.content.value,annotations:this.annotations.flatMap((e=>e.serialize())),properties:Array.from(this.properties.values()).map((e=>e.serialize()))}}prettyPrint(){return{fieldName:FieldName[this.name],text:this.content.value,annotations:this.annotations.flatMap((e=>e.prettyPrint())),properties:Array.from(this.properties.values()).map((e=>e.prettyPrint()))}}reset(){this.content.next(""),this.annotations.forEach((e=>e.reset())),this.properties.forEach((e=>e.reset())),this.changeNotifier.next()}}class PropertyContainer{constructor(e,t){this.propertyName=e,this.propertyType=t,this.value=new BehaviorSubject(void 0)}applySetPropertyOperation(e){const t=extractPropertyValue(e);if(void 0===t)return this.reset();if(t.$type!==this.propertyType)throw new Error(`PropertyValue has type ${t.$type}, but ${this.propertyType} expected`);this.value.next(t)}set(e){return this.value.next(e),[this.serialize()]}reset(){this.value.next(void 0)}serialize(){return wrapSetPropertyOperation(this.propertyName,this.value.value)}prettyPrint(){return{propertyName:PropertyName[this.propertyName],propertyValue:this.value.value}}}class TextDirectionProperty extends PropertyContainer{constructor(){super(PropertyName.TRANSLATOR_TEXT_DIRECTION,TextDirectionPropertyValue.$type),this.isRightToLeft=this.value.pipe(map((e=>(null==e?void 0:e.textDirection)===TextDirection.RIGHT_TO_LEFT)))}}const isMaximumTextLengthPropertyValue=e=>!!e;class MaximumTextLengthProperty extends PropertyContainer{constructor(){super(PropertyName.MAXIMUM_TEXT_LENGTH,MaximumTextLengthPropertyValue.$type),this.max=this.value.pipe(filter(isMaximumTextLengthPropertyValue),map((e=>e.max)))}}class CalculatedSourceLanguageProperty extends PropertyContainer{constructor(){super(PropertyName.TRANSLATOR_CALCULATED_SOURCE_LANGUAGE,CalculatedSourceLanguagePropertyValue.$type),this.language=this.value.pipe(filter((e=>!!e)),map((e=>{var t;return null===(t=e.sourceLanguage)||void 0===t?void 0:t.code}))),this.isAutoDetected=this.value.pipe(filter((e=>!!e)),map((e=>e.origin===CalculatedSourceLanguageOrigin.LANGUAGE_DETECTION)))}updateLanguage(e){return super.set({$type:CalculatedSourceLanguagePropertyValue.$type,sourceLanguage:{$type:SourceLanguage.$type,code:e},origin:CalculatedSourceLanguageOrigin.REQUESTED_LANGUAGE})}}class RequestedSourceLanguageProperty extends PropertyContainer{constructor(){super(PropertyName.TRANSLATOR_REQUESTED_SOURCE_LANGUAGE,RequestedSourceLanguagePropertyValue.$type),this.language=this.value.pipe(filter((e=>!!e)),map((e=>{var t,n;return null!==(n=null===(t=null==e?void 0:e.sourceLanguage)||void 0===t?void 0:t.code)&&void 0!==n?n:TRANSLATOR_DEFAULTS.requestedSourceLanguage})))}updateLanguage(e){if("autodetect"===e){return super.set(void 0)}return super.set({$type:RequestedSourceLanguagePropertyValue.$type,sourceLanguage:{$type:SourceLanguage.$type,code:e}})}}class SourceLanguagesProperty extends PropertyContainer{constructor(){super(PropertyName.TRANSLATOR_SOURCE_LANGUAGES,SourceLanguagesPropertyValue.$type),this.sourceLanguages=this.value.pipe(map((e=>{var t;return null!==(t=null==e?void 0:e.sourceLanguages.map((e=>e.code)))&&void 0!==t?t:[]})))}}class SourceTextField extends Field{constructor(){super(...arguments),this.calculatedSourceLanguageProperty=this.registerProperty(new CalculatedSourceLanguageProperty),this.requestedSourceLanguageProperty=this.registerProperty(new RequestedSourceLanguageProperty),this.sourceLanguagesProperty=this.registerProperty(new SourceLanguagesProperty),this.maximumTextLengthProperty=this.registerProperty(new MaximumTextLengthProperty),this.sourceTextUnitAnnotations=this.registerAnnotation(new AnnotationsContainer(TextUnitAnnotationPayload.$type,{requiresTransformation:!0})),this.textDirection=this.registerProperty(new TextDirectionProperty)}}class TargetLanguagesProperty extends PropertyContainer{constructor(){super(PropertyName.TRANSLATOR_TARGET_LANGUAGES,TargetLanguagesPropertyValue.$type),this.targetLanguages=this.value.pipe(map((e=>{var t;return null!==(t=null==e?void 0:e.targetLanguages.map((e=>e.code)))&&void 0!==t?t:[]})))}}class CalculatedTargetLanguageProperty extends PropertyContainer{constructor(){super(PropertyName.TRANSLATOR_CALCULATED_TARGET_LANGUAGE,CalculatedTargetLanguagePropertyValue.$type),this.language=this.value.pipe(filter((e=>!!e)),map((e=>{var t;return null===(t=e.targetLanguage)||void 0===t?void 0:t.code})))}updateLanguage(e){return super.set({$type:CalculatedTargetLanguagePropertyValue.$type,targetLanguage:{$type:TargetLanguage.$type,code:e}})}}class RequestedTargetLanguageProperty extends PropertyContainer{constructor(){super(PropertyName.TRANSLATOR_REQUESTED_TARGET_LANGUAGE,RequestedTargetLanguagePropertyValue.$type)}updateLanguage(e){return super.set({$type:RequestedTargetLanguagePropertyValue.$type,targetLanguage:{$type:TargetLanguage.$type,code:e}})}}class GlossarySupportProperty extends PropertyContainer{constructor(){super(PropertyName.TRANSLATOR_GLOSSARY_SUPPORT,GlossarySupportPropertyValue.$type),this.supported=this.value.pipe(map((e=>!!e)))}}class GlossaryListProperty extends PropertyContainer{constructor(){super(PropertyName.TRANSLATOR_GLOSSARY_LIST,GlossaryList.$type),this.entries=this.value.pipe(map((e=>{var t;return null!==(t=null==e?void 0:e.glossaryEntries)&&void 0!==t?t:[]})))}updateGlossaryList(e){return super.set(void 0===e?void 0:{$type:GlossaryList.$type,glossaryEntries:e})}}class GlossarySuggestionsProperty extends PropertyContainer{constructor(){super(PropertyName.TRANSLATOR_GLOSSARY_SUGGESTIONS,GlossaryList.$type)}}class FormalityModesProperty extends PropertyContainer{constructor(){super(PropertyName.TRANSLATOR_FORMALITY_MODES,FormalityModesPropertyValue.$type)}}class FormalityModeProperty extends PropertyContainer{constructor(){super(PropertyName.TRANSLATOR_FORMALITY_MODE,FormalityModePropertyValue.$type)}update(e){return super.set(void 0===e?void 0:{$type:FormalityModePropertyValue.$type,formalityMode:e})}}class LanguageModelsProperty extends PropertyContainer{constructor(){super(PropertyName.TRANSLATOR_LANGUAGE_MODELS,LanguageModelsPropertyValue.$type)}}class LanguageModelProperty extends PropertyContainer{constructor(){super(PropertyName.TRANSLATOR_LANGUAGE_MODEL,LanguageModelPropertyValue.$type)}update(e){return super.set(void 0===e?void 0:{$type:LanguageModelPropertyValue.$type,languageModel:e})}}class GlossaryIdProperty extends PropertyContainer{constructor(){super(PropertyName.TRANSLATOR_GLOSSARY_ID,GlossaryIdPropertyValue.$type)}update(e){return super.set(void 0===e?void 0:{$type:GlossaryIdPropertyValue.$type,glossaryId:e})}}class TargetTextField extends Field{constructor(){super(...arguments),this.requestedTargetLanguageProperty=this.registerProperty(new RequestedTargetLanguageProperty),this.calculatedTargetLanguageProperty=this.registerProperty(new CalculatedTargetLanguageProperty),this.targetLanguagesProperty=this.registerProperty(new TargetLanguagesProperty),this.requestWordAlternativesAnnotations=this.registerAnnotation(new AnnotationsContainer(RequestWordAlternativesAnnotationPayload.$type)),this.providedWordAlternativesAnnotations=this.registerAnnotation(new AnnotationsContainer(ProvidedWordAlternativesAnnotationPayload.$type)),this.selectWordAlternativeAnnotations=this.registerAnnotation(new AnnotationsContainer(SelectWordAlternativeAnnotationPayload.$type)),this.requestTextUnitAlternativesAnnotations=this.registerAnnotation(new AnnotationsContainer(RequestTextUnitAlternativesAnnotationPayload.$type)),this.providedTextUnitAlternativesAnnotations=this.registerAnnotation(new AnnotationsContainer(ProvidedTextUnitAlternativesAnnotationPayload.$type)),this.selectTextUnitAlternativeAnnotations=this.registerAnnotation(new AnnotationsContainer(SelectTextUnitAlternativeAnnotationPayload.$type)),this.requestAutocompletionAnnotations=this.registerAnnotation(new AnnotationsContainer(RequestAutocompletionAnnotationPayload.$type)),this.providedAutocompletionAnnotations=this.registerAnnotation(new AnnotationsContainer(ProvidedAutocompletionAnnotationPayload.$type)),this.selectAutocompletionAnnotations=this.registerAnnotation(new AnnotationsContainer(SelectAutocompletionAnnotationPayload.$type)),this.providedAutomaticTextUnitAlternativesAnnotations=this.registerAnnotation(new AnnotationsContainer(ProvidedAutomaticTextUnitAlternativesAnnotationPayload.$type)),this.selectAutomaticTextUnitAlternativeAnnotations=this.registerAnnotation(new AnnotationsContainer(SelectAutomaticTextUnitAlternativeAnnotationPayload.$type)),this.targetTextUnitAnnotations=this.registerAnnotation(new AnnotationsContainer(TextUnitAnnotationPayload.$type,{requiresTransformation:!0})),this.glossaryReplacementAnnotations=this.registerAnnotation(new AnnotationsContainer(GlossaryReplacementAnnotationPayload.$type,{requiresTransformation:!0})),this.glossarySupport=this.registerProperty(new GlossarySupportProperty),this.glossaryListProperty=this.registerProperty(new GlossaryListProperty),this.glossarySuggestions=this.registerProperty(new GlossarySuggestionsProperty),this.formalityModes=this.registerProperty(new FormalityModesProperty),this.formalityMode=this.registerProperty(new FormalityModeProperty),this.languageModels=this.registerProperty(new LanguageModelsProperty),this.languageModel=this.registerProperty(new LanguageModelProperty),this.textDirection=this.registerProperty(new TextDirectionProperty),this.glossaryId=this.registerProperty(new GlossaryIdProperty),this.maximumTextLengthProperty=this.registerProperty(new MaximumTextLengthProperty)}}class TargetTranscriptionTextField extends Field{constructor(){super(...arguments),this.targetTranscriptionTextUnitAnnotations=this.registerAnnotation(new AnnotationsContainer(TextUnitAnnotationPayload.$type,{requiresTransformation:!0}))}}class TranslatorDocument extends Document$1{constructor(){super(...arguments),this.sourceTextField=this.registerField(new SourceTextField(FieldName.TRANSLATOR_SOURCE_TEXT)),this.targetTextField=this.registerField(new TargetTextField(FieldName.TRANSLATOR_TARGET_TEXT)),this.targetTranscriptionTextField=this.registerField(new TargetTranscriptionTextField(FieldName.TRANSLATOR_TARGET_TRANSCRIPTION_TEXT)),this.textUnitAnnotations=combineLatest([this.sourceTextField.sourceTextUnitAnnotations.annotations,this.targetTextField.targetTextUnitAnnotations.annotations,this.targetTranscriptionTextField.targetTranscriptionTextUnitAnnotations.annotations]).pipe(map((e=>{const t=e[0],n=e[1],r=e[2];return t.sort(((e,t)=>e.operation.range.start-t.operation.range.start)).map((e=>{var t,o,a,i;const s=e.operation.range,c=null!==(o=null===(t=n.find((t=>{var n,r;return(null===(n=e.specificPayload.textUnitId)||void 0===n?void 0:n.value)===(null===(r=t.specificPayload.textUnitId)||void 0===r?void 0:r.value)})))||void 0===t?void 0:t.operation.range)&&void 0!==o?o:TextRange.fromJSON({}),l=null!==(i=null===(a=r.find((t=>{var n,r;return(null===(n=e.specificPayload.textUnitId)||void 0===n?void 0:n.value)===(null===(r=t.specificPayload.textUnitId)||void 0===r?void 0:r.value)})))||void 0===a?void 0:a.operation.range)&&void 0!==i?i:TextRange.fromJSON({});return{sourceStart:s.start,sourceEnd:s.end,sourceLength:s.end-s.start,targetStart:c.start,targetEnd:c.end,targetLength:c.end-c.start,targetTranscriptionStart:l.start,targetTranscriptionEnd:l.end,targetTranscriptionLength:l.end-l.start}}))})))}}class Translator extends Client{constructor(){super("Translator",SessionMode.TRANSLATOR,new TranslatorDocument),this.targetLanguage=this.document.targetTextField.requestedTargetLanguageProperty.value.pipe(map((e=>{var t,n;return null!==(n=null===(t=null==e?void 0:e.targetLanguage)||void 0===t?void 0:t.code)&&void 0!==n?n:TRANSLATOR_DEFAULTS.requestedTargetLanguage})))}applyFieldEvent(e){if(e.fieldName===FieldName.TRANSLATOR_TARGET_TEXT&&e.textChangeOperation){const e=[];e.push(...this.cancelTextUnitAlternativesFlows()),e.push(...this.cancelWordAlternativesFlows()),e.push(...this.cancelAutocompletionFlows()),this.publishChange(FieldName.TRANSLATOR_TARGET_TEXT,e)}this.document.applyItaEvent(e)}updateSourceText(e){const t=this.document.sourceTextField.update(e);this.publishChange(FieldName.TRANSLATOR_SOURCE_TEXT,t)}updateTargetText(e){const t=[];t.push(...this.cancelTextUnitAlternativesFlows()),t.push(...this.cancelWordAlternativesFlows()),t.push(...this.cancelAutocompletionFlows()),t.push(...this.document.targetTextField.update(e)),this.publishChange(FieldName.TRANSLATOR_TARGET_TEXT,t)}updateRequestedTargetLanguage(e){const t=this.document.targetTextField.requestedTargetLanguageProperty.updateLanguage(e);this.publishChange(FieldName.TRANSLATOR_TARGET_TEXT,t)}updateRequestedSourceLanguage(e){const t=this.document.sourceTextField.requestedSourceLanguageProperty.updateLanguage(e);this.publishChange(FieldName.TRANSLATOR_SOURCE_TEXT,t)}switchLanguages(e){var t,n,r,o,a,i,s;const c=null===(n=null===(t=this.document.sourceTextField.calculatedSourceLanguageProperty.value.value)||void 0===t?void 0:t.sourceLanguage)||void 0===n?void 0:n.code,l=null===(o=null===(r=this.document.targetTextField.calculatedTargetLanguageProperty.value.value)||void 0===r?void 0:r.targetLanguage)||void 0===o?void 0:o.code,u=this.document.targetTextField.content.value;if(!c||!l)return;const d=null!==(i=null===(a=this.document.sourceTextField.maximumTextLengthProperty.value.value)||void 0===a?void 0:a.max)&&void 0!==i?i:0,p=u.slice(0,d),g=l.split("-")[0],h=null!==(s=e[c])&&void 0!==s?s:c;this.publishChanges([[FieldName.TRANSLATOR_TARGET_TEXT,[...this.document.targetTextField.update("")]],[FieldName.TRANSLATOR_SOURCE_TEXT,[...this.document.sourceTextField.update("")]],[FieldName.TRANSLATOR_TARGET_TEXT,[...this.document.targetTextField.requestedTargetLanguageProperty.updateLanguage(h)]],[FieldName.TRANSLATOR_SOURCE_TEXT,[...this.document.sourceTextField.requestedSourceLanguageProperty.updateLanguage(g),...this.document.sourceTextField.update(p)]]]),this.document.sourceTextField.calculatedSourceLanguageProperty.updateLanguage(g)}cancelWordAlternativesFlows(){return this.document.targetTextField.requestWordAlternativesAnnotations.annotations.value.flatMap((e=>this.document.targetTextField.requestWordAlternativesAnnotations.removeAnnotation(e.operation.annotationId)))}cancelTextUnitAlternativesFlows(){return this.document.targetTextField.requestTextUnitAlternativesAnnotations.annotations.value.flatMap((e=>this.document.targetTextField.requestTextUnitAlternativesAnnotations.removeAnnotation(e.operation.annotationId)))}cancelAutocompletionFlows(){return this.document.targetTextField.requestAutocompletionAnnotations.annotations.value.flatMap((e=>this.document.targetTextField.requestAutocompletionAnnotations.removeAnnotation(e.operation.annotationId)))}requestWordAlternatives(e){const t=[];t.push(...this.cancelWordAlternativesFlows());const n=this.document.targetTextField.requestWordAlternativesAnnotations.add(e,e,{$type:RequestWordAlternativesAnnotationPayload.$type,flowId:{$type:WordAlternativesFlowId.$type,value:crypto.randomUUID()}})[0];t.push(n),this.publishChange(FieldName.TRANSLATOR_TARGET_TEXT,t)}requestTextUnitAlternatives(e){const t=[];t.push(...this.cancelTextUnitAlternativesFlows());const n=this.document.targetTextField.requestTextUnitAlternativesAnnotations.add(e,e,{$type:RequestTextUnitAlternativesAnnotationPayload.$type,flowId:{$type:TextUnitAlternativesFlowId.$type,value:crypto.randomUUID()}})[0];t.push(n),this.publishChange(FieldName.TRANSLATOR_TARGET_TEXT,t)}requestAutocompletion(e){const t=[];t.push(...this.cancelAutocompletionFlows());const n=this.document.targetTextField.requestAutocompletionAnnotations.add(e,e,{$type:RequestAutocompletionAnnotationPayload.$type,flowId:{$type:AutocompletionFlowId.$type,value:crypto.randomUUID()}})[0];t.push(n),this.publishChange(FieldName.TRANSLATOR_TARGET_TEXT,t)}selectWordAlternative(e,t,n){const r=[];r.push(...this.cancelTextUnitAlternativesFlows()),r.push(...this.cancelAutocompletionFlows());const o=this.document.targetTextField.selectWordAlternativeAnnotations.add(e,e,{$type:SelectWordAlternativeAnnotationPayload.$type,flowId:{$type:WordAlternativesFlowId.$type,value:t},selection:n});r.push(...o),this.publishChange(FieldName.TRANSLATOR_TARGET_TEXT,r)}selectTextUnitAlternative(e,t,n){const r=[];r.push(...this.cancelWordAlternativesFlows()),r.push(...this.cancelAutocompletionFlows());const o=this.document.targetTextField.selectTextUnitAlternativeAnnotations.add(e,e,{$type:SelectTextUnitAlternativeAnnotationPayload.$type,flowId:{$type:TextUnitAlternativesFlowId.$type,value:t},selection:n});r.push(...o),this.publishChange(FieldName.TRANSLATOR_TARGET_TEXT,r)}selectAutocompletion(e,t,n){const r=[];r.push(...this.cancelWordAlternativesFlows()),r.push(...this.cancelTextUnitAlternativesFlows());const o=this.document.targetTextField.selectAutocompletionAnnotations.add(e,e,{$type:SelectAutocompletionAnnotationPayload.$type,flowId:{$type:AutocompletionFlowId.$type,value:t},selection:n});r.push(...o),this.publishChange(FieldName.TRANSLATOR_TARGET_TEXT,r)}selectAutomaticTextUnitAlternative(e,t){const n=[],r=this.document.targetTextField.selectAutomaticTextUnitAlternativeAnnotations.add(e,e,{$type:SelectAutomaticTextUnitAlternativeAnnotationPayload.$type,selection:t});n.push(...r),this.publishChange(FieldName.TRANSLATOR_TARGET_TEXT,n)}updateGlossaryList(e){const t=this.document.targetTextField.glossaryListProperty.updateGlossaryList(e);this.publishChange(FieldName.TRANSLATOR_TARGET_TEXT,t)}updateFormalityMode(e){const t=this.document.targetTextField.formalityMode.update(e);this.publishChange(FieldName.TRANSLATOR_TARGET_TEXT,t)}updateLanguageModel(e){const t=this.document.targetTextField.languageModel.update(e);this.publishChange(FieldName.TRANSLATOR_TARGET_TEXT,t)}updateGlossaryId(e){const t=this.document.targetTextField.glossaryId.update(e);this.publishChange(FieldName.TRANSLATOR_TARGET_TEXT,t)}}function isParticipantResponse(e){return e.$type===ParticipantResponse.$type}function isParticipantRequest(e){return e.$type===ParticipantRequest.$type}function isConfirmedMessage(e){return e.$type===ConfirmedMessage.$type}function isInitializedMessage(e){return e.$type===InitializedMessage.$type}function isPublishedMessage(e){return e.$type===PublishedMessage.$type}function isMetaInfoMessage(e){return e.$type===MetaInfoMessage.$type}function extractParticipantResponseMessage(e){if(null==e?void 0:e.confirmedMessage)return e.confirmedMessage;if(null==e?void 0:e.initializedMessage)return e.initializedMessage;if(null==e?void 0:e.publishedMessage)return e.publishedMessage;if(null==e?void 0:e.metaInfoMessage)return e.metaInfoMessage;throw new Error("ParticipantResponse does not contain a message")}function extractParticipantRequestMessage(e){if(null==e?void 0:e.appendMessage)return e.appendMessage;if(null==e?void 0:e.updateAuthenticationTokenMessage)return e.updateAuthenticationTokenMessage;throw new Error("ParticipantRequest does not contain a message")}function extractMessage(e){if(isParticipantResponse(e))return extractParticipantResponseMessage(e);if(isParticipantRequest(e))return extractParticipantRequestMessage(e);throw new Error("Extracting message failed, you need to pass a ParticipantRequest or ParticipantResponse")}function createAppendMessage(e,t){return{$type:AppendMessage.$type,events:e,baseVersion:t}}class EventHandler{constructor(e){this.currentVersion={$type:EventVersion.$type,version:void 0},this.isInitialized=!1,this.pendingEvents=[],this.sentEvents=[],this.confirmedEvents=[],this.incomingEvents=e.pipe(map((e=>extractMessage(e))),tap((e=>{isConfirmedMessage(e)&&this.handleConfirmedMessage(e),isInitializedMessage(e)&&this.handleInitializedMessage()})),filter((e=>isPublishedMessage(e))),map((e=>this.handlePublished(e))),switchMap((e=>from(e))),share())}addClientEvents(e){this.pendingEvents.push(...e),this.trySendPendingEvents()}handleConfirmedMessage(e){this.currentVersion=e.currentVersion,this.confirmedEvents.push(...this.sentEvents),this.sentEvents=[],this.trySendPendingEvents()}handlePublished(e){const t=e.events,{transformedIncomingEvents:n,transformedExistingEvents:r}=transformEvents(t,this.pendingEvents);this.pendingEvents=r;const{transformedIncomingEvents:o,transformedExistingEvents:a}=transformEvents(n,this.sentEvents);return this.sentEvents=a,this.confirmedEvents.push(...o),this.currentVersion=e.currentVersion,this.trySendPendingEvents(),o}connectToSession(e){this.sendEvents=e,this.trySendPendingEvents()}trySendPendingEvents(){0===this.pendingEvents.length||this.sentEvents.length>0||!this.isInitialized||!this.sendEvents||(this.sentEvents=this.sendEvents(compactChanges(this.pendingEvents),this.currentVersion),this.pendingEvents=[])}handleInitializedMessage(){this.sentEvents.length>0&&this.sendEvents(this.sentEvents,this.currentVersion),this.isInitialized=!0,this.trySendPendingEvents()}}var __awaiter=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){e.done?o(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(i,s)}c((r=r.apply(e,t||[])).next())}))},Status;!function(e){e[e.Connecting=0]="Connecting",e[e.Reconnecting=1]="Reconnecting",e[e.Restoring=2]="Restoring",e[e.Connected=3]="Connected",e[e.Disconnected=4]="Disconnected"}(Status||(Status={}));class ConnectionError extends Error{constructor(){super(...arguments),this.name="ConnectionError"}}class SessionError extends Error{constructor(e){super("There was an error with the session on the server. See the info property for details."),this.info=e,this.name="SessionError"}}class Session{constructor(e,t,n,r){this.connection=e,this.config=t,this.client=n,this.metaInfo=r,this.participantResponses=new Subject,this.participantRequests=new Subject,this.errorInfoSubject=new Subject,this.error=this.errorInfoSubject.asObservable(),this.statusSubject=new BehaviorSubject(Status.Disconnected),this.status=this.statusSubject.asObservable(),this.messages=merge(this.participantResponses,this.participantRequests).pipe(scan(((e,t)=>[...e,t]),[]),shareReplay()),this.eventHandler=new EventHandler(this.participantResponses),this.client.addChangeHandler((e=>this.eventHandler.addClientEvents(e))),this.eventHandler.incomingEvents.subscribe((e=>this.client.applyFieldEvent(e))),this.participantResponses.pipe(map(extractMessage),filter(isMetaInfoMessage)).subscribe((e=>{var t;return null===(t=this.metaInfo)||void 0===t?void 0:t.addMetaInfoMessage(e)})),this.connection.on("OnError",(e=>{var t;"1000_participant_evicted"===(null===(t=null==e?void 0:e.detailCode)||void 0===t?void 0:t.value)?this.errorInfoSubject.next(new ConnectionError("Participant was manually evicted by the server.")):this.errorInfoSubject.next(new SessionError(e)),this.statusSubject.next(Status.Disconnected)})),this.connection.onclose((e=>{this.errorInfoSubject.next(new ConnectionError(`The connection was closed with error: ${e}`)),this.statusSubject.next(Status.Disconnected)}))}connect(e){return __awaiter(this,void 0,void 0,(function*(){if(this.statusSubject.value===Status.Disconnected){if(this.startSessionResponse&&!e?this.statusSubject.next(Status.Reconnecting):this.statusSubject.next(Status.Connecting),this.connection.state!==HubConnectionState.Connected)try{yield this.connection.start()}catch(e){throw this.statusSubject.next(Status.Disconnected),new ConnectionError(`Error starting connection: ${e}`)}if(!this.startSessionResponse||e){const t={$type:StartSessionRequest.$type,sessionMode:this.client.sessionMode,baseDocument:e,translatorSessionOptions:{$type:SessionOptions.$type,enableTranscription:this.config.enableTranscription}};try{this.startSessionResponse=yield this.connection.invoke("StartSession",t)}catch(e){throw this.statusSubject.next(Status.Disconnected),new ConnectionError(`Error starting session: ${e}`)}}this.connection.stream("GetMessages",this.startSessionResponse.sessionToken,this.eventHandler.currentVersion).subscribe({next:e=>{this.statusSubject.value!==Status.Connected&&this.statusSubject.next(Status.Connected),this.participantResponses.next(e)},error:()=>{},complete:()=>{}});try{yield this.connection.send("AppendMessages",this.startSessionResponse.sessionToken,this.participantRequests)}catch(e){throw this.statusSubject.next(Status.Disconnected),new ConnectionError(`Error starting 'AppendMessages': ${e}`)}this.eventHandler.connectToSession(((e,t)=>{const n=e.map((e=>Object.assign(Object.assign({},e),{participantId:this.startSessionResponse.participantId}))),r=wrapRequest(createAppendMessage(n,t));return this.participantRequests.next(r),n})),this.config.accessToken.pipe(skipUntil(this.status.pipe(filter((e=>e===Status.Connected))))).subscribe((e=>this.updateAuthenticationToken(e)))}}))}restore(){return __awaiter(this,void 0,void 0,(function*(){this.statusSubject.next(Status.Restoring);const e=this.client.document.serialize();this.client.document.reset();const t=new Session(this.connection,this.config,this.client,this.metaInfo);return yield t.connect(e),t}))}updateAuthenticationToken(e){this.participantRequests.next(wrapRequest({$type:UpdateAuthenticationTokenMessage.$type,token:e}))}}class ItaSdk{constructor(e,t){this.serverUrl=e;const n=new URL(e);n.pathname+="/sessions",this.accessTokenSubject=new BehaviorSubject(t);const r=(new HubConnectionBuilder).withHubProtocol(new MessagePackHubProtocol({extensionCodec:createProtobufExtensionCodec()})).configureLogging(LogLevel.Critical);t?r.withUrl(n.toString(),{accessTokenFactory:()=>this.accessTokenSubject.value}):r.withUrl(n.toString()),this.connection=r.build()}createSession(e,t,n){const r=Object.assign(Object.assign({},{enableTranscription:!1}),n);return new Session(this.connection,Object.assign({accessToken:this.accessTokenSubject.pipe(filter((e=>"string"==typeof e)))},r),e,t)}updateAccessToken(e){this.accessTokenSubject.next(e)}}const MESSAGE_KEYS={ITA_REQUEST_TRANSLATION:"ITA_REQUEST_TRANSLATION",ITA_SOURCE_LANGUAGE:"ITA_SOURCE_LANGUAGE",ITA_SOURCE_LANGUAGE_IS_AUTO_DETECTED:"ITA_SOURCE_LANGUAGE_IS_AUTO_DETECTED",ITA_TARGET_TEXT_FIELD:"ITA_TARGET_TEXT_FIELD",ITA_UPDATE_TARGET_LANGUAGE:"ITA_UPDATE_TARGET_LANGUAGE"},translators={};async function createITATranslatorSession(e,t,n){const r=new ItaSdk({dapApi:"https://s.deepl.com/chrome/statistics",toolingApiPro:"https://api.deepl.com/jsonrpc?client=chrome-extension,1.26.1",toolingApi:"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.26.1",toolingWriteApiPro:"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.26.1",toolingWriteApi:"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.26.1",classicApi:"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.26.1",classicApiPro:"https://api.deepl.com/jsonrpc?client=chrome-extension,1.26.1",classicApiWrite:"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.26.1",classicApiWritePro:"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.26.1",classicApiGlossary:"https://api.deepl.com/termbases/jsonrpc?client=chrome-extension,1.26.1",login:"https://www.deepl.com/auth/login",token:"https://w.deepl.com/oidc/token",logout:"https://www.deepl.com/auth/logout",feedbackSurvey:"https://deepl.typeform.com/to/MkMfP2Y6",newFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_cMvbeX0WZGvkKGi",firefoxFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_eyfDZqQmXuNTFOK",uninstallSurvey:"https://deepl.qualtrics.com/jfe/form/SV_eJxAD8c7J5hqSRU",gslidesFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_9XBLSAbDmLq5emO",deeplPro:"https://www.deepl.com/pro",deeplProWrite:"https://www.deepl.com/pro-write",deeplTranslator:"https://www.deepl.com/translator",deeplDoctrans:"https://www.deepl.com/translator/files",deeplTermsOfServiceFree:"https://www.deepl.com/en/pro-license?tab=free",deeplCreateAccount:"https://www.deepl.com/signup",extensionStorePage:"https://bit.ly/DeepL-Chrome",supportArticle:"https://support.deepl.com/hc/articles/4407580229522",deeplSupport:"https://support.deepl.com/hc",chromeWebstore:"https://chrome.google.com/webstore/detail/deepl-translate-reading-w/cofdbpoegempjloogbagkncekinflcnj",edgeWebstore:"https://microsoftedge.microsoft.com/addons/detail/deepl-translate-reading-/fancfknaplihpclbhbpclnmmjcjanbaf",firefoxWebstore:"https://addons.mozilla.org/en-US/firefox/addon/deepl-translate",firefoxShortcutDocs:"https://support.mozilla.org/kb/manage-extension-shortcuts-firefox",firefoxPrivacyPolicy:"https://addons.mozilla.org/en-US/firefox/addon/deepl-translate/privacy/",clientStateApi:"https://w.deepl.com/web",experimentsEndpoint:"https://s.deepl.com/chrome/experiments",gmailFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_db8ItFTmYBcZjYW",customerSegmentationSurveyFree:"https://deepl.qualtrics.com/jfe/form/SV_3LbBcdg4mjQuCCq?desc=TG-2071",customerSegmentationSurveyPro:"https://deepl.qualtrics.com/jfe/form/SV_3LbBcdg4mjQuCCq?desc=TG-2070",arabicSurvey:"https://deepl.qualtrics.com/jfe/form/SV_ekTrC2ePp0wn7xQ",msAddinsDeepLAds:"https://www.deepl.com/en/microsoft-365"}.interactiveTestApiFree),o=new Translator,a=r.createSession(o);await a.connect(),translators[n]=o,addSubscribers(o,n),o.updateRequestedTargetLanguage(getLanguageInITAFormat(t)),o.updateSourceText(e)}function addSubscribers(e,t){e.document.targetTextField.content.subscribe((e=>{t.postMessage({type:MESSAGE_KEYS.ITA_TARGET_TEXT_FIELD,payload:{targetText:e}})})),e.document.sourceTextField.calculatedSourceLanguageProperty.language.subscribe((e=>{t.postMessage({type:MESSAGE_KEYS.ITA_SOURCE_LANGUAGE,payload:{language:e}})})),e.document.sourceTextField.calculatedSourceLanguageProperty.isAutoDetected.subscribe((e=>{t.postMessage({type:MESSAGE_KEYS.ITA_SOURCE_LANGUAGE_IS_AUTO_DETECTED,payload:{isAutoDetected:e}})}))}function getActiveTranslator(e){return e in translators?translators[e]:null}function updateITATargetLanguage(e,t){e.updateRequestedTargetLanguage(getLanguageInITAFormat(t))}async function fetchExperiments(e=!1){if(!e){let e;try{e=await getCachedExperiments()}catch(e){}if(e)return e}const t=await getInstallationId();if(!t)throw new Error("Installtion ID is not valid");let n=[];try{n=await getCurrentExperiments()}catch(e){}const r=`https://s.deepl.com/chrome/experiments/${t}`;let o;try{const e=await fetch(r,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:JSON.stringify(n),credentials:"omit"});if(o=(await e.json()).client_experiments,!o)return n;try{cacheExperiments(o)}catch(e){}return o}catch(e){return n}}const DL_OIDC_ERROR_CODES={ACCESS_DENIED:"ACCESS_DENIED",INVALID_REQUEST:"INVALID_REQUEST",INVALID_GRANT:"INVALID_GRANT",GET_TOKEN_ERROR:"GET_TOKEN_ERROR",INVALID_NONCE:"INVALID_NONCE"};class AccessDenied extends Error{constructor(e,t){super(e),this.name=DL_OIDC_ERROR_CODES.ACCESS_DENIED,this.message=e,this.httpStatusCode=t}}class InvalidRequest extends Error{constructor(e,t){super(e),this.name=DL_OIDC_ERROR_CODES.INVALID_REQUEST,this.message=e,this.httpStatusCode=t}}class InvalidGrant extends Error{constructor(e,t){super(e),this.name=DL_OIDC_ERROR_CODES.INVALID_GRANT,this.message=e,this.httpStatusCode=t}}class GetTokenError extends Error{constructor(e,t){super(e),this.name=DL_OIDC_ERROR_CODES.GET_TOKEN_ERROR,this.message=e,this.httpStatusCode=t}}class InvalidNonce extends Error{constructor(e){super(e),this.name=DL_OIDC_ERROR_CODES.INVALID_NONCE,this.message=e}}function getQueryParameter(e,t){const n=e.split("?")[1];if(n){var r=n.split("&");for(let e=0;e<r.length;e++){const n=r[e].split("=");if(decodeURIComponent(n[0])===t)return decodeURIComponent(n[1])}}}async function createLoginParameters(e,t,n="https://test.deepl.com/oidc-login"){const r=createRandomString(),o=createRandomString(),a=await createCodeChallenge(o);return{url:n+"?"+new URLSearchParams([["client_id",e],["redirect_uri",t],["code_challenge",a],["code_challenge_method","S256"],["nonce",r]]),nonce:r,codeVerifier:o}}async function getTokens(e,t,n,r,o,a="https://deepl.com/oidc/token"){const i=getQueryParameter(n,"code");if(!i){const e=getQueryParameter(n,"error");if("access_denied"===e)throw new AccessDenied("dl-oidc (get tokens): access denied - undefined code",401);if("invalid_request"===e)throw new InvalidRequest("dl-oidc (get tokens): invalid request - undefined code",400)}let s={client_id:e,code_verifier:o,grant_type:"authorization_code",redirect_uri:t};i&&(s.code=i);const c=await fetch(`${a}`,{method:"POST",credentials:"omit",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(s)}),l=await c.json();errorHandlingTokenRequest(c.status,l);if(parseJwtToken(l.id_token).nonce!==r)throw new InvalidNonce("dl-oidc (get tokens): invalid nonce");return l}function errorHandlingTokenRequest(e,t){if(200!==e){if("invalid_request"===t.error)throw new InvalidRequest(`dl-oidc (get tokens): invalid request - http status: ${e}`,e);if("invalid_grant"===t.error)throw new InvalidGrant(`dl-oidc (get tokens): invalid grant - http status: ${e}`,e);throw new GetTokenError(`dl-oidc (get tokens): http status: ${e}`,e)}}async function refreshAccessToken(e,t="https://deepl.com/oidc/token"){const n=await fetch(t,{method:"POST",credentials:"omit",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:e})}),r=await n.json();return errorHandlingTokenRequest(n.status,r),r.access_token}async function authFetch(e,t,n=!1){let r=t.access_token;async function o(){return await fetch(e,{...t,headers:{...t.headers,Authorization:r?`Bearer ${r}`:"None"},...t.omitCookies&&{credentials:"omit"}})}n&&r&&(r=await refreshAccessToken(t.refresh_token,t.token_url));let a=await o();return 401!==a.status&&403!==a.status||(r=await refreshAccessToken(t.refresh_token,t.token_url),a=await o()),{response:a,accessToken:r}}function jsonrpc_composeMethodCallDict$2(e,t,n){return{jsonrpc:"2.0",method:e,params:t,id:n}}async function fetchClientState(e=!1,t=!0){if(!e){const e=await getCachedClientState();if(e)return e}const n=jsonrpc_composeMethodCallDict$2("getClientState",{v:"20180814"},getRandomUInt32()),r=await getAuthTokens(),o=t||isAccessTokenExpired(r.access_token),{response:a,accessToken:i}=await authFetch("https://w.deepl.com/web",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(n),access_token:r.access_token,refresh_token:r.refresh_token,token_url:"https://w.deepl.com/oidc/token",credentials:"omit"},o);await setAuthTokens(i,r.refresh_token,r.id_token);const s=(await a.json()).result;return s&&(cacheClientState(s),setUserInfoFromClientState(s)),s}async function login(e=!1){try{await(async()=>{const t=await createLoginParameters("chromeExtension",chrome.identity.getRedirectURL(),"https://www.deepl.com/auth/login");return new Promise(((n,r)=>{chrome.identity.launchWebAuthFlow({interactive:!0,url:e?`${t.url}#error_loginfailed`:t.url},(async e=>{if(!e){const e=chrome.runtime.lastError.message;return console.error("response url undefined",e),trackErrorMessage(`login - response url undefined. ${e}`,Sentry),/The user did not approve access/gm.test(e)||/User cancelled or denied access/gm.test(e)?n():r()}try{const r=await getTokens("chromeExtension",chrome.identity.getRedirectURL(),e,t.nonce,t.codeVerifier,"https://w.deepl.com/oidc/token"),o=await setAuthTokens(r.access_token,r.refresh_token,r.id_token);try{await fetchClientState(!0,!1),sendDAPLogin(),sendDAPLoggedIn(),o&&await sendDAPtrackSessionType({sessionType:o,trigger:"LOGIN"})}catch(e){console.error(e)}await markLoginTimestamp(),n()}catch(e){console.error(e);try{sendDAPErrorData({errorCode:e.name,errorMessage:e.message})}catch(e){console.error(e)}r(e)}}))}))})()}catch(e){login(!0)}}async function logout(e){const t=await getAuthTokens(),n=new URLSearchParams([["id_token_hint",t.id_token],["post_logout_redirect_uri",chrome.identity.getRedirectURL()]]),r=async()=>{await clearLoginTimestamp();try{await sendDAPLoggedOut()}catch(e){console.error(e)}await deleteAuthTokens();try{await sendDAPLogout({trigger:e.trigger,reason:e.reason})}catch(e){console.error(e)}await fetchClientState(!0),resetGlossary(),e.showAlert&&chrome.tabs.query({active:!0,currentWindow:!0},(function(t){chrome.tabs.sendMessage(t[0].id,{action:"dlShowAlert",payload:{error:e.reason}})}))};if(!t.id_token)return void await r();const o=`https://www.deepl.com/auth/logout?${n}`;chrome.identity.launchWebAuthFlow({url:o,interactive:!0},(()=>{r()}))}async function utils_sendPOSTRequest(e,t,n,r){const o=await getAuthTokens(),a=await isProServiceLevel(SERVICE_NAME.TRANSLATOR),i=await isProServiceLevel(SERVICE_NAME.WRITE);let s=o&&o.access_token&&a?"https://api.deepl.com/jsonrpc?client=chrome-extension,1.26.1":"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.26.1";r&&(s=o&&o.access_token&&i?"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.26.1":"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.26.1");try{const{response:r,accessToken:a}=await authFetch(s,{method:"POST",headers:{"Content-Type":t},body:e,access_token:o.access_token,refresh_token:o.refresh_token,token_url:"https://w.deepl.com/oidc/token",omitCookies:!0}),i=await setAuthTokens(a,o.refresh_token,o.id_token);if(i)try{await sendDAPtrackSessionType({sessionType:i,trigger:"TRANSLATION"})}catch(e){console.log(e)}try{await fetchClientState(!1,!1)}catch(e){console.error(`Failed to get the client state ${e.message}`)}return{data:error_handling$1(await r.text(),r.status,n),status:r.status}}catch(e){throw e.name!==DL_OIDC_ERROR_CODES.ACCESS_DENIED&&e.name!==DL_OIDC_ERROR_CODES.INVALID_REQUEST&&e.name!==DL_OIDC_ERROR_CODES.INVALID_GRANT&&e.name!==TOOLING_API_ERROR_CODES.USER_UNAUTHORIZED&&e.name!==TOOLING_API_ERROR_CODES.FORBIDDEN_REQUEST||setTimeout((()=>{logout({trigger:LOGOUT_TRIGGER.extension,reason:e.name})}),5e3),e}}function jsonrpc_composeMethodCallDict$1(e,t,n){return{jsonrpc:"2.0",method:e,params:t,id:n}}function error_handling$1(e,t,n){let r;try{r=JSON.parse(e)}catch(e){throw 200===t?new ToolingApiProtocolError("JSON_RPC: Parsing of response object failed"):t>=500&&n?new ToolingApiFullPageServerError(`FPT failed: Http status code ${t}`):new ToolingApiErrorCode(t.toString(),403===t?`Translation failed: Http status code ${t} forbidden request. re-authenticating makes no difference.`:`Translation failed: Http status code ${t}`)}if("2.0"!==r.jsonrpc||void 0!==r.result&&200!==t||void 0===r.result&&void 0===r.error)throw new ToolingApiProtocolError("JSON_RPC: missing field, wrong id, proper result without 200 status, or missing data");if(r.error){const e=r.error;if(void 0===e.code)throw new ToolingApiProtocolError('JSON_RPC: Missing field "code" in error response');throw new ToolingApiErrorCode(e.code.toString(),e.message)}if(200!==t)throw new ToolingApiErrorCode(t.toString(),`Http status code ${t}`);return r}async function jsonrpc_callFunction(e,t,n=(e=>e),r,o,a){const i=jsonrpc_composeMethodCallDict$1(e,t,r),s=n(JSON.stringify(i),i);return(await utils_sendPOSTRequest(s,"application/json; charset=utf-8",o,a)).data.result}async function translate(e){let t,n={};for(const t in e.weights)e.weights[t]>0&&(n[t]=e.weights[t]);try{t=await getUserType()}catch(e){t=USER_TYPE.notLoggedIn,console.log(e)}const r=e.nicheIntegration===PLATFORM_BEHAVIOURS.default||e.nicheIntegration===PLATFORM_BEHAVIOURS.gmail||e.nicheIntegration===PLATFORM_BEHAVIOURS.gslides||!e.nicheIntegration,o=await isProServiceLevel(SERVICE_NAME.TRANSLATOR),a=await isProServiceLevel(SERVICE_NAME.WRITE);if((!o||!a)&&r){const n=e.sourceTexts.reduce(((e,t)=>e+t.length),0),r=e.isWriteRequest?"writeServiceType":"translatorServiceType",i=await getCharacterLimit(r);if(e.isWriteRequest){if(o&&!a&&n>i)throw new WriteWithTranslatorProLimitExceeded(i,"Char limit exceeded (Translator Pro, Write Free)");if(!a&&n>i)throw new WriteAnonymousOrFreeUserLimitExceeded(i,"Char limit exceeded (Write Free Or Anonymous)")}else{if(t===USER_TYPE.loggedInFree&&a&&n>i)throw new FreeOrAnonTranslatorWithWriteProLimitExceeded(i,"Char limit exceeded (Free or Anon Translator, Write Pro)");if(t===USER_TYPE.loggedInFree&&n>i)throw new FreeAccountLimitExceeded(i,"Char limit exceeded (Translator Free)");if(t===USER_TYPE.notLoggedIn&&n>i)throw new AnonymousUserLimitExceeded(i,"Char limit exceeded (Translator Anon)")}}let i=e.sourceTexts;const s=["EN-US","EN-GB","PT-PT","PT-BR","ZH-HANT"].includes(e.targetLangCode?.toUpperCase());let c=e.targetLangCode?.toUpperCase();s&&(c=e.targetLangCode?.toUpperCase().slice(0,2));const l=e.isWriteRequest?e.sourceTexts.map((e=>({text:e,requestAlternatives:4}))):i.map((e=>({text:e}))),u={texts:l,...e.isHtml&&{html:"enabled"},...!e.isHtml&&{splitting:e.splitting?e.splitting:"paragraphs"},lang:{target_lang:c,source_lang_user_selected:"auto"===e.sourceLang?"auto":e.sourceLang.toUpperCase(),preference:{weight:n}},commonJobParams:{regionalVariant:e.regionalVariant&&s?e.regionalVariant:void 0,...e.isWriteRequest&&{mode:"write"},...e.formality&&{formality:e.formality}}};let d=1;const p=Date.now();i.forEach((e=>d+=(e.match(/[i]/g)||[]).length)),u.timestamp=p-p%d+d;const g=await jsonrpc_callFunction("LMT_handle_texts",u,((e,t)=>e=(t.id+3)%13==0||(t.id+5)%29==0?e.replace('"method":"','"method" : "'):e.replace('"method":"','"method": "')),e.id,e.isHtml,e.isWriteRequest);return{texts:g.texts.map((e=>e.text)),sourceLang:g.lang.toUpperCase(),detectedLanguages:g.detectedLanguages}}const LANGUAGES_PAIR=new Map([["ZH_EN","chinese-english"],["EN_ZH","english-chinese"],["NL_EN","dutch-english"],["EN_NL","english-dutch"],["FR_EN","french-english"],["EN_FR","english-french"],["FR_DE","french-german"],["DE_FR","german-french"],["FR_PT","french-portuguese"],["PT_FR","portuguese-french"],["FR_ES","french-spanish"],["ES_FR","spanish-french"],["DE_EN","german-english"],["EN_DE","english-german"],["DE_PT","german-portuguese"],["PT_DE","portuguese-german"],["DE_ES","german-spanish"],["ES_DE","spanish-german"],["IT_EN","italian-english"],["EN_IT","english-italian"],["JA_EN","japanese-english"],["EN_JA","english-japanese"],["PL_EN","polish-english"],["EN_PL","english-polish"],["PT_EN","portuguese-english"],["EN_PT","english-portuguese"],["PT_ES","portuguese-spanish"],["ES_PT","spanish-portuguese"],["RU_EN","russian-english"],["EN_RU","english-russian"],["ES_EN","spanish-english"],["EN_ES","english-spanish"]]);function getLanguagePair(e,t){const n=`${e.toUpperCase()}_${t.toUpperCase()}`;return LANGUAGES_PAIR.get(n)}async function requestDictionary(e){const t=getLanguagePair(checkIfRegionalVariant(e.sourceLang),checkIfRegionalVariant(e.targetLang)),n=encodeURIComponent(e.text),r=`https://www-app.linguee.com/${t}/search?dlApp=BrowserExtension&il=${e.interfaceLang}&query=${n}`;return error_handling(await fetch(r))}async function error_handling(e){let t;if(200!==e.status)throw 404===e.status?(console.error("Dictionary Entry not found: 404"),new LingueeApiErrorCode(LINGUEE_API_ERROR_CODES.ENTRY_NOT_FOUND)):(console.error("Dictionary Server Error"),new LingueeApiErrorCode(LINGUEE_API_ERROR_CODES.SERVER_ERROR));{try{t=await e.text()}catch(e){throw new LingueeApiErrorCode(LINGUEE_API_ERROR_CODES.SERVER_ERROR)}const n=/href=["']([^"']*)["']/g;t=t.replace(n,"")}return t}function checkIfRegionalVariant(e){return["EN-US","EN-GB","PT-PT","PT-BR","ZH-HANT"].includes(e)?["EN-US","EN-GB"].includes(e)?"EN":["PT-PT","PT-BR"].includes(e)?"PT":["ZH-CN","ZH-HANT"].includes(e)?"ZH":e:e}function updateLanguageWeight(e,t){const n=1e-5;return n*Math.floor((.97*e+t)/n)}const CLASSIC_API_ERROR_CODES={PROTOCOL_ERROR:"PROTOCOL_ERROR",NETWORK_ERROR:"NETWORK_ERROR",FULL_PAGE_SERVER_ERROR:"FULL_PAGE_SERVER_ERROR",USER_UNAUTHORIZED:"-32003",USER_BLOCKED:"429",FORBIDDEN_REQUEST:"403",QUOTA_HAS_BEEN_REACHED:"1045601",TOO_MANY_REQUESTS:"1042902",USER_BLOCKED_FIRST_TIME:"1042901",IP_BLOCKED:"1042911",IP_BLOCKED_ALREADY:"1042912"};class ClassicApiProtocolError extends Error{constructor(e){super(e),this.name=CLASSIC_API_ERROR_CODES.PROTOCOL_ERROR,this.message=e}}class ClassicApiErrorCode extends Error{constructor(e,t){super(t),this.name=e,this.message=t}}class ClassicApiFullPageServerError extends Error{constructor(e){super(e),this.name=CLASSIC_API_ERROR_CODES.FULL_PAGE_SERVER_ERROR,this.message=e}}function getRandomUInt32ID(){let e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]}function jsonrpc_composeMethodCallDict(e,t){return{jsonrpc:"2.0",method:e,params:t,id:getRandomUInt32ID()}}const CONTENT_PROCESS_MODE$1={TRANSLATE:"translate",WRITE:"write"},SERVICE_LEVEL={free:"free",pro:"pro",none:"none"},METHODS={SPLIT_TEXT:"LMT_split_text",HANDLE_JOBS:"LMT_handle_jobs",GET_TERMBASES:"getTermbases",GET_TERM_DICTIONARIES:"getTermDictionaries"};async function processContent$1({texts:e,mode:t=CONTENT_PROCESS_MODE$1.TRANSLATE,targetLang:n,config:r}){const o=await splitText$1({mode:t,texts:e,config:r}),a=o.result.texts[0].chunks.map(((e,n,r)=>({kind:"default",preferred_num_beams:4,raw_en_context_after:n<r.length-1&&r.length>1?[r[n+1].sentences[0].text]:[],raw_en_context_before:n>0?[r[n-1].sentences[0].text]:[],sentences:[{...e.sentences[0],id:n}],...t===CONTENT_PROCESS_MODE$1.WRITE&&{write_variant_requests:["main","variants"]}})));return await handleJobs$1({mode:t,jobs:a,sourceLang:o.result.lang.detected,targetLang:t===CONTENT_PROCESS_MODE$1.WRITE?o.result.lang.detected:n,config:r})}const splitText$1=async({mode:e,texts:t,config:n,sourceLang:r="auto",queryParameter:o,textType:a,advancedMode:i})=>{const s=await getBaseUrl(n,e),c=o?`${s}&method=${METHODS.SPLIT_TEXT}&${o}`:`${s}&method=${METHODS.SPLIT_TEXT}`,l=jsonrpc_composeMethodCallDict(METHODS.SPLIT_TEXT,{commonJobParams:{mode:e,...!0===i&&{advancedMode:!0}},lang:{lang_user_selected:r},texts:t,textType:a});return await doAuthRequest(c,{method:"POST",headers:{"Content-Type":"application/json"},body:buildHandleJobsRequestBody(l)},n)},handleJobs$1=async({mode:e,jobs:t,sourceLang:n,targetLang:r,config:o,textType:a,formality:i,termbase:s,styleVariant:c,queryParameter:l,regionalVariant:u})=>{const d=await getBaseUrl(o,e),p=l?`${d}&method=${METHODS.HANDLE_JOBS}&${l}`:`${d}&method=${METHODS.HANDLE_JOBS}`,g=jsonrpc_composeMethodCallDict(METHODS.HANDLE_JOBS,{commonJobParams:{mode:e,...a&&{textType:a},...i&&{formality:i},...c&&{style_variant:c},...s&&{termbase:s},...c&&{style_variant:c},...u&&{regionalVariant:u}},lang:{source_lang_computed:n,target_lang:r},jobs:t,priority:1,timestamp:getFakeTimestamp(t)});return await doAuthRequest(p,{method:"POST",headers:{"Content-Type":"application/json"},body:buildHandleJobsRequestBody(g)},o)},getTermbases$1=async({config:e})=>{const t=`${await getBaseUrl({...e,isTermbase:!0})}&method=${METHODS.GET_TERMBASES}`,n=jsonrpc_composeMethodCallDict(METHODS.GET_TERMBASES,{});return await doAuthRequest(t,{method:"POST",headers:{"Content-Type":"application/json"},body:buildHandleJobsRequestBody(n)},e)},doAuthRequest=async(e,t,n)=>{const r=await n.auth.getAuthTokens(),o=r?{access_token:r.access_token,refresh_token:r.refresh_token,token_url:n.auth.tokenUrl}:{},{response:a,accessToken:i}=await authFetch(e,{...t,...o,omitCookies:n.omitCookies});return await n.auth.setAuthTokens(i,r.refresh_token,r.id_token),await processResponse({response:a,isHtml:!1})},getBaseUrl=async({auth:e,baseUrls:t,isTermbase:n},r=void 0)=>{const o=await e.getAuthTokens(),a=r===CONTENT_PROCESS_MODE$1.WRITE?t.write:t.translate;if(n)return t.glossary;if(!o||!o.access_token)return a.free;if(!e.getServiceLevels){const e=(e=>{try{return JSON.parse(atob(e.split(".")[1]))}catch(e){return null}})(o.access_token),t=e&&"Pro"===e.sessionType;return o.access_token&&t?a.pro:a.free}{const t=await e.getServiceLevels();switch(r){case CONTENT_PROCESS_MODE$1.WRITE:return t.write===SERVICE_LEVEL.pro?a.pro:a.free;case CONTENT_PROCESS_MODE$1.TRANSLATE:return t.translator===SERVICE_LEVEL.pro?a.pro:a.free;default:return a.free}}},getFakeTimestamp=e=>{const t=e.reduce(((e,t)=>[...e,...t.sentences.map((e=>e.text))]),[]);let n=1;const r=Date.now();return t.forEach((e=>n+=(e.match(/[i]/g)||[]).length)),r-r%n+n},buildHandleJobsRequestBody=e=>{let t=JSON.stringify(e);return t=(e.id+3)%13==0||(e.id+5)%29==0?t.replace('"method":"','"method" : "'):t.replace('"method":"','"method": "'),t},processResponse=async({response:e,isHtml:t})=>{let n;try{if(403===e.status)throw new ClassicApiErrorCode(e.status.toString(),`Translation failed: Http status code ${e.status} forbidden request. re-authenticating makes no difference.`);n=JSON.parse(await e.text())}catch(n){throw 200===e.status?new ClassicApiProtocolError("JSON_RPC: Parsing of response object failed"):e.status>=500&&t?new ClassicApiFullPageServerError(`FPT failed: Http status code ${e.status}`):new ClassicApiErrorCode(e.status.toString(),`Translation failed: Http status code ${e.status}`)}if("2.0"!==n.jsonrpc||void 0!==n.result&&200!==e.status||void 0===n.result&&void 0===n.error)throw new ClassicApiProtocolError("JSON_RPC: missing field, wrong id, proper result without 200 status, or missing data");if(n.error){if(void 0===n.error.code)throw new ClassicApiProtocolError('JSON_RPC: Missing field "code" in error response');throw new ClassicApiErrorCode(n.error.code.toString(),n.error.message)}if(200!==e.status)throw new ClassicApiErrorCode(e.status.toString(),`Http status code ${e.status}`);return n},CONTENT_PROCESS_MODE=CONTENT_PROCESS_MODE$1;async function processContent({texts:e,mode:t=CONTENT_PROCESS_MODE$1.TRANSLATE,targetLang:n}){return handleClassicApiCall((async r=>await processContent$1({texts:e,mode:t,targetLang:n,config:r})))}const splitText=async({mode:e,texts:t,sourceLang:n="auto",textType:r="plaintext",advancedMode:o})=>handleClassicApiCall((async a=>await splitText$1({mode:e,texts:t,sourceLang:n,config:a,textType:r,advancedMode:o}))),handleJobs=async({mode:e,jobs:t,sourceLang:n,targetLang:r,textType:o,formality:a,termbase:i,styleVariant:s,regionalVariant:c})=>handleClassicApiCall((async l=>await handleJobs$1({mode:e,jobs:t,sourceLang:n,targetLang:r,config:l,textType:o,formality:a,termbase:i,styleVariant:s,regionalVariant:c}))),getTermbases=async()=>handleClassicApiCall((async e=>await getTermbases$1({config:e}))),handleClassicApiCall=async e=>{try{return await e(buildConfigObject())}catch(e){throw e.name!==DL_OIDC_ERROR_CODES.ACCESS_DENIED&&e.name!==DL_OIDC_ERROR_CODES.INVALID_REQUEST&&e.name!==DL_OIDC_ERROR_CODES.INVALID_GRANT&&e.name!==CLASSIC_API_ERROR_CODES.USER_UNAUTHORIZED&&e.name!==CLASSIC_API_ERROR_CODES.FORBIDDEN_REQUEST||setTimeout((()=>{logout({trigger:LOGOUT_TRIGGER.extension,reason:e.name})}),5e3),e}},buildConfigObject=()=>({baseUrls:{translate:{free:"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.26.1",pro:"https://api.deepl.com/jsonrpc?client=chrome-extension,1.26.1"},write:{free:"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.26.1",pro:"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.26.1"},glossary:"https://api.deepl.com/termbases/jsonrpc?client=chrome-extension,1.26.1"},auth:{getAuthTokens:getAuthTokens,setAuthTokens:setAuthTokens,getServiceLevels:async()=>{const e=await getAllServiceLevels();return{translator:e.translatorServiceType,write:e.writeServiceType}},tokenUrl:"https://w.deepl.com/oidc/token"},omitCookies:!0}),checkLimits=async e=>{let t;try{t=await getUserType()}catch(e){t=USER_TYPE.notLoggedIn,console.log(e)}const n=e.nicheIntegration===PLATFORM_BEHAVIOURS.default||e.nicheIntegration===PLATFORM_BEHAVIOURS.gmail||e.nicheIntegration===PLATFORM_BEHAVIOURS.gslides||!e.nicheIntegration,r=await isProServiceLevel(SERVICE_NAME.TRANSLATOR),o=await isProServiceLevel(SERVICE_NAME.WRITE);if((!r||!o)&&n){const n=e.sourceTexts.reduce(((e,t)=>e+t.length),0),a=e.isWriteRequest?"writeServiceType":"translatorServiceType",i=await getCharacterLimit(a);if(e.isWriteRequest){if(r&&!o&&n>i)throw new WriteWithTranslatorProLimitExceeded(i,"Char limit exceeded (Translator Pro, Write Free)");if(!o&&n>i)throw new WriteAnonymousOrFreeUserLimitExceeded(i,"Char limit exceeded (Write Free Or Anonymous)")}else{if(t===USER_TYPE.loggedInFree&&o&&n>i)throw new FreeOrAnonTranslatorWithWriteProLimitExceeded(i,"Char limit exceeded (Free or Anon Translator, Write Pro)");if(t===USER_TYPE.loggedInFree&&n>i)throw new FreeAccountLimitExceeded(i,"Char limit exceeded (Translator Free)");if(t===USER_TYPE.notLoggedIn&&n>i)throw new AnonymousUserLimitExceeded(i,"Char limit exceeded (Translator Anon)")}}},getActiveTermbaseFromListOfTermbases=(e,t=[])=>{if(!e||0===t.length)return null;if(t.map((e=>e.id)).includes(e)){return t.find((t=>t.id===e))}return null},didGlossaryResultInChangeToTranslationOutput=e=>e.translations[0].beams.map((e=>e.sentences[0])).some((e=>e.glossary_highlights&&e.glossary_highlights.length>0)),simpleTextProcessor=async e=>{await checkLimits(e);const{activeTermbaseId:t,isLoggedIn:n,isGlossaryEnabled:r,hasTermbaseService:o}=await getSettings(["activeTermbaseId","isLoggedIn","isGlossaryEnabled","hasTermbaseService"]),a=getRegionalLanguageSet(e.targetLangCode,e.regionalVariant),i=[],s=[],c=e.isWriteRequest?CONTENT_PROCESS_MODE.WRITE:CONTENT_PROCESS_MODE.TRANSLATE,l=await splitText({texts:e.sourceTexts,mode:c});let u,d=l.result.lang.detected,p=!1,g=!1,h=!1;if(userHasGlossaryService({isLoggedIn:n,hasTermbaseService:o})&&t&&!e.isWriteRequest&&r)try{const[e]=await fetchTermbases(),n=getActiveTermbaseFromListOfTermbases(t,e);if(n)for(let e of n.termDictionaries)if(e.languagePair===`${d.substr(0,2)}>${a.langCode.substr(0,2)}`.toLowerCase()){u={id:n.id,dictionaryId:e.id},p=!0,g=n.shared;break}}catch(e){console.log({e:e,message:"fetching glossaries failed"})}for(const e of l.result.texts){const t=[];for(const n of e.chunks)for(const e of n.sentences)s.push(e),t.push(s.length-1);i.push(t)}const f=s.map(((e,t)=>({kind:"default",preferred_num_beams:4,raw_en_context_after:t<s.length-1?[s[t+1].text]:[],raw_en_context_before:t>0?[s[t-1].text]:[],sentences:[{...e,id:t+1}]})));let m;c===CONTENT_PROCESS_MODE.WRITE?"EN"===d&&a.regionalVariant&&["EN-US"].includes(a.regionalVariant.toUpperCase())&&(m=a.regionalVariant):m=a.regionalVariant;const _={mode:c,jobs:f,sourceLang:d,targetLang:e.isWriteRequest?d:a.langCode,textType:e.textType,...e.formality&&{formality:e.formality},...u&&{termbase:u},...m&&{regionalVariant:m}};let E=(await handleJobs(_)).result;if(h=didGlossaryResultInChangeToTranslationOutput(E),e.autoImproveForTranslate&&c===CONTENT_PROCESS_MODE.TRANSLATE){const t=e.targetLangCode.substring(0,2).toUpperCase(),n=4;if(E.source_lang.substring(0,2).toUpperCase()===t&&getAlphabeticCharactersLength(e.sourceTexts.join(""))>n&&isLanguageSupportedForWrite(t)){E=(await handleJobs({..._,mode:CONTENT_PROCESS_MODE.WRITE})).result}}const T=E.translations.map(((e,t)=>`${s[t].prefix}${e.beams[0].sentences[0].text}`)),S=i.map((e=>e.map((e=>T[e]))));return{processedText:S,result:E,...p&&{glossaryTrackingInfo:{isGlossaryEnabled:!!u,isGlossaryShared:g,didGlossaryChangeTranslation:h}}}};async function triggerTranslateInline(e){const t=await getSettings(["selectedTargetLanguage"]);chrome.tabs.sendMessage(e,{action:"dlTranslateInline",targetLang:t.selectedTargetLanguage})}async function translateHtmlRequest(e){await updateSession();const t=await getSettings(["selectedTargetLanguage","session","installationId","regionalVariant"]),n=new Date,r={sourceLang:"auto",targetLangCode:t.selectedTargetLanguage,sessionId:t.session.id,id:getRandomUInt32(),isHtml:!0,sourceTexts:e.payload.texts,regionalVariant:t.regionalVariant};let o,a;try{const e=await simpleTextProcessor(r);o=e.processedText,a=e.glossaryTrackingInfo}catch(n){try{sendDAPTranslationErrorData({errorCode:n.name,errorMessage:n.message,domainName:e.payload.domainName,targetLang:t.selectedTargetLanguage,websiteLanguage:e.payload.sourceLang,trigger:e.payload.trigger,characterCount:e.payload.texts.reduce(((e,t)=>e+t.length),0)})}catch(e){console.log(e)}throw n}handleSuccessfulTranslationsCount(e?.payload?.sourceLang,t?.selectedTargetLanguage);const i={isFirstTime:e.payload.isFirstTime,processingTimeInMs:new Date-n};try{sendDAPTranslationRequest({installationId:t.installationId,trigger:e.payload.trigger,websiteLanguage:e.payload.sourceLang,targetLanguage:t.selectedTargetLanguage,characterCount:e.payload.texts.reduce(((e,t)=>e+t.length),0),translationPerformance:i,domainName:e.payload.domainName,glossaryTrackingInfo:a})}catch(e){console.error(e)}const s=o.map((e=>e.join("")));return s}async function translateInlineRequest(e){await updateSession();const t=await getSettings(["selectedTargetLanguage","session","installationId","languagePreferenceForReading","regionalVariant"]),n=e.payload.nicheIntegration||PLATFORM_BEHAVIOURS.default,r={sourceLang:e.payload.sourceLang||"auto",targetLangCode:t.selectedTargetLanguage,sessionId:t.session.id,id:getRandomUInt32(),sourceTexts:e.payload.requests.map((e=>e.text)),weights:t.languagePreferenceForReading,splitting:"newlines",regionalVariant:t.regionalVariant,nicheIntegration:n,isWriteRequest:e.payload.isWriteRequest};let o,a,i;try{const e=await simpleTextProcessor(r);o=e.result,a=e.processedText,i=e.glossaryTrackingInfo}catch(r){try{e.payload.isWriteRequest?sendDAPDeeplWriteEvent(DEEPL_WRITE_EVENT_TYPE.ERROR,{lang:e.payload.websiteLanguage,sourceLength:e.payload.requests.reduce(((e,t)=>e+t.text.length),0),targetLength:0,nicheIntegration:n,error:r.name}):sendDAPTranslationErrorData({errorCode:r.name,errorMessage:r.message,domainName:e.payload.domainName,targetLang:t.selectedTargetLanguage,websiteLanguage:e.payload.websiteLanguage,trigger:e.payload.trigger,characterCount:e.payload.requests.reduce(((e,t)=>e+t.text.length),0)})}catch(e){console.log(e)}throw r}handleSuccessfulTranslationsCount(o?.source_lang,t?.selectedTargetLanguage),e.payload.platformBehavior===PLATFORM_BEHAVIOURS.gslides&&handleSuccessfulGslidesTranslationsCount();try{if(o.detectedLanguages){for(const e in o.detectedLanguages)(t.languagePreferenceForReading[e]||0===t.languagePreferenceForReading[e])&&(t.languagePreferenceForReading[e]=updateLanguageWeight(t.languagePreferenceForReading[e],o.detectedLanguages[e]));chrome.storage.sync.set({languagePreferenceForReading:t.languagePreferenceForReading})}}catch(e){console.error(e)}try{e.payload.isWriteRequest?sendDAPDeeplWriteEvent(DEEPL_WRITE_EVENT_TYPE.TEXT_REFINEMENT_REQUEST,{lang:e.payload.sourceLang,sourceLength:e.payload.requests.reduce(((e,t)=>e+t.text.length),0),targetLength:a.flat().reduce(((e,t)=>e+t.length),0),nicheIntegration:n}):sendDAPTranslationRequest({installationId:t.installationId,trigger:e.payload.trigger,websiteLanguage:o.source_lang,targetLanguage:t.selectedTargetLanguage,characterCount:e.payload.requests.reduce(((e,t)=>e+t.text.length),0),domainName:e.payload.domainName,nicheIntegration:n,glossaryTrackingInfo:i})}catch(e){console.error(e)}return a.map((e=>({text:e.join(""),detected_source_language:o.source_lang})))}async function translateInputRequest(e){await updateSession();const t=await getSettings(["targetLanguageUserInput","session","installationId","languagePreferenceForWriting","regionalVariant"]),n=e.payload.requests,r=e.payload.targetLang||t.targetLanguageUserInput,o=e.payload.platformBehavior||PLATFORM_BEHAVIOURS.default,a={sourceLang:"auto",targetLangCode:r,sessionId:t.session.id,id:getRandomUInt32(),sourceTexts:n.map((e=>e.text))||[],weights:t.languagePreferenceForWriting,splitting:"paragraphs",textType:"richtext",regionalVariant:t.regionalVariant,nicheIntegration:o,...e.payload.isHtml&&{isHtml:e.payload.isHtml},...e.payload.formality&&{formality:e.payload.formality},...e.payload.isWriteRequest&&{isWriteRequest:e.payload.isWriteRequest}};let i,s,c;try{const e=await simpleTextProcessor(a);i=e.result,s=e.processedText,c=e.glossaryTrackingInfo}catch(t){try{e.payload.isWriteRequest?sendDAPDeeplWriteEvent(DEEPL_WRITE_EVENT_TYPE.ERROR,{lang:e.payload.source_lang,sourceLength:n.reduce(((e,t)=>e+t.text.length),0),targetLength:0,nicheIntegration:o,error:t.name}):sendDAPTranslationErrorData({errorCode:t.name,errorMessage:t.message,domainName:e.payload.domainName,targetLang:r,websiteLanguage:e.payload.websiteLanguage,trigger:TRANSLATION_TRIGGER.input,characterCount:n.reduce(((e,t)=>e+t.text.length),0)})}catch(e){console.log(e)}throw t}handleSuccessfulTranslationsCount(i?.source_lang,r),e.payload.platformBehavior===PLATFORM_BEHAVIOURS.gmail?handleSuccessfulGmailTranslationsCount():e.payload.platformBehavior===PLATFORM_BEHAVIOURS.gslides&&handleSuccessfulGslidesTranslationsCount();try{if(i.detectedLanguages){for(const e in i.detectedLanguages)(t.languagePreferenceForWriting[e]||0===t.languagePreferenceForWriting[e])&&(t.languagePreferenceForWriting[e]=updateLanguageWeight(t.languagePreferenceForWriting[e],i.detectedLanguages[e]));chrome.storage.sync.set({languagePreferenceForWriting:t.languagePreferenceForWriting})}}catch(e){console.error(e)}if(!0!==e.payload.skipDapReporting)try{e.payload.isWriteRequest?sendDAPDeeplWriteEvent(DEEPL_WRITE_EVENT_TYPE.TEXT_REFINEMENT_REQUEST,{lang:e.payload.source_lang,sourceLength:n.reduce(((e,t)=>e+t.text.length),0),targetLength:s.flat().reduce(((e,t)=>e+t.length),0),nicheIntegration:o}):sendDAPTranslationRequest({installationId:t.installationId,trigger:TRANSLATION_TRIGGER.input,websiteLanguage:i.sourceLang,targetLanguage:r,characterCount:n.reduce(((e,t)=>e+t.text.length),0),domainName:e.payload.domainName,nicheIntegration:o,glossaryTrackingInfo:c})}catch(e){console.error(e)}return[{detected_source_language:i.source_lang,text:s.flat().join(""),texts:s.map((e=>e.join("")))}]}async function translateZendeskInputRequest(e){await updateSession();const t=await getSettings(["session","installationId","languagePreferenceForWriting","regionalVariant","zendeskActiveTermbase"]),n=e.payload.texts,r=e.payload.targetLang,o=PLATFORM_BEHAVIOURS.zendesk,a=CONTENT_PROCESS_MODE.TRANSLATE,i=e.payload.formality;let s,c;const l=[],u=[];let d;try{const e=await splitText({texts:n,mode:a});let o;if(c=e.result.lang.detected,t.zendeskActiveTermbase&&t.zendeskActiveTermbase.termDictionaries)for(let e of t.zendeskActiveTermbase.termDictionaries)if(e.languagePair===`${c.substr(0,2)}>${r.substr(0,2)}`.toLowerCase()){o={id:t.zendeskActiveTermbase.id,dictionaryId:e.id},d=!0;break}for(const t of e.result.texts){const e=[];for(const n of t.chunks)for(const t of n.sentences)u.push(t),e.push(u.length-1);l.push(e)}const p=u.map(((e,t)=>({kind:"default",preferred_num_beams:4,raw_en_context_after:t<u.length-1?[u[t+1].text]:[],raw_en_context_before:t>0?[u[t-1].text]:[],sentences:[{...e,id:t+1}]})));s=await handleJobs({mode:a,jobs:p,sourceLang:c,targetLang:r.substr(0,2),textType:"richtext",...i&&{formality:i},...o&&{termbase:o}})}catch(t){try{sendDAPTranslationErrorData({errorCode:t.name,errorMessage:t.message,domainName:e.payload.domainName,targetLang:r,websiteLanguage:e.payload.websiteLanguage,trigger:TRANSLATION_TRIGGER.input,characterCount:n.reduce(((e,t)=>e+t.text.length),0)})}catch(e){console.log(e)}throw t}const p=s.result.translations.map(((e,t)=>`${u[t].prefix}${e.beams[0].sentences[0].text}`)),g=l.map((e=>e.map((e=>p[e]))));if(handleSuccessfulTranslationsCount(c,r),handleSuccessfulZendeskTranslationsCount(),!0!==e.payload.skipDapReporting)try{sendDAPTranslationRequest({installationId:t.installationId,trigger:TRANSLATION_TRIGGER.input,websiteLanguage:c,targetLanguage:r,characterCount:n.reduce(((e,t)=>e+t.length),0),domainName:e.payload.domainName,nicheIntegration:o,isGlossaryEnabled:d})}catch(e){console.error(e)}return[{detected_source_language:c,text:g[0],texts:g}]}async function translateGmailReceivedEmail(e){await updateSession();const t=await getSettings(["targetLanguage","session","installationId","regionalVariant"]),n=e.payload.requests,r=e.payload.sourceLang,o=e.payload.targetLang||t.targetLanguage,a=PLATFORM_BEHAVIOURS.gmail,i={sourceLang:r||"auto",targetLangCode:o,sessionId:t.session.id,id:getRandomUInt32(),sourceTexts:n.map((e=>e.text))||[],splitting:"newlines",regionalVariant:t.regionalVariant};let s,c,l;try{const e=await simpleTextProcessor(i);s=e.result,c=e.processedText,l=e.glossaryTrackingInfo}catch(t){try{sendDAPTranslationErrorData({errorCode:t.name,errorMessage:t.message,domainName:e.payload.domainName,targetLang:o,trigger:TRANSLATION_TRIGGER.input,characterCount:n.reduce(((e,t)=>e+t.text.length),0)})}catch(e){console.log(e)}throw t}handleSuccessfulTranslationsCount(s?.source_lang,o),handleSuccessfulGmailTranslationsCount();try{sendDAPTranslationRequest({installationId:t.installationId,trigger:TRANSLATION_TRIGGER.manual,websiteLanguage:s.source_lang,targetLanguage:o,characterCount:n.reduce(((e,t)=>e+t.text.length),0),domainName:e.payload.domainName,nicheIntegration:a,glossaryTrackingInfo:l})}catch(e){console.error(e)}return[{detected_source_language:s.source_lang,text:c.flat().join(""),texts:c.map((e=>e.join("")))}]}async function translateTwitterTweetRequest(e){await updateSession();const t=await getSettings(["selectedTargetLanguage","session","installationId","regionalVariant"]),n=e.payload.message,r={sourceLang:"auto",targetLangCode:t.selectedTargetLanguage,sessionId:t.session.id,id:getRandomUInt32(),sourceTexts:[n],splitting:"paragraphs",regionalVariant:t.regionalVariant};let o,a,i;try{const e=await simpleTextProcessor(r);o=e.result,a=e.processedText,i=e.glossaryTrackingInfo}catch(r){try{sendDAPTwitterTweetTranslationFailed({errorCode:r.name,errorMessage:r.message,domainName:e.payload.domainName,targetLang:t.selectedTargetLanguage,messageLang:e.payload.messageLang,messageLength:n.length})}catch(e){console.log(e)}throw r}handleSuccessfulTranslationsCount(o?.source_lang,t?.selectedTargetLanguage);try{sendDAPTranslationRequest({installationId:t.installationId,trigger:e.payload.trigger,websiteLanguage:e.payload.messageLang,targetLanguage:t.selectedTargetLanguage,characterCount:n.length,domainName:e.payload.domainName,nicheIntegration:PLATFORM_BEHAVIOURS.twitter,glossaryTrackingInfo:i})}catch(e){console.error(e)}return a.map((e=>({text:e.join(""),detected_source_language:o.source_lang})))}async function translateLinkedInPostRequest(e){await updateSession();const t=await getSettings(["selectedTargetLanguage","session","installationId","regionalVariant"]),n=e.payload.message,r={sourceLang:"auto",targetLangCode:t.selectedTargetLanguage,sessionId:t.session.id,id:getRandomUInt32(),sourceTexts:[n],splitting:"paragraphs",regionalVariant:t.regionalVariant};let o,a,i;try{const e=await simpleTextProcessor(r);o=e.result,a=e.processedText,i=e.glossaryTrackingInfo}catch(r){try{sendDAPTranslationErrorData({errorCode:r.name,errorMessage:r.message,domainName:e.payload.domainName,targetLang:t.selectedTargetLanguage,websiteLanguage:e.payload.messageLang,characterCount:n.length,trigger:e.payload.trigger,nicheIntegration:PLATFORM_BEHAVIOURS.linkedIn})}catch(e){console.log(e)}throw r}handleSuccessfulTranslationsCount(o?.source_lang,t?.selectedTargetLanguage);try{sendDAPTranslationRequest({installationId:t.installationId,trigger:e.payload.trigger,websiteLanguage:e.payload.messageLang,targetLanguage:t.selectedTargetLanguage,characterCount:n.length,domainName:e.payload.domainName,nicheIntegration:PLATFORM_BEHAVIOURS.linkedIn,glossaryTrackingInfo:i})}catch(e){console.error(e)}return a.map((e=>({text:e.join(""),detected_source_language:o.source_lang})))}async function translateWhatsAppMessageRequest(e){await updateSession();const t=await getSettings(["selectedTargetLanguage","session","installationId","regionalVariant"]),n=e.payload.message,r={sourceLang:"auto",targetLangCode:t.selectedTargetLanguage,sessionId:t.session.id,id:getRandomUInt32(),sourceTexts:[n],splitting:"paragraphs",regionalVariant:t.regionalVariant};let o,a,i;try{const e=await simpleTextProcessor(r);o=e.result,a=e.processedText,i=e.glossaryTrackingInfo}catch(r){try{sendDAPWhatsAppMessageTranslationFailed({errorCode:r.name,errorMessage:r.message,domainName:e.payload.domainName,targetLang:t.selectedTargetLanguage,messageLang:e.payload.messageLang,messageLength:n.length,numberOfLanguages:1,numberOfMessages:1,translator:WHATSAPP_TRANSLATOR_TYPE.message})}catch(e){console.log(e)}throw r}handleSuccessfulTranslationsCount(o?.sourceLang,t?.selectedTargetLanguage);try{sendDAPWhatsAppMessageTranslated({messageLang:e.payload.messageLang,targetLang:t.selectedTargetLanguage,messageLength:n.length,numberOfLanguages:1,numberOfMessages:1,translator:WHATSAPP_TRANSLATOR_TYPE.message}),sendDAPTranslationRequest({installationId:t.installationId,trigger:e.payload.trigger,websiteLanguage:e.payload.messageLang,targetLanguage:t.selectedTargetLanguage,characterCount:n.length,domainName:e.payload.domainName,nicheIntegration:PLATFORM_BEHAVIOURS.whatsappWeb,glossaryTrackingInfo:i})}catch(e){console.error(e)}return a.map((e=>({text:e.join(""),detected_source_language:o.source_lang})))}async function translateWhatsAppMessagesRequest(e){await updateSession();const t=await getSettings(["selectedTargetLanguage","session","installationId","regionalVariant"]),n=e.payload.messages,r={sourceLang:"auto",targetLangCode:t.selectedTargetLanguage,sessionId:t.session.id,id:getRandomUInt32(),sourceTexts:n,splitting:"paragraphs",regionalVariant:t.regionalVariant};let o;try{o=await translate(r)}catch(r){try{sendDAPWhatsAppMessageTranslationFailed({errorCode:r.name,errorMessage:r.message,domainName:e.payload.domainName,targetLang:t.selectedTargetLanguage,messageLang:e.payload.messageLang,messageLength:n.reduce(((e,t)=>e+t.length),0),numberOfLanguages:e.payload.detectedLanguages?.length,numberOfMessages:n.length,translator:WHATSAPP_TRANSLATOR_TYPE.chat})}catch(e){console.log(e)}throw r}handleSuccessfulTranslationsCount(o?.sourceLang,t?.selectedTargetLanguage);try{sendDAPWhatsAppMessageTranslated({messageLang:e.payload.messageLang,targetLang:t.selectedTargetLanguage,messageLength:n.reduce(((e,t)=>e+t.length),0),numberOfLanguages:e.payload.detectedLanguages?.length,numberOfMessages:n.length,translator:WHATSAPP_TRANSLATOR_TYPE.chat}),sendDAPTranslationRequest({installationId:t.installationId,trigger:e.payload.trigger,websiteLanguage:e.payload.messageLang,targetLanguage:t.selectedTargetLanguage,characterCount:n.reduce(((e,t)=>e+t.length),0),domainName:e.payload.domainName,nicheIntegration:PLATFORM_BEHAVIOURS.whatsappWeb})}catch(e){console.error(e)}return[{detected_source_language:o.sourceLang,texts:o.texts}]}async function performGDocsSplitText(e){const{texts:t,mode:n}=e.payload;return await splitText({texts:t,mode:n})}async function performGDocsProcessContent(e){await updateSession();const t=await getSettings(["session","installationId","regionalVariant","activeTermbaseId","isGlossaryEnabled","isLoggedIn","hasTermbaseService"]),{mode:n,sentences:r,sourceLang:o,targetLang:a,domain:i}=e.payload,s=n===CONTENT_PROCESS_MODE.WRITE;let c;try{c=await getActiveTermbase({isLoggedIn:t.isLoggedIn,activeTermbaseId:t.activeTermbaseId,isGlossaryEnabled:t.isGlossaryEnabled,hasTermbaseService:t.hasTermbaseService,sourceLang:o,targetLang:a,mode:n})}catch(e){console.error(e)}let l=4,u=null;s&&(WRITE_LANGS_WITHOUT_SENTENCE_ALTERNATIVES.includes(o)&&(l=1),u=o),await chrome.storage.sync.set({gdocsWriteLang:u});const d=r.map(((e,t)=>({kind:"default",preferred_num_beams:l,raw_en_context_after:t<r.length-1?[r[t+1].text]:[],raw_en_context_before:t>0?[r[t-1].text]:[],sentences:[{...e,id:t+1}],...n===CONTENT_PROCESS_MODE.WRITE&&{write_variant_requests:["main"]}}))),p=new Date,g=await handleJobs({mode:n,jobs:d,sourceLang:o,targetLang:a,...c&&{termbase:c}});try{n===CONTENT_PROCESS_MODE.TRANSLATE&&sendDAPTranslationRequest({installationId:t.installationId,trigger:e.payload.trigger,websiteLanguage:e.payload.sourceLang,targetLanguage:a,characterCount:r.map((e=>e.text)).reduce(((e,t)=>e+t.length),0),translationPerformance:{isFirstTime:!1,processingTimeInMs:new Date-p},domainName:i,nicheIntegration:PLATFORM_BEHAVIOURS.gdocs})}catch(e){console.error(e)}return g}async function fetchGDocsSentenceAlternatives(e){const{mode:t,sourceLang:n,targetLang:r,sentence:o,contextBefore:a,contextAfter:i}=e.payload,s=[{kind:"default",preferred_num_beams:4,raw_en_context_after:i?[i]:[],raw_en_context_before:a?[a]:[],sentences:[{...o,partial_translation:"",id:0}],...t===CONTENT_PROCESS_MODE.WRITE&&{write_variant_requests:["main","variants"]}}];return await handleJobs({mode:t,jobs:s,sourceLang:n,targetLang:r})}async function fetchGDocsWordAlternatives(e){const{mode:t,sourceLang:n,targetLang:r,sentence:o,contextBefore:a,contextAfter:i,partialTranslation:s}=e.payload,c=[{kind:"alternatives_at_position",raw_en_context_after:i?[i]:[],raw_en_context_before:a?[a]:[],sentences:[{...o,partial_translation:s,id:0}],...t===CONTENT_PROCESS_MODE.WRITE&&{write_variant_requests:["main"]}}];return await handleJobs({mode:t,jobs:c,sourceLang:n,targetLang:r})}async function rebuildGDocsSentenceFromPartialTranslation(e){const{mode:t,sourceLang:n,targetLang:r,sentence:o,contextBefore:a,contextAfter:i,partialTranslation:s}=e.payload;let c=4;t===CONTENT_PROCESS_MODE.WRITE&&WRITE_LANGS_WITHOUT_SENTENCE_ALTERNATIVES.includes(n)&&(c=1);const l=[{kind:"default",raw_en_context_after:i?[i]:[],raw_en_context_before:a?[a]:[],preferred_num_beams:c,sentences:[{...o,partial_translation:s,id:0}],...t===CONTENT_PROCESS_MODE.WRITE&&{write_variant_requests:["main"]}}];return await handleJobs({mode:t,jobs:l,sourceLang:n,targetLang:r})}async function translateZendeskMessageRequest(e){await updateSession();const t=await getSettings(["session","installationId","regionalVariant","zendeskActiveTermbase"]),n=CONTENT_PROCESS_MODE.TRANSLATE,r=PLATFORM_BEHAVIOURS.zendesk,{targetLang:o}=e.payload,a=[e.payload.text],i=a.map((e=>e.replaceAll("\n","<br>"))),s=[],c=[];let l,u,d,p;try{const e=await splitText({texts:i,mode:n,textType:"richtext"});if(p=e.result.lang.detected,t.zendeskActiveTermbase&&t.zendeskActiveTermbase.termDictionaries)for(let e of t.zendeskActiveTermbase.termDictionaries)if(e.languagePair===`${p.substr(0,2)}>${o.substr(0,2)}`.toLowerCase()){l={id:t.zendeskActiveTermbase.id,dictionaryId:e.id},u=!0;break}for(const t of e.result.texts){const e=[];for(const n of t.chunks)for(const t of n.sentences)c.push(t),e.push(c.length-1);s.push(e)}const r=c.map(((e,t)=>({kind:"default",preferred_num_beams:4,raw_en_context_after:t<c.length-1?[c[t+1].text]:[],raw_en_context_before:t>0?[c[t-1].text]:[],sentences:[{...e,id:t+1}]})));d=await handleJobs({mode:n,jobs:r,sourceLang:p,targetLang:o.substr(0,2),textType:"richtext",...l&&{termbase:l}})}catch(t){try{sendDAPTranslationErrorData({errorCode:t.name,errorMessage:t.message,domainName:e.payload.domainName,targetLang:o,websiteLanguage:e.payload.websiteLanguage,trigger:TRANSLATION_TRIGGER.inline,characterCount:a.reduce(((e,t)=>e+t.text.length),0)})}catch(e){console.log(e)}throw t}handleSuccessfulTranslationsCount(p,o),handleSuccessfulZendeskTranslationsCount();const g=d.result.translations.map(((e,t)=>`${c[t].prefix}${e.beams[0].sentences[0].text}`)),h=s.map((e=>e.map((e=>g[e])))),f=h[0].join("");try{sendDAPTranslationRequest({installationId:t.installationId,trigger:TRANSLATION_TRIGGER.input,websiteLanguage:p,targetLanguage:o,characterCount:a.reduce(((e,t)=>e+t.length),0),domainName:e.payload.domainName,nicheIntegration:r,isGlossaryEnabled:u})}catch(e){console.error(e)}return f}async function fetchTermbases(){let e,t,n="";try{e=await getUserState()}catch(e){t=e.message}if(!e||!e.isLoggedIn||t)return[[],t];try{n=(await getTermbases()).result||[]}catch(e){t=e.message}return[n,t]}async function trackDetectLanguage(e){try{sendDAPDetectLanguage({language:e.payload.language,domainName:e.payload.domainName})}catch(e){console.error(e)}}async function trackInputTranslationInjection(e){try{sendDAPInputTranslationInjection({domainName:e})}catch(e){console.error(e)}}async function trackExtensionOpenedEvent(e){try{sendDAPExtensionOpened({domainName:e.domainName,extensionOpenedFrom:getDapApiExtensionOpenedFromId(e.extensionContext)})}catch(e){console.error(e)}}async function trackLogoClickedEvent(e){try{sendDAPLogoClicked({logoClickedFrom:getDapApiLogoClickedFromId(e.extensionContext)})}catch(e){console.error(e)}}async function trackDocTransClick(){try{sendDAPDocTransClick()}catch(e){console.error(e)}}async function trackRecommendToAFriendClick(){try{sendDAPRecommendToAFriendClick()}catch(e){console.error(e)}}async function trackInlineSettingsOpened(e){try{sendDAPInlineSettingOpened({uiFunction:e.uiFunction,uiLocation:e.uiLocation,nicheIntegration:e.nicheIntegration||PLATFORM_BEHAVIOURS.default})}catch(e){console.error(e)}}async function trackSettingChanged(e){try{sendDAPSettingsChanged({settingType:e.settingType,newValue:e.newValue,uiFunction:e.uiFunction,uiLocation:e.uiLocation,domainName:e.domainName})}catch(e){console.error(e)}}async function trackRightClick(e){try{sendDAPRightClick({translationType:e.translationType,domainName:e.domainName})}catch(e){console.error(e)}}async function trackInlinePositionChange(e){try{sendDAPInlinePositionChange({newPosition:e.newPosition})}catch(e){console.error(e)}}async function trackInlineDragStart(e){try{sendDAPInlineDragStart(e)}catch(e){console.error(e)}}async function trackFptHide(e){try{sendDAPFPTHide(e)}catch(e){console.error(e)}}async function trackIconHover(e){try{sendDAPIconHover(e)}catch(e){console.error(e)}}async function trackInlineCopy(e){try{sendDAPInlineCopy(e)}catch(e){console.error(e)}}async function trackOnboardingStepChange(e){try{sendDAPOnboardingStepChange(e)}catch(e){console.error(e)}}async function trackInlineListen(e){try{sendDAPInlineListen(e)}catch(e){console.error(e)}}async function trackVoiceOverStops(e){try{sendDAPVoiceOverStops(e)}catch(e){console.error(e)}}async function trackOnboardingOpenExternalLink(e){try{sendDAPOnboardingOpenExternalPage(e)}catch(e){console.error(e)}}async function trackReadMoreClick(e){try{sendDAPReadMoreClicked(e)}catch(e){console.error(e)}}async function trackGDocsReplaceText(e){try{sendDAPGDocsReplaceText(e)}catch(e){console.error(e)}}async function getExperiments(e=!1){const t=await fetchExperiments(e);return chrome.runtime.sendMessage({action:"dlExperimentsUpdated",payload:{experiments:[...t]}}),t}async function loginRequest(){login()}async function logoutRequest(){logout({trigger:LOGOUT_TRIGGER.user})}async function getUserState(){const e=await getUserInfo();return{isLoggedIn:e.isLoggedIn,translatorServiceType:e.translatorServiceType,writeServiceType:e.writeServiceType,hasTermbaseService:e.hasTermbaseService}}async function sendNotification(e){switch(e.type){case NOTIFICATION_TYPES.hintKeyboardShortcut:{const e=await chrome.storage.sync.get(["notificationsViewed"]);if(e.notificationsViewed&&e.notificationsViewed.hintKeyboardShortcut)return;await chrome.storage.sync.set({notificationsViewed:{...e.notificationsViewed,hintKeyboardShortcut:!0}});break}case NOTIFICATION_TYPES.showAdsForMSAddins:{const t=await chrome.storage.sync.get(["notificationsViewed"]),n=`showAdsFor${e.options.matchedWord}`;if(t.notificationsViewed&&t.notificationsViewed[n])return;try{sendDAPTrackAdsShown({matchedWord:e.options.matchedWord})}catch(e){console.error(e)}await chrome.storage.sync.set({notificationsViewed:{...t.notificationsViewed,[n]:!0}});break}}try{sendDAPNotificationViewed({notificationType:e.type})}catch(e){console.error(e)}const t=await chrome.tabs.query({active:!0,currentWindow:!0});chrome.tabs.sendMessage(t[0].id,{action:"dlShowNotification",payload:e})}async function checkCommandShortcuts(){return await chrome.commands.getAll()}async function trackUseOfShortcut(e){const t=await checkCommandShortcuts();try{sendDAPShortcutUsed({shortcutType:e.shortcutType,location:e.location,shortcut:t.filter((t=>t.name===e.shortcutType))[0].shortcut,nicheIntegration:e.nicheIntegration||PLATFORM_BEHAVIOURS.default})}catch(e){console.error(e)}}async function trackUiAction(e){sendDAPUiAction({uiAction:e.uiAction,nicheIntegration:e.nicheIntegration||PLATFORM_BEHAVIOURS.default})}function translateSelection(e){chrome.tabs.query({active:!0,currentWindow:!0},(function(t){chrome.tabs.sendMessage(t[0].id,{action:"dlTranslateSelectionRightClick",payload:e})}))}async function trackLandingOnWebsite(e){try{sendDAPLandingOnSpecificWebsite(e)}catch(e){console.error(e)}}async function handleSuccessfulZendeskTranslationsCount(){const e=(await chrome.storage.sync.get(["zendeskSuccessfulTranslations"])).zendeskSuccessfulTranslations+1;await chrome.storage.sync.set({zendeskSuccessfulTranslations:e})}async function handleSuccessfulTranslationsCount(e,t){const n=await chrome.storage.sync.get(["isReviewPopupShown","successfulTranslations","hasUserSeenProCustomerSegmentationSurvey","hasUserSeenArabicSurvey","successfulArabicTranslations"]),r=await getUserState();userHasProServiceLevel(r,SERVICE_NAME.TRANSLATOR);const o=n.successfulTranslations+1;n.hasUserSeenProCustomerSegmentationSurvey;let a=n.isReviewPopupShown,i=n.hasUserSeenArabicSurvey,s=n.successfulArabicTranslations;if("AR"!==e&&"AR"!==t||(s+=1),!i&&"ar"===chrome.i18n.getUILanguage()&&o>=10){const e=await chrome.tabs.query({active:!0,currentWindow:!0});return chrome.tabs.sendMessage(e[0].id,{action:"dlShowArabicSurveyPopup"}),void await chrome.storage.sync.set({hasUserSeenArabicSurvey:!0,successfulArabicTranslations:s,successfulTranslations:o})}if(!i&&s>=10){const e=await chrome.tabs.query({active:!0,currentWindow:!0});return chrome.tabs.sendMessage(e[0].id,{action:"dlShowArabicSurveyPopup"}),void await chrome.storage.sync.set({hasUserSeenArabicSurvey:!0,successfulArabicTranslations:s,successfulTranslations:o})}if(!a&&o>=SHOW_REVIEW_POPUP_AFTER_TRANSLATIONS){const e=await chrome.tabs.query({active:!0,currentWindow:!0});chrome.tabs.sendMessage(e[0].id,{action:"dlShowAskForAReviewPopup"}),a=!0}await chrome.storage.sync.set({isReviewPopupShown:a,successfulArabicTranslations:s,successfulTranslations:o})}async function textToSpeech(e,t){let n=fuzzyFindSupportedLanguage(e.lang);if(isFirefoxExtension())await speakTextWithWebSpeechAPI(e.text,n.langCodeForSpeech,(()=>{chrome.tabs.sendMessage(t,{action:"dlVoiceOverStopped"})}));else{const r={lang:n.langCodeForSpeech,onEvent:function(e){"end"===e.type&&chrome.tabs.sendMessage(t,{action:"dlVoiceOverStopped"}),"error"==e.type&&chrome.tabs.sendMessage(t,{action:"dlVoiceOverErrorOccurred"})}};isMac()&&(r.rate=.9,n.voice&&ORIGIN_STORE_URLS.chrome===chrome.runtime.id&&(r.voiceName=n.voice)),await chrome.tts.speak(e.text,r)}}async function getSupportedVoices(){let e;return e=isFirefoxExtension()?await getWebSpeechAPIVoices():await chrome.tts.getVoices(),e.map((e=>transformLangCodeToSupportedLangCode(e.lang)))}async function stopSpeech(){if(!isFirefoxExtension())return chrome.tts.stop();speechSynthesis.cancel()}async function trackOpenInputHighlighter(e){try{sendDAPOpenInputHighlighter(e)}catch(e){console.error(e)}}async function trackOpenInlineHighlighter(e){try{sendDAPOpenInlineHighlighter(e)}catch(e){console.error(e)}}async function trackCloseInputHighlighter(e){try{sendDAPCloseInputHighlighter(e)}catch(e){console.error(e)}}async function trackCloseInlineHighlighter(e){try{sendDAPCloseInlineHighlighter(e)}catch(e){console.error(e)}}async function getDictionary(e){return await requestDictionary(e)}async function trackDictionaryStatus(e){try{sendDAPDictionaryStatus(e)}catch(e){console.error(e)}}async function trackOpenDictionarySection(e){try{sendDAPOpenDictionarySection(e)}catch(e){console.error(e)}}async function trackDisabledDictionaryHover(e){try{sendDAPDisabledDictionaryHover(e)}catch(e){console.error(e)}}async function trackZendeskCustomizationEvent({eventType:e,zendeskMetaData:t}){try{sendDAPZendeskCustomizationEvent(e,t)}catch(e){console.error(e)}}async function trackLingueeErrorData(e){try{sendDAPLingueeErrorData(e)}catch(e){console.error(e)}}async function trackGdocsMaxCharExceededShown(e){try{sendDAPGDocsMaxCharExceededShown(e)}catch(e){console.error(e)}}async function trackGDocsMaxCharExceededTryProClicked(e){try{sendDAPGDocsMaxCharExceededTryProClicked(e)}catch(e){console.error(e)}}async function trackOnboardingModalShown(e){try{sendDAPOnboardingModalShown(e)}catch(e){console.error(e)}}async function trackUILocationClicked(e){try{sendDAPUILocationClicked(e)}catch(e){console.error(e)}}async function trackDeeplWriteEvent({eventType:e,deeplWriteMetaData:t}){try{sendDAPDeeplWriteEvent(e,t)}catch(e){console.error(e)}}async function improveWriting(e){try{await updateSession();const t=await getSettings(["selectedTargetLanguage","session"]),n=e.payload.requests,r={sourceLang:e.payload?.sourceLang?e.payload.sourceLang:"auto",targetLangCode:t.selectedTargetLanguage,sessionId:t.session.id,id:getRandomUInt32(),sourceTexts:n.map((e=>e.text))||[],isWriteRequest:!0,...e.payload.isHtml&&{isHtml:!0}},o=await simpleTextProcessor(r),a=o.result,i=o.processedText;if(!e.payload.skipDapReporting)try{sendDAPDeeplWriteEvent(DEEPL_WRITE_EVENT_TYPE.TEXT_REFINEMENT_REQUEST,{lang:a.source_lang,sourceLength:e.payload.requests.reduce(((e,t)=>e+t.text.length),0),targetLength:i.flat().reduce(((e,t)=>e+t.length),0),nicheIntegration:e.payload.nicheIntegration||PLATFORM_BEHAVIOURS.default})}catch(e){console.error(e)}return[{detected_source_language:a.source_lang,text:i.flat().join(""),texts:i.map((e=>e.join("")))}]}catch(t){try{sendDAPDeeplWriteEvent(DEEPL_WRITE_EVENT_TYPE.ERROR,{lang:e.payload.sourceLang,sourceLength:e.payload.requests.reduce(((e,t)=>e+t.text.length),0),targetLength:void 0,nicheIntegration:e.payload.nicheIntegration||PLATFORM_BEHAVIOURS.default,error:t.name})}catch(e){console.error(e)}throw t}}async function trackTranslateAcceptOrUndoEvent({eventType:e,acceptOrRevertMetadata:t}){try{sendDAPTranslateAcceptOrUndoEvent(e,t)}catch(e){console.error(e)}}async function trackCustomizationEnabled(e){try{sendDAPCustomizationEnabled(e)}catch(e){console.error(e)}}async function handleSuccessfulGmailTranslationsCount(){const e=await chrome.storage.sync.get(["wasGmailFeedbackPopupShown","successfulTranslationsGmail"]),t=e.successfulTranslationsGmail+1;let n=e.wasGmailFeedbackPopupShown;if(!n&&t>=10){const e=await chrome.tabs.query({active:!0,currentWindow:!0});chrome.tabs.sendMessage(e[0].id,{action:"dlShowGmailFeedbackPopup"}),n=!0}await chrome.storage.sync.set({wasGmailFeedbackPopupShown:n,successfulTranslationsGmail:t})}async function trackGmailCharLimitReached(e){try{sendDAPGmailCharLimitReached(e)}catch(e){console.error(e)}}async function handleSuccessfulGslidesTranslationsCount(){const e=await chrome.storage.sync.get(["wasGSlidesFeedbackPopupShown","successfulTranslationsGSlides"]),t=e.successfulTranslationsGSlides+1;let n=e.wasGSlidesFeedbackPopupShown;if(!n&&t>=10){const e=await chrome.tabs.query({active:!0,currentWindow:!0});chrome.tabs.sendMessage(e[0].id,{action:"dlShowSlidesFeedbackPopup"}),n=!0}await chrome.storage.sync.set({wasGSlidesFeedbackPopupShown:n,successfulTranslationsGSlides:t})}async function trackAlternativesEvent({eventType:e,alternativesMetaData:t}){try{sendDAPAlternativesEvent(e,t)}catch(e){console.error(e)}}async function getClientState(e=!1,t=!0){let n;try{n=await fetchClientState(e,t)}catch(e){throw e.name===DL_OIDC_ERROR_CODES.INVALID_GRANT&&logout({trigger:LOGOUT_TRIGGER.extension,reason:e.name,showAlert:!0}),e}return n}async function getUsersCharacterLimit(){return await getCharacterLimit()}function trackUpgradeNotificationDisplayed(e){try{sendDAPTrackUpgradeNotificationDisplayed(e)}catch(e){console.error(e)}}function trackUpgradeNotificationClosed(e){try{sendDAPTrackUpgradeNotificationClosed(e)}catch(e){console.error(e)}}function trackZendeskGlossaryOpened(e){try{sendDAPZendeskGlossaryConfigOpened(e)}catch(e){console.error(e)}}function trackGlossaryEnabled(e){try{sendDAPGlossaryEnabledOrDisabled(!0,e)}catch(e){console.error(e)}}function trackGlossaryDisabled(e){try{sendDAPGlossaryEnabledOrDisabled(!1,e)}catch(e){console.error(e)}}function trackUpgradeNotificationAction(e,t){try{sendDAPTrackUpgradeNotificationAction(e,t)}catch(e){console.error(e)}}async function testClassicApi({text:e}){return await processContent({texts:[e],targetLang:"EN",mode:CONTENT_PROCESS_MODE.WRITE})}function trackLanguageDetectionForTextProcessing(e){sendDAPTrackLanguageDetectionForTextProcessing(e)}function trackSeeAlternativesClicked(){sendDAPSeeAlternativesClicked()}function trackAlternativeSelected(e){sendDAPAlternativeSelected(e)}async function splitTextRequest(e){await updateSession();const t=e.payload.texts,n=CONTENT_PROCESS_MODE.TRANSLATE;let r;const o=[],a=[],i=await splitText({texts:t,mode:n});r=i.result.lang.detected;for(const e of i.result.texts){const t=[];for(const n of e.chunks)for(const e of n.sentences)a.push(e),t.push(a.length-1);o.push(t)}return{detected_source_language:r,sentences:a,textLinesComponents:o}}async function requestAlternatives(e){await updateSession();const t=await getSettings(["activeTermbaseId","targetLanguageUserInput","session","installationId","languagePreferenceForWriting","regionalVariant","isLoggedIn","isGlossaryEnabled","hasTermbaseService"]),n=e.payload.texts,r=e.payload.mode?e.payload.mode:CONTENT_PROCESS_MODE.TRANSLATE,o=e.payload.targetLang,a=e.payload.writeLang,i=getRegionalLanguageSet(o,t.regionalVariant);let s;const c=[],l=[];let u,d,p=!1,g=!1,h=!1;try{const h=await splitText({texts:n,mode:r,advancedMode:!!e.payload.style});if(s=h.result.lang.detected,userHasGlossaryService({isLoggedIn:t.isLoggedIn,hasTermbaseService:t.hasTermbaseService})&&t.activeTermbaseId&&r!==CONTENT_PROCESS_MODE.WRITE&&t.isGlossaryEnabled)try{const[e]=await fetchTermbases(),n=getActiveTermbaseFromListOfTermbases(t.activeTermbaseId,e);if(n)for(let e of n.termDictionaries)if(e.languagePair===`${s.substr(0,2)}>${i.langCode.substr(0,2)}`.toLowerCase()){d={id:n.id,dictionaryId:e.id},p=!0,g=n.shared;break}}catch(e){console.log({e:e,message:"fetching glossaries failed"})}for(const e of h.result.texts){const t=[];for(const n of e.chunks)for(const e of n.sentences)l.push(e),t.push(l.length-1);c.push(t)}const f=l.map(((t,n)=>({kind:"default",preferred_num_beams:6,raw_en_context_after:n<l.length-1?[l[n+1].text]:[],raw_en_context_before:n>0?[l[n-1].text]:[],sentences:[{...t,id:n+1}],...e.payload.style&&{style_variant:e.payload.style,write_variant_requests:["main","variants"]},...e.payload.formality&&{formality:e.payload.formality}}))),m=i.regionalVariant&&!a;u=await handleJobs({mode:r,jobs:f,sourceLang:a&&r===CONTENT_PROCESS_MODE.WRITE?a.substr(0,2):s,targetLang:a&&r===CONTENT_PROCESS_MODE.WRITE?a.substr(0,2):o.substr(0,2),textType:"plaintext",styleVariant:e.payload.style,...d&&{termbase:d},...m&&{regionalVariant:i.regionalVariant}})}catch(t){throw r===CONTENT_PROCESS_MODE.WRITE?sendDAPDeeplWriteEvent(DEEPL_WRITE_EVENT_TYPE.ERROR,{lang:s,sourceLength:n.reduce(((e,t)=>e+t.length),0),targetLength:0,nicheIntegration:PLATFORM_BEHAVIOURS.default,error:t.name,style:e.payload.style}):sendDAPTranslationErrorData({errorCode:t.name,errorMessage:t.message,domainName:e.payload.domainName,targetLang:o,websiteLanguage:s,trigger:TRANSLATION_TRIGGER.input_alternatives,characterCount:n.reduce(((e,t)=>e+t.length),0)}),t}h=!!p&&didGlossaryResultInChangeToTranslationOutput(u.result),handleSuccessfulTranslationsCount(s,o);const f=u.result.translations,m=u.result.translations.map(((e,t)=>`${l[t].prefix}${e.beams[0].sentences[0].text}`)),_=joinAlternativeSentences(f,l),E=c.map((e=>e.map((e=>m[e])))),T=_.map((e=>c.map((t=>t.map((t=>e[t])))))),S=joinAlternatives(f,l),y=T.map((e=>e.map((e=>e.join("")))));try{r===CONTENT_PROCESS_MODE.WRITE?(sendDAPDeeplWriteEvent(DEEPL_WRITE_EVENT_TYPE.TEXT_REFINEMENT_REQUEST,{lang:s,sourceLength:n.reduce(((e,t)=>e+t.length),0),targetLength:E.flat().reduce(((e,t)=>e+t.length),0),nicheIntegration:PLATFORM_BEHAVIOURS.default,style:e.payload.style}),sendDAPDeeplWriteEvent(DEEPL_WRITE_EVENT_TYPE.GET_ALTERNATIVES_FOR_INPUT,{lang:s,sourceLength:n.reduce(((e,t)=>e+t.length),0),targetLength:E.flat().reduce(((e,t)=>e+t.length),0),nicheIntegration:PLATFORM_BEHAVIOURS.default,style:e.payload.style})):sendDAPTranslationRequest({installationId:t.installationId,trigger:TRANSLATION_TRIGGER.input_alternatives,websiteLanguage:s,targetLanguage:o,characterCount:n.reduce(((e,t)=>e+t.length),0),domainName:e.payload.domainName,nicheIntegration:PLATFORM_BEHAVIOURS.default,...p&&{glossaryTrackingInfo:{isGlossaryEnabled:!!d,isGlossaryShared:g,didGlossaryChangeTranslation:h}}})}catch(e){console.error(e)}return{detected_source_language:s,processedText:E[0].join(""),textLinesComponents:c,alternatives:S,alternativeComponents:y}}function joinAlternativeSentences(e,t){let n=e[0].beams.length;e.forEach((e=>{e.beams.length<n&&(n=e.beams.length)}));const r=[];for(let o=0;o<n;o++){let n=[];for(let r=0;r<e.length;r++){const a=`${t[r].prefix}`;n.push(`${a}${e[r].beams[o].sentences[0].text}`)}r.push(n)}return r}function joinAlternatives(e,t){let n=e[0].beams.length;e.forEach((e=>{e.beams.length<n&&(n=e.beams.length)}));const r=[];for(let o=0;o<n;o++){let n="";for(let r=0;r<e.length;r++){n=`${n}${`${t[r].prefix}`}${e[r].beams[o].sentences[0].text}`}r.push(n)}return r}const getActiveTermbase=async e=>{if(userHasGlossaryService(e)&&e.activeTermbaseId&&e.isGlossaryEnabled&&e.mode!==CONTENT_PROCESS_MODE.WRITE){const[t]=await fetchTermbases(),n=getActiveTermbaseFromListOfTermbases(e.activeTermbaseId,t);if(n)for(let t of n.termDictionaries)if(t.languagePair===`${e.sourceLang.substr(0,2)}>${e.targetLang.substr(0,2)}`.toLowerCase())return{id:n.id,dictionaryId:t.id}}};function trackIframeTranslationSuccessful(){sendDAPTrackIframeTranslationSuccessful()}function trackIframeTranslationFailed(e){sendDAPTrackIframeTranslationFailed(e)}function trackClickOnAdsButton(){sendDAPTrackAdsButtonClicked()}function trackAdsShown(e){sendDAPTrackAdsShown(e)}function createInteractiveTranslation(e){createITATranslatorSession(e.sourceText,e.targetLang,e.port).then((()=>{isDev()&&console.log(`ITA Translator session created for sender: ${e.port.sender.tab.url}, tab ID: ${e.port.sender.tab.id}}`)})).catch((t=>{isDev()&&console.error(`Error creating ITA Translator session for sender: ${e.port.sender.tab.url}, tab ID: ${e.port.sender.tab.id}}`,t)}))}function updateTargetLanguageInITASession(e){updateITATargetLanguage(getActiveTranslator(e.port),e.language)}const PERODIC_CODE_EXECUTION_NAMES={syncExperiments:"sync_experiments",syncClientState:"sync_client_state"};function isValidUrlForContentScript(e){let t;try{t=new URL(e)}catch(e){return!1}return"http:"===t.protocol||"https:"===t.protocol}const INTERNAL_PAGE_KEYS={developer_tools:"DEVELOPER_TOOLS",settings_page:"SETTINGS_PAGE",settings_writing:"SETTINGS_WRITING",settings_reading:"SETTINGS_READING",settings_customizations:"SETTINGS_CUSTOMIZATIONS",settings_glossary:"SETTINGS_GLOSSARY",onboarding:"ONBOARDING",onboarding_after_successful_login:"ONBOARDING_AFTER_SUCCESSFUL_LOGIN",firefox_first_run:"FIREFOX_FIRST_RUN",privacy_policy:"PRIVACY_POLICY",create_account:"CREATE_ACCOUNT"},INTERNAL_PAGE_FILES={DEVELOPER_TOOLS:"dev-page.html",SETTINGS_PAGE:"settings.html",SETTINGS_READING:"settings.html#translator",SETTINGS_WRITING:"settings.html#write",SETTINGS_CUSTOMIZATIONS:"settings.html#customizations",SETTINGS_GLOSSARY:"settings.html#glossary",ONBOARDING:"onboarding.html",ONBOARDING_FIREFOX:"onboarding-firefox.html",ONBOARDING_AFTER_SUCCESSFUL_LOGIN:"onboarding.html#successful_login",FIREFOX_FIRST_RUN:"firefox-first-run.html",PRIVACY_POLICY:"privacy-policy.html",CREATE_ACCOUNT:"create-account.html"};function openInternalPage({payload:e}){const{destination:t,openInSameTab:n}=e;if(void 0===t)return;let r="";switch(t){case INTERNAL_PAGE_KEYS.developer_tools:r=buildInternalUrl(INTERNAL_PAGE_FILES.DEVELOPER_TOOLS);break;case INTERNAL_PAGE_KEYS.settings_page:r=buildInternalUrl(INTERNAL_PAGE_FILES.SETTINGS_PAGE);break;case INTERNAL_PAGE_KEYS.settings_writing:r=buildInternalUrl(INTERNAL_PAGE_FILES.SETTINGS_WRITING);break;case INTERNAL_PAGE_KEYS.settings_reading:r=buildInternalUrl(INTERNAL_PAGE_FILES.SETTINGS_READING);break;case INTERNAL_PAGE_KEYS.settings_customizations:r=buildInternalUrl(INTERNAL_PAGE_FILES.SETTINGS_CUSTOMIZATIONS);break;case INTERNAL_PAGE_KEYS.settings_glossary:r=buildInternalUrl(INTERNAL_PAGE_FILES.SETTINGS_GLOSSARY);break;case INTERNAL_PAGE_KEYS.onboarding:r=isFirefoxExtension()?buildInternalUrl(INTERNAL_PAGE_FILES.ONBOARDING_FIREFOX):buildInternalUrl(INTERNAL_PAGE_FILES.ONBOARDING);break;case INTERNAL_PAGE_KEYS.onboarding_after_successful_login:r=buildInternalUrl(INTERNAL_PAGE_FILES.ONBOARDING_AFTER_SUCCESSFUL_LOGIN);break;case INTERNAL_PAGE_KEYS.firefox_first_run:r=buildInternalUrl(INTERNAL_PAGE_FILES.FIREFOX_FIRST_RUN);break;case INTERNAL_PAGE_KEYS.privacy_policy:r=buildInternalUrl(INTERNAL_PAGE_FILES.PRIVACY_POLICY);break;case INTERNAL_PAGE_KEYS.create_account:r=buildInternalUrl(INTERNAL_PAGE_FILES.CREATE_ACCOUNT)}r&&(n?chrome.tabs.query({active:!0,currentWindow:!0},(function(e){const t=e[0];chrome.tabs.update(t.id,{url:r})})):chrome.tabs.create({url:r,active:!0}))}function buildInternalUrl(e){return chrome.runtime.getURL(e)}function messageListener(e,t,n){switch(isDev()&&console.log(t.tab?`message from a content script: ${t.tab.url} with tab id: ${t.tab.id}. action: ${e.action}`:`message from the extension with action: ${e.action}`),e.action){case"dlRequestHtmlTranslation":translateHtmlRequest(e).then((e=>n(e))).catch((e=>{n(handleError(e,Sentry))}));break;case"dlRequestInlineTranslation":translateInlineRequest(e).then((e=>{n(e)})).catch((e=>{n(handleError(e,Sentry))}));break;case"dlTriggerTranslateInline":triggerTranslateInline(t.tab.id);break;case"dlRequestInputTranslation":translateInputRequest(e).then((e=>n(e))).catch((e=>{n(handleError(e,Sentry))}));break;case"dlRequestZendeskInputTranslation":translateZendeskInputRequest(e).then((e=>n(e))).catch((e=>{n(handleError(e,Sentry))}));break;case"dlRequestGmailReceivedEmailTranslation":translateGmailReceivedEmail(e).then((e=>n(e))).catch((e=>{n(handleError(e,Sentry))}));break;case"dlRequestWhatsAppMessageTranslation":translateWhatsAppMessageRequest(e).then((e=>n(e))).catch((e=>{n(handleError(e,Sentry))}));break;case"dlRequestTwitterTweetTranslation":translateTwitterTweetRequest(e).then((e=>n(e))).catch((e=>{n(handleError(e,Sentry))}));break;case"dlRequestLinkedInPostTranslation":translateLinkedInPostRequest(e).then((e=>n(e))).catch((e=>{n(handleError(e,Sentry))}));break;case"dlRequestZendeskMessageTranslation":translateZendeskMessageRequest(e).then((e=>n(e))).catch((e=>{n(handleError(e,Sentry))}));break;case"dlRequestWhatsAppMessagesTranslation":translateWhatsAppMessagesRequest(e).then((e=>n(e))).catch((e=>{n(handleError(e,Sentry))}));break;case"dlRequestGDocsSplitText":performGDocsSplitText(e).then((e=>n(e))).catch((e=>{n(handleError(e,Sentry))}));break;case"dlRequestGDocsProcessContent":performGDocsProcessContent(e).then((e=>n(e))).catch((e=>{n(handleError(e,Sentry))}));break;case"dlRequestGDocsSentenceAlternatives":fetchGDocsSentenceAlternatives(e).then((e=>n(e))).catch((e=>{n(handleError(e,Sentry))}));break;case"dlRequestGDocsWordAlternatives":fetchGDocsWordAlternatives(e).then((e=>n(e))).catch((e=>{n(handleError(e,Sentry))}));break;case"dlRequestGDocsSentenceFromPartialTranslation":rebuildGDocsSentenceFromPartialTranslation(e).then((e=>n(e))).catch((e=>{n(handleError(e,Sentry))}));break;case"dlRequestTermbases":fetchTermbases().then((e=>n(e))).catch((e=>{n(handleError(e,Sentry))}));break;case"dlTrackDetectLanguage":trackDetectLanguage(e),n();break;case"dlRequestLogin":loginRequest().then((()=>n(!0))).catch((e=>{n(handleError(e,Sentry))}));break;case"dlRequestLogout":logoutRequest().then((()=>n(!0))).catch((e=>{n(handleError(e,Sentry))}));break;case"dlGetAppSettings":chrome.storage.sync.get(null,(function(e){n(e)}));break;case"dlUpdateAppSettings":chrome.storage.sync.set(e.payload,(function(){n(e.payload)}));break;case"dlTranslatedInputTextNotSet":sendDAPContentScriptErrorData({errorCode:EXTENSION_ERRROR_CODES.TRANSLATED_INPUT_NOT_SET,errorMessage:"The translated text could not be set",domainName:e.payload}),n();break;case"dlGetUserState":getUserState().then((e=>n(e))).catch((e=>{n(handleError(e,Sentry))}));break;case"dlExternalURLRedirect":redirectToExternalURL(e.payload),n();break;case"dlOpenInternalPage":openInternalPage(e),n();break;case"dlTrackInputTranslationInjection":trackInputTranslationInjection(e.payload),n();break;case"dlTrackExtensionOpenedEvent":trackExtensionOpenedEvent(e.payload),n();break;case"dlTrackLogoClickedEvent":trackLogoClickedEvent(e.payload),n();break;case"dlTrackDocTransClick":trackDocTransClick(),n();break;case"dlTrackRecommendToAFriendClick":trackRecommendToAFriendClick(),n();break;case"dlSendNotification":sendNotification(e.payload),n();break;case"dlCheckCommandShortcuts":checkCommandShortcuts().then((e=>n(e)));break;case"dlTrackUseOfShortcut":trackUseOfShortcut(e.payload),n();break;case"dlTrackUiAction":trackUiAction(e.payload),n();break;case"dlTrackInlineSettingOpened":trackInlineSettingsOpened(e.payload),n();break;case"dlTrackSettingChanged":trackSettingChanged(e.payload),n();break;case"dlTrackUILocationClicked":trackUILocationClicked(e.payload),n();break;case"dlTrackRightClick":trackRightClick(e.payload),n();break;case"dlTrackInlinePositionChange":trackInlinePositionChange(e.payload),n();break;case"dlTrackInlineDragStart":trackInlineDragStart(),n();break;case"dlTrackFptHide":trackFptHide(e.payload);break;case"dlTrackInlineCopy":trackInlineCopy(e.payload),n();break;case"dlTrackInlineListen":trackInlineListen(e.payload),n();break;case"dlTrackIconHover":trackIconHover(e.payload),n();break;case"dlTrackVoiceOverStops":trackVoiceOverStops(e.payload),n();break;case"dlTrackOnboardingStepChange":trackOnboardingStepChange(e.payload),n();break;case"dlTrackOnboardingOpenExternalLink":trackOnboardingOpenExternalLink(e.payload),n();break;case"dlTrackReadMore":trackReadMoreClick(e.payload),n();break;case"dlTrackLandingOnWebsite":trackLandingOnWebsite(e.payload),n();break;case"dlTrackGDocsReplaceText":trackGDocsReplaceText(e.payload),n();break;case"dlGetExperiments":getExperiments(e.payload?.forceFetch).then((e=>n(e))).catch((e=>n(e)));break;case"dlGetClientState":getClientState(e.payload?.forceFetch).then((e=>n(e))).catch((e=>n(e)));break;case"dlTextToSpeech":textToSpeech(e.payload,t.tab.id).then((()=>n())).catch((e=>{n(handleError(e,Sentry))}));break;case"dlGetDictionary":getDictionary(e.payload).then((e=>n(e))).catch((e=>{n(handleError(e,Sentry))}));break;case"dlGetSupportedVoices":getSupportedVoices(e.payload).then((e=>n(e))).catch((e=>{n(handleError(e,Sentry))}));break;case"dlStopSpeech":stopSpeech(e.payload).then((()=>n())).catch((e=>{n(handleError(e,Sentry))}));break;case"dlTrackOpenInputHighlighter":trackOpenInputHighlighter(e.payload).then((()=>n())).catch((e=>{n(handleError(e,Sentry))}));break;case"dlTrackOpenInlineHighlighter":trackOpenInlineHighlighter(e.payload).then((()=>n())).catch((e=>{n(handleError(e,Sentry))}));break;case"dlTrackCloseInputHighlighter":trackCloseInputHighlighter(e.payload).then((()=>n())).catch((e=>{n(handleError(e,Sentry))}));break;case"dlTrackCloseInlineHighlighter":trackCloseInlineHighlighter(e.payload).then((()=>n())).catch((e=>{n(handleError(e,Sentry))}));break;case"dlTrackDictionaryStatus":trackDictionaryStatus(e.payload).then((()=>n())).catch((e=>{n(handleError(e,Sentry))}));break;case"dlTrackOpenDictionarySection":trackOpenDictionarySection(e.payload).then((()=>n())).catch((e=>{n(handleError(e,Sentry))}));break;case"dlTrackDisabledDictionaryHover":trackDisabledDictionaryHover(e.payload).then((()=>n())).catch((e=>{n(handleError(e,Sentry))}));break;case"dlTrackZendeskCustomizationEvent":trackZendeskCustomizationEvent(e.payload).then((()=>n())).catch((e=>{n(handleError(e,Sentry))}));break;case"dlTrackZendeskGlossaryOpened":trackZendeskGlossaryOpened(e.payload).then((()=>n())).catch((e=>{n(handleError(e,Sentry))}));break;case"dlTrackGlossaryEnabled":trackGlossaryEnabled(e.payload).then((()=>n())).catch((e=>{n(handleError(e,Sentry))}));break;case"dlTrackGlossaryDisabled":trackGlossaryDisabled(e.payload).then((()=>n())).catch((e=>{n(handleError(e,Sentry))}));break;case"dlTrackDeeplWriteEvent":trackDeeplWriteEvent(e.payload).then((()=>n())).catch((e=>{n(handleError(e,Sentry))}));break;case"dlTrackLingueeErrorData":trackLingueeErrorData(e.payload).then((()=>n())).catch((e=>{n(handleError(e,Sentry))}));break;case"dlTrackGdocsMaxCharExceededShown":trackGdocsMaxCharExceededShown(e.payload).then((()=>n())).catch((e=>{n(handleError(e,Sentry))}));break;case"dlTrackGDocsMaxCharExceededTryProClicked":trackGDocsMaxCharExceededTryProClicked(e.payload).then((()=>n())).catch((e=>{n(handleError(e,Sentry))}));break;case"dlTrackOnboardingModalShown":trackOnboardingModalShown(e.payload).then((()=>n())).catch((e=>{n(handleError(e,Sentry))}));break;case"dlRequestImproveWriting":improveWriting(e).then((e=>n(e))).catch((e=>{n(handleError(e,Sentry))}));break;case"dlSplitTextRequest":splitTextRequest(e).then((e=>n(e))).catch((e=>{n(handleError(e))}));break;case"dlRequestAlternatives":requestAlternatives(e).then((e=>n(e))).catch((e=>{n(handleError(e))}));break;case"dlTrackTranslateAcceptOrRevertEvent":trackTranslateAcceptOrUndoEvent(e.payload).then((()=>n())).catch((e=>{n(handleError(e,Sentry))}));break;case"dlTrackCustomizationEnabledEvent":trackCustomizationEnabled(e.payload).then((()=>n())).catch((e=>{n(handleError(e,Sentry))}));break;case"dlTrackGmailCharLimitReached":trackGmailCharLimitReached(e.payload).then((()=>n())).catch((e=>{n(handleError(e,Sentry))}));break;case"dlGetUsersCharacterLimit":getUsersCharacterLimit().then((e=>n(e))).catch((e=>{n(handleError(e,Sentry))}));break;case"dlTrackAlternativesEvent":trackAlternativesEvent(e.payload).then((()=>n())).catch((e=>{n(handleError(e,Sentry))}));break;case"dlTestClassicAPI":testClassicApi(e.payload).then((e=>n(e))).catch((e=>{n(handleError(e,Sentry))}));break;case"dlOnSuccessfulZendeskTranslation":handleSuccessfulZendeskTranslationsCount();break;case"dlTrackUpgradeNotificationIsDisplayed":trackUpgradeNotificationDisplayed(e.payload.type);break;case"dlTrackUpgradeNotificationClosed":trackUpgradeNotificationClosed(e.payload.type);break;case"dlTrackUpgradeNotificationAction":trackUpgradeNotificationAction(e.payload.type,e.payload.cta);break;case"dlTrackLanguageDetectionForTextProcessing":trackLanguageDetectionForTextProcessing(e.payload).finally(n());break;case"dlTrackSeeAlternativesClicked":trackSeeAlternativesClicked(),n();break;case"dlTrackAlternativeSelected":trackAlternativeSelected(e.payload),n();break;case"dlTrackIframeTranslationSuccessful":trackIframeTranslationSuccessful(),n();break;case"dlTrackIframeTranslationFailed":trackIframeTranslationFailed(e.payload),n();break;case"dlTrackClicksOnAdsButton":trackClickOnAdsButton(),n();break;case"dlTrackAdsShown":trackAdsShown(e.payload),n()}return!0}function commandListener(e){switch(console.log(`Command "${e}" triggered`),e){case SHORTCUT_TYPES.triggerTranslation:chrome.tabs.query({active:!0,currentWindow:!0},(function(e){chrome.tabs.sendMessage(e[0].id,{action:"dlTriggerTranslationShortcut"})}));break;case SHORTCUT_TYPES.changeLanguage:chrome.tabs.query({active:!0,currentWindow:!0},(function(e){chrome.tabs.sendMessage(e[0].id,{action:"dlChangeLanguageShortcut"})}))}}function onInstalled(e){setSettingsAfterInstall().then((t=>{trackInstallation(e.reason,t.installationIdWasSet)})).catch((e=>sendDAPErrorData({errorCode:EXTENSION_ERRROR_CODES.INSTALLATION_ERROR,errorMessage:`setSettingsAfterInstall failed: ${e.message}`}))).finally((()=>{try{getExperiments(),getClientState(!0),setPerodicCodeExecution()}catch(e){console.error(e),sendDAPErrorData({errorCode:EXTENSION_ERRROR_CODES.INSTALLATION_ERROR,errorMessage:e.message})}try{chrome.runtime.setUninstallURL("https://deepl.qualtrics.com/jfe/form/SV_eJxAD8c7J5hqSRU"),e.reason===chrome.runtime.OnInstalledReason.UPDATE&&console.log(`Update from version ${e.previousVersion} to ${chrome.runtime.getManifest().version} was completed`),e.reason!==chrome.runtime.OnInstalledReason.INSTALL||isTest()||(isFirefoxExtension()?openInternalPage({payload:{destination:INTERNAL_PAGE_KEYS.firefox_first_run}}):openInternalPage({payload:{destination:INTERNAL_PAGE_KEYS.create_account}})),chrome.contextMenus.removeAll((function(){chrome.contextMenus.create({id:"dlTranslateWithDeepL",title:chrome.i18n.getMessage("right_click_menu_translate_with_deepl"),contexts:["all"]})})),chrome.tabs.query({},(function(e){for(const t of e)isValidUrlForContentScript(t)&&chrome.scripting.executeScript({target:{tabId:t},files:["build/content.js"]})}))}catch(e){sendDAPErrorData({errorCode:EXTENSION_ERRROR_CODES.INSTALLATION_ERROR,errorMessage:e.message})}}))}async function setPerodicCodeExecution(){await chrome.alarms.clearAll(),await chrome.alarms.create(PERODIC_CODE_EXECUTION_NAMES.syncExperiments,{delayInMinutes:10,periodInMinutes:10}),await chrome.alarms.create(PERODIC_CODE_EXECUTION_NAMES.syncClientState,{delayInMinutes:30,periodInMinutes:30})}function listenToPerodicCodeExecution(e){switch(e.name){case PERODIC_CODE_EXECUTION_NAMES.syncExperiments:getExperiments();break;case PERODIC_CODE_EXECUTION_NAMES.syncClientState:getClientState()}}async function setSettingsAfterInstall(){let e=!1;const t=await chrome.storage.sync.get(null),n=getInitSettings();if(!t||!t.settingSchemeVersion||t.settingSchemeVersion<n.settingSchemeVersion){let r={};for(const[o,a]of Object.entries(n))o in t&&"settingSchemeVersion"!==o?r[o]=t[o]:("installationId"===o&&(e=!0),r[o]=a);await chrome.storage.sync.clear(),await chrome.storage.sync.set(r),console.log("settings set: ",r)}return{installationIdWasSet:e}}async function trackInstallation(e,t){const n=await getBrowserInstanceId();n||e!==chrome.runtime.OnInstalledReason.INSTALL?n||await setBrowserInstanceId():(await setBrowserInstanceId(),sendDAPInstallSuccess(),sendDAPBrowserInstanceIdCreated()),t&&sendDAPInstallationIdCreated()}function onContextMenuClicked(e){if("dlTranslateWithDeepL"===e.menuItemId)translateSelection(!1)}function onStorageChanged(){}function portListener(e,t){switch(isDev()&&console.log(`Port message received, sender: ${t.sender.tab.url}, tab ID: ${t.sender.tab.id}, message type ${e.type}`),e.type){case MESSAGE_KEYS.ITA_REQUEST_TRANSLATION:createInteractiveTranslation({sourceText:e.payload.sourceText,targetLang:e.payload.targetLang,port:t});break;case MESSAGE_KEYS.ITA_UPDATE_TARGET_LANGUAGE:updateTargetLanguageInITASession({language:e.payload.language,port:t});break;default:isDev()&&console.log(`Unrecognised message type: ${e.type}`)}}const ACTIONS={setBrowserExtensionUserAgent:{type:"modifyHeaders",requestHeaders:[{header:"user-agent",operation:"set",value:`DeepLBrowserExtension/1.26.1 ${navigator.userAgent} `}]}},CONDITIONS={lingueeDomainFilter:{excludedDomains:["linguee.com"],urlFilter:"*://www-app.linguee.com*",resourceTypes:["xmlhttprequest"]},deeplToolingApiDomainFilter:{excludedDomains:["deepl.com"],urlFilter:"*://*.deepl.com/jsonrpc?client=chrome-extension,*",resourceTypes:["xmlhttprequest"]},deeplStatisticsDomainFilter:{excludedDomains:["deepl.com"],urlFilter:"*://s.deepl.*/chrome/statistics*",resourceTypes:["xmlhttprequest"]}};function updateDynamicRules(){if(chrome.declarativeNetRequest)chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:[2,3,4],addRules:[{id:2,priority:1,action:ACTIONS.setBrowserExtensionUserAgent,condition:CONDITIONS.lingueeDomainFilter},{id:3,priority:1,action:ACTIONS.setBrowserExtensionUserAgent,condition:CONDITIONS.deeplToolingApiDomainFilter},{id:4,priority:1,action:ACTIONS.setBrowserExtensionUserAgent,condition:CONDITIONS.deeplStatisticsDomainFilter}]},(async e=>{isDev()&&await console.log("created",e)}));else if(chrome.webRequest?.onBeforeSendHeaders){const e=isDev()?"https://test.deepl.com/":"https://www.deepl.com/";browser.webRequest.onBeforeSendHeaders.addListener((t=>{const n=t.requestHeaders;return n.push({name:"Referer",value:e}),{requestHeaders:n}}),{urls:["*://*.deepl.com/jsonrpc?client=chrome-extension,*"]},["requestHeaders","blocking"]),browser.webRequest.onBeforeSendHeaders.addListener((function(e){for(const t of e.requestHeaders)if("User-Agent"===t.name){t.value=`DeepLBrowserExtension/1.26.1 ${navigator.userAgent}`;break}return{requestHeaders:e.requestHeaders}}),{urls:["*://www-app.linguee.com/*","*://*.deepl.com/jsonrpc?client=chrome-extension,*","https://s.deepl.com/chrome/statistics"]},["blocking","requestHeaders"])}}function connected(e){isDev()&&console.log(`PORT connected to tab with id: ${e.sender.tab.id}`),e.onMessage.addListener(portListener)}return self.addEventListener("error",(function(e){const t=e.message||"";shouldIgnoreError(t)&&e.preventDefault()})),self.addEventListener("unhandledrejection",(function(e){const t=e.reason&&e.reason.message||"";shouldIgnoreError(t)&&e.preventDefault()})),init({...initialSentryConfig}),setContext("appContext",{location:"background"}),createSentryUserListener(Sentry),console.info("Sentry initialised"),updateDynamicRules(),chrome.runtime.onInstalled.addListener(onInstalled),chrome.contextMenus.onClicked.addListener(onContextMenuClicked),chrome.tabs.onActivated.addListener((async function(e){isValidUrlForContentScript((await chrome.tabs.get(e.tabId)).url)&&chrome.tabs.sendMessage(e.tabId,{action:"dlTabChanged"}),chrome.tabs.query({},(function(t){for(var n=0;n<t.length;++n)chrome.tabs.sendMessage(t[n].id,{action:"dlChangeActiveTabStatus",payload:{isActive:t[n].id===e.tabId}})})),getClientState()})),chrome.runtime.onConnect.addListener(connected),chrome.runtime.onMessage.addListener(messageListener),chrome.storage.onChanged.addListener(onStorageChanged),chrome.commands.onCommand.addListener(commandListener),chrome.alarms.onAlarm.addListener(listenToPerodicCodeExecution),chrome.runtime.onMessage.addListener((e=>{"reload"===e&&chrome.tabs.query({active:!0}).then((()=>{chrome.runtime.reload(),chrome.tabs.reload()}))})),chrome.webRequest.onBeforeSendHeaders.addListener((()=>{}),{urls:["<all_urls>"]},["requestHeaders","extraHeaders"]),exports.CONTENT_PROCESS_MODE=CONTENT_PROCESS_MODE,exports.INTERNAL_PAGE_KEYS=INTERNAL_PAGE_KEYS,exports.PERODIC_CODE_EXECUTION_NAMES=PERODIC_CODE_EXECUTION_NAMES,exports.URL_ACTIONS=URL_ACTIONS,exports.URL_LIST=URL_LIST,exports.cacheClientState=cacheClientState,exports.cacheExperiments=cacheExperiments,exports.checkCommandShortcuts=checkCommandShortcuts,exports.checkLimits=checkLimits,exports.clearLoginTimestamp=clearLoginTimestamp,exports.commandListener=commandListener,exports.connectDatabase=connectDatabase,exports.createITATranslatorSession=createITATranslatorSession,exports.createInteractiveTranslation=createInteractiveTranslation,exports.deleteAuthTokens=deleteAuthTokens,exports.fetchClientState=fetchClientState,exports.fetchExperiments=fetchExperiments,exports.fetchGDocsSentenceAlternatives=fetchGDocsSentenceAlternatives,exports.fetchGDocsWordAlternatives=fetchGDocsWordAlternatives,exports.fetchTermbases=fetchTermbases,exports.getAccountID=getAccountID,exports.getActiveTermbase=getActiveTermbase,exports.getActiveTranslator=getActiveTranslator,exports.getAllServiceLevels=getAllServiceLevels,exports.getAuthTokens=getAuthTokens,exports.getBrowserInstanceId=getBrowserInstanceId,exports.getCachedClientState=getCachedClientState,exports.getCachedExperiments=getCachedExperiments,exports.getCharacterLimit=getCharacterLimit,exports.getClientState=getClientState,exports.getCurrentExperiments=getCurrentExperiments,exports.getDapAlternativesSegmentationType=getDapAlternativesSegmentationType,exports.getDapApiConfig=getDapApiConfig,exports.getDapApiExtensionOpenedFromId=getDapApiExtensionOpenedFromId,exports.getDapApiInlinePositionType=getDapApiInlinePositionType,exports.getDapApiLingueeError=getDapApiLingueeError,exports.getDapApiLogoClickedFromId=getDapApiLogoClickedFromId,exports.getDapApiNotificationType=getDapApiNotificationType,exports.getDapApiSettingType=getDapApiSettingType,exports.getDapApiShortcutTypes=getDapApiShortcutTypes,exports.getDapApiTranslationTriggerId=getDapApiTranslationTriggerId,exports.getDapApiUiActionEventId=getDapApiUiActionEventId,exports.getDapApiUiFunctionality=getDapApiUiFunctionality,exports.getDapApiUiLocation=getDapApiUiLocation,exports.getDapContentProcessingModeType=getDapContentProcessingModeType,exports.getDapGmailActionType=getDapGmailActionType,exports.getDapLogoutTrigger=getDapLogoutTrigger,exports.getDapNicheIntegration=getDapNicheIntegration,exports.getDapOnboardingExternalLink=getDapOnboardingExternalLink,exports.getDapOnboardingStepChangeTrigger=getDapOnboardingStepChangeTrigger,exports.getDapOriginStore=getDapOriginStore,exports.getDapServiceLevel=getDapServiceLevel,exports.getDapSessionType=getDapSessionType,exports.getDapSessionTypeTrigger=getDapSessionTypeTrigger,exports.getDapUpgradeNotificationAction=getDapUpgradeNotificationAction,exports.getDapUpgradeNotificationType=getDapUpgradeNotificationType,exports.getDapWhatsAppTranslator=getDapWhatsAppTranslator,exports.getDictionary=getDictionary,exports.getExperiments=getExperiments,exports.getExperimentsData=getExperimentsData,exports.getExternalUrl=getExternalUrl,exports.getInstallationId=getInstallationId,exports.getSecondsSinceLastLogin=getSecondsSinceLastLogin,exports.getSessionType=getSessionType,exports.getSettings=getSettings,exports.getSupportedVoices=getSupportedVoices,exports.getTermbases=getTermbases,exports.getUserInfo=getUserInfo,exports.getUserState=getUserState,exports.getUserType=getUserType,exports.getUsersCharacterLimit=getUsersCharacterLimit,exports.getWebsiteIdFromWebsite=getWebsiteIdFromWebsite,exports.getWriteStyle=getWriteStyle,exports.handleJobs=handleJobs,exports.handleSuccessfulGmailTranslationsCount=handleSuccessfulGmailTranslationsCount,exports.handleSuccessfulGslidesTranslationsCount=handleSuccessfulGslidesTranslationsCount,exports.handleSuccessfulZendeskTranslationsCount=handleSuccessfulZendeskTranslationsCount,exports.improveWriting=improveWriting,exports.isPayloadNecessaryForUIEvent=isPayloadNecessaryForUIEvent,exports.isProServiceLevel=isProServiceLevel,exports.isUserLoggedIn=isUserLoggedIn,exports.jsonrpc_callFunction=jsonrpc_callFunction,exports.jsonrpc_composeMethodCallDict=jsonrpc_composeMethodCallDict$2,exports.listenToPerodicCodeExecution=listenToPerodicCodeExecution,exports.login=login,exports.loginRequest=loginRequest,exports.logout=logout,exports.logoutRequest=logoutRequest,exports.markLoginTimestamp=markLoginTimestamp,exports.messageListener=messageListener,exports.onContextMenuClicked=onContextMenuClicked,exports.onInstalled=onInstalled,exports.onStorageChanged=onStorageChanged,exports.openInternalPage=openInternalPage,exports.performGDocsProcessContent=performGDocsProcessContent,exports.performGDocsSplitText=performGDocsSplitText,exports.portListener=portListener,exports.processContent=processContent,exports.readData=readData,exports.rebuildGDocsSentenceFromPartialTranslation=rebuildGDocsSentenceFromPartialTranslation,exports.redirectToExternalURL=redirectToExternalURL,exports.requestAlternatives=requestAlternatives,exports.requestDictionary=requestDictionary,exports.resetGlossary=resetGlossary,exports.sendDAPAlternativeSelected=sendDAPAlternativeSelected,exports.sendDAPAlternativesEvent=sendDAPAlternativesEvent,exports.sendDAPBrowserInstanceIdCreated=sendDAPBrowserInstanceIdCreated,exports.sendDAPCloseInlineHighlighter=sendDAPCloseInlineHighlighter,exports.sendDAPCloseInputHighlighter=sendDAPCloseInputHighlighter,exports.sendDAPContentScriptErrorData=sendDAPContentScriptErrorData,exports.sendDAPCustomizationEnabled=sendDAPCustomizationEnabled,exports.sendDAPDeeplWriteEvent=sendDAPDeeplWriteEvent,exports.sendDAPDetectLanguage=sendDAPDetectLanguage,exports.sendDAPDictionaryStatus=sendDAPDictionaryStatus,exports.sendDAPDisabledDictionaryHover=sendDAPDisabledDictionaryHover,exports.sendDAPDocTransClick=sendDAPDocTransClick,exports.sendDAPErrorData=sendDAPErrorData,exports.sendDAPExtensionOpened=sendDAPExtensionOpened,exports.sendDAPFPTHide=sendDAPFPTHide,exports.sendDAPFTPBlockSizeExceeded=sendDAPFTPBlockSizeExceeded,exports.sendDAPGDocsMaxCharExceededShown=sendDAPGDocsMaxCharExceededShown,exports.sendDAPGDocsMaxCharExceededTryProClicked=sendDAPGDocsMaxCharExceededTryProClicked,exports.sendDAPGDocsReplaceText=sendDAPGDocsReplaceText,exports.sendDAPGlossaryEnabledOrDisabled=sendDAPGlossaryEnabledOrDisabled,exports.sendDAPGmailCharLimitReached=sendDAPGmailCharLimitReached,exports.sendDAPIconHover=sendDAPIconHover,exports.sendDAPInlineCopy=sendDAPInlineCopy,exports.sendDAPInlineDragStart=sendDAPInlineDragStart,exports.sendDAPInlineListen=sendDAPInlineListen,exports.sendDAPInlinePositionChange=sendDAPInlinePositionChange,exports.sendDAPInlineSettingOpened=sendDAPInlineSettingOpened,exports.sendDAPInputTranslationInjection=sendDAPInputTranslationInjection,exports.sendDAPInstallSuccess=sendDAPInstallSuccess,exports.sendDAPInstallationIdCreated=sendDAPInstallationIdCreated,exports.sendDAPLandingOnSpecificWebsite=sendDAPLandingOnSpecificWebsite,exports.sendDAPLingueeErrorData=sendDAPLingueeErrorData,exports.sendDAPLoggedIn=sendDAPLoggedIn,exports.sendDAPLoggedOut=sendDAPLoggedOut,exports.sendDAPLogin=sendDAPLogin,exports.sendDAPLogoClicked=sendDAPLogoClicked,exports.sendDAPLogout=sendDAPLogout,exports.sendDAPNotificationViewed=sendDAPNotificationViewed,exports.sendDAPOnboardingModalShown=sendDAPOnboardingModalShown,exports.sendDAPOnboardingOpenExternalPage=sendDAPOnboardingOpenExternalPage,exports.sendDAPOnboardingStepChange=sendDAPOnboardingStepChange,exports.sendDAPOpenDictionarySection=sendDAPOpenDictionarySection,exports.sendDAPOpenInlineHighlighter=sendDAPOpenInlineHighlighter,exports.sendDAPOpenInputHighlighter=sendDAPOpenInputHighlighter,exports.sendDAPReadMoreClicked=sendDAPReadMoreClicked,exports.sendDAPRecommendToAFriendClick=sendDAPRecommendToAFriendClick,exports.sendDAPRightClick=sendDAPRightClick,exports.sendDAPSeeAlternativesClicked=sendDAPSeeAlternativesClicked,exports.sendDAPSessionStarted=sendDAPSessionStarted,exports.sendDAPSettingsChanged=sendDAPSettingsChanged,exports.sendDAPShortcutUsed=sendDAPShortcutUsed,exports.sendDAPTrackAdsButtonClicked=sendDAPTrackAdsButtonClicked,exports.sendDAPTrackAdsShown=sendDAPTrackAdsShown,exports.sendDAPTrackIframeTranslationFailed=sendDAPTrackIframeTranslationFailed,exports.sendDAPTrackIframeTranslationSuccessful=sendDAPTrackIframeTranslationSuccessful,exports.sendDAPTrackLanguageDetectionForTextProcessing=sendDAPTrackLanguageDetectionForTextProcessing,exports.sendDAPTrackUpgradeNotificationAction=sendDAPTrackUpgradeNotificationAction,exports.sendDAPTrackUpgradeNotificationClosed=sendDAPTrackUpgradeNotificationClosed,exports.sendDAPTrackUpgradeNotificationDisplayed=sendDAPTrackUpgradeNotificationDisplayed,exports.sendDAPTranslateAcceptOrUndoEvent=sendDAPTranslateAcceptOrUndoEvent,exports.sendDAPTranslationErrorData=sendDAPTranslationErrorData,exports.sendDAPTranslationRequest=sendDAPTranslationRequest,exports.sendDAPTwitterTweetTranslationFailed=sendDAPTwitterTweetTranslationFailed,exports.sendDAPUILocationClicked=sendDAPUILocationClicked,exports.sendDAPUiAction=sendDAPUiAction,exports.sendDAPVoiceOverStops=sendDAPVoiceOverStops,exports.sendDAPWhatsAppMessageTranslated=sendDAPWhatsAppMessageTranslated,exports.sendDAPWhatsAppMessageTranslationFailed=sendDAPWhatsAppMessageTranslationFailed,exports.sendDAPZendeskCustomizationEvent=sendDAPZendeskCustomizationEvent,exports.sendDAPZendeskGlossaryConfigOpened=sendDAPZendeskGlossaryConfigOpened,exports.sendDAPtrackSessionType=sendDAPtrackSessionType,exports.sendNotification=sendNotification,exports.setAuthTokens=setAuthTokens,exports.setBrowserInstanceId=setBrowserInstanceId,exports.setUserInfoFromClientState=setUserInfoFromClientState,exports.simpleTextProcessor=simpleTextProcessor,exports.splitText=splitText,exports.splitTextRequest=splitTextRequest,exports.stopSpeech=stopSpeech,exports.testClassicApi=testClassicApi,exports.textToSpeech=textToSpeech,exports.trackAdsShown=trackAdsShown,exports.trackAlternativeSelected=trackAlternativeSelected,exports.trackAlternativesEvent=trackAlternativesEvent,exports.trackClickOnAdsButton=trackClickOnAdsButton,exports.trackCloseInlineHighlighter=trackCloseInlineHighlighter,exports.trackCloseInputHighlighter=trackCloseInputHighlighter,exports.trackCustomizationEnabled=trackCustomizationEnabled,exports.trackDeeplWriteEvent=trackDeeplWriteEvent,exports.trackDetectLanguage=trackDetectLanguage,exports.trackDictionaryStatus=trackDictionaryStatus,exports.trackDisabledDictionaryHover=trackDisabledDictionaryHover,exports.trackDocTransClick=trackDocTransClick,exports.trackExtensionOpenedEvent=trackExtensionOpenedEvent,exports.trackFptHide=trackFptHide,exports.trackGDocsMaxCharExceededTryProClicked=trackGDocsMaxCharExceededTryProClicked,exports.trackGDocsReplaceText=trackGDocsReplaceText,exports.trackGdocsMaxCharExceededShown=trackGdocsMaxCharExceededShown,exports.trackGlossaryDisabled=trackGlossaryDisabled,exports.trackGlossaryEnabled=trackGlossaryEnabled,exports.trackGmailCharLimitReached=trackGmailCharLimitReached,exports.trackIconHover=trackIconHover,exports.trackIframeTranslationFailed=trackIframeTranslationFailed,exports.trackIframeTranslationSuccessful=trackIframeTranslationSuccessful,exports.trackInlineCopy=trackInlineCopy,exports.trackInlineDragStart=trackInlineDragStart,exports.trackInlineListen=trackInlineListen,exports.trackInlinePositionChange=trackInlinePositionChange,exports.trackInlineSettingsOpened=trackInlineSettingsOpened,exports.trackInputTranslationInjection=trackInputTranslationInjection,exports.trackLandingOnWebsite=trackLandingOnWebsite,exports.trackLanguageDetectionForTextProcessing=trackLanguageDetectionForTextProcessing,exports.trackLingueeErrorData=trackLingueeErrorData,exports.trackLogoClickedEvent=trackLogoClickedEvent,exports.trackOnboardingModalShown=trackOnboardingModalShown,exports.trackOnboardingOpenExternalLink=trackOnboardingOpenExternalLink,exports.trackOnboardingStepChange=trackOnboardingStepChange,exports.trackOpenDictionarySection=trackOpenDictionarySection,exports.trackOpenInlineHighlighter=trackOpenInlineHighlighter,exports.trackOpenInputHighlighter=trackOpenInputHighlighter,exports.trackReadMoreClick=trackReadMoreClick,exports.trackRecommendToAFriendClick=trackRecommendToAFriendClick,exports.trackRightClick=trackRightClick,exports.trackSeeAlternativesClicked=trackSeeAlternativesClicked,exports.trackSettingChanged=trackSettingChanged,exports.trackTranslateAcceptOrUndoEvent=trackTranslateAcceptOrUndoEvent,exports.trackUILocationClicked=trackUILocationClicked,exports.trackUiAction=trackUiAction,exports.trackUpgradeNotificationAction=trackUpgradeNotificationAction,exports.trackUpgradeNotificationClosed=trackUpgradeNotificationClosed,exports.trackUpgradeNotificationDisplayed=trackUpgradeNotificationDisplayed,exports.trackUseOfShortcut=trackUseOfShortcut,exports.trackVoiceOverStops=trackVoiceOverStops,exports.trackZendeskCustomizationEvent=trackZendeskCustomizationEvent,exports.trackZendeskGlossaryOpened=trackZendeskGlossaryOpened,exports.translate=translate,exports.translateGmailReceivedEmail=translateGmailReceivedEmail,exports.translateHtmlRequest=translateHtmlRequest,exports.translateInlineRequest=translateInlineRequest,exports.translateInputRequest=translateInputRequest,exports.translateLinkedInPostRequest=translateLinkedInPostRequest,exports.translateSelection=translateSelection,exports.translateTwitterTweetRequest=translateTwitterTweetRequest,exports.translateWhatsAppMessageRequest=translateWhatsAppMessageRequest,exports.translateWhatsAppMessagesRequest=translateWhatsAppMessagesRequest,exports.translateZendeskInputRequest=translateZendeskInputRequest,exports.translateZendeskMessageRequest=translateZendeskMessageRequest,exports.triggerTranslateInline=triggerTranslateInline,exports.updateDynamicRules=updateDynamicRules,exports.updateITATargetLanguage=updateITATargetLanguage,exports.updateSession=updateSession,exports.updateTargetLanguageInITASession=updateTargetLanguageInITASession,exports.writeData=writeData,Object.defineProperty(exports,"__esModule",{value:!0}),exports}({});
//# sourceMappingURL=background.js.map
