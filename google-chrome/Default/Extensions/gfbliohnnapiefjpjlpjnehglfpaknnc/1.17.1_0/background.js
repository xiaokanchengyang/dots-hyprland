(()=>{"use strict";var __webpack_modules__={321:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function LOG(e,t){chrome.storage.local.get(["logLevels"],(n=>{const o=n&&n.logLevels||["error"];-1!==["log","warn","error"].indexOf(e)&&-1!==o.indexOf(e)&&console[e](t)}))}function regexFromString(str,highlight){var rxp=null;if(/^\/.+\/([gimuy]*)$/.test(str))try{rxp=eval(str)}catch(e){rxp=null}if(!rxp&&(/^\/.+$/.test(str)&&(rxp=eval(str+"/i")),!rxp))if(str=str.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&"),highlight)rxp=new RegExp(str.replace(/\s+/,"|"),"gi");else{var words=str.split(/\s+/).map((function(e){return`(?=.*${e})`})).join("");rxp=new RegExp(`^${words}.*$`,"gi")}return rxp}function filterByTitleOrUrl(e,t){if(t&&t.length){var n=regexFromString(t,!1);e=e.filter((function(e){return n.test(e.title)||n.test(e.url)}))}return e}__webpack_require__.d(__webpack_exports__,{$9:()=>LOG,kM:()=>filterByTitleOrUrl})}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](n,n.exports,__webpack_require__),n.exports}__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={};(()=>{var e=__webpack_require__(321);function t(e,t,n,o,r){n=n||{};const i=/(?:charset|encoding)\s*=\s*['"]? *([\w\-]+)/i;fetch(e,{method:void 0!==o?"POST":"GET",headers:n,body:o}).then((e=>{const t=e.headers.get("content-type")?e.headers.get("content-type").match(i):[];return Promise.all([Promise.resolve(t&&t.length>1?t[1]:"utf-8"),e.arrayBuffer()])})).then((e=>{const n=new TextDecoder(e[0]).decode(e[1]);t(n)})).catch((e=>{r&&r(e)}))}function n(e,t){var n={};return e.forEach((function(e){n[e]=t})),n}function o(e,t){for(var n in t)e[n]=t[n]}function r(e,t){var n;return t?(t instanceof Array||(t=[t]),n={},t.forEach((function(t){n[t]=e[t]}))):n=e,n}function i(e,n,o){e===chrome.storage.sync?(n.localPath&&(delete n.snippets,delete n.localPath),e.set(n,o)):n.localPath?(delete n.snippets,t(n.localPath,(function(t){n.snippets=t,e.set(n,o)}))):e.set(n,o)}var s=function(){var e={};var n,o="",r=[];function i(e,r){t(`https://api.github.com/gists/${o}/comments`,(function(e){r&&r(e)}),{Authorization:"token "+n},`{"body": "${encodeURIComponent(e)}"}`)}function s(e,r){t(`https://api.github.com/gists/${o}/comments/${e}`,(function(e){var t=JSON.parse(e);r({status:0,content:decodeURIComponent(t.body)})}),{Authorization:"token "+n})}function a(e){t(`https://api.github.com/gists/${o}/comments`,(function(t){r=JSON.parse(t).map((function(e){return e.id})),e(r)}),{Authorization:"token "+n})}function c(e,r,i){t(`https://api.github.com/gists/${o}/comments/${e}`,(function(e){i&&i(e)}),{Authorization:"token "+n},`{"body": "${encodeURIComponent(r)}"}`)}return e.initGist=function(e,r){if(n===e&&""!==o)return o;!function(e,n,o){t("https://api.github.com/gists",(function(r){var i=JSON.parse(r),s="";i.forEach((function(e){e.hasOwnProperty("description")&&e.description===n&&e.files.hasOwnProperty(n)&&(s=e.id)})),""===s?t("https://api.github.com/gists",(function(e){var t=JSON.parse(e);o(t.id)}),{Authorization:"token "+e},`{ "description": "${n}", "public": false, "files": { "${n}": { "content": "${n}" } } }`):o(s)}),{Authorization:"token "+e})}(n=e,"cloudboard",(function(e){o=e,r&&r(o)}))},e.readComment=function(e,t){""===o?t({status:1,content:"Please call initGist first!"}):e>=r.length?a((function(n){e<n.length?s(n[e],t):t({status:1,content:"Register not exists!"})})):s(r[e],t)},e.editComment=function(e,t,n){""===o?n({status:1,content:"Please call initGist first!"}):e>=r.length?a((function(o){if(e<o.length)c(o[e],t,n);else{var r=e-o.length+1;function s(){--r>0?i(".",s):0===r&&i(t,n)}s()}})):c(r[e],t,n)},e}();let a=!1;const c={};c.instance=function t(){return new Promise(((n,o)=>{const r=chrome.runtime.connectNative("surfingkeys"),i=function(){const e=new Uint32Array(8);return self.crypto.getRandomValues(e),Array.from(e).join("")}();r.onDisconnect.addListener((n=>{if(chrome.runtime.lastError)chrome.runtime.lastError.message;a?c.instance=t():(delete c.instance,(0,e.$9)("error","Failed to connect neovim, please make sure your neovim version 0.5 or above."))})),r.onMessage.addListener((async t=>{if(!0===t.status){if(a=!0,"serverStarted"===t.res.event){const e=`127.0.0.1:${t.res.port}/${i}`;n({url:e,nm:r})}}else t.err&&(0,e.$9)("error",t.err)})),r.postMessage({startServer:!0,password:i})}))}(),function(r){var a={},c=[],u=0,l=0,d=!1,f={},h={},p={},m=r._setNewTabUrl(),b={focusAfterClosed:"right",repeatThreshold:99,tabsMRUOrder:!0,newTabPosition:"default",showTabIndices:!1,interceptedErrors:[]},g=[];function w(e,t){var n=t;if(""===e.title||e.hasOwnProperty("url")&&void 0!==e.url||(n+="/"+e.title,g.push({id:e.id,title:n+"/"})),e.hasOwnProperty("children"))for(var o=0;o<e.children.length;++o)w(e.children[o],n)}function y(e,t){e.path.length?chrome.bookmarks.create({parentId:e.folder,title:e.path.shift()},(function(n){e.folder=n.id,y(e,t)})):chrome.bookmarks.create({parentId:e.folder,title:e.title,url:e.url},(function(e){t(e)}))}function v(e,n){r.loadRawSettings(e,(function(e){"string"==typeof e.proxy&&(e.proxy=[e.proxy],e.autoproxy_hosts=[e.autoproxy_hosts]),e.localPath?t(e.localPath,(function(t){e.snippets=t,n(e)}),void 0,void 0,(function(t){e.error="Failed to read snippets from "+e.localPath,n(e)})):n(e)}),{blocklist:{},marks:{},findHistory:[],cmdHistory:[],sessions:{},proxyMode:"clear",autoproxy_hosts:[],proxy:[]})}function x(e){if(h.hasOwnProperty(e)){const t=h[e];k(e,0,{subject:"setScrollPos",scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}),delete h[e]}}function k(e,t,n,o){-1===t?chrome.tabs.sendMessage(e,n):chrome.tabs.sendMessage(e,n,{frameId:t})}v(null,r._applyProxySettings),chrome.tabs.onRemoved.addListener((function(e){delete f[e],delete h[e],delete p[e],c=c.filter((function(t){return t!==e})),J.length&&chrome.tabs.create({active:!1,url:J.shift()}),R()}));var _=null;function T(e){_!==e&&(null!==_&&k(_,0,{subject:"tabDeactivated"}),k(e,0,{subject:"tabActivated"}),_=e)}function I(e){chrome.tabs.query({active:!0,currentWindow:!0},(function(t){t.length>0&&e(t[0])}))}function S(e,t,n){var o=a.pendingPorts.indexOf(e);-1!==o&&a.pendingPorts.splice(o,1),t(n)}function P(e,t,n){if(a.hasOwnProperty(e.action)){e.repeats>b.repeatThreshold&&(e.repeats=b.repeatThreshold);var o=a[e.action](e,t,n);if(e.needResponse)return o?(n(o),e.needResponse=!1):a.pendingPorts.push(e),e.needResponse}else console.log("[unexpected runtime message] "+JSON.stringify(e))}function L(e){chrome.tabs.query({},(function(t){t.forEach((function(t){k(t.id,-1,{subject:"settingsUpdated",settings:e})}))}))}function O(e,t){L(e),function(e,t){e.savedAt=(new Date).getTime(),i(chrome.storage.local,e,(function(){i(chrome.storage.sync,e,(function(){chrome.runtime.lastError&&chrome.runtime.lastError.message})),t&&t()}))}(e,t)}function R(){b.showTabIndices&&chrome.tabs.query({currentWindow:!0},(function(e){e.forEach((function(e){k(e.id,0,{subject:"tabIndexChange",index:e.index+1})}))}))}function q(e){return 0!==e.frameId&&"about:blank"===e.url?e.tab.url:e.url}function U(e,t,n,o){if(e.blocklist[".*"])return"disabled";if(t){if(e.blocklist[t.origin])return"disabled";if(n&&(n=new RegExp(n.source,n.flags)).test(t.href))return"disabled";if(o&&(o=new RegExp(o.source,o.flags)).test(t.href))return"lurking"}return"enabled"}function E(t,n){return t=t.filter((function(e){return e.url})),(0,e.kM)(t,n)}function C(e,t,n,o){r.getLatestHistoryItem(e,t,(e=>{o&&(e=e.sort((function(e,t){return t.visitCount-e.visitCount}))),n(e)}))}function A(e,t){chrome.windows.update(e,{focused:!0},(function(){chrome.tabs.update(t,{active:!0})}))}function M(e,t){return e<0?e=0:e>=t&&(e=t),e}function $(e,t){e?chrome.tabs.query({windowId:e.windowId},(function(n){0==e.index&&-1==t?t=n.length-1:e.index==n.length-1&&1==t&&(t=1-n.length);var o=M(e.index+t,n.length-1);chrome.tabs.update(n[o].id,{active:!0})})):I((function(e){$(e,t)}))}function j(e,t,n){e?chrome.tabs.query({windowId:e.windowId},(function(o){var r=o.map((function(e){return e.id}));t=M(t,o.length);var i=function(e,t,n){return t>n-e&&(e-=t-(n-e)),e}(e.index,t,o.length);n(r.slice(i,i+t))})):I((function(e){j(e,t,n)}))}function G(e,t){chrome.tabs.query({currentWindow:!0},(function(n){n=n.map((function(e){return e.id})),chrome.tabs.remove(n.slice(e.tab.index+(t<0?t:1),e.tab.index+(t<0?0:1+t)))}))}chrome.tabs.onUpdated.addListener((function(e,t,n){"complete"===t.status&&n.active&&T(e),r.detectTabTitleChange&&t.title&&k(e,0,{subject:"titleChanged",changeInfo:t})})),chrome.windows.onFocusChanged.addListener((function(e){I((function(e){T(e.id)}))})),chrome.tabs.onCreated.addListener((function(e){R()})),chrome.tabs.onMoved.addListener((function(){R()})),chrome.tabs.onActivated.addListener((function(e){d||e.tabId==c[c.length-1]||(c.length>10&&c.shift(),u!=c.length-1&&c.splice(u+1,c.length-1),c.push(e.tabId),u=c.length-1),f[e.tabId]=(new Date).getTime(),T(e.tabId),d=!1,l=0,R()})),chrome.tabs.onDetached.addListener((function(){R()})),chrome.tabs.onAttached.addListener((function(){R()})),chrome.commands.onCommand.addListener((function(e){switch(e){case"restartext":chrome.tabs.query({},(function(e){e.forEach((function(e){chrome.tabs.reload(e.id)})),chrome.runtime.reload()}));break;case"previousTab":case"nextTab":I((function(t){var n="previousTab"===e?t.index-1:t.index+1;chrome.tabs.query({windowId:t.windowId},(function(e){n=(n%e.length+e.length)%e.length,chrome.tabs.update(e[n].id,{active:!0})}))}));break;case"closeTab":I((function(e){chrome.tabs.remove(e.id)}));break;case"proxyThis":I((function(e){V({host:new URL(e.url||e.pendingUrl).host,operation:"toggle"},(function(){chrome.tabs.reload(e.id,{bypassCache:!0})}))}))}})),a.pendingPorts=[],chrome.runtime.onMessage.addListener(P),chrome.runtime.onUserScriptMessage.addListener(((e,t,n)=>{e.fromUserScript=!0,P(e,t,n)})),a.toggleBlocklist=function(e,t,n){v("blocklist",(function(o){var r=".*",i=t.origin||new URL(q(t)).origin;0!==chrome.runtime.getURL("/").indexOf(i)&&"null"!==i&&(r=i),o.blocklist.hasOwnProperty(r)?delete o.blocklist[r]:o.blocklist[r]=1,O({blocklist:o.blocklist},(function(){n({state:U(o,t.tab?new URL(q(t)):null,e.blocklistPattern,e.lurkingPattern),blocklist:o.blocklist,url:r})}))}))},a.toggleMouseQuery=function(e,t,n){v("mouseSelectToQuery",(function(n){if(t.tab&&0!==t.tab.url.indexOf(chrome.runtime.getURL("/"))){var o=n.mouseSelectToQuery||[],r=o.indexOf(e.origin);-1===r?o.push(e.origin):o.splice(r,1),O({mouseSelectToQuery:o})}}))},a.getState=function(e,t,n){v(["blocklist","noPdfViewer"],(function(o){t.tab&&S(e,n,{noPdfViewer:o.noPdfViewer,state:U(o,new URL(q(t)),e.blocklistPattern,e.lurkingPattern)})}))},a.addVIMark=function(e,t,n){v("marks",(function(t){o(t.marks,e.mark),O({marks:t.marks})}))},a.jumpVIMark=function(e,t,n){v("marks",(function(o){var r=o.marks;if(r.hasOwnProperty(e.mark)){var i=r[e.mark];chrome.tabs.query({},(function(e){0===(e=e.filter((function(e){return e.url===i.url}))).length?(i.tab={tabbed:!0,active:!0},a.openLink(i,t,n)):((i.scrollLeft||i.scrollTop)&&(h[e[0].id]={scrollLeft:i.scrollLeft,scrollTop:i.scrollTop}),e[0].id===t.tab.id?x(e[0].id):chrome.tabs.update(e[0].id,{active:!0}))}))}}))},a.resetSettings=function(e,t,n){chrome.storage.local.clear(),chrome.storage.sync.clear(),v(null,(function(t){r._applyProxySettings(t),S(e,n,{settings:t}),L(t)}))},a.loadSettingsFromUrl=function(e,n,o){var r,i;r=e.url,i=function(t){S(e,o,t)},t(r,(function(e){O({localPath:r,snippets:e}),i({status:"Succeeded",snippets:e})}),void 0,void 0,(function(e){i({status:"Failed"})}))},a.getRecentlyClosed=function(e,t,n){chrome.sessions.getRecentlyClosed({},(function(t){for(var o=[],r=0;r<t.length;r++){var i=t[r];i.hasOwnProperty("window")?o=o.concat(i.window.tabs):i.hasOwnProperty("tab")&&o.push(i.tab)}o=E(o,e.query),S(e,n,{urls:o})}))},a.getTopSites=function(e,t,n){chrome.topSites?chrome.topSites.get((function(t){t=E(t,e.query),S(e,n,{urls:t})})):S(e,n,{urls:[]})},a.getAllURLs=function(e,t,n){chrome.bookmarks.search(e.query||{},(function(t){var o=t,r=e.maxResults||100,i=r-o.length;i>0?C(e.query||"",i,(function(t){o=o.concat(t),S(e,n,{urls:o})}),!0):S(e,n,{urls:o.slice(0,r)})}))},a.getTabs=function(e,t,n){var o=t.tab,r=e.queryInfo||{};chrome.tabs.query(r,(function(t){(t=E(t,e.filter)).length>e.tabsThreshold&&b.tabsMRUOrder&&(t=t.filter((function(e){return e.id!==o.id}))).sort((function(e,t){var n=f[e.id],o=f[t.id];return isFinite(n)||isFinite(o)?isFinite(n)?isFinite(o)?o-n:-1:1:0})),S(e,n,{tabs:t})}))},a.togglePinTab=function(e,t,n){I((function(e){return chrome.tabs.update(e.id,{pinned:!e.pinned})}))},a.focusTab=function(e,t,n){void 0!==e.windowId&&t.tab.windowId!==e.windowId?A(e.windowId,e.tabId):chrome.tabs.update(e.tabId,{active:!0})},a.focusTabByIndex=function(e,t,n){var o=e.queryInfo||{currentWindow:!0};chrome.tabs.query(o,(function(t){e.repeats>0&&e.repeats<=t.length&&chrome.tabs.update(t[e.repeats-1].id,{active:!0})}))},a.goToLastTab=function(e,t,n){if(c.length>1){var o=c[c.length-2];chrome.tabs.update(o,{active:!0})}},a.historyTab=function(e,t,n){if(c.length>0){d=!0,e.hasOwnProperty("index")?u=(parseInt(e.index)+c.length)%c.length:(u+=e.backward?-1:1)<0?u=0:u>=c.length&&(u=c.length-1);const t=c[u];chrome.tabs.update(t,{active:!0})}},a.nextTab=function(e,t,n){$(t.tab,e.repeats)},a.previousTab=function(e,t,n){$(t.tab,-e.repeats)},a.reloadTab=function(e,t,n){j(t.tab,e.repeats,(function(t){t.forEach((function(t){chrome.tabs.reload(t,{bypassCache:e.nocache})}))}))},a.closeTab=function(e,t,n){j(t.tab,e.repeats,(function(e){chrome.tabs.remove(e,(function(){"left"===b.focusAfterClosed?$(t.tab,-1):"last"===b.focusAfterClosed&&a.historyTab({backward:!0})}))}))},a.closeTabLeft=function(e,t,n){G(t,-e.repeats)},a.closeTabRight=function(e,t,n){G(t,e.repeats)},a.closeTabsToLeft=function(e,t,n){G(t,-t.tab.index)},a.closeTabsToRight=function(e,t,n){chrome.tabs.query({currentWindow:!0},(function(e){G(t,e.length-t.tab.index)}))},a.tabOnly=function(e,t,n){chrome.tabs.query({currentWindow:!0},(function(e){e=e.filter((function(e){return e.id!=t.tab.id&&!e.pinned})).map((function(e){return e.id})),chrome.tabs.remove(e)}))},a.closeAudibleTab=function(e,t,n){chrome.tabs.query({audible:!0},(function(e){e&&chrome.tabs.remove(e[0].id)}))},a.muteTab=function(e,t,n){var o=t.tab;chrome.tabs.update(o.id,{muted:!o.mutedInfo.muted})},a.openLast=function(e,t,n){chrome.sessions.restore()},a.duplicateTab=function(e,t,n){chrome.tabs.duplicate(t.tab.id,(function(){!1===e.active&&chrome.tabs.update(t.tab.id,{active:!0})}))};let F=-1;function N(e,t,n){return e.filter((function(e){var o=e.title,r=e.url;return n||(o=o.toLowerCase(),r=r&&r.toLowerCase(),t=t.toLowerCase()),-1!==o.indexOf(t)||r&&-1!==r.indexOf(t)}))}function D(e,t,n){var o;if(e)switch(b.newTabPosition){case"left":o=e.index;break;case"right":o=e.index+1;break;case"first":o=0;break;case"last":break;default:o=e.index+1+l,l++}chrome.tabs.create({url:t,active:n.tab.active,index:o,pinned:n.tab.pinned,openerTabId:e.id},(function(e){(n.scrollLeft||n.scrollTop)&&(h[e.id]={scrollLeft:n.scrollLeft,scrollTop:n.scrollTop})}))}function B(){try{if(chrome.userScripts)return!0}catch{return!1}return!1}function W(){chrome.windows.getAll({populate:!1},(function(e){e.forEach((function(e){chrome.windows.remove(e.id)}))}))}function V(e,t){v(["proxyMode","proxy","autoproxy_hosts"],(function(o){if("deleteProxyPair"===e.operation)o.proxy.splice(e.number,1),o.autoproxy_hosts.splice(e.number,1);else if("set"===e.operation)o.proxyMode=e.mode,o.proxy=e.proxy,o.autoproxy_hosts=e.host;else if(e.mode&&(o.proxyMode=e.mode),e.number||(e.number=0),e.proxy&&(o.proxy[e.number]=e.proxy,o.autoproxy_hosts.length<=e.number&&(o.autoproxy_hosts[e.number]=[])),e.host){var i=n(o.autoproxy_hosts[e.number],1),s=e.host.split(/\s*[ ,\n]\s*/);"toggle"===e.operation?s.forEach((function(e){i.hasOwnProperty(e)?delete i[e]:i[e]=1})):"add"===e.operation?s.forEach((function(e){i[e]=1})):s.forEach((function(e){delete i[e]})),o.autoproxy_hosts[e.number]=Object.keys(i)}var a={autoproxy_hosts:o.autoproxy_hosts,proxyMode:o.proxyMode,proxy:o.proxy};O(a),r._applyProxySettings(o),t&&t(a)}))}function H(e,t){chrome.bookmarks.search({url:e},(function(e){e.forEach((function(e){chrome.bookmarks.remove(e.id)})),t&&t()}))}a.getWindows=function(e,t,n){chrome.tabs.query({currentWindow:!1},(function(t){const o={};t.forEach((e=>{const t=o[e.windowId]||[];t.push({title:e.title,url:e.url}),o[e.windowId]=t})),S(e,n,{windows:Object.keys(o).map((e=>({id:e,tabs:o[e],isPreviousChoice:parseInt(e)===F})))})}))},a.moveToWindow=function(e,t,n){-1===e.windowId?chrome.windows.create({tabId:t.tab.id}):chrome.tabs.move(t.tab.id,{windowId:e.windowId,index:-1},(()=>{A(e.windowId,t.tab.id)})),F=e.windowId},a.gatherWindows=function(e,t,n){const o=t.tab.windowId;chrome.tabs.query({currentWindow:!1},(function(e){e.forEach((function(e){chrome.tabs.move(e.id,{windowId:o,index:-1})}))}))},a.gatherTabs=function(e,t,n){const o=t.tab.windowId;e.tabs.forEach((function(e){chrome.tabs.move(e.id,{windowId:o,index:-1})}))},a.getBookmarkFolders=function(e,t,n){chrome.bookmarks.getTree((function(t){g=[],w(t[0],""),S(e,n,{folders:g})}))},a.createBookmark=function(e,t,n){H(e.page.url,(function(){y(e.page,(function(t){S(e,n,{bookmark:t})}))}))},a.getBookmarks=function(e,t,n){e.parentId?chrome.bookmarks.getSubTree(e.parentId,(function(t){var o=t[0].children;e.query&&e.query.length&&(o=N(o,e.query,e.caseSensitive)),S(e,n,{bookmarks:o})})):e.query&&e.query.length?chrome.bookmarks.search(e.query,(function(t){S(e,n,{bookmarks:N(t,e.query,e.caseSensitive)})})):chrome.bookmarks.getTree((function(t){S(e,n,{bookmarks:t[0].children})}))},a.getHistory=function(e,t,n){C(e.query||"",e.maxResults||100,(function(t){S(e,n,{history:t})}),e.sortByMostUsed)},a.addHistories=function(e,t,n){e.history.forEach((e=>{chrome.history.addUrl({url:e})}))},a.openLink=function(e,t,n){var o=function(e){return!/^view-source:|^javascript:/.test(e)&&/^(?:https?:\/\/)?(?:[^@\/\n]+@)?(?:www\.)?([^:\/\n]+)/im.test(e)&&(/^[\w-]+?:/i.test(e)||(e="http://"+e)),e}(e.url);o.startsWith("javascript:")?k(t.tab.id,0,{subject:"showBanner",message:"JavaScript URLs are not allowed in such operation."}):e.tab.tabbed?0!==t.frameId&&chrome.runtime.getURL("pages/frontend.html")===t.url||!t.tab?I((function(t){D(t,o,e)})):D(t.tab,o,e):chrome.tabs.update({url:o,pinned:e.tab.pinned||t.tab.pinned},(function(t){(e.scrollLeft||e.scrollTop)&&(h[t.id]={scrollLeft:e.scrollLeft,scrollTop:e.scrollTop})}))},a.viewSource=function(e,t,n){e.url="view-source:"+t.tab.url,a.openLink(e,t,n)},a.getSettings=function(e,t,n){var o=v;"RAW"===e.key&&(o=r.loadRawSettings,e.key=""),o(e.key,(function(t){void 0===e.key&&function(e){if(e.useNeovim=!!r.nvimServer.instance,e.isUserScriptsAvailable=B(),e.showAdvanced=e.isUserScriptsAvailable&&e.showAdvanced,e.isUserScriptsAvailable){const t="settingsSnippets";if(e.showAdvanced&&e.snippets){const n=e.snippets;chrome.userScripts.getScripts({ids:[t]},(e=>{const o=`import('./api.js').then((module) => {module.default("${chrome.runtime.getURL("/")}", (api, settings) => {${n}\n})});`,r=()=>{chrome.userScripts.register([{id:t,matches:["*://*/*"],js:[{code:o}]}])};e.length>0?e[0].js[0].code!==o&&chrome.userScripts.unregister({ids:[t]},r):r()}))}else chrome.userScripts.getScripts({ids:[t]},(e=>{e.length>0&&chrome.userScripts.unregister({ids:[t]})}))}}(t),S(e,n,{settings:t})}))},a.updateSettings=function(e,t,n){let o="";if("snippets"===e.scope)for(var r in e.settings)b.hasOwnProperty(r)&&(b[r]=e.settings[r]);else e.settings.showAdvanced?B()?(chrome.userScripts.configureWorld({csp:"script-src 'self' 'unsafe-eval'",messaging:!0}),O(e.settings)):o="Advanced mode is only available when Developer mode is turned on from chrome://extensions/.":O(e.settings);return{error:o}},a.setSurfingkeysIcon=function(e,t,n){let o="icons/48.png";"disabled"===e.status?o="icons/48-x.png":"lurking"===e.status&&(o="icons/48-l.png"),chrome.action.setIcon({path:o,tabId:t.tab?t.tab.id:void 0})},a.request=function(e,n,o){t(e.url,(function(t){S(e,o,{text:t})}),e.headers,e.data)},a.requestImage=function(e,t,n){fetch(e.url,{method:"GET"}).then((e=>e.blob())).then((e=>createImageBitmap(e))).then((t=>{const o=new OffscreenCanvas(t.width,t.height);o.getContext("2d").drawImage(t,0,0,o.width,o.height),o.convertToBlob().then((t=>{const o=new FileReader;o.onload=function(t){S(e,n,{text:t.target.result})},o.readAsDataURL(t)}))})).catch((t=>{S(e,n,{text:""})}))},a.nextFrame=function(e,t,n){const o=t.tab.id;chrome.scripting.executeScript({target:{allFrames:!0,tabId:o},func:()=>"function"==typeof getFrameId?getFrameId():0},(function(t){if((t=t.map((e=>e.result)).filter((e=>e))).length>0){let n=0;for(n=0;n<t.length&&t[n]!==e.frameId;n++);n=n===t.length-1?0:n+1,k(o,-1,{subject:"focusFrame",frameId:t[n]})}}))},a.moveTab=function(e,t,n){chrome.tabs.query({windowId:t.tab.windowId},(function(n){var o=M(t.tab.index+e.step*e.repeats,n.length);chrome.tabs.move(t.tab.id,{index:o})}))},a.quit=function(e,t,n){W()},a.createSession=function(e,t,n){v("sessions",(function(t){chrome.tabs.query({},(function(n){var o={};n.forEach((function(e){e&&void 0!==e.index&&(o.hasOwnProperty(e.windowId)||(o[e.windowId]=[]),e.url!==m&&o[e.windowId].push(e.url))}));var r=[];for(var i in o)o[i].length&&r.push(o[i]);t.sessions[e.name]={},t.sessions[e.name].tabs=r,O({sessions:t.sessions},e.quitAfterSaved?W:void 0)}))}))},a.openSession=function(e,t,n){v("sessions",(function(t){if(t.sessions.hasOwnProperty(e.name)){var n=t.sessions[e.name].tabs;n[0].forEach((function(e){chrome.tabs.create({url:e,active:!1,pinned:!1})}));for(var o=1;o<n.length;o++){var r=n[o];chrome.windows.create({},(function(e){r.forEach((function(t){chrome.tabs.create({windowId:e.id,url:t,active:!1,pinned:!1})}))}))}chrome.tabs.query({url:m},(function(e){chrome.tabs.remove(e.map((function(e){return e.id})))}))}}))},a.deleteSession=function(e,t,n){v("sessions",(function(t){delete t.sessions[e.name],O({sessions:t.sessions})}))},a.closeDownloadsShelf=function(e,t,n){e.clearHistory?chrome.downloads.erase({urlRegex:".*"}):(chrome.downloads.setShelfEnabled(!1),chrome.downloads.setShelfEnabled(!0))},a.getDownloads=function(e,t,n){chrome.downloads.search(e.query,(function(t){S(e,n,{downloads:t})}))},a.download=function(e,t,n){chrome.downloads.download({url:e.url,saveAs:e.saveAs})},a.tabURLAccessed=function(e,t,n){if(t.tab){var o=t.tab.id;return x(o),p.hasOwnProperty(o)||(p[o]={}),p[o][e.url]=e.title,{active:t.tab.active,index:b.showTabIndices?t.tab.index+1:0}}return{}},a.getTabURLs=function(e,t,n){var o=p[t.tab.id]||{};return{urls:o=Object.keys(o).map((function(e){return{url:e,title:o[e]}}))}},a.getTopURL=function(e,t,n){return{url:t.tab?t.tab.url:""}},a.updateProxy=function(e,t,n){V(e,(function(t){S(e,n,t)}))},a.setZoom=function(e,t,n){var o=t.tab.id,r=e.zoomFactor*e.repeats;0==r?chrome.tabs.setZoom(o,1):chrome.tabs.getZoom(o,(function(e){chrome.tabs.setZoom(o,e+r)}))},a.removeURL=function(e,t,n){var o=0,r=e.uid.length,i=e.uid;function s(){++o===r&&S(e,n,{response:"Done"})}"string"==typeof e.uid&&(r=1,i=[e.uid]),i.forEach((function(e){!function(e,t){var n=e[0];e=e.substr(1),"B"===n?chrome.bookmarks.remove(e,t):"H"===n?chrome.history.deleteUrl({url:e},t):"T"===n?(e=e.split(":").map((function(e){return parseInt(e)})),chrome.windows.update(e[0],{focused:!0},(function(){chrome.tabs.remove(e[1],t)}))):"M"===n&&v("marks",(function(n){delete n.marks[e],O({marks:n.marks},t)}))}(e,s)}))},a.localData=function(e,t,n){e.data.constructor===Object?(chrome.storage.local.set(e.data,(function(){})),L(e.data)):chrome.storage.local.get(e.data,(function(t){S(e,n,{data:t})}))},a.captureVisibleTab=function(e,t,n){chrome.tabs.captureVisibleTab(null,{format:"png"},(function(t){S(e,n,{dataUrl:t})}))},a.getCaptureSize=function(e,t,n){var o=document.createElement("img");o.onload=function(){S(e,n,{width:o.width,height:o.height})},chrome.tabs.captureVisibleTab(null,{format:"png"},(function(e){o.src=e}))},a.deleteHistoryOlderThan=function(e,t,n){var o=e.days||0,r=e.hours||0;chrome.history.deleteRange({startTime:0,endTime:(new Date).getTime()-1e3*(86400*o+3600*r)},(function(){}))},a.removeBookmark=function(e,t,n){H(t.tab.url)},a.getBookmark=function(e,t,n){chrome.bookmarks.search({url:t.tab.url},(function(t){S(e,n,{bookmarks:t})}))},a.initGist=function(e,t,n){return s.initGist(e.token,(function(t){S(e,n,{gist:t})}))},a.readComment=function(e,t,n){s.readComment(e.index,(function(t){S(e,n,t)}))},a.editComment=function(e,t,n){s.editComment(e.index,e.content,(function(t){S(e,n,{gistResp:t})}))};var J=[];a.queueURLs=function(e,t,n){J=J.concat(e.urls)},a.getQueueURLs=function(e,t,n){return{queueURLs:J}},a.clearQueueURLs=function(e,t,n){J=[]},a.getVoices=function(e,t,n){chrome.tts.getVoices((function(t){S(e,n,{voices:t})}))},a.read=function(e,t,n){var o=e.options||{};o.onEvent=function(o){"start"===o.type?S(e,n,{ttsEvent:o}):k(t.tab.id,-1,{subject:"onTtsEvent",ttsEvent:o})},chrome.tts.speak(e.content,o)},a.stopReading=function(e,t,n){chrome.tts.stop()},a.openIncognito=function(e,t,n){chrome.windows.create({url:e.url,incognito:!0})},a.writeClipboard=function(e,t,n){navigator.clipboard.writeText(e.text)},a.readClipboard=function(e,t,n){chrome.runtime.sendNativeMessage("application.id",{message:"Clipboard.read"},(function(t){S(e,n,t)}))},a.getContainerName=r._getContainerName(a,S),chrome.runtime.setUninstallURL("http://brookhong.github.io/2018/01/30/why-did-you-uninstall-surfingkeys.html"),a.connectNative=function(e,t,n){r.nvimServer&&r.nvimServer.instance&&r.nvimServer.instance.then((({url:t,nm:o})=>{o.postMessage({mode:e.mode}),S(e,n,{url:t})})).catch((t=>{S(e,n,{error:t})}))}}({detectTabTitleChange:!0,getLatestHistoryItem:function(t,n,o){t.toLowerCase();let r=(new Date).getTime(),i=[];const s=(n,o,r)=>{const a=o*Math.pow(10,Math.min(2,t.length));chrome.history.search({startTime:0,endTime:n,text:"",maxResults:a},(function(a){const c=(0,e.kM)(a,t);i=[...i,...c],a.length<o||i.length>=o?r(i.slice(0,o)):(n=a[a.length-1].lastVisitTime-.01,s(n,o,r))}))};s(r,n,o)},loadRawSettings:function(e,t,n){var s=n||{};chrome.storage.local.get(null,(function(n){var a=n.savedAt||0;chrome.storage.sync.get(null,(function(c){var u=c.savedAt||0;a>u?(o(s,n),i(chrome.storage.sync,n,(function(){var n=r(s,e);chrome.runtime.lastError&&(n.error="Settings sync may not work thoroughly because of: "+chrome.runtime.lastError.message),t(n)}))):a<u?(o(s,c),t(r(s,e)),i(chrome.storage.local,c)):(o(s,n),t(r(s,e)))}))}))},nvimServer:c,_applyProxySettings:function(e){if(e.proxyMode&&"clear"!==e.proxyMode){var t=e.autoproxy_hosts.map((function(e){return e.filter((function(e){return-1!==e.indexOf("*")})).join("|")})),o=e.autoproxy_hosts.map((function(e){return n(e.filter((function(e){return-1===e.indexOf("*")})),1)})),r={mode:-1!==["always","byhost","bypass"].indexOf(e.proxyMode)?"pac_script":e.proxyMode,pacScript:{data:`var pacGlobal = {\n                        hosts: ${JSON.stringify(o)},\n                        autoproxy_pattern: ${JSON.stringify(t)},\n                        proxyMode: '${e.proxyMode}',\n                        proxy: ${JSON.stringify(e.proxy)}\n                    };\n                    function FindProxyForURL(url, host) {\n                        var lastPos;\n                        if (pacGlobal.proxyMode === "always") {\n                            return pacGlobal.proxy[0];\n                        } else if (pacGlobal.proxyMode === "bypass") {\n                            var pp = new RegExp(pacGlobal.autoproxy_pattern[0]);\n                            do {\n                                if (pacGlobal.hosts[0].hasOwnProperty(host)\n                                    || (pacGlobal.autoproxy_pattern[0].length && pp.test(host))) {\n                                    return "DIRECT";\n                                }\n                                lastPos = host.indexOf('.') + 1;\n                                host = host.slice(lastPos);\n                            } while (lastPos >= 1);\n                            return pacGlobal.proxy[0];\n                        } else {\n                            for (var i = 0; i < pacGlobal.proxy.length; i++) {\n                                var pp = new RegExp(pacGlobal.autoproxy_pattern[i]);\n                                var ahost = host;\n                                do {\n                                    if (pacGlobal.hosts[i].hasOwnProperty(ahost)\n                                        || (pacGlobal.autoproxy_pattern[i].length && pp.test(ahost))) {\n                                        return pacGlobal.proxy[i];\n                                    }\n                                    lastPos = ahost.indexOf('.') + 1;\n                                    ahost = ahost.slice(lastPos);\n                                } while (lastPos >= 1);\n                            }\n                            return "DIRECT";\n                        }\n                    }`}};chrome.proxy.settings.set({value:r,scope:"regular"},(function(){}))}else chrome.proxy.settings.clear({scope:"regular"})},_setNewTabUrl:function(){return"chrome://newtab/"},_getContainerName:function(e,t){}})})()})();